M.define("/js/Dropdown",function(c,b,d){function a(e){this.$nav=typeof e.nav==="string"?$(e.nav):e.nav;this.$panel=typeof e.panel==="string"?$(e.panel):e.panel;this.showCallback=e.showCallback;this.hideCallback=e.hideCallback;this.delay=e.delay||0;this.event=e.event||"mouseenterleave";this._isShow=false;this.init()}a.prototype={init:function(){if(this.event==="mouseenterleave"){this.$nav.on("mouseenter.dropdown",M.bind(function(e){this.show()},this)).on("mouseleave.dropdown",M.bind(function(e){if($(e.relatedTarget).closest(this.$panel).length===0){this.hide(true)}},this));this.$panel.on("mouseenter.dropdown",M.bind(function(e){this.show()},this)).on("mouseleave.dropdown",M.bind(function(e){if($(e.relatedTarget).closest(this.$nav).length===0){this.hide(false)}},this))}if(this.event==="click"){this.$nav.on("click.dropdown",M.bind(function(e){this.show()},this));$(document).on("click.dropdown",M.bind(function(e){if($(e.target).closest(this.$nav).length===0&&$(e.target).closest(this.$panel).length===0){this.hide(false)}},this))}},show:function(){this.$panel.show();this._isShow=true;if(M.isFunction(this.showCallback)){this.showCallback.call(this,this.$nav,this.$panel)}},hide:function(e){this._isShow=false;if(e&&this.delay>0){setTimeout(M.bind(function(){if(!this._isShow){this.$panel.hide();if(M.isFunction(this.hideCallback)){this.hideCallback.call(this,this.$nav,this.$panel)}}},this),this.delay)}else{this.$panel.hide();if(M.isFunction(this.hideCallback)){this.hideCallback.call(this,this.$nav,this.$panel)}}},destory:function(){if(this.event==="mouseenterleave"){this.$nav.off("mouseenter.dropdown").off("mouseleave.dropdown");this.$panel.off("mouseenter.dropdown").off("mouseleave.dropdown")}if(this.event==="click"){this.$nav.off("click.dropdown")}this.$panel.hide()}};d.exports=a});M.define("/js/pageletcommon/pageHeadUserInfoWWWNormal",function(c){var a=c("/js/Dropdown"),b=window.Env||{};return{events:{},init:function(){var k=$("#head-btn-daka");$(function(){$(".new_daka_tips").addClass("on")});$(".ndt_close").on("click",function(){$(this).parent().hide()});M.Event.on("afterDaka",l);function l(q){if(q&&q.dakaFlag){k.closest(".head-daka").addClass("daka-complete")}}var e=i("dakaday");if(e!==null){$(".head-btn-daka").attr("data-day",e)}function i(q){var s=new RegExp("(^|&)"+q+"=([^&]*)(&|$)");var t=window.location.search.substr(1).match(s);if(t!==null){return unescape(t[2])}return null}var g=new a({nav:"#_j_head_user",panel:"#_j_user_panel",showCallback:function(q,r){q.find(".drop-trigger").addClass("drop-trigger-active")},hideCallback:function(q,r){q.find(".drop-trigger").removeClass("drop-trigger-active")},delay:500});var d=0,p=$("#_j_head_msg"),o=$("#_j_msg_panel"),n=p.find(".head-msg-new"),j=$("#_j_msg_float_panel");var f=new a({nav:p.selector,panel:o.selector,showCallback:function(q,r){q.find(".drop-trigger").addClass("drop-trigger-active")},hideCallback:function(q,r){q.find(".drop-trigger").removeClass("drop-trigger-active")},delay:200});M.Event.on("get new msg",function(q){if(q.msg||d>0){o.find("ul").html(q.menu_index);h()}});o.on("click","a",function(q){M.Event.fire("update msg")});j.on("click","ul a",function(q){M.Event.fire("update msg")});j.on("click",".close-newmsg",function(q){m()});function m(){n.hide();j.hide();$.ajax({url:"http://"+b.WWW_HOST+"/ajax/ajax_msg.php",dataType:"jsonp",data:{a:"ignore",from:"1"},success:function(q){M.Event.fire("update msg")}})}window.close_msg_tips=m;function h(){var q="";d=0;o.find(".num").each(function(r,t){var s=$(t);d+=Number(s.html());q+="<li>"+s.closest("li").html()+"</li>"});if(d>0){n.html((d>99?"99+":d)).show();j.find("ul").html(q).end().show()}else{n.hide();j.hide()}}h()}}});
/*!
 * jQuery Templates Plugin 1.0.0pre
 * http://github.com/jquery/jquery-tmpl
 * Requires jQuery 1.4.2
 *
 * Copyright 2011, Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
(function(i,f){var t=i.fn.domManip,h="_tmplitem",u=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,p={},e={},y,x={key:0,data:{}},w=0,q=0,g=[];function k(B,A,D,E){var C={data:E||(E===0||E===false)?E:(A?A.data:{}),_wrap:A?A._wrap:null,tmpl:null,parent:A||null,nodes:[],calls:c,nest:b,wrap:n,html:r,update:z};if(B){i.extend(C,B,{nodes:[],parent:A})}if(D){C.tmpl=D;C._ctnt=C._ctnt||C.tmpl(i,C);C.key=++w;(g.length?e:p)[w]=C}return C}i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(A,B){i.fn[A]=function(C){var F=[],I=i(C),E,G,D,J,H=this.length===1&&this[0].parentNode;y=p||{};if(H&&H.nodeType===11&&H.childNodes.length===1&&I.length===1){I[B](this[0]);F=this}else{for(G=0,D=I.length;G<D;G++){q=G;E=(G>0?this.clone(true):this).get();i(I[G])[B](E);F=F.concat(E)}q=0;F=this.pushStack(F,A,I.selector)}J=y;y=null;i.tmpl.complete(J);return F}});i.fn.extend({tmpl:function(C,B,A){return i.tmpl(this[0],C,B,A)},tmplItem:function(){return i.tmplItem(this[0])},template:function(A){return i.template(A,this[0])},domManip:function(E,H,G,I){if(E[0]&&i.isArray(E[0])){var B=i.makeArray(arguments),A=E[0],F=A.length,C=0,D;while(C<F&&!(D=i.data(A[C++],"tmplItem"))){}if(D&&q){B[2]=function(J){i.tmpl.afterManip(this,J,G)}}t.apply(this,B)}else{t.apply(this,arguments)}q=0;if(!y){i.tmpl.complete(p)}return this}});i.extend({tmpl:function(C,F,E,B){var D,A=!B;if(A){B=x;C=i.template[C]||i.template(null,C);e={}}else{if(!C){C=B.tmpl;p[B.key]=B;B.nodes=[];if(B.wrapped){s(B,B.wrapped)}return i(m(B,null,B.tmpl(i,B)))}}if(!C){return[]}if(typeof F==="function"){F=F.call(B||{})}if(E&&E.wrapped){s(E,E.wrapped)}D=i.isArray(F)?i.map(F,function(G){return G?k(E,B,C,G):null}):[k(E,B,C,F)];return A?i(m(B,null,D)):D},tmplItem:function(B){var A;if(B instanceof i){B=B[0]}while(B&&B.nodeType===1&&!(A=i.data(B,"tmplItem"))&&(B=B.parentNode)){}return A||x},template:function(B,A){if(A){if(typeof A==="string"){A=l(A)}else{if(A instanceof i){A=A[0]||{}}}if(A.nodeType){A=i.data(A,"tmpl")||i.data(A,"tmpl",l(A.innerHTML))}return typeof B==="string"?(i.template[B]=A):A}return B?(typeof B!=="string"?i.template(null,B):(i.template[B]||i.template(null,u.test(B)?B:i(B)))):null},encode:function(A){return(""+A).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});i.extend(i.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(A){p={}},afterManip:function v(C,A,D){var B=A.nodeType===11?i.makeArray(A.childNodes):A.nodeType===1?[A]:[];D.call(C,A);o(B);q++}});function m(A,E,C){var D,B=C?i.map(C,function(F){return(typeof F==="string")?(A.key?F.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+h+'="'+A.key+'" $2'):F):m(F,A,F._ctnt)}):A;if(E){return B}B=B.join("");B.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(G,H,F,I){D=i(F).get();o(D);if(H){D=a(H).concat(D)}if(I){D=D.concat(a(I))}});return D?D:a(B)}function a(B){var A=document.createElement("div");A.innerHTML=B;return i.makeArray(A.childNodes)}function l(A){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+i.trim(A).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(I,C,G,D,E,J,F){var L=i.tmpl.tag[G],B,H,K;if(!L){throw"Unknown template tag: "+G}B=L._default||[];if(J&&!/\w$/.test(E)){E+=J;J=""}if(E){E=j(E);F=F?(","+j(F)+")"):(J?")":"");H=J?(E.indexOf(".")>-1?E+j(J):("("+E+").call($item"+F)):E;K=J?H:"(typeof("+E+")==='function'?("+E+").call($item):("+E+"))"}else{K=H=B.$1||"null"}D=j(D);return"');"+L[C?"close":"open"].split("$notnull_1").join(E?"typeof("+E+")!=='undefined' && ("+E+")!=null":"true").split("$1a").join(K).split("$1").join(H).split("$2").join(D||B.$2||"")+"__.push('"})+"');}return __;")}function s(B,A){B._wrap=m(B,true,i.isArray(A)?A:[u.test(A)?A:i(A).html()]).join("")}function j(A){return A?A.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function d(A){var B=document.createElement("div");B.appendChild(A.cloneNode(true));return B.innerHTML}function o(G){var I="_"+q,B,A,E={},F,D,C;for(F=0,D=G.length;F<D;F++){if((B=G[F]).nodeType!==1){continue}A=B.getElementsByTagName("*");for(C=A.length-1;C>=0;C--){H(A[C])}H(B)}function H(P){var L,O=P,N,J,K;if((K=P.getAttribute(h))){while(O.parentNode&&(O=O.parentNode).nodeType===1&&!(L=O.getAttribute(h))){}if(L!==K){O=O.parentNode?(O.nodeType===11?0:(O.getAttribute(h)||0)):0;if(!(J=p[K])){J=e[K];J=k(J,p[O]||e[O]);J.key=++w;p[w]=J}if(q){Q(K)}}P.removeAttribute(h)}else{if(q&&(J=i.data(P,"tmplItem"))){Q(J.key);p[J.key]=J;O=i.data(P.parentNode,"tmplItem");O=O?O.key:0}}if(J){N=J;while(N&&N.key!=O){N.nodes.push(P);N=N.parent}delete J._ctnt;delete J._wrap;i.data(P,"tmplItem",J)}function Q(R){R=R+I;J=E[R]=(E[R]||k(J,p[J.parent.key+I]||J.parent))}}}function c(C,A,D,B){if(!C){return g.pop()}g.push({_:C,tmpl:A,item:this,data:D,options:B})}function b(A,C,B){return i.tmpl(i.template(A),C,B,this)}function n(C,A){var B=C.options||{};B.wrapped=A;return i.tmpl(i.template(C.tmpl),C.data,B,C.item)}function r(B,C){var A=this._wrap;return i.map(i(i.isArray(A)?A.join(""):A).filter(B||"*"),function(D){return C?D.innerText||D.textContent:D.outerHTML||d(D)})}function z(){var A=this.nodes;i.tmpl(null,null,null,this).insertBefore(A[0]);i(A).remove()}if(window.M&&typeof M.define=="function"){M.define("jq-tmpl",function(){return i})}})(jQuery);M.define("InputListener",function(c,b,d){var a={listen:function(f,e){f=$(f);f.each($.proxy(function(g,h){h=$(h);if(!h.is("input")&&!h.is("textarea")){throw new Error("input listener only apply to input or textarea")}this.initListen(h,e)},this))},unlisten:function(e){e=$(e);e.each($.proxy(function(h,k){k=$(k);if(!k.is("input")&&!k.is("textarea")){throw new Error("input listener only apply to input or textarea")}if(arguments.length==1){k.unbind("focus",this.getStartListenFunc());k.unbind("blur",this.getStopListenFunc());k.removeData("__input_listener_handlers")}else{if(typeof arguments[1]=="function"){var j=arguments[1],g=k.data("__input_listener_listeninterval");for(var h=0,f=g.length;h<f;h++){if(g[h]==j){g.splice(h,1);h--}}}}},this))},initListen:function(f,e){f.data("__input_listener_currentval",f.val());if(!f.data("__input_listener_handlers")){this.bindListenEvent(f)}this.addListenHandler(f,e);if(f.is(":focus")){f.blur();f.focus()}},bindListenEvent:function(e){e.data("__input_listener_handlers",[]);e.focus(this.getStartListenFunc());e.blur(this.getStopListenFunc())},getStartListenFunc:function(){if(!this.bindStartListenFunc){this.bindStartListenFunc=$.proxy(this.startListen,this)}return this.bindStartListenFunc},getStopListenFunc:function(){if(!this.bindStopListenFunc){this.bindStopListenFunc=$.proxy(this.stopListen,this)}return this.bindStopListenFunc},startListen:function(e){var f=$(e.target);f.data("__input_listener_currentval",f.val());f.data("__input_listener_listeninterval",setInterval($.proxy(function(){var h=f.data("__input_listener_currentval"),g=f.val();if(h!=g){f.data("__input_listener_currentval",g);this.triggerListenHandler(f)}},this),100))},stopListen:function(e){var f=$(e.target);clearInterval(f.data("__input_listener_listeninterval"))},addListenHandler:function(f,e){if(typeof e=="function"){f.data("__input_listener_handlers").push(e)}},triggerListenHandler:function(h){var f=h.data("__input_listener_handlers");for(var g=0,e=f.length;g<e;g++){f[g].call(null,{target:h.get(0)})}}};return a});M.define("SuggestionXHR",function(b,a,c){function d(e){this.URL=null;this.delay=200;this.dataType="text";$.extend(this,e);this.delayTimer=null;this.xhr=null;this.cache={};this.init()}d.prototype={init:function(){if(!this.URL){throw new Error("no url for suggestion")}},getSuggestion:function(g,h){var f=this.getQuery(g),e=this.cache[f];h=typeof h==="function"?h:$.noop;this.stop();if(e){h(e)}else{this.getXHRData(f,h)}},stop:function(){clearTimeout(this.delayTimer);if(this.xhr&&this.xhr.readyState!==4){this.xhr.abort()}},getQuery:function(h){var g="";if(typeof h=="string"){g=encodeURIComponent(h)}else{if(h&&typeof h=="object"){var e=[];for(var f in h){if(h.hasOwnProperty(f)){e.push(f+"="+encodeURIComponent(h[f]))}}g=e.join("&")}}return g},getXHRData:function(e,h){var f=this.xhr,g={url:this.URL,data:e,dataType:this.dataType,success:M.bind(function(i){h(i);this.cache[e]=i},this)};this.delayTimer=setTimeout(M.bind(function(){this.xhr=$.ajax(g)},this),this.delay)}};return d});M.define("DropList",function(c,b,d){var a=M.Event;function e(f){this.trigger=null;this.container=null;this.itemSelector="._j_listitem";this.itemHoverClass="on";this.firstItemHover=false;$.extend(this,f);this.trigger=$(this.trigger);this.container=$(this.container);this.mouseon=false;this.visible=false;this.init()}M.mix(e.prototype,{createContainer:$.noop,updateList:$.noop,init:function(){if(!this.trigger.length){M.error("no trigger for drop list")}if(!this.container.length){this.container=this.createContainer()}if(!this.container.length){M.error("no container for drop list")}this.bindEvents()},bindEvents:function(){this.trigger.on("keydown",$.proxy(function(g){var h=g.keyCode;if(this.visible&&h==13){var f=this.getFocusItem();if(f.length){this.selectItem(f);g.preventDefault()}}else{if(this.visible&&h==38){this.moveFocus(-1)}else{if(this.visible&&h==40){this.moveFocus(1)}}}},this));this.container.on("mouseenter",this.itemSelector,$.proxy(this.moveFocus,this)).on("click",this.itemSelector,$.proxy(this.clickItem,this)).on("mouseenter",$.proxy(this.mouseOverCnt,this)).on("mouseleave",$.proxy(this.mouseOutCnt,this))},show:function(g){this.updateList(g);this.container.show();if(this.firstItemHover){var f=this.container.find(this.itemSelector);if(f.length){this.moveFocus(1)}}this.visible=true},hide:function(){this.container.hide();this.visible=false},clickItem:function(g){var f=this.getFocusItem();this.selectItem(f);g.preventDefault()},selectItem:function(f){a(this).fire("itemselected",{item:f})},moveFocus:function(i){var h=this.container.find(this.itemSelector),j=this.getFocusItem(),g=j,f;if(i===-1){if(j.length){f=h.index(j)-1}if(!j.length||f==-1){g=h.last()}else{g=h.eq(f)}}else{if(i===1){if(j.length){f=h.index(j)+1}if(!j.length||f==h.length){g=h.first()}else{g=h.eq(f)}}else{if(i.currentTarget){g=$(i.currentTarget)}}}j.removeClass(this.itemHoverClass);g.addClass(this.itemHoverClass);a(this).fire("itemfocused",{prevItem:j,focusItem:g})},getFocusItem:function(){var f=this.container.find(this.itemSelector);return f.filter("."+this.itemHoverClass)},mouseOverCnt:function(){this.mouseon=true},mouseOutCnt:function(){this.mouseon=false}});return e});M.define("Suggestion",function(c){c("jq-tmpl");var a=c("InputListener");var b='{{each(i, item) list}}<li class="${listItemClass}" data-value="${item.value}">${item.text}</li>{{/each}}';function d(e){e.suggestionURL=e.url||$(e.input).data("suggestionurl");this.dropListClass="droplist";this.listItemSelector="._j_listitem";this.listItemHoverClass="on";this.listFirstItemHover=false;this.keyParamName="key";this.dataType="json";this.suggestionParams={};this.listContainer=null;M.mix(this,e);this.input=$(this.input);this.listTmpl=this.listTmpl||b;this.actOnList=false;this.init()}M.mix(d.prototype,{init:function(){a.listen(this.input,$.proxy(this.inputChange,this));this.input.blur($.proxy(function(f){var e=$(f.currentTarget);if(e.data("droplist")){setTimeout($.proxy(function(){if(!this.actOnList&&e.data("droplist")){e.data("droplist").hide()}this.actOnList=false},this),200)}},this));this.input.keyup($.proxy(function(f){var e=$(f.currentTarget);if(f.keyCode==40&&(!e.data("droplist")||!e.data("droplist").visible)){this.inputChange(f)}},this))},inputChange:function(i){var f=$(i.target),k=$.trim(f.val()),j=c("SuggestionXHR"),h=c("DropList");var g=f.data("droplist");if(!g){f.data("droplist",g=new h({trigger:f,itemSelector:this.listItemSelector,itemHoverClass:this.listItemHoverClass,firstItemHover:this.listFirstItemHover,container:this.listContainer,createContainer:$.proxy(function(){var l=this.createListContainer(f);this.listContainer=l;return l},this),updateList:$.proxy(this.updateList,this)}));M.Event(g).on("itemselected",$.proxy(function(l){this.dropItemSelected(f,l.item)},this));M.Event(g).on("itemfocused",$.proxy(function(l){M.Event(this).fire("itemfocused",l)},this))}g.hide=function(){setTimeout($.proxy(function(){if(M.windowFocused){this.container.hide();this.visible=false}},this),1)};var e=f.data("suggestion");if(!e){f.data("suggestion",e=new j({URL:this.suggestionURL,dataType:this.dataType}))}if(!k.length){e.stop();g.hide();M.Event(this).fire("after hide list")}else{this.suggestionParams[this.keyParamName]=k;M.Event(this).fire("before suggestion xhr");e.getSuggestion(this.suggestionParams,$.proxy(function(m){M.Event(this).fire("before show list");var l=this.handleSuggest(m);if(l){f.data("droplist").show(l)}},this))}},handleSuggest:function(f){var e="";if(this.dataType=="json"){e=$.tmpl(this.listTmpl,f)}return e},createListContainer:function(f){var g=$("<ul />"),e=f.position();g.css({display:"none",position:"absolute",left:e.left,top:e.top+f.outerHeight()}).addClass(this.dropListClass);g.insertAfter(f);return g},updateList:function(e){this.listContainer.html(e)},hideDropList:function(){this.input.data("droplist")&&this.input.data("droplist").hide()},dropItemSelected:function(e,f){a.unlisten(e);M.Event(this).fire("itemselected",{item:f,input:e});a.listen(e,$.proxy(this.inputChange,this))}});return d});M.define("MesSearchEvent",function(b,a,c){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(f,j){var l=e,h=[],g;j=j||l.length;if(f){for(g=0;g<f;g++){h[g]=l[0|Math.random()*j]}}else{var k;h[8]=h[13]=h[18]=h[23]="-";h[14]="4";for(g=0;g<36;g++){if(!h[g]){k=0|Math.random()*16;h[g]=l[(g==19)?(k&3)|8:k]}}}return h.join("")};Math.uuidFast=function(){var k=e,h=new Array(36),g=0,j;for(var f=0;f<36;f++){if(f==8||f==13||f==18||f==23){h[f]="-"}else{if(f==14){h[f]="4"}else{if(g<=2){g=33554432+(Math.random()*16777216)|0}j=g&15;g=g>>4;h[f]=k[(f==19)?(j&3)|8:j]}}}return h.join("")};Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(h){var g=Math.random()*16|0,f=h=="x"?g:(g&3|8);return f.toString(16)})};var d={uuid:function(){return Math.uuid()},search:function(f){var g=Math.uuid();f.id=g;!!mfwPageEvent&&mfwPageEvent("se","v2_search",f);return g},searchCache:function(f){var g=Math.uuid();f.id=g;!!mfwPageEvent&&mfwPageEvent("se","v2_search_cache",f);return g},resultClick:function(f){!!mfwPageEvent&&mfwPageEvent("se","v2_result_click",f);return f.id}};c.exports=d});M.define("/js/SiteSearch",function(e){var d="1.0.0",h=e("Suggestion"),f=e("MesSearchEvent"),g=M.cssSupport("transition"),b=M.cssSupport("transform"),c=window.Env||{};var a=function(C){var E=$("#"+C.input+""),T=!!C.submit?$("#"+C.submit+""):null,t=C.additionalClass?C.additionalClass:"",K=!!C.isRelevant,s=C.maxCount||0,z=C.hideOnScroll||false,n=false,J=false,i="",y="",l="",p="";if(C.input==="_j_index_search_input_all"){var H=[];if(E.val()===""&&H&&H.length){var S=Math.floor(Math.random()*H.length),I=H[S];E.val(I.name).data("url",I.url)}E.on("focus",function(V){if(E.data("url")){E.val("").data("url","")}})}if(c.is_async_site_search){n=true}var P=new h({url:(c.WWW_HOST?window.location.protocol+"//"+c.WWW_HOST:"")+"/search/ss.php",suggestionParams:{isHeader:Number(K)},input:E,listItemHoverClass:"active",listFirstItemHover:false,dataType:"jsonp",createListContainer:function(){var V=$('<div class="m-search-suggest '+t+' hide"><ul class="mss-list"></ul></div>').appendTo("body");V.on("mouseenter",".mss-place .mss-title, .mss-place .mss-nav a",function(X){var W=$(X.currentTarget),Y=W.closest(".mss-place");Y.find(".mss-title").removeClass("active").removeClass("frozen").end().find(".mss-nav a").removeClass("active").end();W.addClass("active")}).on("mouseleave",".mss-place .mss-title, .mss-place .mss-nav a",function(X){var W=$(X.currentTarget);W.removeClass("active")});return V},handleSuggest:function(aB){i=aB.keyword;J=!!aB.is_hit;l="http://"+aB.www_host;var aw=aB.keyword_cut,ay=aB.show_types,W=aB.hide_types;var aq=$("<ul>");var aa=aB.first_poi;if(!!aa){var al=aa,aj=$('<li class="mss-item _j_listitem" data-type="poi">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",al.url);ao.append('<span class="mss-fr">'+(!!al.mddname?al.mddname:"")+al.typename+"</span>");ao.append('<span class="mss-cn">'+al.dis_name+"</span>")}var ag=aB.article_info;if(ag&&ag.result){for(var ar=0;ar<ag.result.length;ar++){var af=ag.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="article_promoted">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",af.link);ao.html(af.name_display)}}var ak=aB.mdd_info;if(ak&&ak.result){for(var ar=0;ar<ak.result.length;ar++){var Z=ak.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="mdd">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",Z.url);if(!!Z.parent){ao.append('<span class="mss-fr">'+Z.parent+"</span>")}ao.append('<span class="mss-cn">'+Z.dis_name+"</span>");ao.append('<span class="mss-gl"> '+Z.infoname+"</span>")}}var an=aB.hotel_info;if(an&&an.result&&!K){for(var ar=0;ar<an.result.length;ar++){var az=an.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="hotel_promoted">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",az.url);ao.append('<span class="mss-fr">'+az.typename+"</span>");ao.append('<span class="mss-cn">'+az.title+"</span>");ao.append('<span class="mss-gl"> '+az.infoname+"</span>")}}var ad=aB.gl_info;if(ad&&ad.result){for(var ar=0;ar<ad.result.length;ar++){var ap=ad.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="sales_gonglve">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",ap.url);ao.append('<span class="mss-fr">'+ap.typename+"</span>");ao.append('<span class="mss-cn">'+ap.title+"</span>")}}var Y=aB.sales_info;if(Y&&Y.result&&!K){for(var ar=0;ar<Y.result.length;ar++){var V=Y.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="sales_promoted">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",V.url);ao.append('<span class="mss-fr">'+V.typename+"</span>");ao.append('<span class="mss-cn">'+V.title+"</span>");ao.append('<span class="mss-gl"> '+V.infoname+"</span>")}}var ae=aB.route_info;if(ae&&ae.result&&!K){for(var ar=0;ar<ae.result.length;ar++){var ax=ae.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="route_promoted">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",ax.url);ao.append('<span class="mss-fr">'+ax.typename+"</span>");ao.append('<span class="mss-cn">'+ax.title+"</span>");ao.append('<span class="mss-gl"> '+ax.infoname+"</span>")}}var at=aB.qa_info;if(at&&at.result){for(var ar=0;ar<at.result.length;ar++){var ah=at.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="wenda">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",ah.url);ao.append('<span class="mss-fr">'+ah.typename+"</span>");ao.append('<span class="mss-cn">'+ah.title+"</span>")}}var ac=aB.poi_info,av=!K;if(M.isArray(ay)&&M.indexOf(ay,"poi")!==-1){av=true}if(ac&&ac.result&&av){for(var ar=0;ar<ac.result.length;ar++){var al=ac.result[ar],X="hotel"===al.stype?"hotel":"poi",aj=$('<li class="mss-item _j_listitem" data-type="'+X+'">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",al.url);ao.append('<span class="mss-fr">'+(!!al.mddname?al.mddname:"")+al.typename+"</span>");ao.append('<span class="mss-cn" style="color:#999;">'+al.dis_name+"</span>")}}var ai=aB.sekey_info,au=K;if(M.isArray(W)&&M.indexOf(W,"sekey")!==-1){au=false}if(ai&&ai.result&&au){for(var ar=0;ar<ai.result.length;ar++){if(ar>4){break}var aA=ai.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="sekey">').appendTo(aq);aj.attr("data-url",aA.url);aj.append('<div class="mss-title">'+aA.name+"</div>")}}var ab=aB.ginfo_num;if(!!ab){var aj=$('<li class="mss-item _j_listitem" data-type="info">').appendTo(aq);aj.append('<div class="mss-title">搜“<span class="mss-key">'+aw+'</span>”相关游记<span class="mss-num">'+ab+"篇</span></div>")}var am=aB.user_num;if(!!ab){var aj=$('<li class="mss-item _j_listitem" data-type="user">').appendTo(aq);aj.append('<div class="mss-title">搜“<span class="mss-key">'+aw+"</span>”相关用户</div>")}if(s>0){aq.find("._j_listitem").each(function(aC,aD){if(aC>s){$(aD).remove()}})}return aq.html()},updateList:function(V){this.listContainer.find(".mss-list").html(V);if(K){this.listContainer.find(".mss-list").addClass("shrink-list")}if(J){P.input.data("droplist").moveFocus(1)}}});if(n){var A=e("InputListener"),w=e("SuggestionXHR"),D=new w({URL:(c.WWW_HOST?"http://"+c.WWW_HOST:"")+"/search/s.php",dataType:"json"}),v=$("#_j_mfw_search_main"),U=E.closest(".search-wrapper"),L=$('<div class="search-keyword-tip"></div>').appendTo(U),B=C.input==="_j_index_search_input_all",G=false,u,q,N,k,r;A.listen(E,function(W){var V=$(W.target),X=$.trim(V.val());if(!G&&X){G=true}L.hide()});M.Event(P).on("before suggestion xhr",function(){var V=P.suggestionParams[P.keyParamName];if(V&&V!==y){D.getSuggestion({q:V,gall:1},$.proxy(function(X){var ab=$.trim(E.val());if(!ab){return false}if(!X||!X.keyword||(!X.result&&!X.unmatch)){return false}if(X.unmatch===1){L.hide()}else{y=V;if(U[0]){var Y=X.keyword.length,W=X.keyword.replace(/[A-Za-z0-9\s]/g,"").length,aa=Y-W;setTimeout(function(){L.html(X.keyword).css("left",32+W*14+aa*7).show()},1)}v.html($(X.result).css("minHeight",0).html());if(g&&b){v.find("> .wid").addClass("anim-climb");setTimeout(function(){v.find("> .wid").removeClass("anim-climb")},1)}var Z=c.search_type||"all";c.search_seid=Q(V,Z);c.search_keyword=V;c.is_search_cache=true;c.is_search_updated=true}},P))}})}M.Event(P).on("before suggestion xhr",function(){R(E,P.listContainer)});M.Event(P).on("before show list",function(){P.listContainer.find(".mss-list").show()});M.Event(P).on("itemfocused",function(W){var V=W.prevItem,X=W.focusItem,Y=P.listContainer;if(1<Y.find(".mss-place").length){if(X.hasClass("mss-place")){Y.find(".mss-place").removeClass("frozen")}if(!X.hasClass("mss-place")&&!!V&&V.hasClass("mss-place")){Y.find(".mss-place").removeClass("frozen");V.addClass("frozen")}}if(X.hasClass("mss-place")){X.find(".mss-title").addClass("frozen")}});M.Event(P).on("itemselected",function(X){var Z=X.item;if(Z.length){var Y=Z.data("type"),W=Z.data("url"),ab=E.attr("id")==="_j_head_search_input"?"header":"default";if(Y==="flight_hotel"||Y==="flight"||Y==="local"){Y="sales"}p=m(i,"all",ab,"suggest");if("info"===Y||"user"===Y){var aa=m(i,Y,ab,"suggest");location.href=l+"/search/s.php?q="+encodeURIComponent(i)+"&t="+Y+"&seid="+aa}else{var W=Z.data("url"),V=P.listContainer.find(".mss-item").index(Z.closest(".mss-item"))+1;O(W,V,Y);location.href=Z.data("url")}}else{if(i!==""){location.href=l+"/search/s.php?q="+encodeURIComponent(i)}}});var x=E.closest(".head-search-wrapper");if(x[0]){E.on("focus",function(V){setTimeout(function(){x.addClass("head-search-focus")},1)}).on("blur",function(V){setTimeout(function(){if(M.windowFocused){x.removeClass("head-search-focus")}},1)})}if(T&&T[0]){T.on("click",function(X){var W=$.trim(E.val());if(E.data("url")){if(E.data("url").indexOf("http")!==-1){location.href=E.data("url")}else{location.href=(c.WWW_HOST?"http://"+c.WWW_HOST:"")+E.data("url")}return true}if(W!==""){if(P.listContainer){P.listContainer.hide()}var Z=E.attr("id")==="_j_head_search_input"?"header":"default",aa=c.search_type||"all",Y=m(W,aa,Z,"form"),V=l+"/search/s.php?q="+encodeURIComponent(W);if(c.search_type&&location.pathname==="/search/s.php"){V+="&t="+c.search_type}V+="&seid="+Y;location.href=V}})}if(E&&E[0]){E.on("keydown",function(X){if(X.keyCode==13){var aa=P.input.data("droplist");if(aa&&aa.getFocusItem().length){return true}var W=$.trim(E.val());if(W!==""){if(P.listContainer){P.listContainer.hide()}var Z=E.attr("id")==="_j_head_search_input"?"header":"default",ab=c.search_type||"all",Y=m(W,ab,Z,"form"),V=l+"/search/s.php?q="+encodeURIComponent(W);if(c.search_type&&location.pathname==="/search/s.php"){V+="&t="+c.search_type}V+="&seid="+Y;location.href=V}}})}$(window).resize(function(){if(P.listContainer&&P.listContainer.length&&P.listContainer.is(":visible")){R(E,P.listContainer)}});$(window).on("scroll",function(V){if(z){P.hideDropList()}});function R(V,X){var W=V.offset();X.css({left:W.left+(C.input==="_j_index_search_input_all"?0:1),top:W.top+E.outerHeight()-2})}function m(V,Z,Y,X){var W={keyword:V,content_category:Z,searchbox_category:"main_search",searchbox_position:Y,search_type:X,version:d};return f.search(W)}function Q(V,X){var W={keyword:V,content_category:X,version:d};return f.searchCache(W)}function O(Y,W,X){var V={id:p,keyword:i,click_url:Y,index:W,content_category:X,search_type:"suggest",version:d};return f.resultClick(V)}function F(W,aa){var X=[],ac=W.split("|");aa=j(aa);for(var Z=0;Z<ac.length;Z++){var Y=$.trim(ac[Z]);if(Y=="search://"){var V=X.length;X[V]=ac[Z++];X[V+1]=ac[Z++];X[V+2]=ac[Z++];X[V+3]=ac[Z++];X[V+4]=ac[Z++];X[V+5]=ac[Z];continue}if(Y){try{Y=Y.replace(new RegExp(aa,"ig"),function(ad){return'<span class="highlight">'+ad+"</span>"})}catch(ab){Y=Y.replace(aa,function(ad){return'<span class="highlight">'+ad+"</span>"})}X[X.length]=Y}}return X}var o=$("<div/>");function j(V){return o.text(V).html()}};return a});M.closure(function(c){var r=$("#header");if(!r.length){return false}var o=c("/js/Dropdown");var n=c("/js/SiteSearch");new n({input:"_j_head_search_input",submit:"_j_head_search_link",isRelevant:true});$("#_j_nav_sales").find("[data-sales-nav]").on("click",function(){var t=$(this).data("salesNav");mfwPageEvent("sales","index_sales_nav",{name:t})});if(!window.showBarFlag){$("._j_sales_nav_show").off("hover")}else{var b=0,p=0;$("._j_sales_nav_show").hover(function(){clearTimeout(b);p=setTimeout(function(){$("._j_sales_nav_show").addClass("head-nav-hover");$("._j_sales_top").fadeIn(300)},200)},function(){clearTimeout(p);b=setTimeout(function(){$("._j_sales_nav_show").removeClass("head-nav-hover");$("._j_sales_top").fadeOut(300)},200)})}var m=0,f=0;$("._j_shequ_nav_show").hover(function(){clearTimeout(m);f=setTimeout(function(){$("._j_shequ_nav_show").addClass("head-nav-hover");$("._j_shequ_top").fadeIn(300)},200)},function(){clearTimeout(f);m=setTimeout(function(){$("._j_shequ_nav_show").removeClass("head-nav-hover");$("._j_shequ_top").fadeOut(300)},200)});var q=$("#_j_community_panel"),i=q.find(".panel-image").length,j=Math.floor(Math.random()*i);if(j===i){j--}q.find(".panel-image").eq(j).show();$("#_j_showlogin").click(function(t){if(window.location.host===Env.WWW_HOST){t.preventDefault()}M.Event.fire("login:required")});var g=window.location.hostname,k=window.location.pathname+window.location.search,a=$("#_j_head_nav");if(g.indexOf("www")===0){if(k===""||k==="/"){a.children("li:eq(0)").addClass("head-nav-active")}var h=new RegExp("^/(mdd|photo/mdd|poi|photo/poi|travel-scenic-spot|jd|cy|gw|yl|yj|xc|baike)/|sFrom=mdd.*|sFrom=smdd.*","i");if(h.test(k)){a.children("li:eq(1)").addClass("head-nav-active")}var e=new RegExp("^/gonglve/.*","i");if(e.test(k)){a.children("li:eq(2)").addClass("head-nav-active")}var d=window.Env&&window.Env.sales_title_tag;if(d){if(d==="flight_hotel"){a.children("li:eq(3)").find("ul>li:eq(0)>a").addClass("on")}else{if(d==="visa"){a.children("li:eq(3)").find("ul>li:eq(2)>a").addClass("on")}else{if(d==="localdeals"){a.children("li:eq(3)").find("ul>li:eq(1)>a").addClass("on")}else{if(d==="insurance"){a.children("li:eq(3)").find("ul>li:eq(4)>a").addClass("on")}}}}a.find("li:eq(3)").addClass("head-nav-active")}if(/^\/insurance\//i.test(k)){a.find("li:eq(3)").addClass("head-nav-active")}var s=new RegExp("^/hotel/(?!.*sFrom=mdd).*","ig");if(s.test(k)){a.children("li:eq(4)").addClass("head-nav-active");a.children("li:eq(4)").find(".head-act616").remove()}var l=new RegExp("^/(wenda|qa|mall|together|group|i|traveller|rudder|paimai|club|postal|school|photo_pk|focus)/(?!.*sFrom=mdd|s.php*).*","i");if(l.test(k)){a.children("li:eq(5)").addClass("head-nav-active")}}});(function(){var b=function(){};b.prototype={getPath:function(c){if(c[0]!="/"){c="/"+c}if(c[c.length-1]!="/"){c+="/"}if(c.indexOf("/rest/")<0){c="/rest"+c}return c},get:function(g,c,h,d,f){var e={};if(d){e.data_style=d}if(f){e.data_decorate=f}return $.get(this.getPath(g)+c,e,h,"json")},getMulti:function(j,e,g,i,k,h,d,c){var f={};if(e){f.filter=e}if(g){f.page=g}if(k){f.data_style=k}if(h){f.data_decorate=h}if(d){f.ex_style=d}if(c){f.ex_decorate=c}return $.get(this.getPath(j),f,i,"json")},post:function(g,i,h,c,e,d){var f={update:i};if(c){f.post_style=c}if(e){f.after_style=e}if(d){f.after_decorate=d}return $.post(this.getPath(g),f,h,"json")},put:function(l,i,d,k,g,h,f,j,c){var e={method:"PUT",update:d};if(g){e.put_style=g}if(h){e.after_style=h}if(f){e.after_decorate=f}if(j){e.before_style=j}if(c){e.before_decorate=c}return $.post(this.getPath(l)+i,e,k,"json")},"delete":function(g,e,h,c,d){var f={method:"DELETE"};if(c){f.before_style=c}if(d){f.before_decorate=d}return $.post(this.getPath(g)+e,f,h,"json")}};b.prototype.constructor=b;var a=new b();window.mfwRest=a;if(window.M&&M.define){M.define("/js/localdeals/rest",function(){return a})}})();M.define("/js/sales/navbar",function(b,a,c){var d=function(e){this.config=$.extend(true,{},this.config,e);this.anchorsTop=[]};d.prototype={$navbar:null,$anchors:null,config:{offsetTop:0,navbar:".sales-nav",wrapper:".sales-nav-wrap",anchors:"",resizeEvents:[],navbarFixedClass:"fixed"},status:null,init:function(){var e=this;this.$navbar=$(this.config.navbar);$(window).on("scroll",function(){e.onScroll()});$(document).on(this.config.resizeEvents.join(" "),function(){e.reset()});if(this.config.anchors){this.$navbar.find("a[href^=#]").click(function(j){var k=$(this).attr("href");var g=$(k);if(g.length){var f=g.offset().top;var i=Math.abs($(window).scrollTop()-f);var h=Math.min(500,i/2);$("html,body").stop().animate({scrollTop:g.offset().top+g.outerHeight()-(e.config.scrollNavHeight==undefined?e.navHeight:e.config.scrollNavHeight)-e.config.offsetTop},h);j.preventDefault()}})}e.reset()},reset:function(){var e=this;if(this.config.anchors){this.$anchors=$(this.config.anchors)}this.navTop=parseInt($(this.config.wrapper).offset().top)-this.config.offsetTop;this.navHeight=parseInt($(this.config.navbar).outerHeight());this.wrapperHeight=$(this.config.wrapper).height();if(this.config.anchors){this.$anchors.each(function(f){e.anchorsTop[f]=$(this).offset().top})}this.onScroll()},onScroll:function(){var f=this;var g=$(window).scrollTop();var e=this.status;if(g<=this.navTop){e="static"}else{if(g<this.navTop+this.wrapperHeight-this.navHeight){e="fixed"}else{e="absolute"}}if(e!==this.status){this.status=e;switch(e){case"static":this.$navbar.removeClass(this.config.navbarFixedClass);this.$navbar.css({position:"",top:""});break;case"fixed":this.$navbar.addClass(this.config.navbarFixedClass);this.$navbar.css({position:"",top:this.config.offsetTop||""});break;case"absolute":if($(this.config.wrapper).css("position")!=="relative"){this.$navbar.css({position:"absolute",top:this.navTop+this.wrapperHeight-(f.config.scrollNavHeight==undefined?f.navHeight:f.config.scrollNavHeight)+this.config.offsetTop})}else{this.$navbar.css({position:"absolute",top:this.wrapperHeight-this.navHeight})}break}}if(this.config.anchors){$.each(this.anchorsTop,function(h,k){if(k-30-f.config.offsetTop<g){var j=f.$navbar.find('a[href="#'+f.$anchors.eq(h).attr("id")+'"]');j.closest("li").addClass("on").siblings().removeClass("on")}})}}};c.exports=d});M.define("/js/sales/stock",function(c,e,a){var h=c("/js/localdeals/rest");var g=0;var d=1;var f=2;var i=function(k,j){if("mAlert" in window){window.mAlert(k)}else{if("Pieces" in window){if(!j){j=3000}i.dialog=new Pieces({type:"toast",message:k,delay:j});i.dialog.creat()}else{window.alert(k)}}};var b=function(j){this.config=$.extend(true,{},this.config,j)};b.EVENT_CHANGE_NUMS="stock_change_nums";b.EVENT_SELECT_LEAF="stock_select_leaf";b.EVENT_CHANGE_CALENDAR="stock_change_calendar";b.EVENT_SELECT_NODE="stock_select_node";b.EVENT_SELECT_DATE="stock_select_date";b.EVENT_CHANGE_MONTH="stock_select_month";b.EVENT_SOLD_OUT="stock_sold_out";b.MODE_FENGQIANG=1;b.MODE_GET_N_OFF_M=2;b.MODE_GET_N_OFF_M_KEY_PERCENT=0;b.MODE_GET_N_OFF_M_KEY_PRICE=1;b.prototype={config:{clickEvent:"click",hideCartBlock:".intro-r",salesId:0,scope:"sales",giftCode:null,structureOnCss:"on",structureDisabledCss:"disabled",calendarOnCss:"on",calendarDisabledCss:"disabled",selectFirstStock:true,calendarScrollLeft:"",calendarScrollRight:"",calendarPrev:"",calendarNext:"",numButton:"[data-action=plus],[data-action=minus]",structureWrapper:"",remainSpan:"",calendarWrapper:"",calendarBlock:"",sidebarCalendarWrapper:"",totalPriceSelector:"",totalPriceExtStrSelector:".total-price-ext",adultNumSpan:"",adultText:"",adultChangeText:"数量",adultPriceSpan:"",kidAmountBlock:"",kidBlock:"",kidNumSpan:"",kidPriceSpan:"",infantAmountBlock:"",infantBlock:"",infantNumSpan:"",roomAmountBlock:"",roomBlock:"",roomNumSpan:"",singleRoomBlock:"",singleRoomTotalPriceSpan:"",singleRoomPriceSpan:"",buyButton:"",bargainButton:"",noStockMsg:"请选择日期",selectD:false,usedHoneySelector:"#used_honey",usedHoneyRightSelector:".book-action .price-total",calendarDataDecorate:""},calendarCache:{},sidebarCalendarCache:{},selectedStock:{},rememberNums:{adult:0,kid:0,infant:0,room:0},nums:{adult:0,kid:0,infant:0,room:0,singleRoom:0},price:{total:0,singleRoom:0},mode:{type:0},currentMonth:"",rememberDate:"",isSoldOut:false,currentLevelLabel:"日期",trigger:function(j,k){if(k){$(document).trigger(j,k)}else{$(document).trigger(j)}},on:function(j,k){$(document).on(j,function(m,l){k(l)})},init:function(){if(window.Env.salesType!=28&&window.Env.salesType!=29){this.initEventHandler();this.config.adultText=$("[data-adult]").eq(0).text();var j=this.getFirstEnableId(0);if(j){if(this.config.selectFirstStock){this.selectNode(j)}}else{this.trigger(b.EVENT_SOLD_OUT);this.isSoldOut=true}this.currentLevelLabel=$.trim($(".stock_0").find(this.config.levelLabel).text())}},login:function(j){if(j&&j.charAt(0)==="/"){j=window.location.protocol+"//"+window.location.host+j}if(SalesApp.isApp()&&"MFWAPP" in window&&"login" in MFWAPP&&"showLogin" in MFWAPP.login){if(typeof MFWAPP.login.hasLoggedIn==="function"){var k=MFWAPP.login.hasLoggedIn();if(k&&k.hasLoggedIn){location.href=j||window.location.href;return}}var l;if(j){l={onSuccess:function(){window.location.href=j},successCallback:j}}else{l={onSuccess:function(){window.reload(true)}}}MFWAPP.login.showLogin(l)}else{window.location.href="https://passport.mafengwo.cn/?return_url="+encodeURIComponent(j||window.location.href)}},redirect:function(k,j){if(j&&!window.Env.UID){this.login(k)}else{window.location.href=k}},initEventHandler:function(){var j=this;this.on(b.EVENT_SELECT_LEAF,function(l){j.selectedStock=l||{};if(l){if(!("kidPrice" in l)){l.kidPrice=0}}else{}j.setNum("all",0,false);if(j.selectedStock){if(j.config.remainSpan){$(".stock-remain").show();$(j.config.remainSpan).html(j.selectedStock.remain|0)}}else{$(".stock-remain").hide()}$(j.config.adultPriceSpan).html(j.selectedStock.price);$(j.config.kidPriceSpan).html(j.selectedStock.kidPrice);$(j.config.singleRoomPriceSpan).html(j.selectedStock.singleRoomPrice);if(j.selectedStock.kidPrice){$(j.config.kidAmountBlock).show();j.kidFlag=false}else{$(j.config.kidAmountBlock).hide();j.kidFlag=true}if(j.selectedStock.infant){$(j.config.infantAmountBlock).show();j.infantFlag=false}else{$(j.config.infantAmountBlock).hide();j.infantFlag=true}if(j.selectedStock.singleRoomPrice){$(j.config.roomAmountBlock).show();j.roomFlag=false}else{$(j.config.roomAmountBlock).hide();j.roomFlag=true}var k=$("[data-adult]");if(j.kidFlag&&j.infantFlag&&j.roomFlag){k.text(j.config.adultChangeText)}else{k.text(j.config.adultText)}j.changePrice()});this.on(b.EVENT_CHANGE_NUMS,function(){if(j.config.kidBlock){if(j.nums.kid){$(j.config.kidNumSpan).html(j.nums.kid);$(j.config.kidBlock).show()}else{$(j.config.kidBlock).hide()}}if(j.config.infantBlock){if(j.nums.infant){$(j.config.infantNumSpan).html(j.nums.infant);$(j.config.infantBlock).show()}else{$(j.config.infantBlock).hide()}}if(j.config.singleRoomBlock){if(j.nums.singleRoom){$(j.config.singleRoomBlock).show()}else{$(j.config.singleRoomBlock).hide()}}if(j.config.roomBlock){if(j.nums.room){$(j.config.roomBlock).show()}else{$(j.config.roomBlock).hide()}}$(j.config.adultNumSpan).html(j.nums.adult);$(j.config.kidNumSpan).html(j.nums.kid);$(j.config.infantNumSpan).html(j.nums.infant);$(j.config.roomNumSpan).html(j.nums.room);j.changePrice()});if(j.config.calendarScrollLeft){this.on(b.EVENT_CHANGE_CALENDAR,function(){var m=$(j.config.calendarScrollLeft);var n=$(j.config.calendarScrollRight);m.addClass("tab-arrDisabled");var k=$(".tab-box li:last");var l=k.position().left+k.outerWidth();if(l>$(".cal-tab").width()){n.removeClass("tab-arrDisabled")}else{n.addClass("tab-arrDisabled")}})}this.on(b.EVENT_CHANGE_CALENDAR,function(){var k=$(j.config.calendarWrapper).find("[data-calendar]").attr("data-calendar");if(j.rememberDate&&j.rememberDate.substr(0,7)!=k){k=j.rememberDate.substr(0,7)}j.trigger(b.EVENT_CHANGE_MONTH,k)});this.on(b.EVENT_CHANGE_MONTH,function(m){var l=$('[data-month-tab="'+m+'"]'),k=$('[data-calendar="'+m+'"]');if(!l.lenght&&!k.length){j.currentMonth=j.getFirstEnableDate().substr(0,7)}else{if(m){j.currentMonth=m;$("[data-calendar]").hide().filter('[data-calendar="'+m+'"]').show()}else{j.currentMonth=j.getFirstEnableDate().substr(0,7)}}});$(this.config.structureWrapper).on(this.config.clickEvent,"[data-stock-id]",function(){j.selectNode($(this).attr("data-stock-id"));var k=$("[data-adult]");if(j.kidFlag&&j.infantFlag&&j.roomFlag){k.text(j.config.adultChangeText)}else{k.text(j.config.adultText)}});$(this.config.calendarWrapper).on(this.config.clickEvent,"[data-stock-id]",function(){j.selectDate($(this).attr("data-name"))});if(this.config.sidebarCalendarWrapper){$(this.config.sidebarCalendarWrapper).on(this.config.clickEvent,"[data-stock-id]",function(){j.selectDate($(this).attr("data-name"))})}if(j.config.calendarScrollRight){$(document).on(j.config.clickEvent,j.config.calendarScrollRight,function(){j.monthTabRight()})}if(j.config.calendarScrollLeft){$(document).on(j.config.clickEvent,j.config.calendarScrollLeft,function(){j.monthTabLeft()})}if(j.config.calendarNext){$(document).on(j.config.clickEvent,j.config.calendarNext,function(){var l=$(this);if(!l.hasClass("disabled")){var k=$(j.config.calendarWrapper).find('[data-calendar="'+j.currentMonth+'"]').next();var m=k.attr("data-calendar");j.trigger(b.EVENT_CHANGE_MONTH,m)}})}if(j.config.calendarPrev){$(document).on(j.config.clickEvent,j.config.calendarPrev,function(){var l=$(this);if(!l.hasClass("disabled")){var k=$(j.config.calendarWrapper).find('[data-calendar="'+j.currentMonth+'"]').prev();var m=k.attr("data-calendar");j.trigger(b.EVENT_CHANGE_MONTH,m)}})}$(document).on(this.config.clickEvent,"[data-month-tab]",function(){var k=$(this).attr("data-month-tab");j.trigger(b.EVENT_CHANGE_MONTH,k)});$(this.config.numButton).on(this.config.clickEvent,function(){if(j.isSoldOut){return}if(j.config.selectD){var l=$(this).data("value");if(j.nums.hasOwnProperty(l)){var k=j.nums[l];if($(this).data("action")=="plus"){j.setNum(l,k+1,true,"plus")}else{j.setNum(l,k-1,true,"minus")}}}else{j.alertNoStockMsg()}});$(this.config.buyButton).on(this.config.clickEvent,function(k,l){if(!$(this).is(j.config.buyButton)){return}if(j.config.selectD){j.gotoBuy()}else{j.alertNoStockMsg()}});$(this.config.bargainButton).on(this.config.clickEvent,function(){if(j.config.selectD){j.gotoBargain()}else{j.alertNoStockMsg()}})},alertNoStockMsg:function(){var j;if(this.currentLevelLabel){j="请选择"+this.currentLevelLabel}else{j=this.config.noStockMsg}i(j)},selectNode:function(j){var l=$(this.config.structureWrapper).find('[data-stock-id="'+j+'"]');var n=l.data();if(l.hasClass(this.config.structureDisabledCss)){return}if(n.childType==g){this.config.selectD=true}else{this.config.selectD=false}if(n.level==0){if(n.mode&&n.mode>0){this.mode={type:n.mode|0,saleOnBefore:n.saleOnBefore==1,saleOnAfter:n.saleOnAfter==1,sellingTime:parseFloat(n.sellingTime)||0,offlineTime:parseFloat(n.offlineTime)||0,discount:{key:n.discountKey|0,val:parseFloat(n.discountVal||0),minNum:n.discountMinNum|0}}}else{this.mode={type:0}}if(this.config.hideCartBlock){if(this.mode.type==b.MODE_GET_N_OFF_M){$(this.config.hideCartBlock).addClass("hide-cart")}else{$(this.config.hideCartBlock).removeClass("hide-cart")}}var k=$(".action-panel .bargain");if(k.length){k[n.role==1?"hide":"show"]()}}l.addClass(this.config.structureOnCss).siblings().removeClass(this.config.structureOnCss);this.trigger(b.EVENT_SELECT_NODE,n);var p=l.closest("[data-stock-level]").data("stockLevel");$('[data-stock-level="'+(p+1)+'"]').hide();var m=$(".stock_"+j).show();if(m.length&&this.config.levelLabel){this.currentLevelLabel=$.trim(m.find(this.config.levelLabel).text())}else{this.currentLevelLabel="日期"}if(this.config.selectFirstStock){var o=this.getFirstEnableId(j);if(o){this.selectNode(o)}}else{m.find("."+this.config.structureOnCss).removeClass(this.config.structureOnCss)}switch(l.attr("data-child-type")|0){case f:this.showCalendar(j);break;case g:this.hideCalendar();this.trigger(b.EVENT_SELECT_LEAF,n);break;case d:if(!this.config.selectFirstStock){this.trigger(b.EVENT_SELECT_LEAF,"");this.hideCalendar()}break}},selectDate:function(k){var j=this.getDateEl(k);if(j!=null){$(this.config.calendarWrapper).find("[data-stock-id]."+this.config.calendarOnCss).removeClass(this.config.calendarOnCss);j.addClass(this.config.calendarOnCss);$(this.config.sidebarCalendarWrapper).find("[data-stock-id]."+this.config.calendarOnCss).removeClass(this.config.calendarOnCss);$(this.config.sidebarCalendarWrapper).find('[data-name="'+k+'"]').addClass(this.config.calendarOnCss);this.rememberDate=k;this.config.selectD=true;this.trigger(b.EVENT_SELECT_DATE,k);this.trigger(b.EVENT_SELECT_LEAF,j.data())}},getDateEl:function(k){if(k){var j=$(this.config.calendarWrapper).find('[data-name="'+k+'"]');if(j.length){return j}}return null},showCalendar:function(j){var k=this;$(k.config.calendarWrapper).html("");if(k.config.sidebarCalendarWrapper){$(k.config.sidebarCalendarWrapper).html("")}$(k.config.calendarBlock).show();if(this.calendarCache[j]){$(k.config.calendarWrapper).html(k.calendarCache[j]);if(k.config.sidebarCalendarWrapper){$(k.config.sidebarCalendarWrapper).html(k.sidebarCalendarCache[j])}if(k.rememberDate){if(this.getDateEl(k.rememberDate)){k.config.selectD=true;k.selectDate(k.rememberDate)}else{k.config.selectD=false;k.trigger(b.EVENT_SELECT_LEAF,"");$("[data-date]").text("请选择日期");$(".stock-remain").hide()}}else{k.config.selectD=false;$("[data-date]").text("请选择日期");k.trigger(b.EVENT_SELECT_LEAF,"");$(".stock-remain").hide()}k.trigger(b.EVENT_CHANGE_CALENDAR,j)}else{h.getMulti("/sales/stock",{type:"calendar",parent_id:j,sales_id:k.config.salesId},{},function(m){if(m.errno){}else{var l=m.data.list;k.calendarCache[j]=l[0];$(k.config.calendarWrapper).html(l[0]);if(k.config.sidebarCalendarWrapper){k.sidebarCalendarCache[j]=l[1];$(k.config.sidebarCalendarWrapper).html(l[1])}if(k.rememberDate){if(k.getDateEl(k.rememberDate)){k.config.selectD=true;k.selectDate(k.rememberDate)}else{k.config.selectD=false;k.trigger(b.EVENT_SELECT_LEAF,"");$("[data-date]").text("请选择日期");$(".stock-remain").hide()}}else{k.config.selectD=false;k.trigger(b.EVENT_SELECT_LEAF,"");$("[data-date]").text("请选择日期");$(".stock-remain").hide()}k.trigger(b.EVENT_CHANGE_CALENDAR,j)}},"html",k.config.calendarDataDecorate)}},hideCalendar:function(){$(this.config.calendarBlock).hide()},getFirstEnableId:function(k){var j=$(".stock_"+k).find("[data-stock-id]:not(."+this.config.structureDisabledCss+")").eq(0);if(j.length){return j.attr("data-stock-id")|0}else{return 0}},getFirstEnableDate:function(){var j=this.getFirstDateNode();return j.attr("data-name")},getFirstDateNode:function(){return $(this.config.calendarWrapper).find("[data-stock-id]:not(."+this.config.calendarDisabledCss+")").eq(0)},monthTabLeft:function(){var j=$(".cal-month>.tab-arrLeft");if(!j.hasClass("tab-arrDisabled")){var k=$(".tab-box");var l=parseInt(k.css("margin-left"));$(".tab-box li").each(function(){var n=$(this).prev();var m=Math.ceil($(this).position().left);if(m+1>=-l){var o=m-n.outerWidth(true);if(o<=0){o=0;j.addClass("tab-arrDisabled")}k.animate({"margin-left":-o},200);$(".cal-month>.tab-arrRight").removeClass("tab-arrDisabled");return false}})}},monthTabRight:function(){var l=$(".cal-month>.tab-arrRight");if(!l.hasClass("tab-arrDisabled")){var j=$(".tab-box");var k=parseInt(j.css("margin-left"));$(".tab-box li").each(function(){var m=Math.ceil($(this).position().left);if(m>=-k){var p=m+$(this).outerWidth(true);var n=$(".tab-box li:last");var o=n.position().left+n.outerWidth()-$(".cal-tab").width();if(p>=o){l.addClass("tab-arrDisabled");p=o}j.animate({"margin-left":-p},200);$(".cal-month>.tab-arrLeft").removeClass("tab-arrDisabled");return false}})}},setNum:function(u,p,q,t){if(!this.selectedStock||!this.selectedStock.stockId){return}var k=$.extend(true,{},this.nums);if(u=="all"){this.nums.adult=this.rememberNums.adult;this.nums.kid=this.rememberNums.kid;this.nums.infant=this.rememberNums.infant;this.nums.room=this.rememberNums.room}if(u=="adult"){this.nums.adult=p}if(u=="kid"){this.nums.kid=p}if(u=="infant"){this.nums.infant=p}if(u=="room"){this.nums.room=p}if(this.nums.adult<this.selectedStock.min){this.nums.adult=this.selectedStock.min;if(t=="minus"){i("最小购买数为"+this.selectedStock.min)}}var l=Math.min(this.selectedStock.max,this.selectedStock.remain);if(this.config.giftCode){l=1}if(this.nums.adult>l){this.nums.adult=l;if(t=="plus"){i("最大购买数为"+l)}}var j;if(this.config.scope=="sales"){j=Math.min(this.nums.adult*2,this.selectedStock.kidRemain)}else{j=Math.min(this.selectedStock.max,this.selectedStock.remain)-this.nums.adult}if(this.selectedStock.kidPrice<=0){j=0}if(this.nums.kid>j){this.nums.kid=j}if(this.nums.kid<0){this.nums.kid=0}var s=this.nums.adult;if(this.nums.infant>s){this.nums.infant=s}if(this.nums.infant<0){this.nums.infant=0}var n=0;var o=0;if(this.selectedStock.singleRoomPrice>0){n=Math.ceil(this.nums.adult/2);o=this.nums.adult}else{o=n=0}if(this.nums.room<n){this.nums.room=n}if(this.nums.room>o){this.nums.room=o}if(u=="adult"){this.nums.room=n}if(this.selectedStock.singleRoomPrice>0){this.nums.singleRoom=this.nums.room*2-this.nums.adult}else{this.nums.singleRoom=0}var m=false;var r=this;$.each(k,function(v,w){if(w!=r.nums[v]){m=true;if(q&&u==v){r.rememberNums[v]=r.nums[v]}}});if(m){this.trigger(b.EVENT_CHANGE_NUMS,this.nums)}},changePrice:function(){this.price.singleRoom=this.round(this.selectedStock.singleRoomPrice*this.nums.singleRoom);var j=this.selectedStock.price*this.nums.adult+this.selectedStock.kidPrice*this.nums.kid+this.price.singleRoom;var l="";if(this.mode.type==b.MODE_GET_N_OFF_M){var k=new Date().getTime();if(this.mode.offlineTime>k&&(this.mode.sellingTime<k||!this.mode.saleOnBefore)){if(this.nums.adult>=this.mode.discount.minNum){var m=0;if(this.mode.discount.key==b.MODE_GET_N_OFF_M_KEY_PERCENT){m=this.round(this.mode.discount.val*this.selectedStock.price)}else{if(this.mode.discount.key==b.MODE_GET_N_OFF_M_KEY_PRICE){m=this.mode.discount.val}}j-=m;l="（第"+this.mode.discount.minNum+"份已省"+m+"元）"}}else{}}this.price.total=this.round(j);if(this.config.giftCode){this.price.total=0}if(isNaN(this.price.total)){$(this.config.totalPriceSelector).html("--");$(this.config.usedHoneySelector).html("");$(this.config.usedHoneyRightSelector).removeClass("has-honey")}else{$(this.config.rmbFlag).removeClass("hide").show();$(this.config.totalPriceSelector).html(this.price.total);if(this.selectedStock.honey>0){this.totalHoney=this.nums.adult*this.selectedStock.honey;$(this.config.usedHoneySelector).html("+"+this.totalHoney+"蜂蜜");$(this.config.usedHoneyRightSelector).html(this.price.total+'<br><span class="honey">+'+this.totalHoney+"蜂蜜</span>");$(this.config.usedHoneyRightSelector).addClass("has-honey")}else{$(this.config.usedHoneySelector).html("");$(this.config.usedHoneyRightSelector).removeClass("has-honey");$(this.config.usedHoneyRightSelector).html(this.price.total)}}if(this.config.totalPriceExtStrSelector){$(this.config.totalPriceExtStrSelector).html(l)[l?"show":"hide"]()}if(this.price.singleRoom){$(this.config.singleRoomTotalPriceSpan).html(this.price.singleRoom);$(this.config.singleRoomBlock).show()}else{$(this.config.singleRoomBlock).hide()}},round:function(j){return Math.round(j*100)/100},gotoBuy:function(){if(!this.selectedStock||!this.selectedStock.stockId){return}if(this.totalHoney>0&&this.totalHoney>window.Env.user_honey){i("购买当前商品需要"+this.totalHoney+"蜂蜜，您的蜂蜜余量不足，无法购买");return}var k={};k.sales_id=this.config.salesId;k.stock_id=this.selectedStock.stockId;k.num=this.nums.adult;k.infant_num=this.nums.infant;k.kid_num=this.nums.kid;k.room_num=this.nums.room;if(this.config.giftCode&&this.config.giftCode.length){k.gift_code=this.config.giftCode}var j=$.param(k);this.redirect("/sales/order/booking.php?"+j,true)},gotoBargain:function(){var k={bargain:1};k.sales_id=this.config.salesId;k.stock_id=this.selectedStock.stockId;k.num=this.nums.adult;k.infant_num=this.nums.infant;k.kid_num=this.nums.kid;k.room_num=this.nums.room;if(this.config.giftCode&&this.config.giftCode.length){k.gift_code=this.config.giftCode}var j=$.param(k);this.redirect("/sales/order/booking.php?"+j,true)}};a.exports=b});M.define("/js/sales/sidebar",function(b,a,c){var d=function(e){this.config=$.extend(true,{},this.config,e)};d.prototype={$sidebar:null,config:{sidebar:".side-bar",wrapper:".detail-wrapper",resizeEvents:[]},sidebarTop:0,sidebarHeight:0,sidebarMaxTop:0,init:function(){this.initDropMenu();this.initOtaContact();this.initFixed()},initDropMenu:function(){$(".m-book").on("click",".trigger",function(){var e=$(this);var i=e.parent();var g=$(this).nextAll(".s_popup");if(g.is(":visible")){}else{g.show();i.addClass("drop-open");var f=g.children(".drop-menu");if(f.length){f.css({"max-height":"",overflow:""});var h=$(window).height()-g.position().top-20;if(h<f.height()){f.css({"max-height":h+"px",overflow:"scroll"})}}setTimeout(function(){$(document.body).on("click",function(k){var j=$(k.target);if(!j.closest(i).length||j.closest(e).length||j.closest("[data-stock-id]").length||j.is("[data-stock-id]")||j.is(".btn")){g.hide();i.removeClass("drop-open");$(document.body).off("click",arguments.callee)}})},0)}})},initOtaContact:function(){var e=this;$(this.config.sidebar).find(".m-contact .s-more").click(function(){var f=$(this).nextAll(".contact-pop");if(f.is(":visible")){f.hide()}else{$(e.config.sidebar).find(".m-contact .contact-pop").hide();f.show()}})},initFixed:function(){var e=this;this.$sidebar=$(this.config.sidebar);$(window).on("scroll",function(){e.onScroll()});$(document).on(this.config.resizeEvents.join(" "),function(){e.reset()});e.reset()},reset:function(){var e=$(this.config.wrapper);this.sidebarTop=parseInt(e.offset().top);this.sidebarHeight=parseInt(this.$sidebar.outerHeight());this.sidebarMaxTop=this.sidebarTop+e.height()-this.sidebarHeight;this.onScroll()},onScroll:function(){var e=$(window).scrollTop();if(e>=this.sidebarTop){if(e>=this.sidebarMaxTop){this.$sidebar.addClass("absolute");this.$sidebar.addClass("fixed")}else{this.$sidebar.addClass("fixed");this.$sidebar.removeClass("absolute")}}else{this.$sidebar.removeClass("fixed")}}};c.exports=d});M.define("/js/sales/map",function(b,a,c){var d=function(e){this.config=$.extend(true,{},this.config,e)};d.prototype={$sidebar:null,config:{trigger:".a-maps",closeBtn:"#btn_close_map",dialog:"#pnl_mappop",mapWrapper:"#hotel_map_box",resizeEvents:[]},_map:null,_marker:null,init:function(){var e=0;var f=this;$(this.config.trigger).on("click",function(){var g=$(this),j=g.offset().top,i=g.offset().left;var h=g.data();$(f.config.dialog).css({top:j,left:i-233}).show();if(e===0){e=1;var k=new MfwMapLoad(function(){f.setMarker(h.lat,h.lng,h.name);e=2},6000,false);k.loadGoogleMap()}else{if(e===1){var l=setInterval(function(){if(e===2){clearInterval(l);f.setMarker(h.lat,h.lng,h.name)}},500)}else{f.setMarker(h.lat,h.lng,h.name)}}});$(this.config.closeBtn).on("click",function(){$(f.config.dialog).hide()})},getMap:function(f){if(!f){return this._map}var e={center:f,zoom:14,panControl:true,scaleControl:true,disableDefaultUI:true,zoomControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP};e.styles=[{featureType:"all",stylers:[{saturation:-28}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{saturation:50}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#cccccc"},{saturation:-25}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]}];if(this._map){this._map.setOptions(e)}else{this._map=new google.maps.Map($(this.config.mapWrapper).get(0),e)}return this._map},setMarker:function(g,e,h){var i=new google.maps.LatLng(parseFloat(g),parseFloat(e));var f={position:i,map:this.getMap(i),title:h,icon:location.protocol+"//images.mafengwo.net/images/hotel/map_marker_red.png"};if(this._marker){this._marker.setOptions(f)}else{this._marker=new google.maps.Marker(f)}}};c.exports=d});M.define("/js/sales/slider",function(c,b,d){var a=function(){};a.prototype={_index:0,_length:0,_autoPlayInterval:0,_autoPlayId:0,_autoPlayPause:false,_itemWidth:0,$list:null,$wrapper:null,sliderDom:[],init:function(f){var e=this;this.sliderDom=f;this.$list=$(this.sliderDom);this._length=this.$list.length;this.$wrapper=this.$list.parent();this._index=0;this._itemWidth=this.$list.eq(0).width();this.$wrapper.width(this._itemWidth*this._length);$(this.$wrapper.siblings(".btn-next")).click(function(){e.next(e.sliderDom)});$(this.$wrapper.siblings(".btn-prev")).click(function(){e.prev(e.sliderDom)});$(this.$wrapper).on("mouseenter",function(){e._autoPlayPause=true}).on("mouseleave",function(){e._autoPlayPause=false})},next:function(){var e=this._index+1;if(e>=this._length){e=0}this.setIndex(e)},prev:function(){var e=this._index-1;if(e<0){e=this._length-1}this.setIndex(e)},setIndex:function(e){this.$wrapper.stop().animate({"margin-left":-e*this._itemWidth},200);this._index=e;$(this.$wrapper.siblings(".dot")).children().removeClass("on").eq(e).addClass("on")},autoPlay:function(e){var f=this;this._autoPlayInterval=e;window.setTimeout(function(){if(!f._autoPlayPause){f.next()}window.setTimeout(arguments.callee,e)},e)}};d.exports=a});function get_connect_share_js(e,h,f,d,c){var g="";if(e=="sina"){if("object"===typeof f){f=f.sina}if(f!=""){h=f.substr(0,140)}var b="http://service.weibo.com/share/share.php?appkey=82015185&title="+encodeURIComponent(h)+"&pic="+encodeURIComponent(c)+"&url="+encodeURIComponent(d)+"&ralateUid=1730714982";g="window.open('"+b+"','_blank','scrollbars=no,width=600,height=480,left=75,top=20,status=no,resizable=yes');"}else{if(e=="renren"||e=="xiaonei"){if("object"===typeof h){h=h.renren}if("object"===typeof f){f=f.renren}var a={resourceUrl:d,pic:c,title:h,description:f};shareClick(a)}else{if(e=="qzone"||e=="qq"){if("object"===typeof h){h=h.qq}if("object"===typeof f){f=f.qq}g="window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title="+encodeURIComponent(h)+"&summary="+encodeURIComponent(f)+"&pics="+encodeURIComponent(c)+"&site="+encodeURIComponent("马蜂窝")+"&url="+encodeURIComponent(d)+"','_blank','scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes');"}else{return false}}}return g}function sns_share_show(e,g,f,d,c,a){var h=e.split("_")[0];if("object"===typeof f){f=f[h]}if(typeof(ata)!="undefined"){ata("sn")}if(h=="wb"){if(f!=""&&f!=undefined){f=f.substr(0,140)}var b="http://www.mafengwo.cn/connect_share.php?key="+e+"&title="+encodeURIComponent(g)+"&content="+encodeURIComponent(f)+"&url="+encodeURIComponent(d)+"&pic="+encodeURIComponent(c);return'window.open("'+b+'", "_blank", "scrollbars=no,width=600,height=480,left=75,top=20,status=no,resizable=yes");'}else{if(h=="rr"){var b="http://www.mafengwo.cn/connect_share.php?key="+e+"&title="+encodeURIComponent(g)+"&content="+encodeURIComponent(f)+"&url="+encodeURIComponent(d)+"&pic="+encodeURIComponent(c);return'window.open("'+b+'", "_blank", "scrollbars=no,width=700,height=650,left=75,top=20,status=no,resizable=yes");'}else{if(h=="qz"){var b="http://www.mafengwo.cn/connect_share.php?key="+e+"&title="+encodeURIComponent(g)+"&content="+encodeURIComponent(f)+"&url="+encodeURIComponent(d)+"&pic="+encodeURIComponent(c);return'window.open("'+b+'", "_blank", "scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes");'}else{if(h=="qt"){var b="http://www.mafengwo.cn/connect_share.php?key="+e+"&title="+encodeURIComponent(g)+"&content="+encodeURIComponent(f)+"&url="+encodeURIComponent(d)+"&pic="+encodeURIComponent(c);return'window.open("'+b+'", "_blank", "scrollbars=no,width=700,height=680,left=75,top=20,status=no,resizable=no,menubar=no,toolbar=no,scrollbars=no,location=yes");'}else{if(h=="ww"){var b="http://www.mafengwo.cn/connect_share.php?key="+e+"&title="+encodeURIComponent(g)+"&content="+encodeURIComponent(f)+"&url="+encodeURIComponent(d)+"&pic="+encodeURIComponent(c)+"&tag="+encodeURIComponent(a);return'window.open("'+b+'", "_blank", "scrollbars=no,width=660,height=550,left=75,top=20,status=no,resizable=no,menubar=no,toolbar=no,scrollbars=no,location=yes");'}}}}}}if("M" in window&&"define" in M){M.define("/js/m.sns.share",function(){return sns_share_show})}M.define("/js/sales/share",function(require,exports,module){var SalesShare=function(config){this.config=$.extend(true,{},this.config,config)};SalesShare.prototype={config:{salesId:0,title:"",description:"",url:"",img:""},toWeibo:function(){var sns_share_show=require("/js/m.sns.share");eval(sns_share_show("wb_tinfo_1",this.config.title,this.config.title,this.config.url,this.config.img));this._record("sina")},toQzone:function(){var sns_share_show=require("/js/m.sns.share");eval(sns_share_show("qz_tinfo_1",this.config.title,this.config.title,this.config.url,this.config.img));this._record("qq")},toWeixin:function(){$("#popup_container2").show();this._record("weixin")},_record:function(type){var params={act:"shareSales",sales_id:this.config.salesId,share_type:type};$.getJSON("/sales/ajax.php",params)}};return module.exports=SalesShare});M.define("/js/sales/favorite",function(c,b,d){var a=function(e){this.config=$.extend(true,{},this.config,e)};a.prototype={config:{},add:function(e,f,g){return mfwRest.post("/sales/favorite",{action:"add",data_id:e,type:f},function(h){g(h)},"default","message")},remove:function(e,f,g){return mfwRest.post("/sales/favorite",{action:"remove",data_id:e,type:f},function(h){g(h)})},list:function(){throw new Error("undefined method")}};return d.exports=a});M.define("/js/sales/review",function(c,b,d){var a=c("/js/localdeals/rest");var e=function(f){this.config=$.extend(true,{},this.config,f)};e.EVENT_LOAD_LIST="sales_review_load_list";e.prototype={config:{salesId:0},currentPage:1,currentStar:0,currentHasImg:"",init:function(){var f=this;this.loadList(0,"",1);$(".m-reviews a").click(function(){var h=$(this),i=h.data("star"),g=h.data("has-img")||"";if((f.currentStar!=i)||(f.currentHasImg!==g)){f.loadList(i,g,1);$(this).parent().addClass("on").siblings().removeClass("on")}})},alert:function(f){if("mTinyAlert" in window){window.mTinyAlert(f)}else{alert(f)}},trigger:function(f,g){$(document).trigger(f,g)},loadList:function(j,f,i){var h=this;if(!arguments.length){j=h.currentStar;f=h.currentHasImg;i=h.currentPage}else{h.currentStar=j;h.currentHasImg=f;h.currentPage=i}var g={sales_id:this.config.salesId,star:j,has_img:f,page_no:i,style:"html",decorate:"www"};$(".rev-list").css("visibility","hidden");$.get("/sales/c/comment/api/list",g,function(l){if(l.error){h.alert(l.error.msg)}else{var k=$(".rev-list").empty();if(l.data.page.data_total){$(".m-reviews .empty-msg").hide();$.each(l.data.list,function(n,m){k.append(m)});k.css("visibility","visible");h.trigger(e.EVENT_LOAD_LIST)}else{$(".m-reviews .empty-msg").show()}$("#review_page_box").pagination("destroy").pagination({page:l.data.page.no,total:l.data.page.data_total,item_size:l.data.page.num,callback:function(m){var n=$("#target_review");$(window).scrollTop(n.offset().top);h.loadList(h.currentStar,h.currentHasImg,m)}});$(".rev-item").delegate("._j_total","click",function(){var o=$(this),n=o.parents(".txt");n.hide();var m=n.next();m.show()})}})}};d.exports=e});M.define("dialog/Layer",function(a){var g=0,f=550,d=(function(){return $.browser&&$.browser.msie&&parseInt($.browser.version,10)==7}()),c=(function(){return $.browser&&$.browser.msie&&parseInt($.browser.version,10)<7}());function b(){return g++}function e(h){this.opacity=0.8;this.background="#fff";this.impl="Dialog";this.fixed=true;M.mix(this,h);this.id="_j_layer_"+b();this.stacks=[];this.activeStackId=null;this.overflow=false;this.changeFixed=false;e.instances[this.id]=this;if(!e[this.impl]){e[this.impl]=[]}e[this.impl].push(this.id);this.init()}e.prototype={init:function(){this._createPanel()},_createPanel:function(){f++;var h={position:(!c&&this.fixed)?"fixed":"absolute",width:"100%",height:"100%",top:0,left:0},j=M.mix({},h,{"z-index":f,display:"none"}),k=M.mix({},h,{position:!c?"fixed":"absolute",background:this.background,opacity:this.opacity,"z-index":-1}),i=M.mix({},h,{"z-index":0},(!c&&this.fixed)?{"overflow-x":"hidden","overflow-y":"hidden"}:{overflow:"visible"});this._panel=$('<div id="'+this.id+'" class="layer _j_layer">                                <div class="layer_mask _j_mask"></div>                                <div class="layer_content _j_content"></div>                            </div>').css(j).appendTo("body");this._mask=this._panel.children("._j_mask").css(k);this._content=this._panel.children("._j_content").css(i)},setZIndex:function(h){f=h;this._panel.css("z-index",f)},getZIndex:function(){return +this._panel.css("z-index")},toFront:function(){this.setZIndex(f+1)},setFixed:function(h){h=!!h;if(this.fixed!=h){this.changeFixed=true;this.fixed=h;if(!c&&this.fixed){this._panel.css("position","fixed");this._content.css({position:"fixed","overflow-x":"hidden","overflow-y":"hidden"})}else{this._panel.css("position","absolute");this._content.css({position:"absolute","overflow-x":"","overflow-y":"",overflow:"visible"})}}else{this.changeFixed=false}},newStack:function(i){var h=$(i).appendTo(this._content);this.stacks.push(h);return this.stacks.length-1},getStack:function(h){return this.stacks[h]},getActiveStack:function(){return this.stacks[this.activeStackId]},setActiveStack:function(h){this.activeStackId=h},getPanel:function(){return this._panel},getMask:function(){return this._mask},getContent:function(){return this._content},show:function(j){var i=this;if(this.visible){typeof j==="function"&&j();return}e.activeId=this.id;this.visible=true;if(c){var h=document.documentElement&&document.documentElement.scrollHeight||document.body.scrollHeight;this._panel.css("height",h);this._mask.css("height",h)}this._panel.fadeIn(200,function(){typeof j==="function"&&j()})},hide:function(i){var h=this;if(!this.visible){typeof i==="function"&&i();return}this.visible=false;if(c){this._panel.css("height","");this._mask.css("height","")}this._panel.fadeOut(200,function(){typeof i==="function"&&i();h._recoverTopScroller()})},setOverFlow:function(h){this.overflow=h;if(h){if(!c&&this.fixed){this._hideTopScroller();this._content.css("overflow-y","auto")}}else{if(!c&&this.fixed){this._content.css("overflow-y","hidden")}}},_hideTopScroller:function(){if(d){$("html").css("overflow","hidden")}else{if(!c){$("body").css("overflow","hidden")}else{$("body").css("overflow-x","hidden");this._panel.height($(document).height()+20)}}},_recoverTopScroller:function(){if(d){$("html").css("overflow","")}else{if(!c){$("body").css("overflow","")}else{$("body").css("overflow-x","")}}},destroy:function(){this.hide($.proxy(function(){this._panel&&this._panel.remove();this._panel=null;if(M.indexOf(e[this.impl],this.id)!=-1){e[this.impl].splice(M.indexOf(e[this.impl],this.id),1)}delete e.instances[this.id]},this))},clear:function(){this._content.empty();this.stacks=[];this.activeStackId=null}};e.instances={};e.activeId=null;e.getInstance=function(h){return e.instances[h]};e.getActive=function(h){var i=e.getInstance(e.activeId);if(h&&i){i=i.impl===h?i:null}return i};e.getImplInstance=function(i){var h=e.getActive(i);if(!h&&M.is(e[i],"Array")&&e[i].length){h=e.getInstance(e[i][e[i].length-1])}return h};e.closeActive=function(){var h=e.getActive();if(h&&h.getActiveStack()){h.getActiveStack().trigger("close")}};$(document).keyup(function(h){if(h.keyCode==27){e.closeActive()}});$(document).unload(function(){M.forEach(e.instances,function(){e.destroy()})});return e});M.define("dialog/DialogBase",function(b){var e=b("dialog/Layer"),a=M.Event,d=(function(){return $.browser&&$.browser.msie&&parseInt($.browser.version,10)<7}());function c(f){this.newLayer=false;this.width="";this.height="";this.background="#000";this.panelBackground="#fff";this.bgOpacity=0.7;this.stackable=true;this.fixed=true;this.reposition=false;this.autoPosition=true;this.minTopOffset=20;this.layerZIndex=-1;this.impl="Dialog";M.mix(this,f);this.visible=false;this.destroyed=false;this.positioned=false;this.resizeTimer=0;this.init()}c.prototype={tpl:"<div />",init:function(){this._createDialog();this._bindEvents()},_createDialog:function(){this._panel=$(this.tpl).css({position:"absolute",opacity:0,display:"none",background:this.panelBackground,"z-index":0});this.setRect({width:this.width,height:this.height});this._layer=!this.newLayer&&e.getImplInstance(this.impl)||new e({impl:this.impl});if(this.layerZIndex>=0){this._layer.setZIndex(this.layerZIndex)}this._layer.setFixed(this.fixed);this._layer.getMask().css({background:this.background,opacity:this.bgOpacity});this._stackId=this._layer.newStack(this._panel);this.setPanelContent()},_bindEvents:function(){var f=this;$(window).resize($.proxy(this.resizePosition,this));M.Event(this).on("resize",$.proxy(this.resizePosition,this));this._panel.delegate("._j_close, a[data-dialog-button]","click",function(g){var h=$(g.currentTarget).attr("data-dialog-button");if(h=="hide"){f.hide()}else{f.close()}g.preventDefault()});this._panel.bind("close",function(g,h){f.close(h)})},resizePosition:function(){var f=this;clearTimeout(this.resizeTimer);if(f.visible&&f.autoPosition){this.resizeTimer=setTimeout(function(){f.setPosition()},100)}},addClass:function(f){this._panel.addClass(f)},removeClass:function(f){this._panel.removeClass(f)},setRect:function(f){if(f.width){this._panel.css("width",f.width);this.width=f.width}if(f.height){this._panel.css("height",f.height);this.height=f.height}},getPanel:function(){return this._panel},getLayer:function(){return this._layer},getMask:function(){return this._layer&&this._layer.getMask()},setPanelContent:function(){},_getPanelRect:function(){var f=this.getPanel(),g=f.outerHeight(),h=f.outerWidth();if(!f.is(":visible")){f.css({visibility:"hidden",display:"block"});var g=f.outerHeight(),h=f.outerWidth();f.css({visibility:"",display:""})}return{height:g,width:h}},_getNumric:function(f){f=parseInt(f,10);return isNaN(f)?0:f},setPosition:function(f){var g=this._getPanelRect(),h={width:$(window).width(),height:$(window).height()};var k=(h.width-(this._getNumric(this.width)>0?this._getNumric(this.width):g.width))/2,j=(h.height-(this._getNumric(this.height)>0?this._getNumric(this.height):g.height))*4/9;j=j<this.minTopOffset?this.minTopOffset:j;if(d||!this.fixed){var i=$(window).scrollTop();if(i>0){j+=i}}f={left:(f&&f.left)||k,top:(f&&f.top)||j};if(!d&&this.fixed){if(h.height-g.height<=f.top){this.getPanel().addClass("dialog_overflow");this._layer.setOverFlow(true)}else{this.getPanel().removeClass("dialog_overflow");this._layer.setOverFlow(false)}}var l=this.positioned?"animate":"css";$.fn[l].call(this.getPanel(),f,200);this.positioned=true;this.position=f},setFixed:function(f){this.fixed=!!f;this._layer.setFixed(this.fixed)},getPosition:function(){return this.position},show:function(f){if(this.visible){return}var h=this;a(this).fire("beforeshow");var g;if(this._layer.getActiveStack()){g=this._layer.getActiveStack();if(!this.reposition&&!f&&!this._layer.changeFixed){f=this._layer.getActiveStack().position()}}this._layer.show();this.getPanel().css({display:"","z-index":1});this.setPosition(f);g&&g.trigger("close",[true]);this.visible=true;this._layer.setActiveStack(this._stackId);this.getPanel().animate({opacity:1},{queue:false,duration:200,complete:function(){a(h).fire("aftershow")}})},close:function(){var f=this.stackable?"hide":"destroy";this[f].apply(this,Array.prototype.slice.call(arguments))},hide:function(g,f){if(typeof g=="function"){f=g;g=undefined}if(!this.visible){typeof f=="function"&&f();return}a(this).fire("beforeclose");a(this).fire("beforehide");this._layer.setActiveStack(null);this.visible=false;if(!g){this._layer.hide()}this.getPanel().animate({opacity:0},{queue:false,duration:200,complete:$.proxy(function(){this.getPanel().css({display:"none","z-index":0});a(this).fire("afterhide");a(this).fire("afterclose");typeof f=="function"&&f()},this)})},destroy:function(g,f){if(typeof g=="function"){f=g;g=undefined}if(this.destroyed){M.error("Dialog already destroyed!");typeof f=="function"&&f();return}a(this).fire("beforeclose");a(this).fire("beforedestroy");this.destroyed=true;this.hide(g,$.proxy(function(){if(this._panel.length){this._panel.undelegate();this._panel.unbind();this._panel.remove();this._panel=null}this._layer=null;a(this).fire("afterdestroy");a(this).fire("afterclose");typeof f=="function"&&f()},this))}};return c});M.define("dialog/Dialog",function(c){var d=c("dialog/DialogBase"),a='<div class="popup-box layer_dialog _j_dialog pop_no_margin">                    <div class="dialog_title" style="display:none"><div class="_j_title title"></div></div>                    <div class="dialog_body _j_content"></div>                    <a id="popup_close" class="close-btn _j_close"><i></i></a>                </div>';var b=M.extend(function(e){this.content="";this.title="";this.PANEL_CLASS="";this.MASK_CLASS="";b.$parent.call(this,e)},d);M.mix(b.prototype,{tpl:a,setPanelContent:function(){this._dialogTitle=this._panel.find("._j_title");this._dialogContent=this._panel.find("._j_content");this.setTitle(this.title);this.setContent(this.content);this.addClass(this.PANEL_CLASS);this.getMask().addClass(this.MASK_CLASS)},setTitle:function(e){if(e){this._dialogTitle.html(e).parent().css("display","")}else{this._dialogTitle.parent().css("display","none")}this.title=e},getTitle:function(){return this.title},setContent:function(e){this._dialogContent.empty().append(e)}});return b});M.define("/js/sales/countdown",function(b,a,c){var d=function(e){this.$el=$(e);this.target=0};d.prototype={zero:function(f,e){var f=parseInt(f,10);if(f>0){if(f<=9&&e!=1){f="0"+f}return String(f)}else{return e==1?"0":"00"}},caculate:function(){var e=(new Date()).valueOf();var f=Math.round((this.target-e)/100);var g={msec:"00",sec:"00",mini:"00",hour:"00",dur:f};if(f>0){g.msec=this.zero(f%10);g.sec=Math.floor(f/10)>0?this.zero(Math.floor(f/10)%60):"00";g.mini=Math.floor(f/600)>0?this.zero(Math.floor(f/600)%60):"00";if(this.isDayHour){g.hour=Math.floor(f/36000)>0?this.zero(Math.floor(f/36000)):"00"}else{g.hour=Math.floor(f/36000)>0?this.zero(Math.floor(f/36000)%24):"00"}g.day=Math.floor(f/864000)>0?Math.floor(f/864000):"0"}return g},correctTime:function(){var e=this;if("serverTimeDiff" in d){e.target+=d.serverTimeDiff}else{if(!d.lock){d.lock=true;$.getJSON("/sales/ajax.php",{act:"GetTime"},function(g){d.lock=false;if(g.ret==1){var f=parseInt(g.msg);d.serverTimeDiff=((new Date()).valueOf()-f);e.target+=d.serverTimeDiff}})}}},setTargetTime:function(f){if(f){this.target=f;this.correctTime();var e=this.caculate();if(e.dur>0){this.start();return true}else{this.stop();return false}}else{this.stop();return false}},_interval:0,start:function(){if(!this._interval){var e=this;this._interval=setInterval(function(){e.interval()},100);e.interval()}},stop:function(){clearInterval(this._interval);this._interval=0},interval:function(){var e=this.caculate();this.$el.find(".dd").text(e.day);this.$el.find(".hh").text(e.hour);this.$el.find(".mm").text(e.mini);this.$el.find(".ss").text(e.sec);this.$el.find(".ms").text(e.msec);if(e.dur<=0){this.stop();this.$el.trigger("countdownover")}},isDayHour:false};c.exports=d});M.define("/js/sales/stock/Process",function(f,r,b){var d={addJQueryFn:function(){if(!$.fn.findByData){$.fn.findByData=function(t,u){if(u!==undefined){return $(this).find(d.dataWrap(t+"="+u))}else{return $(this).find(d.dataWrap(t))}}}},Result:function(u,t,v){this.code=u;this.message=t;this.data=v},success:function(t){return new d.Result(0,"",t)},error:function(u,t){return new d.Result(t||-1,u,null)},danger:function(t){if("mAlert" in window){window.mAlert(t.message)}},select:function(t){return $(d.dataWrap(t))},dataWrap:function(t){return"["+t+"]"},selectWithValue:function(t,u){return d.select(t+"="+u)},getDataValue:function(u,t){var v;t=t.split("-");t.shift();v=_.reduce(t,function(w,y,x){return(w+(x===0?y:y.charAt(0).toUpperCase()+y.slice(1)))},"");return u.data(v)},setDataValue:function(u,t,v){u.attr(t,v)},clone:function(t,u){return d.select(t).clone().removeAttr(t).attr(t.replace("-template",""),u||1)},bindRootClickEvent:function(t,u){$(document).on("click",d.dataWrap(t),u)},bindSubClickEvent:function(u,t,v){$(document).on("click",d.dataWrap(u)+" "+d.dataWrap(t),v)},fetch:function(t){return $.getJSON("/sales/detail/stock/info",{groupId:t})},fetchSkuDetail:function(u,t){return $.getJSON("/sales/detail/stock/detail",{groupId:u,skuIds:t})},precheckFengqiang:function(t){return $.getJSON("/sales/detail/stock/precheckFengqiang",{skuId:t})},fetchPromotion:function(t){return $.getJSON("/rest/sales/promotion/",{filter:{group_id:t},data_style:"simple"})},calPromotion:function(u,w,t,v){return $.getJSON("/rest/sales/promotion/",{filter:{type:"cal",group_id:u,start_time:w,end_time:t,detail:v}})},createCalendar:function(v){var u=_.reduce(v,function(x,y){var z=y.substr(0,7);if(!_.contains(x,z)){x.push(z)}return x},[]);var t=[],w={};_.each(u,function(A){var y=moment(A,"YYYY-MM").startOf("month"),C=moment(A,"YYYY-MM").endOf("month"),z=[],B;for(B=0;B<y.format("d");B++){z.push({date:"",D:"",day:B})}for(var x=y;x.isSame(C)||x.isBefore(C);x.add(1,"days")){B=x.format("d");z.push({date:x.format("YYYY-MM-DD"),D:x.format("D"),day:B})}for(;B<6;B++){z.push({date:"",D:"",day:B})}x.add(-1,"days");w[A]={firstDayMoment:y,list:z}});_.each(_.keys(w).sort(),function(x){t.push(w[x])});return t},getFirstMonth:function(t){t.sort();return t.length?t.shift().substr(0,7):""},rangeWalk:function(x,y,u){var t=moment(x,"YYYY-MM-DD"),v=moment(y,"YYYY-MM-DD");for(;t.isBefore(v)||t.isSame(v);t.add(1,"days")){var w=u(t.format("YYYY-MM-DD"));if(w===false){break}}},getRangeLength:function(u,t){if(!u||!t||!(u<t)){return 0}var v=0;d.rangeWalk(u,t,function(){v++});return v},SINGLE_ROOM_DEF_ID:29,ADDON_DEF_ID:66};var p=function(u,t){this.data=u;this.template=t;this.id=u.id;this.name=u.name;this.price=u.price;this.remain=u.remain;this.rangeMinLength=u.range_min_length;this.rangeMaxLength=u.range_max_length;this.lastDate=u.last_date;this.rules=u.rules;this.fetched=false;this.isDefault=u.price_search_way===0;this.isSingleDate=u.price_search_way===1;this.isRangeDate=u.price_search_way===2;this.lastDate=u.last_date;this.isCalendar=this.isSingleDate||this.isRangeDate;this.calendar=[];this.defaultPrice=null;this.priceDefs=t.listPriceDef(u.price_def_set);this.primaryPriceDef=t.getPrimaryDef(u.price_def_set)};p.prototype.setData=function(t){if(this.isDefault){this.fetched=true;this.defaultPrice=t.default_price}else{this.calendar=_.filter(t.calendar,function(u){return(u.is_unlimited||(!u.is_unlimited&&u.remain>=u.min_order_num))});if(this.calendar.length){this.fetched=true}}};p.prototype.setRangeData=function(t){this.rangeData=t};p.prototype.getRangeData=function(){return this.rangeData};p.prototype.listPriceByDate=function(t){return _.filter(this.calendar,function(u){return u.date===t})};p.prototype.hasPriceOnDate=function(t){return(this.listPriceByDate(t).length>0&&this.getPriceByDefAndDate(this.primaryPriceDef.id,t)&&this.getPriceByDefAndDate(this.primaryPriceDef.id,t).remain>0)};p.prototype.hasPriceOnRange=function(v,u){var t=true,x=this,w;if(!v||!u||!(v<u)){return false}w=d.getRangeLength(v,u);if(w<this.rangeMinLength||w>this.rangeMaxLength){return false}d.rangeWalk(v,u,function(y){if(!x.hasPriceOnDate(y)){t=false;return false}});return t};p.prototype.needRoomPicker=function(t){return(_.some(this.priceDefs,function(u){return u.id===d.SINGLE_ROOM_DEF_ID})&&_.some(this.listPriceByDate(t),function(u){return u.def_id===d.SINGLE_ROOM_DEF_ID}))};p.prototype.getPriceByDefAndDate=function(t,u){return _.find(this.calendar,function(v){return(v.date===u&&v.def_id===t*1&&v.remain>=v.min_order_num)})};p.prototype.getPickedPrice=function(u){var t={},v=this;_.each(u,function(x,w){var y=v.getPriceByDef(w);t[w]=y.price});return t};p.prototype.getPickedPriceByDate=function(u,v){var t={},w=this;_.each(u,function(y,x){var z=w.getPriceByDefAndDate(x,v);if(z){t[x]=z.price}});return t};p.prototype.getPriceByDef=function(t){return _.find(this.defaultPrice,function(u){return u.def_id===t*1&&u.remain>=u.min_order_num})};p.prototype.sumUseBedNum=function(t){var u=0;_.each(this.priceDefs,function(v){if(v.use_bed&&v.type===0&&_.has(t,v.id)){u+=t[v.id]}});return u};p.prototype.getDefaultPrice=function(){return this.defaultPrice};p.prototype.listCalendar=function(){var t=this;return _.filter(this.calendar,function(u){return u.def_id===t.primaryPriceDef.id})};p.prototype.testDefaultNum=function(u){if(!_.size(u)){return d.error()}var t=d.success(),v=this;_.every(u,function(y,w){var x=v.template.getPriceDef(w).name,z=v.getPriceByDef(w);if(y>z.remain){t=d.error(x+"仅剩"+z.remain+"份",1002);return false}else{if(y>z.max_order_num){t=d.error(x+"每单最多购买"+z.max_order_num+"份",1002);return false}else{if(y<z.min_order_num){t=d.error(x+"每单最少购买"+z.min_order_num+"份",1002);return false}}}return true});return t};p.prototype.createDefaultNum=function(){var t={},u=this;_.each(this.priceDefs,function(w){var v=u.getPriceByDef(w.id);if(v){t[w.id]=Math.min(v.min_order_num,v.remain)}});return t};p.prototype.testDateNum=function(v,u){if(!_.size(u)){return d.error()}var t=d.success(),w=this,x=this.listPriceByDate(v);if(x.length>_.size(u)){t=d.error("日期["+v+"]需要重置费用",1001);return t}_.every(u,function(A,y){var B=w.getPriceByDefAndDate(y,v),z;if(!B||!B.def_id){t=d.error("日期["+v+"]不存在费用",1001);return false}z=w.template.getPriceDef(B.def_id).name;if(A>B.remain){t=d.error("日期["+v+"]的"+z+"仅剩"+B.remain+"份",1002);return false}else{if(A>B.max_order_num){t=d.error("日期["+v+"]的"+z+"每单最多购买"+B.max_order_num+"份",1002);return false}else{if(A<B.min_order_num){t=d.error("日期["+v+"]的"+z+"每单最少购买"+B.min_order_num+"份",1002);return false}}}return true});return t};p.prototype.createDateNum=function(u){var t={},v=this;_.each(this.priceDefs,function(x){var w=v.getPriceByDefAndDate(x.id,u);if(w){t[x.id]=Math.min(w.min_order_num,w.remain)}});return t};p.prototype.testRangeNum=function(w,v,u){if(!_.size(u)){return d.error()}var x=this,t=d.success();d.rangeWalk(w,v,function(y){t=x.testDateNum(y,u);return t.code===0});return t};p.prototype.createRangeNum=function(v,u){var w=this,t={};d.rangeWalk(v,u,function(y){var x=_.size(t);_.each(w.priceDefs,function(B){var A=w.getPriceByDefAndDate(B.id,y);if(A){var z=Math.min(A.min_order_num,A.remain);if(!_.has(t,B.id)&&x===0){t[B.id]=z}else{if(_.has(t,B.id)){t[B.id]=Math.min(t[B.id],z);return t[B.id]}}}else{delete t[B.id]}})});return t};p.prototype.hasFengqiang=function(){return this.promotion&&this.promotion.FlashSale};p.prototype.hasNOff=function(){return this.promotion&&this.promotion.NOff};p.prototype.hasEarlyBird=function(){return this.promotion&&this.promotion.EarlyBird};p.prototype.hasTimeLimitedReduce=function(){return this.promotion&&this.promotion.TimeLimitedReduce};var o=function(u,t){this.data=u;this.id=u.id;this.name=u.name;this.isCalendar=u.price_search_way===1||u.price_search_way===2;this.calendar=u.calendar||[];this.defaultPrice=u.default_price;this.priceDef=t.getAddonDef()};o.prototype.getDatePrice=function(t){return _.find(this.calendar,function(u){return u.date===t&&u.remain>=u.min_order_num})};var j=function(){this.skuList=[];this.addonList=[];this.template=null};j.prototype.setTemplate=function(t){this.template=t};j.prototype.setSkuList=function(t){var u=this;_.each(t,function(v){u.skuList.push(new p(v,u.template))})};j.prototype.setAddonList=function(u){var t=this;_.each(u,function(v){t.addonList.push(new o(v,t.template))})};j.prototype.listSku=function(){return this.skuList};j.prototype.listByIds=function(x,w,t){var y=this,u=[],v;v=_.filter(this.skuList,function(z){if(!z.fetched&&_.contains(w,z.id)){u.push(z.id)}return _.contains(w,z.id)});if(u.length){d.fetchSkuDetail(x,u.splice(0,10)).then(function(z){if(z.error.code===0){_.each(z.data.sku,function(A){var B=y.findSkuById(A.id);B.setData(A)})}t(v)})}else{t(v)}};j.prototype.findSkuById=function(t){if(!t){return null}return _.find(this.skuList,function(u){return u.id===t})};j.prototype.removeSkuById=function(u){var t=_.findIndex(this.skuList,function(v){return v.id===u});if(t>=0){this.skuList.splice(t,1)}};j.prototype.findAddonById=function(t){if(!t){return null}return _.find(this.addonList,function(u){return u.id===t})};j.prototype.listAddon=function(t){return _.filter(this.addonList,function(u){return !u.isCalendar||(t&&u.getDatePrice(t))})};j.prototype.firstMonth=function(t){return _.first(_.keys(this.getMonthInfo(t)).sort())};j.prototype.listAllSkuIds=function(){return _.map(this.skuList,function(t){return t.id})};j.prototype.getMonthInfo=function(v,u,t){this.listByIds(v,u,function(x){var w={};_.each(x,function(z){var y=z.listCalendar();_.each(y,function(A){var B=A.date.substr(0,7);if(!_.has(w,B)||w.month>A.price){w[B]=A.price}})});t(w)})};j.prototype.listCalendarBySkuIds=function(v,u,t){this.listByIds(v,u,function(x){var w={};_.each(x,function(y){_.each(y.listCalendar(),function(z){if(_.has(w,z.date)){w[z.date].skuIds.push(y.id);if(z.price!==w[z.date].price){if(z.price<w[z.date].price){w[z.date]=_.extend(w[z.date],z)}w[z.date].hasMultiPrice=true}}else{w[z.date]=_.clone(z);w[z.date].skuIds=[y.id];w[z.date].hasMultiPrice=false}})});t(w)})};j.prototype.hasPromotion=function(){return _.some(this.skuList,function(t){return t.hasFengqiang()||t.hasNOff()||t.hasEarlyBird()})};var e=function(){this.info={};this.firstAttribute=0;this.firstAttributeValue=0};e.prototype.setSkuList=function(t){var u=this;_.each(t,function(w){u.info[w.id]={};var v=w.code.split("|");_.each(v,function(A,x){A=A.split(":");var z=A[0],y=A[1]*1;u.info[w.id][z]=y;if(x===0){u.firstAttribute=z;u.firstAttributeValue=y}})})};e.prototype.setAttributes=function(t){t=_.each(t,function(u){u.values=_.sortBy(u.values,function(v){return v.group_sort})});t=_.sortBy(t,function(u){return u.sort});this.attributes=t};e.prototype.combineAttributes=function(){var u=89,y,w,C=95,A,z,t=8995,B={id:t,name:"天数晚数",values:{}},x=this;_.each(this.attributes,function(D){if(D.id===u){y=D;w=_.indexBy(y.values,"id")}if(D.id===C){A=D;z=_.indexBy(A.values,"id")}});if(!y||!A){return false}_.each(y.values,function(D){_.each(x.info,function(F){if(F[u]===D.id){var G=(F[u]+""+F[C])*1,E=w[F[u]].value+""+z[F[C]].value;B.values[G]={id:G,value:E};delete F[u];delete F[C];F[t]=G}})});B.values=_.values(B.values);this.attributes=_.indexBy(this.attributes,"id");delete this.attributes[u];delete this.attributes[C];this.attributes=_.values(this.attributes);this.attributes.unshift(B);if(_.size(this.info)===1){var v=_.values(this.info)[0];this.firstAttribute=t;this.firstAttributeValue=v[t]}};e.prototype.isSingleAttribute=function(){return _.size(this.info)===1};e.prototype.getFirstAttributeInfo=function(){return[this.firstAttribute,this.firstAttributeValue]};e.prototype.getAttributes=function(){return this.attributes};e.prototype.listCompatibleSkuIds=function(u){var t=[];_.each(this.info,function(x,v){var w=_.every(u,function(z,y){return x[y]*1===z*1});if(w||!_.size(u)){t.push(v*1)}});return t};e.prototype.listCompatibleAttributeValueIds=function(v){var t={},w=this;_.each(this.info,function(x){_.each(x,function(z,y){if(!t[y]){t[y]=[z]}else{if(t[y].indexOf(z)===-1){t[y].push(z)}}})});var u=function(x){return _.some(w.info,function(y){return _.every(x,function(z,A){return y[A]===z})})};_.each(t,function(A,x){var z,y;if(v[x]){y=v[x];for(z=0;z<A.length;z++){v[x]=A[z];if(!u(v)){A.splice(z,1);z--}}v[x]=y}else{for(z=0;z<A.length;z++){v[x]=A[z];if(!u(v)){A.splice(z,1);z--}}delete v[x]}});return _.reduce(_.values(t),function(y,x){return y.concat(x)})};e.prototype.listRestAttributeValueIds=function(t,v){var u={};_.each(this.info[t],function(x,w){if(!v[w]){u[w]=x}});return u};e.prototype.listUnselectedAttributes=function(t){return _.reduce(this.attributes,function(w,u){if(!_.has(t,u.id)){w.push(u.name)}return w},[])};var a={dataAttributeMount:"data-attribute-mount",dataAttributeTemplate:"data-attribute-template",dataAttribute:"data-attribute",dataAttributeName:"data-attribute-name",dataAttributeValueMount:"data-attribute-value-mount",dataAttributeValueTemplate:"data-attribute-value-template",dataAttributeValue:"data-attribute-value",dataAttributeValueName:"data-attribute-value-name",dataSkuWrap:"data-sku-wrap",dataSkuTemplate:"data-sku-id-template",dataSkuMount:"data-sku-mount",dataSkuId:"data-sku-id",dataSkuName:"data-sku-name",dataSkuPop:"data-sku-pop",dataSkuModeTag:"data-sku-mode-tag",dataSkuModeTagDesc:"data-sku-mode-tag-desc",dataSkuRule:"data-sku-rule",dataSkuRuleTemplate:"data-sku-rule-template",dataSkuRuleLabel:"data-sku-rule-label",dataSkuRuleValue:"data-sku-rule-value",dataCalWrap:"data-cal-wrap",dataCalTemplate:"data-cal-template",dataCalPrevMonth:"data-cal-prev-month",dataCalNextMonth:"data-cal-next-month",dataCalMonthTabMount:"data-cal-month-tab-mount",dataCalMonthTabTemplate:"data-cal-month-tab-template",dataCalMonthTab:"data-cal-month-tab",dataCalMonthName:"data-cal-month-name",dataCalMonthTabOffset:"data-cal-month-tab-offset",dataCalMonthBodyMount:"data-cal-month-body-mount",dataCalMonthBodyTemplate:"data-cal-month-body-template",dataCalMonthBody:"data-cal-month-body",dataCalMonthBodyList:"data-cal-month-body-list",dataCalDateItemTemplate:"data-cal-date-item-template",dataCalDateItem:"data-cal-date-item",dataCalDateItemCheckable:"data-cal-date-item-checkable",dataCalDateItemMount:"data-cal-date-item-mount",dataCalDateItemDay:"data-cal-date-item-day",dataCalDateItemPrice:"data-cal-date-item-price",dataCalDateItemPriceText:"data-cal-date-item-price-text",dataCalDateItemRemainText:"data-cal-date-item-remain-text",dataCalDateItemBorder:"data-cal-date-item-border",dataCalDateItemTag:"data-cal-date-item-zao",dataRangePicker:"data-range-picker",dataRangePickerBegin:"data-range-picker-begin",dataRangePickerEnd:"data-range-picker-end",dataRangePickerTips:"data-range-picker-tips",dataRangeCalBeginWrap:"data-range-cal-begin-wrap",dataRangeCalEndWrap:"data-range-cal-end-wrap",dataNumPickerWrap:"data-num-picker-wrap",dataNumPickerMount:"data-num-picker-mount",dataNumPickerTemplate:"data-num-picker-template",dataNumPicker:"data-num-picker",dataNumPickerName:"data-num-picker-name",dataNumPickerPlus:"data-num-picker-plus",dataNumPickerMinus:"data-num-picker-minus",dataNumPickerNumber:"data-num-picker-number",dataNumPickerDefId:"data-num-picker-def-id",dataNumPickerTips:"data-num-picker-tips",dataNumPickerPrice:"data-num-picker-price",dataRoomPickerTemplate:"data-room-picker-template",dataRoomPicker:"data-room-picker",dataRoomPickerNumber:"data-room-picker-number",dataRoomPickerPlus:"data-room-picker-plus",dataRoomPickerMinus:"data-room-picker-minus",dataRoomPickerPrice:"data-room-picker-price",dataAddonWrap:"data-addon-wrap",dataAddonMount:"data-addon-mount",dataAddonTemplate:"data-addon-template",dataAddon:"data-addon",dataAddonName:"data-addon-name",dataAddonNum:"data-addon-num",dataAddonPlus:"data-addon-plus",dataAddonMinus:"data-addon-minus",dataAddonPrice:"data-addon-price",dataAddonDesc:"data-addon-desc",dataTotalPricePrefix:"data-total-price-prefix",dataTotalPriceText:"data-total-price-text",dataTotalPriceHoney:"data-total-price-honey",dataTotalPriceSingleRoom:"data-total-price-single-room",dataTotalPriceSingleRoomText:"data-total-price-single-room-text",dataTotalPriceMode:"data-total-price-mode",dataCountdown:"data-countdown",dataCountdownShow:"data-countdown-show",dataCountdownHide:"data-countdown-hide",dataBookBtn:"data-book-btn",dataBookDisableBtn:"data-book-disable-btn",dataBookBarginBtn:"data-book-bargin-btn",dataPromotionList:"data-promotion-list",dataPromotionLimitPreview:"data-promotion-limit-preview",dataPromotionLimitApp:"data-promotion-limit-app",dataPromotionScan:"data-promotion-scan",dataPromotionBargain:"data-promotion-bargain",dataPromotionBargainBtn:"data-promotion-bargain-btn",dataPromotionHoney:"data-promotion-honey",dataPromotionZao:"data-promotion-zao",dataPromotionNOff:"data-promotion-n-off",dataPromotionImgTop:"data-promotion-img-top",classMonthHighlight:"on",classDateHighlight:"on",classBeginHighlight:"on",classMiddleHighlight:"on",classEndHighlight:"on",classDateDisable:"soldout",classValueDisabled:"disabled",classValueHighlight:"on",classSkuHighlight:"on",classBreakDate:""};var n={renderSkuList:function(u){var t=$([]);_.each(u,function(C){var x=d.clone(a.dataSkuTemplate,C.id);x.find(d.dataWrap(a.dataSkuName)).text(C.name);if(C.hasFengqiang()){var D=C.promotion.FlashSale.time_status<0?moment(C.promotion.FlashSale.begin_ts*1000).format("M月D日HH:mm")+"开售, 抄底蜂抢价<span>"+(C.price-C.promotion.FlashSale.discount.reduce)+"元</span>！":"此产品正在参加蜂抢，限时特价，限量秒杀！"+(C.promotion.FlashSale.tooltip?"<br>"+C.promotion.FlashSale.tooltip:"");x.findByData(a.dataSkuModeTag).filter(":empty:first").text("蜂抢").show();x.findByData(a.dataSkuModeTagDesc).html(D)}else{var B=[];if(C.hasTimeLimitedReduce()&&C.promotion.TimeLimitedReduce.time_status===0&&(C.promotion.TimeLimitedReduce.platform.www||C.promotion.TimeLimitedReduce.platform.app)){var v,A="",E;var w=moment(C.promotion.TimeLimitedReduce.begin_ts*1000).format("M.D");var y=moment(C.promotion.TimeLimitedReduce.end_ts*1000).format("M.D");if(w!==y){v=w+"-"+y+"期间，"}else{v=moment(C.promotion.TimeLimitedReduce.begin_ts*1000).format("M月D日")+"，"}if(C.promotion.TimeLimitedReduce.new_user_only){A="新人"}E=(C.promotion.TimeLimitedReduce.platform.www?"限时":"APP")+'立减<span class="red">'+C.promotion.TimeLimitedReduce.discount.reduce+"元</span>！";B.push(v+A+E);x.findByData(a.dataSkuModeTag).filter(":empty:first").text("立减").show()}if((C.hasNOff()&&C.promotion.NOff.time_status===0&&C.promotion.NOff.platform.www)){var w=moment(C.promotion.NOff.begin_ts*1000).format("M.D");var y=moment(C.promotion.NOff.end_ts*1000).format("M.D");var v="";if(w!==y){v=w+"-"+y+"期间下单，"}else{v=moment(C.promotion.NOff.begin_ts*1000).format("M月D日")+"，"}B.push(v+(C.promotion.NOff.discount.is_repeat?"每买":"第")+C.promotion.NOff.discount.num+"件<span> "+(C.promotion.NOff.discount.reduce_unit==="rate"?(C.promotion.NOff.discount.reduce===1?"免单":"可享"+Math.round((1-C.promotion.NOff.discount.reduce)*100)/10+"折"):("立减"+C.promotion.NOff.discount.reduce+"元"))+"</span>！");x.findByData(a.dataSkuModeTag).filter(":empty:first").text("促销").show()}if((C.hasEarlyBird()&&C.promotion.EarlyBird.time_status===0&&C.promotion.EarlyBird.platform.www)){var z=C.promotion.EarlyBird;_.each(C.promotion.EarlyBird.discount.ladder,function(F){B.push("出发前"+F.level+"天预订，每人<span>立减"+F.reduce+"元</span>！")});x.findByData(a.dataSkuModeTag).filter(":empty:first").text("早鸟").show()}if(B.length){x.findByData(a.dataSkuModeTagDesc).html(B.join("<br>"))}else{if(!C.rules.length){x.find(d.dataWrap(a.dataSkuPop)).remove()}}}if(C.rules){C.rules=_.sortBy(C.rules,"sort");_.each(C.rules,function(G){var F=d.clone(a.dataSkuRuleTemplate).findByData(a.dataSkuRuleLabel).text(G.label).end().findByData(a.dataSkuRuleValue).text(G.value).end();x.findByData(a.dataSkuPop).append(F)})}else{x.findByData(a.dataSkuRule).remove()}t=t.add(x)});d.select(a.dataSkuMount).append(t);d.select(a.dataSkuWrap).show()},renderAttributes:function(t){_.each(t,function(v){var u=$([]);_.each(v.values,function(x){var w=d.clone(a.dataAttributeValueTemplate,x.id).findByData(a.dataAttributeValueName).text(x.value).end().attr(a.dataAttribute,v.id);u=u.add(w)});d.clone(a.dataAttributeTemplate,v.id).findByData(a.dataAttributeName).text(v.name).end().findByData(a.dataAttributeValueMount).append(u).end().appendTo(d.dataWrap(a.dataAttributeMount))})},highlightSku:function(t){d.select(a.dataSkuId).removeClass(a.classSkuHighlight);d.selectWithValue(a.dataSkuId,t).addClass(a.classSkuHighlight)},renderCompatibleAttributeValues:function(t){d.select(a.dataAttributeValue).addClass(a.classValueDisabled).filter(function(){var u=$(this).attr(a.dataAttributeValue);return _.contains(t,u*1)}).removeClass(a.classValueDisabled)},renderHighlightAttributeValue:function(t,u){d.select(a.dataAttributeValue).filter(function(){return $(this).attr(a.dataAttribute)*1===t}).removeClass(a.classValueHighlight);d.selectWithValue(a.dataAttributeValue,u).addClass(a.classValueHighlight)},renderRemoveHighlightAttributeValue:function(t){d.selectWithValue(a.dataAttributeValue,t).removeClass(a.classValueHighlight)},renderCalendar:function(x,t,A){var y=$([]),v=$([]),z=d.clone(a.dataCalTemplate),w=z.findByData(a.dataCalMonthTabMount),u=z.findByData(a.dataCalMonthBodyMount);_.each(d.createCalendar(_.keys(x)),function(E,G){var D=E.firstDayMoment.format("YYYY-MM"),C=d.clone(a.dataCalMonthTabTemplate,D).show(),B=d.clone(a.dataCalMonthBodyTemplate,D),F=G<3?0:(G-2)*140;if(G===0){B.show();C.addClass(a.classMonthHighlight);c.setCurrentMonth(D)}else{B.hide();C.removeClass(a.classMonthHighlight)}C.findByData(a.dataCalMonthName).text(E.firstDayMoment.format("YYYY年M月")).end().attr(a.dataCalMonthTabOffset,F);y=y.add(C);_.each(E.list,function(K){var O=d.clone(a.dataCalDateItemTemplate,K.date),L=K.date==="";if(L){O.empty().removeAttr(a.dataCalDateItem)}else{O.show().find(d.dataWrap(a.dataCalDateItemDay)).text(K.D);if(_.has(x,K.date)){if((A&&A.hasEarlyBird()&&A.promotion.EarlyBird.time_status===0)||(h.EarlyBird&&h.EarlyBird.time_status===0)){var J=0;if(h.EarlyBird){_.each(h.EarlyBird.discount.ladder,function(Q){var P=moment().add(Q.level,"days").format("YYYY-MM-DD");if(moment(K.date).format("YYYY-MM-DD")>=P){J=Q.reduce}})}else{_.each(A.promotion.EarlyBird.discount.ladder,function(Q){var P=moment().add(Q.level,"days").format("YYYY-MM-DD");if(moment(K.date).format("YYYY-MM-DD")>=P){J=Q.reduce}})}if(J>0){O.findByData(a.dataCalDateItemTag).show();var H=J+"元/每人";O.append('<div class="tips_popup"><p>现在下单享早鸟优惠立减<span data-cal-date-item-hover-text="1">'+H+"</span></p></div>")}}var N=x[K.date];var I=N.price;if(A&&A.hasFengqiang()){I=Math.round((I-A.promotion.FlashSale.discount.reduce)*100)/100}O.find(d.dataWrap(a.dataCalDateItemPriceText)).text("￥"+I+(N.hasMultiPrice?"起":"")).end().find(d.dataWrap(a.dataCalDateItemRemainText)).text(N.remain>30?"充足":"余"+N.remain).end().find(d.dataWrap(a.dataCalDateItemBorder)).show().end().attr(a.dataCalDateItemCheckable,1)}}B.findByData(a.dataCalDateItemMount).append(O)});v=v.add(B)});w.empty().append(y).css({width:y.length*140+140,left:0});u.empty().append(v);t.empty().append(z)},createEmtyMonth:function(u){var t=[];_.each(d.createCalendar([u+"-01"]),function(y){var x=y.firstDayMoment.format("YYYY-MM"),w=d.clone(a.dataCalMonthTabTemplate,x).show(),v=d.clone(a.dataCalMonthBodyTemplate,x).hide();w.findByData(a.dataCalMonthName).text(y.firstDayMoment.format("YYYY年M月"));_.each(y.list,function(z){var B=d.clone(a.dataCalDateItemTemplate,z.date),A=z.date==="";if(A){B.empty().removeAttr(a.dataCalDateItem)}else{B.show().find(d.dataWrap(a.dataCalDateItemDay)).text(z.D)}v.findByData(a.dataCalDateItemMount).append(B)});t[0]=w;t[1]=v});return t},renderSingleCalendar:function(t,u){n.renderCalendar(t,d.select(a.dataCalWrap),u)},showSingleCalendar:function(){d.select(a.dataCalWrap).show()},showBeginCalendar:function(){d.select(a.dataRangeCalBeginWrap).show()},renderBeginCalendar:function(x,v,u,w,A){var t="",z=d.createCalendar(_.keys(x)),y=d.select(a.dataRangeCalBeginWrap);n.renderCalendar(x,y,A);_.each(z,function(B,C){_.each(B.list,function(G,D){if(_.has(x,G.date)){t=G.date}if((G.date&&!_.has(x,G.date))||(C+1===z.length&&D+1===B.list.length)){for(var E=0;E<w-1;E++){if(t){var F=moment(t).subtract(E,"days").format("YYYY-MM-DD");y.findByData(a.dataCalDateItemMount).findByData(a.dataCalDateItem,F).addClass(a.classDateDisable).removeAttr(a.dataCalDateItemCheckable)}}}})});if(v){y.findByData(a.dataCalDateItem,v).addClass(a.classBeginHighlight)}if(u){d.rangeWalk(v,u,function(B){if(B!==v&&B!==u){y.findByData(a.dataCalDateItem,B).addClass(a.classMiddleHighlight)}});y.findByData(a.dataCalDateItem,u).addClass(a.classEndHighlight)}},showEndCalendar:function(){d.select(a.dataRangeCalEndWrap).show()},renderEndCalendar:function(K,I,t,y,w,E,C){var H=E?0:1;var D=d.createCalendar(_.keys(K)),u=d.select(a.dataRangeCalEndWrap),B=I?moment(I,"YYYY-MM-DD").add(y-1,"days").format("YYYY-MM-DD"):null,F=B?moment(B,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD"):null,A=I?moment(I,"YYYY-MM-DD").add(w-H,"days").format("YYYY-MM-DD"):null,z=null,v=false,x="",G="";n.renderCalendar(K,u,C);_.each(D,function(L,N){_.each(L.list,function(P,O){if(_.has(K,P.date)){var Q=u.findByData(a.dataCalDateItem,P.date);if(I&&P.date<I){Q.addClass(a.classDateDisable).removeAttr(a.dataCalDateItemCheckable)}if(I&&P.date===I){Q.addClass(a.classDateHighlight)}if((!E&&B&&P.date<B)||(E&&F&&P.date<F)){if(P.date!==I){Q.addClass(a.classDateDisable)}Q.removeAttr(a.dataCalDateItemCheckable)}if((z&&P.date>z)||(A&&P.date>A)){Q.addClass(a.classDateDisable).removeAttr(a.dataCalDateItemCheckable)}}v=(N+1===D.length&&O+1===L.list.length)||(N+1===D.length&&(!L.list[O+1]||(L.list[O+1]&&L.list[O+1].date==="")));if(!z&&(!_.has(K,P.date)||v)&&P.date>=B&&P.date<=A){z=P.date;G=moment(P.date,"YYYY-MM-DD").add(1,"days");if(v){x=G.format("YYYY-MM")}}})});if(z){if(x&&E){var J=n.createEmtyMonth(x);u.findByData(a.dataCalMonthTabMount).append(J[0]);u.findByData(a.dataCalMonthBodyMount).append(J[1]);z=G.format("YYYY-MM-DD")}if(E){u.findByData(a.dataCalDateItem,z).attr(a.dataCalDateItemCheckable,1).attr(a.dataCalDateItem,z).findByData(a.dataCalDateItemBorder).show().addClass(a.classBreakDate)}}},renderRangeTips:function(u,t){d.select(a.dataRangePickerTips).text("最少预订"+u+(t?"晚":"天")).show()},clearDateItem:function(t){t.findByData(a.dataCalDateItemPrice).hide();t.findByData(a.dataCalDateItemBorder).hide()},renderBeginText:function(t){d.select(a.dataRangePickerBegin).html(t+"<i></i>")},renderEndText:function(t){d.select(a.dataRangePickerEnd).html(t+"<i></i>")},resetBeginText:function(t){d.select(a.dataRangePickerBegin).html((t?"入住日期":"起始日期")+"<i></i>")},resetEndText:function(t){d.select(a.dataRangePickerEnd).html((t?"离店日期":"结束日期")+"<i></i>")},showRangePicker:function(){d.select(a.dataRangePicker).show()},hideRangeCal:function(){d.select(a.dataRangePicker).hide()},showRangeCalBegin:function(){d.select(a.dataRangeCalBeginWrap).show()},hideRangeCalBegin:function(){d.select(a.dataRangeCalBeginWrap).hide()},toggleRangeCalBegin:function(){d.select(a.dataRangeCalBeginWrap).toggle()},showRangeCalEnd:function(){d.select(a.dataRangeCalEndWrap).show()},hideRangeCalEnd:function(){d.select(a.dataRangeCalEndWrap).hide()},toggleRangeCalEnd:function(){d.select(a.dataRangeCalEndWrap).toggle()},renderTotalPrice:function(u,x,v,t,w){d.select(a.dataTotalPricePrefix).show();d.select(a.dataTotalPriceText).text(u);if(x&&x.gt(0)){d.select(a.dataTotalPriceSingleRoom).show();d.select(a.dataTotalPriceSingleRoomText).text(x)}else{d.select(a.dataTotalPriceSingleRoom).hide()}},clearTotalPrice:function(){d.select(a.dataTotalPricePrefix).hide();d.select(a.dataTotalPriceText).text("--");d.select(a.dataTotalPriceMode).hide();d.select(a.dataTotalPriceSingleRoom).hide()},highlightCurrentMonth:function(t){d.select(a.dataCalMonthBody).hide();d.selectWithValue(a.dataCalMonthBody,t).show();d.select(a.dataCalMonthTab).removeClass(a.classMonthHighlight);d.selectWithValue(a.dataCalMonthTab,t).addClass(a.classMonthHighlight)},highlightCurrentDate:function(t){if(t){n.highlightCurrentMonth(t.substr(0,7))}d.select(a.dataCalDateItem).removeClass(a.classDateHighlight);d.selectWithValue(a.dataCalDateItem,t).addClass(a.classDateHighlight)},hideRangeSelector:function(){d.select([])},renderNumPicker:function(w,v,t,x,u){var z=d.select(a.dataNumPickerMount),y;z.empty();_.each(w,function(A){if(_.has(v,A.id)&&A.id!==d.SINGLE_ROOM_DEF_ID){y=d.clone(a.dataNumPickerTemplate,A.id).findByData(a.dataNumPickerName).text(A.name).end().findByData(a.dataNumPickerDefId).attr(a.dataNumPickerDefId,A.id).end().findByData(a.dataNumPickerNumber).text(v[A.id]).end();if(t&&t[A.id]){y.findByData(a.dataNumPickerPrice).text(t[A.id])}else{y.findByData(a.dataNumPickerTips).remove()}y.appendTo(z)}});if(x){d.clone(a.dataRoomPickerTemplate).findByData(a.dataRoomPickerNumber).text(u).end().findByData(a.dataRoomPickerPrice).text(t[d.SINGLE_ROOM_DEF_ID]).end().appendTo(z)}d.select(a.dataNumPickerWrap).show()},changeNumPicker:function(t,u){d.selectWithValue(a.dataNumPicker,t).findByData(a.dataNumPickerNumber).text(u)},changeRoomNum:function(t){d.select(a.dataRoomPicker).findByData(a.dataRoomPickerNumber).text(t)},clearNumPicker:function(){d.select(a.dataNumPickerWrap).hide()},renderAddonList:function(v){var u=d.select(a.dataAddonMount).empty(),t=d.select(a.dataAddonWrap);_.each(v,function(x,y){var w=d.clone(a.dataAddonTemplate,y);w.findByData(a.dataAddonName).text(x.name).end().findByData(a.dataAddonNum).text(x.num).end().findByData(a.dataAddonPrice).text(x.price).end().findByData(a.dataAddon).attr(a.dataAddon,y);if(x.desc.length){w.findByData(a.dataAddonDesc).text(x.desc).end()}u.append(w)});if(_.size(v)){t.show()}},showCountdown:function(){d.select(a.dataCountdownShow).show();d.select(a.dataCountdownHide).hide()},hideCountdown:function(){d.select(a.dataCountdownShow).hide();d.select(a.dataCountdownHide).show()},renderPromotionTags:function(v,t){var u={};function w(A,z){if(A.time_status<=0){if(A.discount.type!=="FLashSale"&&A.begin_ts*1000-(new Date().getTime())>86400000*14){return false}if(!z){return true}else{if(z.begin_ts>A.begin_ts){return true}else{if(z.begin_ts===A.begin_ts){if(z.discount.reduce_unit===A.discount.reduce_unit){if(!A.is_ladder){if(z.discount.reduce<A.discount.reduce){return true}}else{var x=_.max(z.discount.ladder,"level").reduce;var y=_.max(z.discount.ladder,"level").reduce;if(x<y){return true}}}else{if(z.discount.reduce_unit==="rate"&&A.discount.reduce_unit==="price"){return true}}}}}}return false}_.each(v,function(x){if(x.promotion){_.each(x.promotion,function(A,z){if(A.time_status<=0){var y=u[z];if(w(A,y)){u[z]=A}}})}});_.each(t,function(z,y){if(z.time_status<=0){var x=u[y];if(w(z,x)){u[y]=z}}});_.each(u,function(z,y){z.end_ts=z.end_ts-1;switch(y){case"TimeLimitedReduce":var x='<div class="s_popup num-tips" style="padding: 0;left: -110px;">                    <i class="i-arrow i-arrCenter"></i>                    <p>';if(z.time_status===0){if(moment(z.end_ts*1000).diff(moment(z.begin_ts*1000),"days")<=0){x+=moment(z.begin_ts*1000).format("M月D日")+"，"}else{x+=moment(z.begin_ts*1000).format("M.D")+"-"+moment(z.end_ts*1000).format("M.D")+"期间，"}}if(z.time_status<0){x+=moment(z.begin_ts*1000).format("M月D日HH:mm")+"开始，"}x+=z.sku_id?"部分套餐":"";x+=z.new_user_only?"新人":"限时";x+="立减"+z.discount.reduce+"元！";x+="</p></div>APP立减"+z.discount.reduce+"元";d.select(a.dataPromotionLimitApp).html(x).show();d.select(a.dataPromotionScan).show();break;case"EarlyBird":var x=z.time_status<0?moment(z.begin_ts*1000).format("M月D日HH:mm")+"开始，":"";x+=z.sku_id?"部分套餐":"";_.each(z.discount.ladder,function(A){x+="出发前"+A.level+"天预订，每人<span>立减"+A.reduce+"元</span>！<br>"});if(z.time_status<0||!z.sku_id){d.select(a.dataPromotionZao).html('<div class="tips_popup"><p>'+x+"</p></div>早鸟").show()}break;case"NOff":var x=z.time_status<0?moment(z.begin_ts*1000).format("M月D日HH:mm")+"开始，":"";x+=z.sku_id?"部分套餐":"";if(z.discount.is_repeat){x+="每"+z.discount.num+"件立减"+z.discount.reduce+"元！"}else{if(z.discount.reduce_unit==="price"){x+="第"+z.discount.num+"件立减"+z.discount.reduce+"元！"}else{if(z.discount.reduce<1){x+="第"+z.discount.num+"件可享"+Math.round((1-z.discount.reduce)*100)/10+"折！"}else{x+=z.discount.num+"人同行1人免单！"}}}if(z.time_status<0||!z.sku_id){d.select(a.dataPromotionNOff).html('<div class="tips_popup"><p>'+x+"</p></div>促销").show()}break;case"Bargain":var x="";if(z.time_status<0){x=moment(z.begin_ts*1000).format("M月D日HH:mm")+"开始，此产品支持砍价，下单更优惠！";d.select(a.dataBookBarginBtn).addClass("btn-disabled").text("即将砍价").attr(a.dataBookBarginBtn,2)}else{if(moment(z.end_ts*1000).diff(moment(z.begin_ts*1000),"days")<=0){x=moment(z.begin_ts*1000).format("M月D日")+"，砍价更优惠！";d.select(a.dataBookBarginBtn).removeClass("btn-disabled").text("去砍价").attr(a.dataBookBarginBtn,1)}else{x=moment(z.begin_ts*1000).format("M.D")+"-"+moment(z.end_ts*1000).format("M.D")+"期间下单 ，砍价更优惠！";d.select(a.dataBookBarginBtn).removeClass("btn-disabled").text("去砍价").attr(a.dataBookBarginBtn,1)}}d.select(a.dataPromotionBargain).html(x).show();break;case"Honey":var x='<div class="s_popup num-tips">              <i class="i-arrow i-arrCenter"></i>              <p>下单时使用蜂蜜至多可抵扣订单金额的<span>'+(z.discount.reduce*100)+"％</span></p>            </div>            蜂蜜抵"+(z.discount.reduce*100)+"%";d.select(a.dataPromotionHoney).html(x).show();break}})},renderImgTopPromotion:function(v,u){if(u){var w=u.TimeLimitedReduce;if(w&&w.time_status===0){var t,x;if(w.platform.www){t='<span class="mid-line"><i></i>限时立减</span>'}else{if(w.platform.app){t='<span class="mid-line"><i></i>APP立减</span>'}else{return}}x="<div>立减<b>"+w.discount.reduce+"</b>元</div>";d.select(a.dataPromotionImgTop).html(t+x).show()}}}};var g=function(){var t=this;this.controller=null;this.state=null;d.bindRootClickEvent(a.dataAttributeValue,function(){if($(this).hasClass(a.classValueDisabled)){return false}t.onSelectAttributeValue(d.getDataValue($(this),a.dataAttribute),d.getDataValue($(this),a.dataAttributeValue))});d.bindRootClickEvent(a.dataSkuId,function(){t.onSelectSku(d.getDataValue($(this),a.dataSkuId))});d.bindRootClickEvent(a.dataCalMonthTab,function(){var u=d.getDataValue($(this),a.dataCalMonthTab),v=$(this).attr(a.dataCalMonthTabOffset);t.onSelectMonth(u,v)});d.bindRootClickEvent(a.dataCalPrevMonth,function(){var w=t.state.getCurrentMonth(),v=d.selectWithValue(a.dataCalMonthTab,w),u,y,x;if(w){u=v.prev();if(u.length){y=u.attr(a.dataCalMonthTab);x=u.attr(a.dataCalMonthTabOffset);t.onSelectMonth(y,x)}}});d.bindRootClickEvent(a.dataCalNextMonth,function(){var x=t.state.getCurrentMonth(),w=d.selectWithValue(a.dataCalMonthTab,x),v,u,y;if(x){u=w.next();if(u.length){v=u.attr(a.dataCalMonthTab);y=u.attr(a.dataCalMonthTabOffset);t.onSelectMonth(v,y)}}});d.bindSubClickEvent(a.dataCalWrap,a.dataCalDateItem,function(){t.onSelectSingleDate(d.getDataValue($(this),a.dataCalDateItem))});d.bindRootClickEvent(a.dataRangePickerBegin,function(){n.toggleRangeCalBegin();n.hideRangeCalEnd()});d.bindRootClickEvent(a.dataRangePickerEnd,function(){if(!t.state.getRangeBegin()){d.danger(d.error("请先选择"+d.select(a.dataRangePickerBegin).text()));return false}n.toggleRangeCalEnd();n.hideRangeCalBegin()});d.bindSubClickEvent(a.dataRangeCalBeginWrap,a.dataCalDateItemCheckable,function(){t.onSelectBeginDate($(this).attr(a.dataCalDateItem))});d.bindSubClickEvent(a.dataRangeCalEndWrap,a.dataCalDateItemCheckable,function(){t.onSelectEndDate($(this).attr(a.dataCalDateItem))});d.bindRootClickEvent(a.dataNumPickerPlus,function(){t.onNumPickerPlus($(this).attr(a.dataNumPickerDefId))});d.bindRootClickEvent(a.dataNumPickerMinus,function(){t.onNumPickerMinus($(this).attr(a.dataNumPickerDefId))});d.bindRootClickEvent(a.dataRoomPickerPlus,function(){t.onRoomPickerPlus()});d.bindRootClickEvent(a.dataRoomPickerMinus,function(){t.onRoomPickerMinus()});d.bindRootClickEvent(a.dataAddonPlus,function(){t.onAddonPlus($(this).attr(a.dataAddon))});d.bindRootClickEvent(a.dataAddonMinus,function(){t.onAddonMinus($(this).attr(a.dataAddon))});d.select(a.dataCountdown).eq(0).on("countdownover",function(){n.hideCountdown()});$(document).on("click","#popup_container .close-btn",function(){$("#popup_container, #popup_overlay").hide()});d.bindRootClickEvent(a.dataBookBtn,function(){var u=$(this).attr(a.dataBookBarginBtn)*1===1?true:false;var v=$(this).attr(a.dataBookBarginBtn)*1===2?true:false;if(v){return false}t.onBook(u)})};g.prototype.setController=function(t){this.controller=t};g.prototype.setState=function(t){this.state=t};g.prototype.onSelectAttributeValue=function(u,t){this.controller.selectAttributeValue(u,t)};g.prototype.onSelectSku=function(t){this.controller.selectSku(t)};g.prototype.onSelectSingleDate=function(t){this.controller.selectSingleDate(t)};g.prototype.onSelectBeginDate=function(t){this.controller.selectBeginDate(t)};g.prototype.onSelectEndDate=function(t){this.controller.selectEndDate(t)};g.prototype.onNumPickerPlus=function(u){var t=this.controller.numPickerChange(u*1,1);if(t.code!==0){d.danger(t)}};g.prototype.onNumPickerMinus=function(u){var t=this.controller.numPickerChange(u*1,-1);if(t.code!==0){d.danger(t)}};g.prototype.onRoomPickerPlus=function(){this.controller.roomPickerChange(1)};g.prototype.onRoomPickerMinus=function(){this.controller.roomPickerChange(-1)};g.prototype.onAddonPlus=function(t){this.controller.addonNumChange(t*1,1)};g.prototype.onAddonMinus=function(t){this.controller.addonNumChange(t*1,-1)};g.prototype.onBook=function(u){var t=this.controller.book(u);if(t.code!==0){d.danger(t)}};g.prototype.onSelectMonth=function(t,u){if(t){this.state.setCurrentMonth(t);n.highlightCurrentMonth(t);if(u){d.select(a.dataCalMonthTabMount).css({left:-1*u})}}};var i=function(){this.skuIds=[];this.attributeSelection={};this.pickedNum={};this.addonNum={};this.roomNum=0;this.countdown=null;this.countdownStatus=false;this.rangeBeginDate=null;this.rangeEndDate=null;this.checkoutDate=null;this.performedUserChange=false};i.prototype.setSkuIds=function(t){this.skuIds=t};i.prototype.getSkuIds=function(){return this.skuIds};i.prototype.getSkuId=function(){return this.skuIds.length===1?this.skuIds[0]:null};i.prototype.selectAttributeValue=function(t,u){this.attributeSelection[t]=u};i.prototype.unSelectAttribute=function(t){delete this.attributeSelection[t]};i.prototype.getSelectedAttributeValue=function(t){return this.attributeSelection[t]};i.prototype.getSelection=function(){return this.attributeSelection};i.prototype.setCurrentMonth=function(t){this.month=t};i.prototype.getCurrentMonth=function(){return this.month};i.prototype.getCurrentDate=function(){return this.currentDate};i.prototype.setCurrentDate=function(t){if(t){this.setCurrentMonth(t.substr(0,7))}this.currentDate=t};i.prototype.setCurrentMode=function(t){this.currentMode=t};i.prototype.getCurrentMode=function(){return this.currentMode};i.prototype.setRangeBegin=function(t){this.rangeBeginDate=t};i.prototype.getRangeBegin=function(){return this.rangeBeginDate};i.prototype.setRangeEnd=function(t){this.rangeEndDate=t};i.prototype.getRangeEnd=function(){return this.rangeEndDate};i.prototype.setCheckeoutDate=function(t){this.checkoutDate=t};i.prototype.getCheckoutDate=function(){return this.checkoutDate};i.prototype.setPickedNum=function(t){this.pickedNum=t};i.prototype.setSinglePickedNum=function(t,u){this.pickedNum[t]=u};i.prototype.getPickedNum=function(){return this.pickedNum};i.prototype.setRoomNum=function(t){this.roomNum=t};i.prototype.getRoomNum=function(){return this.roomNum};i.prototype.getAddonNum=function(){return this.addonNum};i.prototype.setAddonNum=function(t){this.addonNum=t};i.prototype.setCountdown=function(t){this.countdown=t};i.prototype.getCountdown=function(){return this.countdown};i.prototype.setCountdownStatus=function(t){this.countdownStatus=t};i.prototype.performNumChange=function(){this.performedUserChange=true};i.prototype.hasPerformedNumChange=function(){return this.performedUserChange};var q=function(){this.priceDefs=[];this.rangeByNight=false};q.prototype.setData=function(t){this.rangeByNight=t.range_type===1;this.priceLayout=t.price_layout;this.calendarLayout=this.priceLayout>0;this.defaultLayout=this.priceLayout===0;this.singleCalendarLayout=this.priceLayout===1;this.rangeCalendarLayout=this.priceLayout===2;this.selectDirectLayout=t.sku_select_layout===1;this.selectAttributeLayout=t.sku_select_layout===0;this.selectAttributeCombineLayout=t.sku_select_layout===2;this.priceDefs=t.priceDefs};q.prototype.getPrimaryDef=function(t){var u=_.find(this.priceDefs,function(v){return(v.price_def_set===t&&v.def.is_primary)});return u.def};q.prototype.listPriceDef=function(t){return _.map(_.filter(this.priceDefs,function(u){return(u.price_def_set===t&&(u.def.type===0||u.def.date_flow===1))}),function(u){return u.def})};q.prototype.getPriceDef=function(u){var t=_.find(this.priceDefs,function(v){return v.def.id*1===u*1});return t.def};q.prototype.getAddonDef=function(){return this.getPriceDef(d.ADDON_DEF_ID)};var s=function(){this.state=null;this.ui=null;this.template=new q();this.attributeStore=new e();this.store=new j();this.groupId=0};s.prototype.setUI=function(t){this.ui=t};s.prototype.setState=function(t){this.state=t};s.prototype.boot=function(w){var x=this;this.groupId=w;var u=null;var t=null;var y=2;d.fetchPromotion(this.groupId).then(function(z){if(z.error===0){u=z.data}else{u={list:[]}}if(!--y){v()}});d.fetch(this.groupId).then(function(z){t=z;if(!--y){v()}});var v=function(){if(t.error.code===0){x.template.setData(t.data.template);x.store.setTemplate(x.template);x.store.setSkuList(t.data.sku);x.store.setAddonList(t.data.addon);m.set("is_new_user",u.ex.isNew);x.attributeStore.setSkuList(t.data.sku);x.attributeStore.setAttributes(t.data.attributes);if(x.template.selectAttributeCombineLayout){x.attributeStore.combineAttributes()}var B=x.template.selectAttributeLayout||x.template.selectAttributeCombineLayout;var A=function(E,D){var F={"0":0,"-1":1,"1":2};var C=E?F[E.time_status]:999;var G=D?F[D.time_status]:999;if(C<G){return E}else{if(C>G){return D}else{if(C==G){if(E.time_status>0){if(D.end_ts>E.end_ts){return D}else{return E}}if(E.time_status<0){if(D.begin_ts<E.begin_ts){return D}else{return E}}if(E.time_status==0){return E}}}}};_.each(u.list,function(C){if(C.sku_id){var D=x.store.findSkuById(C.sku_id);if(!D){return}if(!D.promotion){D.promotion={}}if(C.discount.type==="FlashSale"){D.promotion={FlashSale:A(C,D.promotion.FlashSale)}}else{if(C.new_user_only&&!m.isNewUser()){return}if(D.promotion.FlashSale){return}else{D.promotion[C.discount.type]=A(C,D.promotion[C.discount.type])}}if(C.time_status===0){B=false}else{if(C.discount.type==="FlashSale"){if(C.time_status>0){x.store.removeSkuById(C.sku_id)}else{B=false}}}}else{h[C.discount.type]=A(C,h[C.discount.type])}});if(B){n.renderAttributes(x.attributeStore.getAttributes())}else{n.renderSkuList(x.store.listSku())}n.renderPromotionTags(x.store.listSku(),h);n.renderImgTopPromotion(x.store.listSku(),h);if(x.attributeStore.isSingleAttribute()){var z=x.attributeStore.getFirstAttributeInfo();x.selectAttributeValue(z[0],z[1])}x.refreshCalendar(x.store.listAllSkuIds());d.select(a.dataPromotionList).removeClass("hide");if(h.Bargain){d.select(a.dataPromotionBargainBtn).show()}}}};s.prototype.selectAttributeValue=function(y,u){var A=this.state.getSelectedAttributeValue(y),w=this,v=false;if(A===u){this.state.unSelectAttribute(y);n.renderRemoveHighlightAttributeValue(u);v=false}else{this.state.selectAttributeValue(y,u);n.renderHighlightAttributeValue(y,u);v=true}var z=this.state.getSelection();var B=this.attributeStore.listCompatibleAttributeValueIds(z);var x=this.attributeStore.listCompatibleSkuIds(z);this.state.setSkuIds(x);n.renderCompatibleAttributeValues(B);if(this.state.getSkuIds().length===1){if(v){var t=this.attributeStore.listRestAttributeValueIds(x[0],z);_.each(t,function(D,C){w.state.selectAttributeValue(C,D);n.renderHighlightAttributeValue(C,D)});z=this.state.getSelection();B=this.attributeStore.listCompatibleAttributeValueIds(z);n.renderCompatibleAttributeValues(B)}this.selectSku(x[0])}else{this.refreshCalendar(x);this.state.setRangeBegin("");this.state.setRangeEnd("");n.clearNumPicker();n.clearTotalPrice()}};s.prototype.selectSku=function(A){var z=this.store.findSkuById(A),u=this.state.getCurrentDate(),t=this.state.getRangeBegin(),x=this.state.getRangeEnd(),B=this.state.getPickedNum(),y=this,w=false,v=0;this.state.setSkuIds([A]);this.setCountdown(A);n.highlightSku(A);this.setAddon();if(z.isDefault){this.store.listByIds(this.groupId,[A],function(){if(!y.state.hasPerformedNumChange()||z.testDefaultNum(B).code!==0){B=z.createDefaultNum();y.state.setPickedNum(B)}n.renderNumPicker(z.priceDefs,B,z.getPickedPrice(B),false,0);y.setTotalPrice()})}else{if(z.isSingleDate){this.refreshCalendar([A],function(){if(z.hasPriceOnDate(u)){if(!y.state.hasPerformedNumChange()||z.testDateNum(u,B).code!==0){B=z.createDateNum(u);y.state.setPickedNum(B)}w=z.needRoomPicker(u);if(w){v=Math.ceil(z.sumUseBedNum(B)/2);y.state.setRoomNum(v)}n.renderNumPicker(z.priceDefs,B,z.getPickedPriceByDate(B,u),w,v);n.highlightCurrentDate(u);y.setTotalPrice()}else{y.state.setCurrentDate(null);y.state.setPickedNum({});n.clearNumPicker();n.clearTotalPrice()}})}else{this.refreshCalendar([A],function(){if(z.hasPriceOnRange(t,x)){if(!y.state.hasPerformedNumChange()||z.testRangeNum(t,x,B).code!==0){B=z.createRangeNum(t,x);y.state.setPickedNum(B)}n.renderBeginCalendar(z.getRangeData(),t,x,z.rangeMinLength,z);n.renderEndCalendar(z.getRangeData(),t,x,z.rangeMinLength,z.rangeMaxLength,y.template.rangeByNight,z);n.renderNumPicker(z.priceDefs,B,{},false,0);y.setTotalPrice()}else{y.state.setRangeBegin(null);y.state.setRangeEnd(null);n.renderBeginCalendar(z.getRangeData(),null,null,z.rangeMinLength,z);n.clearNumPicker();n.clearTotalPrice()}})}}};s.prototype.setAddon=function(){var t=this.state.getCurrentDate()||null,w=this.state.getAddonNum(),v=this.store.listAddon(this.state.getCurrentDate()),u={};_.each(v,function(x){var y;if(x.isCalendar){y=x.getDatePrice(t);if(y){u[x.id]={num:w[x.id]&&t===w[x.id].date?w[x.id].num:0,date:t,price:y.price,name:x.name,priceDef:x.priceDef,desc:x.data.description?"服务介绍:"+x.data.description:"",}}}else{y=x.defaultPrice;u[x.id]={num:w[x.id]?w[x.id].num:0,date:"",price:y.price,name:x.name,priceDef:x.priceDef,desc:x.data.description?"服务介绍:"+x.data.description:"",}}});this.state.setAddonNum(u);n.renderAddonList(u)};s.prototype.setCountdown=function(t){var w=this.state.getCountdown(),v,x=this.store.findSkuById(t);if(!w){v=f("/js/sales/countdown");w=new v(d.dataWrap(a.dataCountdown));this.state.setCountdown(w)}if(x.hasFengqiang()){var u=w.setTargetTime(moment(x.promotion.FlashSale.begin_ts*1000).format("x")*1);if(u){this.state.setCountdownStatus(true);n.showCountdown()}else{this.state.setCountdownStatus(false);n.hideCountdown()}}else{n.hideCountdown()}};s.prototype.refreshCalendar=function(u,t){var v=this,w;if((this.template.rangeCalendarLayout&&u.length===1)||this.template.singleCalendarLayout){this.store.listCalendarBySkuIds(this.groupId,u,function(x){if(v.template.singleCalendarLayout){if(u.length===1){w=v.store.findSkuById(u[0])}n.renderSingleCalendar(x,w);n.showSingleCalendar()}else{w=v.store.findSkuById(u[0]);w.setRangeData(x);n.renderRangeTips(w.rangeMinLength,v.template.rangeByNight);n.showRangePicker()}if(_.isFunction(t)){t()}})}if(this.template.rangeCalendarLayout&&u.length>1){n.hideRangeCal();n.clearNumPicker();this.state.setPickedNum({});this.state.setRangeBegin("");this.state.setRangeEnd("")}};s.prototype.selectSingleDate=function(t){n.highlightCurrentDate(t);this.state.setCurrentDate(t);var u=this.state.getSkuId();if(u){this.selectSku(u)}};s.prototype.testRangeEstablished=function(B,v,A,x){var D=d.success();v=moment(v,"YYYY-MM-DD");A=moment(A,"YYYY-MM-DD");for(var u=v;u.isSame(A)||u.isBefore(A);u.add(1,"days")){var t=u.format("YYYY-MM-DD");for(var w in x){if(x.hasOwnProperty(w)){var y=x[w],z=B.getPriceByDefAndDate(w,t);if(z){var C=B.priceDefs[z.def_id].name;if(y<z.remain){D=d.error("日期["+t+"]的"+C+"仅剩"+z.remain+"份",1002);break}if(y<z.min_order_num){D=d.error("日期["+t+"]的"+C+"每单最少购买"+z.min_order_num+"份",1002);break}if(y>z.max_order_num){D=d.error("日期["+t+"]的"+C+"每单最多购买"+z.max_order_num+"份",1002);break}}else{D=d.error("日期"+t+"费用"+w+"不存在",1001);break}}}if(D.code!==0){break}}return D};s.prototype.selectBeginDate=function(w){var u=this.state.getRangeEnd(),t=this.state.getPickedNum(),v=this.state.getSkuIds(),y=this.store.findSkuById(v[0]),x=this;this.state.setRangeBegin(w);n.renderBeginText(w);if(u){if(y.hasPriceOnRange(w,u)){if(y.testRangeNum(w,u,t).code!==0){t=y.createRangeNum(w,u);x.state.setPickedNum(t)}n.renderBeginCalendar(y.getRangeData(),w,u,y.rangeMinLength,y);n.renderEndCalendar(y.getRangeData(),w,u,y.rangeMinLength,y.rangeMaxLength,x.template.rangeByNight,y);n.renderNumPicker(y.priceDefs,t,{},false,0);n.hideRangeCalBegin();x.setTotalPrice()}else{x.state.setRangeBegin(w);x.state.setRangeEnd(null);n.renderBeginCalendar(y.getRangeData(),w,null,y.rangeMinLength,y);n.renderEndCalendar(y.getRangeData(),w,null,y.rangeMinLength,y.rangeMaxLength,x.template.rangeByNight,y);n.resetEndText(x.template.rangeByNight);n.clearNumPicker();n.clearTotalPrice()}n.hideRangeCalBegin();n.showRangeCalEnd()}else{n.renderBeginCalendar(y.getRangeData(),w,null,y.rangeMinLength,y);n.renderEndCalendar(y.getRangeData(),w,null,y.rangeMinLength,y.rangeMaxLength,x.template.rangeByNight,y);n.clearNumPicker();n.hideRangeCalBegin();n.showRangeCalEnd()}};s.prototype.selectEndDate=function(u){var w=this.state.getRangeBegin(),t=this.state.getPickedNum(),y=this.store.findSkuById(this.state.getSkuId()),x=this,v=u;if(this.template.rangeByNight){this.state.setCheckeoutDate(u);v=u;u=moment(u,"YYYY-MM-DD").add(-1,"days").format("YYYY-MM-DD")}if(y.testRangeNum(w,u,t).code!==0){t=y.createRangeNum(w,u);this.state.setPickedNum(t);n.renderNumPicker(y.priceDefs,t,{},false,0)}n.renderBeginCalendar(y.getRangeData(),w,v,y.rangeMinLength,y);n.renderEndCalendar(y.getRangeData(),w,v,y.rangeMinLength,y.rangeMaxLength,x.template.rangeByNight,y);this.state.setRangeEnd(u);n.renderEndText(this.template.rangeByNight?this.state.getCheckoutDate():u);n.hideRangeCalEnd();this.setTotalPrice()};s.prototype.numPickerChange=function(u,z){var w=_.clone(this.state.getPickedNum()),y=this.store.findSkuById(this.state.getSkuId()),x,v,t=d.success();w[u]=z+w[u];if(y.isSingleDate){t=y.testDateNum(this.state.getCurrentDate(),w);if(t.code===0){this.state.setPickedNum(w);n.changeNumPicker(u,w[u]);if(y.needRoomPicker(this.state.getCurrentDate())){v=y.sumUseBedNum(w);x=Math.ceil(v/2);if(this.state.getRoomNum()<x||this.state.getRoomNum()>v){this.state.setRoomNum(x);n.changeRoomNum(x)}}this.setTotalPrice()}}else{if(y.isRangeDate){t=y.testRangeNum(this.state.getRangeBegin(),this.state.getRangeEnd(),w);if(t.code===0){this.state.setPickedNum(w);n.changeNumPicker(u,w[u]);this.setTotalPrice()}}else{t=y.testDefaultNum(w);if(t.code===0){this.state.setPickedNum(w);n.changeNumPicker(u,w[u]);this.setTotalPrice()}}}this.state.performNumChange();return t};s.prototype.roomPickerChange=function(z){var x=this.state.getSkuIds(),B=this.state.getPickedNum(),u=this.state.getRoomNum(),v=u+z,A,y=0,w,t;if(x.length===1){A=this.store.findSkuById(x[0]);y=A.sumUseBedNum(B);w=Math.ceil(y/2);t=y;if(v>t){return d.error("最多选择"+t+"间房")}else{if(v<w){return d.error("最少选择"+w+"间房")}else{this.state.setRoomNum(v);n.changeRoomNum(v);this.setTotalPrice()}}}};s.prototype.addonNumChange=function(v,z){var y=this.state.getAddonNum(),x=y[v].num+z,t=y[v].date,u=this.store.findAddonById(v),w=u.isCalendar?u.getDatePrice(t):u.defaultPrice;if(x>w.remain){return d.error("仅剩"+w.remain+"份")}else{if(x>w.max_order_num){return d.error("每单最多购买"+w.max_order_num+"份")}else{if(x<w.min_order_num){return d.error("每单最少购买"+w.min_order_num+"份")}else{y[v].num=x;this.state.setAddonNum(y);n.renderAddonList(y);this.setTotalPrice()}}}};s.prototype.setTotalPrice=function(){var C=this.state.getSkuIds(),y=this.state.getPickedNum(),H=this.state.getCurrentDate(),B,F,K=0,w=new Decimal(0),t=0,E=0;if(C.length===1){B=this.store.findSkuById(C[0]);if(B.isDefault){_.each(y,function(N,L){F=B.getPriceByDef(L);w=new Decimal(F.price).times(N).plus(w)})}else{if(B.isSingleDate){if(H){_.each(y,function(N,L){F=B.getPriceByDefAndDate(L,H);w=new Decimal(F.price).times(N).plus(w)});if(B.needRoomPicker(H)){F=B.getPriceByDefAndDate(d.SINGLE_ROOM_DEF_ID,H);K=new Decimal(F.price).times(this.state.getRoomNum()*2-B.sumUseBedNum(y));w=w.plus(K)}}else{n.clearTotalPrice()}}else{if(B.isRangeDate){var I=this.state.getRangeBegin(),u=this.state.getRangeEnd();d.rangeWalk(I,u,function(L){_.each(y,function(O,N){F=B.getPriceByDefAndDate(N,L);w=new Decimal(F.price).times(O).plus(w)})})}}}_.each(this.state.getAddonNum(),function(L){w=new Decimal(L.price).times(L.num).plus(w)});var A=[],J="",D="",x={};for(var G in B.priceDefs){x[B.priceDefs[G].id]=B.priceDefs[G].key}if(B.isDefault){_.each(y,function(N,L){F=B.getPriceByDef(L);A.push({sku_id:B.id,priceDefKey:x[L],num:N,price:F.price})})}else{if(B.isSingleDate){if(H){if(B.needRoomPicker(H)){F=B.getPriceByDefAndDate(d.SINGLE_ROOM_DEF_ID,H);var z=this.state.getRoomNum()*2-B.sumUseBedNum(y);A.push({sku_id:B.id,priceDefKey:x[d.SINGLE_ROOM_DEF_ID],num:z,price:F.price})}_.each(y,function(N,L){if(L==29){return}F=B.getPriceByDefAndDate(L,H);A.push({sku_id:B.id,priceDefKey:x[L],num:N,price:F.price})})}}else{if(B.isRangeDate){var I=this.state.getRangeBegin(),u=this.state.getRangeEnd();var v={};d.rangeWalk(I,u,function(L){_.each(y,function(O,N){F=B.getPriceByDefAndDate(N,L);if(N){if(!v[N]){v[N]={priceDefKey:x[N],num:0,price:new Decimal(0)}}v[N].num=O;v[N].price=v[N].price.plus(F.price)}})});_.each(v,function(L){A.push({sku_id:B.id,priceDefKey:L.priceDefKey,num:L.num,price:L.price.valueOf()})})}}}_.each(this.state.getAddonNum(),function(N,L){var O={sku_id:L,priceDefKey:N.priceDef.key,num:N.num,price:N.price};A.push(O)});if(B.isSingleDate){J=H;D=H}else{if(B.isRangeDate){J=this.state.getRangeBegin();D=this.state.getRangeEnd()}}d.calPromotion(B.data.sales_id,J,D,A).then(function(T){var O=0,U=0,L=0;if(T.errno===0&&T.data.list){for(var Q in T.data.list.aOrderItems){for(var P in T.data.list.aOrderItems[Q].aPromotionResult){var R=T.data.list.aOrderItems[Q].aPromotionResult[P];var N=R.fReduceMfw?parseFloat(R.fReduceMfw):0;var S=R.fReduceOta?parseFloat(R.fReduceOta):0;O+=N+S;if(R.sDiscountTypeKey=="NOff"){L+=N+S}else{if(R.sDiscountTypeKey=="EarlyBird"){U+=N+S}}}}d.select(a.dataTotalPriceMode).hide();if(L>0||U>0){d.select(a.dataTotalPriceMode).show();d.select(a.dataTotalPriceMode).text("(已优惠"+(L+U)+"元)")}}d.select(a.dataBookDisableBtn).hide();d.select(a.dataBookBtn).show();if(!B.isCalendar&&B.data.remain<=0){d.select(a.dataBookBtn).hide();if(B.hasFengqiang()){n.clearTotalPrice();d.selectWithValue(a.dataBookDisableBtn,"1").show()}else{n.clearTotalPrice();d.selectWithValue(a.dataBookDisableBtn,"2").show()}}w=w.minus(O);if(w<=0){n.clearTotalPrice()}else{n.renderTotalPrice(w,K,t,E,B)}})}else{n.clearTotalPrice()}};s.prototype.book=function(F){var B=this.store.findSkuById(this.state.getSkuId()),v=this.state.getCurrentDate(),u=this.state.getRangeBegin(),x=this.state.getRangeEnd(),z=this.state.getCheckoutDate(),t=B?B.primaryPriceDef:null,D=this.state.getPickedNum(),y=_.clone(D),A=this.state.getAddonNum(),w=this.state.getRoomNum(),C={},E;if(!B){if(this.template.selectAttributeLayout){E=this.attributeStore.listUnselectedAttributes(this.state.getSelection);if(E.length){return d.error("请选择"+E.join("、"))}}return d.error("请选择套餐")}if(B.isSingleDate&&!v){return d.error("请选择日期")}if(B.isRangeDate){if(!u){return d.error("请选择起始日期")}if(!x){return d.error("请选择结束日期")}}if(!D[t.id]){return d.error("请选择"+t.name+"的数量")}delete y[d.SINGLE_ROOM_DEF_ID];C[B.id]={t:y};if(B.isSingleDate){C[B.id].d={s:v}}else{if(B.isRangeDate){C[B.id].d={s:u,e:x};if(B.template.rangeByNight){C[B.id].d.c=z}}}_.each(A,function(G,H){if(G.num){C[H]={t:{}};C[H].t[d.ADDON_DEF_ID]=G.num;if(G.date){C[H].d={s:G.date}}}});C="/sales/order/booking.php?skus="+encodeURIComponent(JSON.stringify(C));if(B.isSingleDate&&B.needRoomPicker(v)){C+="&room_num="+w}if(F){C+="&bargain=1"}if(B.hasFengqiang()){d.precheckFengqiang(B.id).then(function(G){if(G&&G.data&&G.data.passed){window.location.href=C}else{d.danger(d.error("您已参与过此套餐的蜂抢，不可再次参与"))}})}else{window.location.href=C}return d.success()};var m={_data:{},isNewUser:function(){return !!this._data.is_new_user},set:function(t,u){this._data[t]=u}};var h={};d.addJQueryFn();var l=new g();var c=new i();var k=new s();l.setState(c);l.setController(k);k.setUI(l);k.setState(c);b.exports={boot:function(t){k.boot(t)}}});M.define("/js/sales/detail/Object",function(a){return function(){this._get=function(c,b){if(!("__data" in this)||!(c in this.__data)){if(arguments.length>1){this._set(c,b);return b}return undefined}return this.__data[c]};this._set=function(b,c){if(!("__data" in this)){this.__data={}}this.__data[b]=c};this._getArray=function(c,b){if(arguments.length===1){b=[]}return this._get(c,b)};this._pushToArray=function(c,d){var e=this._getArray(c);for(var b=1;b<arguments.length;b++){e.push(d)}};this._uniquePushToArray=function(c,d){var f=this._getArray(c);var e=0;for(var b=1;b<arguments.length;b++){if(f.indexOf(d)<0){f.push(d);e++}}return e};this.test=function(){}}});M.define("/js/sales/detail/stock/Price",function(b){var a=function(){this.getName=function(){return this._get("name")};this.getDefId=function(){return this._get("def_id")};this.getKey=function(){return this._get("key")};this.getUnit=function(){return this._get("unit")};this.getMoney=function(){return this._get("money",0)};this.getRemain=function(){return this._get("remain",0)};this.getRemainStr=function(){if(this.getMinNum()<this.getRemain()){return"已售完"}else{if(this.getRemain()>20){return"充足"}else{return this.getRemain().toString()}}};this.getMaxNum=function(){return Math.min(this._get("max_num",0),this.getRemain())};this.getMinNum=function(){return this._get("min_num",0)};this.isPrimary=function(){return this._get("is_primary",false)};this.getNum=function(){var c=this.getNumBox();if(c){return c.getNum()}else{return 0}};this.getNumBox=function(){return this._get("num_box")};this.setNumBox=function(c){return this._set("num_box",c)}};a.prototype=new (b("/js/sales/detail/Object"));a.prototype.constructor=a;a.find=function(l,c,j){var o=[];if(j in l.calendar){var k=l.calendar[j];for(var h in k){var p=k[h];var d=0;var n=l.price_remain[j][h]|0;var e=1;var g=0;if(p in l.list){var i=l.list[p];if(i){d=Math.max(i.price_sold,0);if(i.limit_mode){n=65535}else{n=Math.max(i.remain,0)}e=Math.max(i.min_order_num,1);g=Math.min(i.max_order_num,n)}}if(!d){n=0}var f=c[h];var m=new a();m._set("money",d);m._set("remain",n);m._set("max_num",g);m._set("min_num",e);m._set("name",f.name);m._set("unit",f.unit);m._set("is_primary",!!f.is_primary);m._set("def_id",f.id);m._set("key",f.key||("id_"+f.id));m.getMoney();o.push(m)}}return o};return a});M.define("/js/sales/detail/stock/SoldNode",function(a){var b=function(){this.getName=function(){return this._get("name")};this.getPrices=function(){return this._getArray("prices")};this.getPrimaryPrice=function(){var d=this.getPrices();for(var c=0;c<d.length;c++){if(d[c].isPrimary()){return d[c]}}return null};this.isSoldOut=function(){var c=this.getPrimaryPrice();return(c&&c.getRemain()<c.getMinNum())};this.isTimeout=function(){return false};this.isEmpty=function(){return !this.getPrimaryPrice()};this.isDisabled=function(){return this.isSoldOut()||this.isTimeout()}};b.prototype=new (a("/js/sales/detail/Object"));b.prototype.constructor=b;return b});M.define("/js/sales/detail/stock/CalendarDate",function(b){var a=b("/js/sales/detail/stock/Price");var c=function(){this.getName=function(){return this.getDate().getDate().toString()};this.toDateString=function(){var f=this.getDate();var h=f.getFullYear();var e="0"+(f.getMonth()+1).toString();e=e.substr(e.length-2);var g="0"+(f.getDate()).toString();g=g.substr(g.length-2);return h+"-"+e+"-"+g};this.getMonth=function(){return this._get("month")};this.setMonth=function(d){this._set("month",d)};this.getDate=function(){return this._get("date")};this.getDom=function(){return this._get("$dom")};this.select=function(){if(!this.isEmpty()&&!this.isDisabled()&&!this.isSelected()){this._get("$dom").addClass("on");return true}else{return false}};this.unselect=function(){this._get("$dom").removeClass("on");return true};this.isSelected=function(){return this._get("$dom").hasClass("on")}};c.prototype=new (b("/js/sales/detail/stock/SoldNode"));c.prototype.constructor=c;c.parse=function(d,h,g){var e=new this();var f=d.attr("data-date");e._set("date",moment(f,"YYYY-MM-DD").toDate());e._set("$dom",d);e._set("prices",a.find(h,g,f));return e};return c});M.define("/js/sales/detail/stock/CalendarMonth",function(b){var c=b("/js/sales/detail/stock/CalendarDate");var a=function(){this.getName=function(){return this.getYear()+"年"+this.getMonth()+"月"};this.getYear=function(){return this._get("year")};this.getMonth=function(){return this._get("month")};this.getDates=function(){return this._getArray("dates")};this.getCalendar=function(){return this._get("calendar")};this.setCalendar=function(d){this._set("calendar",d)};this.selectDateByName=function(d){var f=this.getDates();for(var e=0;e<f.length;e++){if(f[e].getName()===d){return this.getCalendar().selectDate(f[e])}}return false};this.isAvailable=function(){var f=this.getDates();for(var e=0;e<f.length;e++){var d=f[e];if(!d.isEmpty()&&!d.isDisabled()){return true}}return false}};a.prototype=new (b("/js/sales/detail/Object"));a.prototype.constructor=a;a.parse=function(d,g,f){var h=new this();var e=d.attr("data-month-panel").split("-");h._set("year",parseInt(e[0],10));h._set("month",parseInt(e[1],10));d.find("[data-date]").each(function(){var j=$(this);var i=c.parse(j,g,f);h._pushToArray("dates",i);i.setMonth(h);j.on("click",function(){h.getCalendar().selectDate(i)})});return h};return a});M.define("/js/sales/detail/stock/Calendar",function(c){var b=c("/js/sales/detail/stock/CalendarMonth");var d=function(){this.getDom=function(){return this._get("$dom")};this.getMonths=function(){return this._getArray("months")};this.getCurrentMonth=function(){return this._get("currentMonth")};this.selectMonth=function(f){var e=this.getMonths().indexOf(f);if(e<0){return false}if(f===this.getCurrentMonth()){return true}this._set("currentMonth",f);var h=this._get("$monthTabs").removeClass("on").eq(e).addClass("on");this._get("$monthPanels").hide().eq(e).show();var g=-h.attr("data-month-offset")||0;this.getDom().find("[data-month-scroll]").css("margin-left",g);return true};this.selectMonthByIndex=function(e){return this.selectMonth(this.getMonths()[e])};this.selectMonthByName=function(f){var e=this.getMonths();for(var g=0;g<e.length;g++){if(e[g].getName()===f){return this.selectMonth(e[g])}}return false};this.nextMonth=function(){var h=this.getCurrentMonth();if(h){var e=this.getMonths();var g=e.length;var f=e.indexOf(h);if(f<g-1){this.selectMonth(e[f+1]);return true}}return false};this.prevMonth=function(){var g=this.getCurrentMonth();if(g){var e=this.getMonths();var f=e.indexOf(g);if(f>0){this.selectMonth(e[f-1]);return true}}return false};this.getCurrentDate=function(){return this._get("currentDate")};this.selectDate=function(g){if(g===this.getCurrentDate()){$(document).trigger("stock_calendar_date_select",g);return true}var e=this.getMonths();var j=null;var f=-1;for(var h=0;h<e.length;h++){j=e[h];f=j.getDates().indexOf(g);if(f>=0){break}}if(f>=0){if(this.getCurrentMonth()!==j){this.selectMonth(j)}if(g.select()){this.unselectCurrentDate();this._set("currentDate",g);$(document).trigger("stock_calendar_date_select",g);return true}}return false};this.unselectCurrentDate=function(){var e=this.getCurrentDate();if(e){e.unselect();this._set("currentDate",null);$(document).trigger("stock_calendar_date_unselect",e)}}};d.prototype=new (c("/js/sales/detail/Object"));d.prototype.constructor=d;var a={};d.load=function(i,h,g){if(i in a){h(a[i],false)}else{var f=new this();var e=c("/js/localdeals/rest");e.getMulti("sales/stockv2",{sku_id:i,type:"calendar"},{},function(n){var l=n.data.list.html;if(g){l=l.replace(/(￥|¥|data-price-sold=['"]?)([\d\.]+)/g,function(s,u,t){return u+Math.round((parseFloat(t)-g)*100)/100});$.each(n.data.list.data.list,function(t,s){s.price_sold=Math.round((s.price_sold-g)*100)/100})}var r=$(l);var k=r.find("[data-month-tab]");var j=r.find("[data-prev-month]");var q=r.find("[data-next-month]");var p=r.find("[data-month-panel]");f._set("$dom",r);f._set("$monthTabs",k);f._set("$monthPrevBtn",j);f._set("$monthNextBtn",q);f._set("$monthPanels",p);j.click(function(){f.prevMonth()});q.click(function(){f.nextMonth()});k.find("a").click(function(){var s=$(this).closest("li").index();f.selectMonthByIndex(s)});var o=[];p.each(function(s){var t=b.parse($(this),n.data.list.data,n.data.list.def);if(t.isAvailable()){t.setCalendar(f);f._pushToArray("months",t)}else{o.push(s)}});while(o.length){var m=o.pop();k.eq(m).remove();k.splice(m,1);p.eq(m).remove();p.splice(m,1)}k.each(function(s){var t=Math.max(0,(s-2)*140);$(this).attr("data-month-offset",t);$(this).data("month-offset",t)});a[i]=f;h(f,true)})}};return d});M.define("/js/sales/detail/stock/Sku",function(a){var c=a("/js/sales/detail/stock/Calendar");var b=function(){this.getId=function(){return this._get("id")};this.getName=function(){var e=this._get("name");if(e){return e}var d=this.getAttributes();if(d){e="";for(var f=0;f<d.length;f++){if(f){e+=" "}e+=d[f]}return e}return""};this.setName=function(d){this._set("name",d)};this.getSellingTime=function(){if(!this._get("mode")){return 0}if(this._get("saleOnBefore",0)){return 0}return this._get("sellingTime",0)};this.getOfflineTime=function(){if(!this._get("mode")){return 0}if(this._get("saleOnAfter",0)){return 0}return this._get("offlineTime",0)};this.getReduce=function(){if(!this._get("reduce")){return 0}return this._get("reduce")};this.getNOff=function(){var d=this;if(this.isNOff()){return{type:this._get("discountType"),minNum:this._get("discountMinNum"),discountRepeat:this._get("discountRepeat"),value:this._get("discountVal"),during:function(){var e=new Date().getTime();if(e>d.__data.sellingTime&&e<d.__data.offlineTime){return true}return false},calcPrice:function(e,f){if(e>=this.minNum){if(this.type===1){if(0===this.discountRepeat){return this.value}if(1===this.discountRepeat){return parseInt(e/this.minNum)*this.value}}else{return Math.round(f*this.value*100)/100}}return 0}}}return null};this.isNOff=function(){return this._get("mode")===2};this.getEarlyBird=function(){if(this.isEarlyBird()){var e=this;var d=new Date().getTime();return{calcPrice:function(k,h){var g=e._get("earlyBirdLadder");if(!g||!g.length){return 0}var f;if(typeof h==="string"){var l=h.split("-");f=new Date(l[0]|0,((l[1]|0)-1),l[2]|0,0,0,0,0)}else{if(h instanceof Date){f=h.getTime()}else{f=h}}var m=Math.ceil((f-d)/86400000);var o=-1;var n=0;for(var j=0;j<g.length;j++){var p=g[j];if(m>=p.level&&p.level>=o){n=Math.round(k*p.reduce*100)/100}}return n}}}return null};this.isEarlyBird=function(){return !!this._get("earlyBirdLadder")};this.isFengqiang=function(){return this._get("mode")===1};this.isSellingBefore=function(){var d=new Date().getTime();if(this.getSellingTime()>d){return true}return false};this.isSellingAfter=function(){var d=new Date().getTime();var e=this.getOfflineTime();if(e>0&&d>e){return true}return false};this.isTimeInPromotion=function(){var d=new Date().getTime();if(this.isNOff()||this.isFengqiang()){if(!this.isSellingBefore()&&!this.isSellingAfter()){return true}}return false};this.getAttributes=function(){return this._getArray("attrs")};this.getPromotions=function(){return this._getArray("promos")};this.getIntros=function(){return this._getArray("intros")};this.getCalendar=function(){return this._get("calendar")};this.isEnable=function(){return !this.isSellingBefore()&&!this.isSellingAfter()&&!this.isSoldOut()};this.isSoldOut=function(){return this._get("is_sold_out",false)};this.hide=function(){b.getPopupDom().hide()};this.show=function(){if(!this.isEnable()){return}b.setCurrentSku(this);b.getPopupDom().show();b.getTitleDom().text("");b.getWrapperDom().children().hide();$(document).trigger("stock_sku_show",this);b.getOnSelectShowDom().css("visibility","hidden");this.loadCalendar($.proxy(function(){b.getOnSelectShowDom().css("visibility","visible");if(b.getCurrentSku()!==this){return}b.getTitleDom().text(this.getName());var g=this.getCalendar();if(!g.getMonths().length){b.setCurrentSku(b.getPrevSku());this.hide();return}var e=g.getDom();if(b.getWrapperDom().children().index(e)<0){b.getWrapperDom().append(e)}e.show();var d=b.getPrevSku();if(d){if(d!==this){var f=d.getCalendar().getCurrentMonth().getName();g.unselectCurrentDate();if(g.selectMonthByName(f)){var h=d.getCalendar().getCurrentDate();if(h){if(g.getCurrentMonth().selectDateByName(h.getName())){b.getOnSelectShowDom().show()}else{b.getOnSelectShowDom().hide()}}}else{g.selectMonthByIndex(0)}}}else{g.selectMonthByIndex(0);b.getOnSelectShowDom().hide()}$(document).trigger("stock_calendar_show",g)},this))};this.initButton=function(d){var i=d.find(".buybtn");var e=d.find(".countdown-time");if(i.hasClass("soldout")){this._set("is_sold_out",true)}else{i.on("click",$.proxy(function(){if(i.data("bargain")){b.getPopupDom().find(".buy-btn").addClass("bargain")}else{b.getPopupDom().find(".buy-btn").removeClass("bargain")}this.show()},this));if(this.isFengqiang()||this.isNOff()){if(this.isTimeInPromotion()){if(this.isFengqiang()){i.addClass("qiang").html("立即抢购")}}else{if(this.isSellingBefore()){i.text("距开售").addClass("countdown");var g=a("/js/sales/countdown");var f=new g(e);f.setTargetTime(this.getSellingTime());var h=this;e.on("countdownover",function(){i.addClass("qiang").html("立即抢购");e.hide();h._set("saleOnBefore",1)});e.show()}}}}};this.loadCalendar=function(d){c.load(this.getId(),$.proxy(function(m,f){this._set("calendar",m);if(f){if(this.isEarlyBird()){var e=this.getCalendar().getMonths();if(e.length){for(var k in e){var l=e[k].getDates();if(l.length){for(var h in l){var g=l[h];if(!g.isEmpty()){var n=this.getEarlyBird().calcPrice(1,g.getDate());if(n){g.getDom().append('<div class="zao">早</div>');g.getDom().append('<div class="tips_popup">现在下单享早鸟优惠立减<span>'+n+"元/人</span></div>")}}}}}}}}d()},this),this.getReduce())}};b.prototype=new (a("/js/sales/detail/Object"));b.prototype.constructor=b;b.setCurrentSku=function(d){this._prevSku=this._currentSku;this._currentSku=d};b.getCurrentSku=function(){return this._currentSku};b.getPrevSku=function(){return this._prevSku};b.getPopupDom=function(){if(!("_popupDom" in this)){this._popupDao=$("#calendar_popup,#calendar_popup_mask")}return this._popupDao};b.getTitleDom=function(){if(!("_titleDom" in this)){this._titleDom=this.getPopupDom().find(".ticket-tit p")}return this._titleDom};b.getWrapperDom=function(){if(!("_wrapperDom" in this)){this._wrapperDom=this.getPopupDom().find("#calendar_wrap")}return this._wrapperDom};b.getOnSelectShowDom=function(){if(!("_onSelectShowDom" in this)){this._onSelectShowDom=this.getPopupDom().find(".property-panel,.btn-group")}return this._onSelectShowDom};b.parse=function(e){var g=new b();var d=["id","name","reduce","earlyBirdLadder","mode","sellingTime","offlineTime","discountMinNum","discountType","discountVal","saleOnBefore","saleOnAfter","discountRepeat"];for(var f in e){if(d.indexOf(f)>=0){g._set(f,e[f])}}return g};return b});M.define("/js/sales/detail/stock/NumBox",function(a){var b=function(){this.setMax=function(c){this._set("max",c|0)};this.setMin=function(c){this._set("min",c|0)};this.getMax=function(){return this._get("max",0)};this.getMin=function(){return this._get("min",1)};this.getNum=function(){return this._get("num",0)};this.setNum=function(c){if(c>this.getMax()||c<this.getMin()){return false}this._set("num",c);this._get("$num").text(c);$(document).trigger("stock_price_num_change",this)};this.plus=function(){return this.setNum(this.getNum()+1)};this.minus=function(){return this.setNum(this.getNum()-1)}};b.prototype=new (a("/js/sales/detail/Object"));b.prototype.constructor=b;b.getInstanceFromDom=function(c){var g=c.data("numBox");if(!g){var f=c.find("[data-id=plus]");var d=c.find("[data-id=minus]");var e=c.find("[data-num-input]");g=new this();f.click(function(){g.plus()});d.click(function(){g.minus()});g._set("$num",e);c.data("numBox",g)}return g};return b});M.define("/js/sales/detail",function(d,c,e){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(g){var f=this.length>>>0;var h=Number(arguments[1])||0;h=(h<0)?Math.ceil(h):Math.floor(h);if(h<0){h+=f}for(;h<f;h++){if(h in this&&this[h]===g){return h}}return -1}}var b=d("/js/localdeals/rest");var a=function(f){this.config=$.extend(true,{},this.config,f)};a.EVENT_WINDOW_RESIZE="sales_detail_window_resize";a.EVENT_CHANGE_TAB="sales_detail_change_tab";a.EVENT_EXPAND="sales_detail_expand";a.EVENT_IS_UNKNOW_TRAVEL_SOLDOUT="sales_detail_unknow_travel_soldout";a.prototype={config:{sales:{id:0,name:"",img:"",scope:"sales",is_unknow_travel:false},allow_show_review:true,gift_code:"",stock_version:0},resizeEvents:[a.EVENT_CHANGE_TAB,a.EVENT_EXPAND,a.EVENT_IS_UNKNOW_TRAVEL_SOLDOUT],_resizeEvents:"",_triggetIntervalId:0,slider:null,share:null,deals:null,map:null,sliderDom:[".sales-photo ul",".detail-photo ul"],formLock:false,init:function(){var h=this;this.initSlider();this.initEvent();this.initDropMenu();var i=d("/js/sales/navbar");new i({wrapper:".detail-wrapper",anchors:".main-detail .nav-anchor",resizeEvents:[a.EVENT_WINDOW_RESIZE]}).init();var g=d("/js/sales/sidebar");new g({resizeEvents:[a.EVENT_WINDOW_RESIZE]}).init();this.initStock();this.initShare();this.initFavorite();this.initReview();this.initStatistics();this.initSelfRecommend();this.initRecommend();this.initOtaCoupon();this.initWebIm();this.dingzhiSubmit();var f=d("/js/sales/map");this.map=new f();this.map.init();this.initLog()},dingzhiSubmit:function(){var f=$(".js_dingzhi_sunmit");f.on("click",function(){if(window.Env.UID!=0){$(this).attr("href","/customize/customize_demand.php?entry_type=product&entry_id="+window.Env.salesId)}else{SalesApp.gotoLogin()}})},initSlider:function(){var f=this;$.each(this.sliderDom,function(h,k){var j=$(k).length,g="";if(j>1){$(k).each(function(l,m){g=$(m).children("li");if(g.length>1){f.sliderAuto(g,null)}})}else{g=$(k).children("li");if(g.length>1){if($(k).data("type")=="salesPhoto"){f.sliderAuto(g,3000)}else{f.sliderAuto(g,null)}}}})},sliderAuto:function(h,g){var f=d("/js/sales/slider"),i=new f(),g=g||null;i.init(h);if(g){i.autoPlay(g)}},initShare:function(){var j=this;var h=d("/js/sales/share");var g=this.config.sales.name.replace(/（.*）/,"");this.share=new h({salesId:this.config.sales.id,title:"推荐个马蜂窝超赞旅行产品："+g+"。超值有品质，自由有保障，你也快来看看吧！",img:this.config.sales.img,url:"http://www.mafengwo.cn/sales/"+this.config.sales.id+".html"});$(".s-weibo").click(function(){j.share.toWeibo()});$(".s-qzone").click(function(){j.share.toQzone()});$(".s-weixin").click(function(){j.share.toWeixin()});var f=$(".intro-l .share-icon");var i=0;$(".intro-l .share").on("mouseenter",function(){if(i){clearTimeout(i);i=0}f.fadeIn(500)}).on("mouseleave",function(){i=setTimeout(function(){f.fadeOut(500);clearTimeout(i)},500)})},initFavorite:function(){var h=this;var g=d("/js/sales/favorite");var f=new g();$(".btn-collect").click(function(){var i=$(this);if($(this).hasClass("on")){i.removeClass("on");f.remove(h.config.sales.id,1,function(k){if(k.errno){i.addClass("on");mTinyAlert(k.error)}else{var j=i.find(".num").html()|0;i.find(".num").html(j-1);mTinyAlert("已取消收藏")}})}else{i.addClass("on");f.add(h.config.sales.id,1,function(k){if(k.errno){i.removeClass("on");mTinyAlert(k.error)}else{var j=i.find(".num").html()|0;i.find(".num").html(j+1);mTinyAlert("收藏成功")}})}})},initReview:function(){if(this.config.allow_show_review){var g=d("/js/sales/review");this.regResizeEvent([g.EVENT_LOAD_LIST]);var f=new g({salesId:this.config.sales.id});f.init()}},initSelfRecommend:function(){$.getJSON("/sales/detail_partial/selfRecommend?id="+window.Env.salesId,{},function(f){if(f&&f.data&&f.data.length){$("#selfRecommend").html(f.data);this.initBaoguangStatistics('[data-stat-display="10"]');this.initClickStatistics('[data-stat-area="6_2"]')}}.bind(this))},initRecommend:function(){$.getJSON("/sales/detail_partial/recommend?id="+window.Env.salesId,{},function(f){if(f&&f.data&&f.data.length){$("#selfRecommend").after(f.data);this.initBaoguangStatistics('[data-stat-display="9"]');this.initClickStatistics('[data-stat-area="6_1"]')}}.bind(this))},initOtaCoupon:function(){$.getJSON("/sales/detail_partial/ota_coupon?id="+window.Env.salesId,{},function(h){if(h&&h.data&&h.data.length){$("#mount_ota_coupon").after(h.data);var f=d("dialog/Dialog");var g=new f({content:$(".coupon-pop").show(),layerZIndex:100});$(document).on("click","#ota_coupon_show, .ota-coupon-btn",function(){g.show()});$(document).on("click",".js_ling_coupon",function(){if(window.Env.UID!=0){var i=$(this);b.post("/sales/coupon/",{action:"bindCoupon",code:i.data("bindcode")},function(j){if(j.errno==0){i.addClass("disabled").removeClass("js_ling_coupon").text("已领取");mAlert("恭喜你!领取成功")}else{mAlert(j.error)}},"bindCoupon","mobile")}else{SalesApp.gotoLogin()}})}})},initWebIm:function(){$.getJSON("/sales/detail_partial/web_im?id="+window.Env.salesId,{},function(f){if(f&&f.data&&f.data.show){$('[data-show-im="entrance"]').eq(0).show();if(f.data.hour){$('[data-show-im="hour"]').html(f.data.hour)}}})},initEvent:function(){var f=this;$(".main-detail img").on("load",function(){f._triggetResizeEvent()});$(window).on("resize",function(){f._triggetResizeEvent()});this.regResizeEvent(this.resizeEvents);$(".main-detail .tab").each(function(){var g=$(this).attr("data-event")||"click";$(this).children().on(g,function(){var h=$(this).index();$(this).addClass("on").siblings().removeClass("on");$(this).parent().nextAll(".list").hide().eq(h).show();$(this).trigger(a.EVENT_CHANGE_TAB)})});$(".crumb .drop").on("mouseenter",function(){$(this).addClass("open");var g=$(this).data("_hide");if(g){clearTimeout(g)}$(this).data("_hide",0)}).on("mouseleave",function(){var g=$(this);g.data("_hide",setTimeout(function(){g.removeClass("open");g.data("_hide",0)},300))});$(".expand-more").click(function(){$(this).closest(".react-expand").addClass("expanded");$(document).trigger(a.EVENT_EXPAND)});$(".poi-more").click(function(){$(".item-place").show();$(this).parent().remove();$(document).trigger(a.EVENT_EXPAND)});$(".react-expand:not(.expanded)").each(function(){if($(this).height()>=this.scrollHeight-18||location.search.indexOf("extend=1")>=0){$(this).addClass("expanded")}});$(".item-place .card").click(function(){var g=$(this).nextAll(".pop-place");if(g.is(":visible")){g.fadeOut(500)}else{$(".item-place .pop-place").not(g).hide();g.fadeIn(500)}});$(".item-place .pop-place .btn-close").click(function(){$(this).closest(".pop-place").fadeOut(500)});$(".bargain .i-tips").click(function(){var g=$(".bargain .tipspop");g.toggle()});$(".bargain .tipspop .close-btn").click(function(){$(".bargain .tipspop").hide()})},initStatistics:function(){this.initBaoguangStatistics('[data-stat-display][data-stat-display!="9"][data-stat-display!="10"]');this.initClickStatistics('[data-stat-area][data-stat-area!="6_1"][data-stat-area!="6_2"]')},initBaoguangStatistics:function(f){var g=this;$(f).baoguang({attr:"data-stat-display",relativeId:"data-stat-display",callback:function(j){var i=typeof(j.attr("data-stat-id"))==="undefined"?0:j.attr("data-stat-id");var h=typeof(j.attr("data-abtest"))==="undefined"?0:j.attr("data-abtest");if(g.isWeChatMiniProgram()){mfwPageEvent("sales","sales_product_details_display_v2",{product_id:window.Env.salesId,product_type:window.Env.salesType,section_id:j.attr("data-stat-display"),status:window.Env.saleStatus,test_id:0,suggest_id:h,suggest_product_id:i,source_id:window.Env.wxapp.source_id,source_ext:window.Env.wxapp.source_ext,is_ota:window.Env.wxapp.is_ota,business_name:window.Env.wxapp.business_name,})}if(false==g.isWeChatMiniProgram()){mfwPageEvent("sales","sales_product_details_display_v2",{product_id:window.Env.salesId,product_type:window.Env.salesType,section_id:j.attr("data-stat-display"),status:window.Env.saleStatus,test_id:0,suggest_id:h,suggest_product_id:i})}}})},initClickStatistics:function(f){$(document).on("click",f,function(){var h=typeof($(this).attr("data-stat-id"))==="undefined"?0:$(this).attr("data-stat-id");var g=typeof($(this).attr("data-abtest"))==="undefined"?0:$(this).attr("data-abtest");mfwPageEvent("sales","sales_product_details_click_v2",{product_id:window.Env.salesId,product_type:window.Env.salesType,position_id:$(this).attr("data-stat-area"),status:window.Env.saleStatus,test_id:0,suggest_id:g,suggest_product_id:h})})},regResizeEvent:function(f){var h=this;var i=f;if(typeof f=="string"){i=f.split(" ")}var g=false;$.each(i,function(k,j){if(h.resizeEvents.indexOf(j)<0){h.resizeEvents.push(j);g=true}});if(g){$(document).off(this._resizeEvents,this._triggetResizeEvent);this._resizeEvents=this.resizeEvents.join(" ");$(document).on(this._resizeEvents,this._triggetResizeEvent)}},_triggetResizeEvent:function(){var f=this;if(f._triggetIntervalId){clearTimeout(f._triggetIntervalId)}f._triggetIntervalId=setTimeout(function(){f._triggetIntervalId=0;$(document).trigger(a.EVENT_WINDOW_RESIZE)},100)},initDropMenu:function(){$(".ui-date").on("click",".trigger",function(i){i.stopPropagation();var f=$(this);var h=f.parent();var g=$(this).nextAll(".s_popup");if(g.is(":visible")){}else{g.show();h.addClass("drop-open");setTimeout(function(){$(document.body).on("click",function(k){var j=$(k.target);if(!j.closest(h).length||j.closest(f).length||j.closest("[data-stock-id]").length||j.is("[data-stock-id]")||j.is(".btn")){g.hide();h.removeClass("drop-open");$(document.body).off("click",arguments.callee)}})},0)}})},initLog:function(){try{$(".action-panel .buy .btn:not(.btn-disabled)").click(function(){mfwPageEvent("sales","detail_click",{pageId:window.Env.uPageId,button:"头部购买按钮",platform:"www"})});$(".m-book .buy .btn:not(.btn-disabled)").click(function(){mfwPageEvent("sales","detail_click",{pageId:window.Env.uPageId,button:"右侧购买按钮",platform:"www"})})}catch(f){}},initStock:function(){if($(".ticket-info").length){this.initTicketStock()}else{this.initNewStock()}},initNewStock:function(){this.regResizeEvent("stock_render_detail_content");d("/js/sales/stock/Process").boot(this.config.sales.id)},setDomDataAndAttr:function(f,g,h){f.attr("data-"+g,h);f.data(g,h)},initTicketPromotion:function(h){var f=this;var g=function(k,j){var l={"0":0,"-1":1,"1":2};var i=k?l[k.time_status]:999;var m=j?l[j.time_status]:999;if(i<m){return k}else{if(i>m){return j}else{if(k.time_status>0){if(j.end_ts>k.end_ts){return j}else{return k}}if(k.time_status<0){if(j.begin_ts<k.begin_ts){return j}else{return k}}if(k.time_status==0){if(j.begin_ts<k.begin_ts){return j}else{return k}}}}};b.getMulti("/sales/promotion/",{group_id:this.config.sales.id},{},function(j){if(!j.errno){var k={};$.each(j.data.list,function(){if(!(this.discount.type in k)){k[this.discount.type]={sku:{},product:null}}if(this.sku_id>0){k[this.discount.type]["sku"][this.sku_id]=g(this,k[this.discount.type]["sku"][this.sku_id])}else{k[this.discount.type]["product"]=g(this,k[this.discount.type]["product"])}});var i={is_new_user:j.data.ex.isNew,platform:"www"};if(k.TimeLimitedReduce){f.initTicketPromotion_TimeLimitedReduce(k.TimeLimitedReduce,i)}if(k.NOff){f.initTicketPromotion_NOff(k.NOff,i)}if(k.EarlyBird){f.initTicketPromotion_EarlyBird(k.EarlyBird,i)}if(k.Bargain){f.initTicketPromotion_Bargain(k.Bargain,i)}if(k.Honey){f.initTicketPromotion_Honey(k.Honey,i)}if(k.FlashSale){f.initTicketPromotion_FlashSale(k.FlashSale,i)}}h()},"simple")},initTicketPromotion_getBySkuId:function(h,g,j){var f=h.sku[g];var i=h.product;if(f){if(i){if(f.time_status!==0&&i.time_status===0){return i}else{if(!f.platform[j.platform]&&f.platform[j.platform]){return i}else{if(f.new_user_only&&!j.is_new_user&&!i.new_user_only){return i}}}}return f}else{if(i){return i}}return null},initTicketPromotion_TimeLimitedReduce:function(g,h){var i='<div class="t-blue">\n    <div class="s_popup num-tips">\n        <i class="i-arrow i-arrCenter"></i>\n        <p>{popup}</p>\n        {qrcode}\n    </div>\n    {btn}\n</div>';if(g.product&&g.product.time_status===0){(function(){var k,l;if(g.product.platform.www){k='<span class="mid-line"><i></i>限时立减</span>'}else{if(g.product.platform.app){k='<span class="mid-line"><i></i>APP立减</span>'}else{return}}l="<div>立减<b>"+g.product.discount.reduce+"</b>元</div>";$("[data-promotion-img-top]").html(k+l).show()})()}var j=this;var f=new Date().getTime()/1000|0;$(".ticket-info .ticket-item").each(function(){var k=$(this).find(".buybtn").data("id");var l=j.initTicketPromotion_getBySkuId(g,k,h);if(l&&l.time_status<=0&&l.begin_ts-f<86400*14&&(l.platform[h.platform]||l.platform.app)){var m=i.replace(/{popup}/g,function(){var o,q="",n;if(l.time_status<0){o=moment(l.begin_ts*1000).format("M月D日HH:mm")+"开始，"}else{var r=moment(l.begin_ts*1000).format("M.D");var p=moment(l.end_ts*1000).format("M.D");if(r!==p){o=r+"-"+p+"期间，"}else{o=moment(l.begin_ts*1000).format("M月D日")+"，"}}if(l.new_user_only){q="新人"}if(!l.platform[h.platform]){n='APP立减<span class="red">'+l.discount.reduce+"元</span>！"}else{n='限时立减<span class="red">'+l.discount.reduce+"元</span>！"}return o+q+n}).replace(/{btn}/g,function(){var n;if(l.platform[h.platform]){n="限时立减"}else{n="APP立减"}if(l.time_status===0){n+=l.discount.reduce+"元"}return n}).replace(/{qrcode}/g,function(){if(!l.platform[h.platform]&&l.time_status===0){return'<p>收藏产品，扫码下单</p>\n    <img src="https://n2-q.mafengwo.net/s9/M00/5D/32/wKgBs1bVB56AH_aIAAACrCZiYf4650.png?imageMogr2%2Fthumbnail%2F%21150x150r%2Fquality%2F90">'}else{return""}});$(m).appendTo($(this).find(".discount-info"))}})},initTicketPromotion_Honey:function(f,g){var h='<div class="t-default honey-hover">\n    <div class="s_popup num-tips">\n        <i class="i-arrow i-arrCenter"></i>\n        <p>下单时使用蜂蜜至多可抵扣订单金额的{reduce}%</p>\n    </div>\n    蜂蜜抵{reduce}%\n</div>';var i=this;$(".ticket-info .ticket-item").each(function(){var j=$(this).find(".buybtn").data("id");var k=i.initTicketPromotion_getBySkuId(f,j,g);if(k&&k.time_status===0&&k.platform.www){var l=h.replace(/{reduce}/g,k.discount.reduce*100);$(l).appendTo($(this).find(".discount-info"))}})},initTicketPromotion_NOff:function(g,h){var i='<div class="prop-tag">\n    <div class="s_popup num-tips">\n        <i class="i-arrow i-arrCenter"></i>\n        <p>{popup}</p>\n    </div>\n    {btn}\n</div>';var j=this;var f=new Date().getTime()/1000|0;$(".ticket-info .ticket-item").each(function(){var n=$(this).find(".buybtn");var k=n.data("id");var l=j.initTicketPromotion_getBySkuId(g,k,h);if(l&&l.time_status<=0&&l.begin_ts-f<86400*14&&l.platform[h.platform]){var m=i.replace(/{popup}/g,function(){var p,s,o;if(l.time_status<0){p=moment(l.begin_ts*1000).format("M月D日HH:mm")+"开始，"}else{var r=moment(l.begin_ts*1000).format("M.D");var q=moment(l.end_ts*1000).format("M.D");if(r!==q){p=r+"-"+q+"期间下单，"}else{p=moment(l.begin_ts*1000).format("M月D日")}}if(l.discount.is_repeat){s="每买"+l.discount.num+"件"}else{s="第"+l.discount.num+"件"}if(l.discount.reduce_unit==="rate"){if(l.discount.reduce>=1){o="免单！"}else{o="可享"+(1-l.discount.reduce)*10+"折！"}}else{o="立减"+l.discount.reduce+"元！"}return p+s+o}).replace(/{btn}/g,function(){if(l.discount.is_repeat){return"每买"+l.discount.num+"件减价"}else{return"第"+l.discount.num+"件减价"}});j.setDomDataAndAttr(n,"mode",2);j.setDomDataAndAttr(n,"selling-time",l.begin_ts*1000);j.setDomDataAndAttr(n,"offline-time",l.end_ts*1000+999);j.setDomDataAndAttr(n,"discount-min-num",l.discount.num);j.setDomDataAndAttr(n,"discount-type",l.discount.reduce_unit==="price"?1:0);j.setDomDataAndAttr(n,"discount-val",l.discount.reduce);j.setDomDataAndAttr(n,"sale-on-before",1);j.setDomDataAndAttr(n,"sale-on-after",1);j.setDomDataAndAttr(n,"discount-repeat",l.discount.is_repeat?1:0);$(m).appendTo($(this).find(".discount-info"))}})},initTicketPromotion_Bargain:function(g,h){var i='<div class="prop-tag">\n    <div class="s_popup num-tips">\n        <i class="i-arrow i-arrCenter"></i>\n        <p>{popup}</p>\n    </div>\n    砍价\n</div>';var j=this;var f=new Date().getTime()/1000|0;$(".ticket-info .ticket-item").each(function(){var n=$(this).find(".buybtn");var k=n.data("id");var l=j.initTicketPromotion_getBySkuId(g,k,h);if(l&&l.time_status<=0&&l.begin_ts-f<86400*14&&l.platform[h.platform]){var m=i.replace(/{popup}/g,function(){if(l.time_status<0){return moment(l.begin_ts*1000).format("M月D日HH:mm")+"开始，此产品支持砍价，下单更优惠！"}else{var p=moment(l.begin_ts*1000).format("M.D");var o=moment(l.end_ts*1000).format("M.D");if(p!==o){return p+"-"+o+"期间下单，砍价更优惠！"}else{return moment(l.begin_ts*1000).format("M月D日")+"下单，砍价更优惠"}}}).replace(/{btn}/g,function(){if(l.discount.is_repeat){return"每买"+l.discount.num+"件减价"}else{return"第"+l.discount.num+"件减价"}});$(m).appendTo($(this).find(".discount-info"));if(l.time_status===0&&!n.hasClass("soldout")){n.addClass("bargain").text("去砍价");n.data("bargain",true);j.setDomDataAndAttr(n,"stat-area","8_4")}}})},initTicketPromotion_EarlyBird:function(f,g){var h='<div class="prop-tag">\n    <div class="s_popup num-tips">\n        <i class="i-arrow i-arrCenter"></i>\n        <p>{popup}</p>\n    </div>\n    早鸟优惠\n</div>';var i=this;$(".ticket-info .ticket-item").each(function(){var m=$(this).find(".buybtn");var j=m.data("id");var k=i.initTicketPromotion_getBySkuId(f,j,g);if(k&&k.time_status===0&&k.platform[g.platform]){var l=h.replace(/{popup}/g,function(){var n="";$.each(k.discount.ladder,function(o,p){if(o){n+="<br>"}n+="出发前"+p.level+'天预定，每人️<span class="red">立减'+p.reduce+"元</span>！"});return n});m.data("earlyBirdLadder",k.discount.ladder);$(l).appendTo($(this).find(".discount-info"))}})},initTicketPromotion_FlashSale:function(g,h){var i='<div class="prop-tag">\n    <div class="s_popup num-tips">\n        <i class="i-arrow i-arrCenter"></i>\n        <p>{popup}</p>\n    </div>\n    蜂抢\n</div>';var j=this;var f=new Date().getTime()/1000|0;$(".ticket-info .ticket-item").each(function(){var p=$(this).find(".buybtn");var l=p.data("id");var n=j.initTicketPromotion_getBySkuId(g,l,h);if(n){if(n.time_status>0||!n.platform[h.platform]){$(this).hide();var k=$(this).find(".ticket-type");var r=$(this).nextAll(".ticket-item:visible:first");if(k.length&&r.length){r.prepend(k)}return}var q=(p.data("price")-n.discount.reduce);var o=i.replace(/{popup}/g,function(){var t,s="";if(n.time_status<0){t=moment(n.begin_ts*1000).format("M月D日HH:mm")+"开售，";s="抄底蜂抢价"+q+"元！"}else{t="此产品正在参加蜂抢，限时特价，限量秒杀！"}return t+s});var m=$(this).find(".ticket-price");m.html(m.html().replace(/¥[\d\.]+/,"¥"+q));j.setDomDataAndAttr(p,"mode",1);j.setDomDataAndAttr(p,"selling-time",n.begin_ts*1000);j.setDomDataAndAttr(p,"offline-time",n.end_ts*1000+999);j.setDomDataAndAttr(p,"reduce",n.discount.reduce);p.removeClass("bargain").data("bargain",false);p.data("earlyBirdLadder",null);$(o).appendTo($(this).find(".discount-info").empty())}})},initTicketStock:function(){var g=this;var f=$(".ticket-info");this.regResizeEvent("ticket_info_toggle");if(f.length){this.initTicketPromotion(function(){f.css("visibility","visible");var l=d("/js/sales/detail/stock/Sku");var k=d("/js/sales/detail/stock/NumBox");var o=$("#calendar_popup,#calendar_popup_mask");var j=o.find("[data-num-select]");var i=$("#text_total_price");var n=o.find(".n-discount");f.on("click",".ticket-item .ticket-name, .ticket-item .order-time, .ticket-item .ticket-price",function(){var p=$(this).closest("tr");if(!p.find(".ticket-name > i").length){return}p.toggleClass("info-spread");p.closest("table").find(".info-spread").not(p).removeClass("info-spread");$(document).trigger("ticket_info_toggle",p)});o.find(".close-btn").click(function(){o.hide()});g.skus=[];f.find(".ticket-item").each(function(){var p=$(this);var q=p.find(".buybtn");var r=l.parse(q.data());r.initButton(p);r.setName(p.find(".ticket-name").text());g.skus.push(r)});function m(w,q){var s=q.getPrices();j.hide();for(var r=0;r<s.length;r++){var v=s[r];var u=j.filter('[data-num-select="'+v.getKey()+'"]').show();u.find(".price").text(v.getMoney());var t=k.getInstanceFromDom(u);v.setNumBox(t);t.setMax(v.getMaxNum());t.setMin(v.getMinNum());if(v.getMaxNum()>=v.getMinNum()){var p=t.getNum()||v.getMinNum();if(t.getNum()<v.getMinNum()){p=v.getMinNum()}if(t.getNum()>v.getMaxNum()){p=v.getMaxNum()}if(!t.setNum(p)){}}}l.getOnSelectShowDom().show()}function h(y,z){var x=l.getCurrentSku();var p=0;var C={};var t=x.getCalendar();if(!t){return}var q=t.getCurrentDate();if(!q){return}var u=q.getPrices();if(!u){return}var B=0;for(var s=0;s<u.length;s++){var v=u[s];C[v.getDefId()]=v.getNum();p+=v.getMoney()*v.getNum();if(v.isPrimary()&&x.isNOff()&&x.isTimeInPromotion()){if(x.getNOff().during()){B+=x.getNOff().calcPrice(v.getNum(),v.getMoney())}}if(v.isPrimary()&&x.isEarlyBird()){B+=x.getEarlyBird().calcPrice(v.getNum(),x.getCalendar().getCurrentDate().getDate())}}p-=B;i.text(Math.round(p*100)/100);if(B){n.html("已优惠<span>"+(Math.round(B*100)/100)+"</span>元").show()}else{n.hide()}var r,w={};w[x.getId()]={t:C,d:{s:t.getCurrentDate().toDateString()}};r="skus="+JSON.stringify(w);var A="/sales/order/booking.php?"+r;$("[data-booking-btn-v2]").attr("href",A);$("[data-bargain-btn-v2]").attr("href",A+"&bargain=1")}$(document).on("stock_calendar_date_select",m);$(document).on("stock_price_num_change",h)})}},isWeChatMiniProgram:function(){if(window.__wxjs_environment){return window.__wxjs_environment==="miniprogram"}return false},};e.exports=a});M.define("PageAdmin",function(b){var e={},c=d();e.uuid=window.Env&&window.Env.uPageId||a();function a(){var f=c();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(h){var g=(f+Math.random()*16)%16|0;f=Math.floor(f/16);return(h==="x"?g:(g&3|8)).toString(16)})}function d(){var f=window.performance||{},g=f.now||f.mozNow||f.msNow||f.oNow||f.webkitNow||Date.now||function(){return new Date().getTime()};return g}return e});M.define("Storage",function(e,g,b){var n=document;var d=c();var f={_element:null,_expires:null,_file:document.location.hostname,init:function(){if(!this._element){try{this._element=n.createElement("input");this._element.type="hidden";this._element.addBehavior("#default#userData");n.body.appendChild(this._element);this.setItem("__detectUserDataStorage",1);this.removeItem("__detectUserDataStorage");return{setItem:this.setItem,getItem:this.getItem,removeItem:this.removeItem}}catch(p){M.error(p)}}return true},setItem:function(s,t,q){var p=j(q);this._element.expires=p.toUTCString();this._element.load(this._file);var r=a(this._element.getAttribute(s)),u=i(t,+p);this._element.setAttribute(s,u);this._element.save(this._file);k({key:s,newValue:u,oldValue:r,url:window.location.href})},getItem:function(p){this._element.load(this._file);var q=a(this._element.getAttribute(p));return q&&q.value},removeItem:function(p){this._element.load(this._file);this._element.removeAttribute(p);this._element.save(this._file)}};var l={setItem:function(r,s,q){if(!d){return}var p=j(q);localStorage.setItem(r,i(s,+p))},getItem:function(p){if(!d){return}var r=+new Date(),q=a(localStorage.getItem(p));if(q){if(r>q.timestamp){localStorage.removeItem(p);q=null}else{q=q.value}}return q},removeItem:function(p){if(!d){return}localStorage.removeItem(p)}};var h={},m={on:function(q,r){var p=h[q]||(h[q]=[]);p.push(r)},off:function(q,r){var p=h[q];if(!!p){if(!!r){M.forEach(p,function(t,s){if(t==r){p.splice(s,1)}})}else{p=[]}}return this}};M.mix(f,m);M.mix(l,m);if(window.addEventListener){window.addEventListener("storage",k,false)}else{if(window.attachEvent){window.attachEvent("onstorage",k)}}function k(u){if(!u){u=window.event}var p=M.mix({},u),w=u.newValue&&a(u.newValue),q=u.oldValue&&a(u.oldValue),v=+new Date();p.newValue=w&&w.value;if(!!q&&v<q.timestamp){p.oldValue=q.value}else{p.oldValue=null}var t=u.key,s=h[t],r=0;if(!t||!s||0===s.length){return}while(r<s.length){s[r++].call(window,p)}}function j(p){if(Object.prototype.toString.call(p)!="[object Date]"){var q=typeof p==="number"&&p>0?p:86400;p=new Date();p.setTime(+p+q*1000)}return p}function i(q,p){var r={value:q,timestamp:p};return JSON.stringify(r)}function a(p){if(p){try{p=JSON.parse(p);if(!("value" in p)||!("timestamp" in p)){p={value:p,timestamp:+j()}}}catch(q){p={value:p,timestamp:+j()}}}return p}function c(){if(window.localStorage){try{localStorage.setItem("__detectLocalStorage",1);localStorage.removeItem("__detectLocalStorage");return true}catch(p){return false}}return false}var o=window.localStorage?l:f.init();b.exports=M.mix(o,{isAvailable:c,isSupport:window.localStorage?d:("setItem" in o)})});M.define("Cookie",function(f,h,e){var g=/\+/g;var i=navigator.cookieEnabled;if(!i){document.cookie="__detectCookieEnabled=1;";i=document.cookie.indexOf("__detectCookieEnabled")!=-1?true:false;if(i){document.cookie="__detectCookieEnabled=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}}if(!i){return{isSupport:false}}var d={isSupport:true,set:function(m,n,k){k=(typeof k=="object"&&k!==null)?k:{};if(typeof k.expires==="number"){var o=k.expires,l=k.expires=new Date();l.setTime(+l+o*1000)}return(document.cookie=[j(m),"=",j(String(n)),k.expires?"; expires="+k.expires.toUTCString():"",k.path?"; path="+k.path:"",k.domain?"; domain="+k.domain:"",k.secure?"; secure":""].join(""))},get:function(q){var k=q?undefined:{};var r=document.cookie?document.cookie.split("; "):[];for(var p=0,m=r.length;p<m;p++){var s=r[p].split("=");var n=a(s.shift());var o=s.join("=");if(q&&q===n){k=b(o);break}if(!q&&(o=b(o))!==undefined){k[n]=o}}return k},remove:function(l,k){if(this.get(l)===undefined){return false}k=(typeof k=="object"&&k!==null)?k:{};k.expires=-1;this.set(l,"",k)}};function j(k){return encodeURIComponent(k)}function a(k){return decodeURIComponent(k)}function c(k){if(k.indexOf('"')===0){k=k.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{k=decodeURIComponent(k.replace(g," "));return k}catch(l){}}function b(k){var l=c(k);return l}e.exports=d});M.define("ResourceKeeper",function(d){var m=b();if(!m){return{isSupport:false}}var c=[];if(window.addEventListener){window.addEventListener("onbeforeunload",l,false)}else{if(window.attachEvent){window.attachEvent("onbeforeunload",l)}}function l(){M.forEach(c,function(n){n.release()})}var e=d("PageAdmin").uuid,j="default_resource",h="__resource_keeper",f=1000,k=2000;function a(n){n=""+n;n=n||j;this.keeping=false;this.resourceKeeperStorageKey=h+"_"+n;this.keepingRefreshInterval=0;this._initStorageListener();c.push(this)}M.mix(a.prototype,{keep:function(){this._requestKeep();return this.keeping},forceKeep:function(n){this._startKeep(n)},release:function(){if(this.keeping){var n=+new Date(),o=g(this.resourceKeeperStorageKey);if(o.currentKeeperPageUUID==e&&o.expire>n){m.remove(this.resourceKeeperStorageKey);this._setKeeping(false)}}},_initStorageListener:function(){M.Event(m).on("resource_keeper_change",M.bind(function(n){if(this.keeping&&n.key==this.resourceKeeperStorageKey&&n.pageUUID&&n.pageUUID!=e){this._setKeeping(false)}},this))},_requestKeep:function(){var n=+new Date(),o=g(this.resourceKeeperStorageKey);if(!o.currentKeeperPageUUID||o.currentKeeperPageUUID==e||o.expire<=n){this._startKeep(n)}else{this._setKeeping(false)}},_startKeep:function(n){n=n||+new Date();var o=n+k;m.set(this.resourceKeeperStorageKey,e+":"+o);this._setKeeping(true)},_setKeeping:function(n){this.keeping=n;if(this.keeping){this._startKeepingRefreshRequest()}else{this._stopKeepingRefreshRequest()}},_startKeepingRefreshRequest:function(){clearInterval(this.keepingRefreshInterval);this.keepingRefreshInterval=setInterval(M.bind(this._requestKeep,this),f)},_stopKeepingRefreshRequest:function(){clearInterval(this.keepingRefreshInterval)}});function b(){var o=null,p=d("Storage");if(p&&p.isSupport){o={set:M.bind(p.setItem,p),get:M.bind(p.getItem,p),remove:M.bind(p.removeItem,p)};if(window.addEventListener){window.addEventListener("storage",function(r){var q=r.key;if(q.indexOf(h)===0){var t="";if(r.newValue){var s=r.newValue.split(":");if(s.length==2){t=s[0]}}M.Event(o).fire("resource_keeper_change",{key:q,pageUUID:t})}},false)}}else{var n=d("Cookie");if(n&&n.isSupport){o={set:function(q,r){return n.set(q,r,k)},get:M.bind(n.get,n),remove:M.bind(n.remove,n)}}}return o}function g(p){var o={currentKeeperPageUUID:"",expire:0},n=m.get(p);if(n){n=n.split(":");o.currentKeeperPageUUID=n[0];o.expire=+n[1]}return o}function i(o){var n=new a(o);return{keep:M.bind(n.keep,n),forceKeep:M.bind(n.forceKeep,n),release:M.bind(n.release,n)}}i.isSupport=true;return i});(function(a){a.jGrowl=function(b,c){if(a("#jGrowl").size()==0){a('<div id="jGrowl"></div>').addClass((c&&c.position)?c.position:a.jGrowl.defaults.position).appendTo("body")}a("#jGrowl").jGrowl(b,c)};a.fn.jGrowl=function(b,d){if(a.isFunction(this.each)){var c=arguments;return this.each(function(){var e=this;if(a(this).data("jGrowl.instance")==undefined){a(this).data("jGrowl.instance",a.extend(new a.fn.jGrowl(),{notifications:[],element:null,interval:null}));a(this).data("jGrowl.instance").startup(this)}if(a.isFunction(a(this).data("jGrowl.instance")[b])){a(this).data("jGrowl.instance")[b].apply(a(this).data("jGrowl.instance"),a.makeArray(c).slice(1))}else{a(this).data("jGrowl.instance").create(b,d)}})}};a.extend(a.fn.jGrowl.prototype,{defaults:{pool:0,header:"",group:"",sticky:false,position:"top-right",glue:"after",theme:"default",themeState:"highlight",corners:"10px",check:250,life:3000,closeDuration:"normal",openDuration:"normal",easing:"swing",closer:true,closeTemplate:"&times;",closerTemplate:"<div>[ 关闭 ]</div>",log:function(c,b,d){},beforeOpen:function(c,b,d){},afterOpen:function(c,b,d){},open:function(c,b,d){},beforeClose:function(c,b,d){},close:function(c,b,d){},animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},notifications:[],element:null,interval:null,create:function(b,c){var c=a.extend({},this.defaults,c);if(typeof c.speed!=="undefined"){c.openDuration=c.speed;c.closeDuration=c.speed}this.notifications.push({message:b,options:c});c.log.apply(this.element,[this.element,b,c])},render:function(d){var b=this;var c=d.message;var e=d.options;var d=a('<div class="jGrowl-notification '+e.themeState+" ui-corner-all"+((e.group!=undefined&&e.group!="")?" "+e.group:"")+'"><div class="jGrowl-close">'+e.closeTemplate+'</div><div class="jGrowl-header">'+e.header+'</div><div class="jGrowl-message">'+c+"</div></div>").data("jGrowl",e).addClass(e.theme).children("div.jGrowl-close").bind("click.jGrowl",function(){a(this).parent().trigger("jGrowl.close")}).parent();a(d).bind("mouseover.jGrowl",function(){a("div.jGrowl-notification",b.element).data("jGrowl.pause",true)}).bind("mouseout.jGrowl",function(){a("div.jGrowl-notification",b.element).data("jGrowl.pause",false)}).bind("jGrowl.beforeOpen",function(){if(e.beforeOpen.apply(d,[d,c,e,b.element])!=false){a(this).trigger("jGrowl.open")}}).bind("jGrowl.open",function(){if(e.open.apply(d,[d,c,e,b.element])!=false){if(e.glue=="after"){a("div.jGrowl-notification:last",b.element).after(d)}else{a("div.jGrowl-notification:first",b.element).before(d)}a(this).animate(e.animateOpen,e.openDuration,e.easing,function(){if(a.browser.msie&&(parseInt(a(this).css("opacity"),10)===1||parseInt(a(this).css("opacity"),10)===0)){this.style.removeAttribute("filter")}a(this).data("jGrowl").created=new Date();a(this).trigger("jGrowl.afterOpen")})}}).bind("jGrowl.afterOpen",function(){e.afterOpen.apply(d,[d,c,e,b.element])}).bind("jGrowl.beforeClose",function(){if(e.beforeClose.apply(d,[d,c,e,b.element])!=false){a(this).trigger("jGrowl.close")}}).bind("jGrowl.close",function(){a(this).data("jGrowl.pause",true);a(this).animate(e.animateClose,e.closeDuration,e.easing,function(){a(this).remove();var f=e.close.apply(d,[d,c,e,b.element]);if(a.isFunction(f)){f.apply(d,[d,c,e,b.element])}})}).trigger("jGrowl.beforeOpen");if(e.corners!=""&&a.fn.corner!=undefined){a(d).corner(e.corners)}if(a("div.jGrowl-notification:parent",b.element).size()>1&&a("div.jGrowl-closer",b.element).size()==0&&this.defaults.closer!=false){a(this.defaults.closerTemplate).addClass("jGrowl-closer ui-state-highlight ui-corner-all").addClass(this.defaults.theme).appendTo(b.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){a(this).siblings().trigger("jGrowl.beforeClose");if(a.isFunction(b.defaults.closer)){b.defaults.closer.apply(a(this).parent()[0],[a(this).parent()[0]])}})}},update:function(){a(this.element).find("div.jGrowl-notification:parent").each(function(){if(a(this).data("jGrowl")!=undefined&&a(this).data("jGrowl").created!=undefined&&(a(this).data("jGrowl").created.getTime()+parseInt(a(this).data("jGrowl").life))<(new Date()).getTime()&&a(this).data("jGrowl").sticky!=true&&(a(this).data("jGrowl.pause")==undefined||a(this).data("jGrowl.pause")!=true)){a(this).trigger("jGrowl.beforeClose")}});if(this.notifications.length>0&&(this.defaults.pool==0||a(this.element).find("div.jGrowl-notification:parent").size()<this.defaults.pool)){this.render(this.notifications.shift())}if(a(this.element).find("div.jGrowl-notification:parent").size()<2){a(this.element).find("div.jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){a(this).remove()})}},startup:function(b){this.element=a(b).addClass("jGrowl").append('<div class="jGrowl-notification"></div>');this.interval=setInterval(function(){a(b).data("jGrowl.instance").update()},parseInt(this.defaults.check));if(a.browser.msie&&parseInt(a.browser.version)<7&&!window.XMLHttpRequest){a(this.element).addClass("ie6")}},shutdown:function(){a(this.element).removeClass("jGrowl").find("div.jGrowl-notification").remove();clearInterval(this.interval)},close:function(){a(this.element).find("div.jGrowl-notification").each(function(){a(this).trigger("jGrowl.beforeClose")})}});a.jGrowl.defaults=a.fn.jGrowl.prototype.defaults})(jQuery);if(window.M&&typeof window.M.define=="function"){window.M.define("jq-jgrowl",function(){return jQuery})}M.closure(function(e){var j=e("ResourceKeeper"),t=j.isSupport?new j("new_msg_loop"):null,s=e("Storage"),b=1000,r=10000,u=40000,d=120000;var v=(function(){if(j.isSupport){return $.proxy(t.keep,t)}else{return function(){return M.windowFocused}}}());var k=function(){if(j.isSupport){t.forceKeep()}};if("addEventListener" in window){window.addEventListener("focus",k,false)}else{if("attachEvent" in document){document.attachEvent("onfocusin",k)}}$(function(){if(window.Env&&window.Env.UID>0||window.__mfw_uid>0){setTimeout(n,b)}else{setTimeout(l,r)}$("body").delegate(".jGrowl-closer","click",function(x){$.getJSON("/ajax/ajax_msg.php",{a:"closetip"});s.setItem("jgrowl_close_time",+new Date())});M.Event.on("update msg",function(){setTimeout(function(){w();s.setItem("update_msg",+new Date())},1)});s.on("update_msg",function(x){w()});function w(){if(window.Env&&window.Env.UID>0||window.__mfw_uid>0){p("msgdisplay")}else{p("nologinfeed")}}});function n(){setInterval(function(){v()&&p("msgdisplay")},u)}function l(){var x,w=1;v()&&p("nologinfeed");x=setInterval(function(){v()&&p("nologinfeed");w++;if(w==3){clearInterval(x)}},d)}function p(w){$.get("/ajax/ajax_msg.php?a="+w,function(x){if(x){o(x)}},"json")}function o(w){g();M.Event.fire("get new msg",w);if(w.msg){m()}if(w.tips&&!i()){a(w)}}e("jq-jgrowl");function a(w){var x=w.tips.split(w.split_char);M.forEach(x,function(z,y){if(z){setTimeout(function(){$.jGrowl(z,{header:"新鲜事：",closer:false,life:20000})},2000*y+10)}})}function i(){var x=s.getItem("jgrowl_close_time"),w=+new Date();if(x&&w-x<24*60*60*1000){return true}return false}var c,f=0,h=1000,q=document.title;function m(){g();c=setInterval(function(){if(v()){f++;document.title=f%2===0?"【　　　】 - "+q:"【新消息】 - "+q}else{document.title=q}},h)}function g(){clearInterval(c);document.title=q}});M.define("dialog/alert",function(e,d){var b=e("dialog/Dialog"),a='<div id="popup_container" class="popup-box new-popbox"><a class="close-btn _j_close"><i></i></a><div class="pop-ico" id="_j_alertpopicon"><i class="i1"></i></div><div class="pop-ctn"><p class="hd _j_content"></p><p class="bd _j_detail"></p></div><div class="pop-btns"><a role="button" tabindex="0" class="popbtn popbtn-submit _j_close">&nbsp;确定&nbsp;</a></div></div>',f=M.extend(function(j){var i={width:420,content:"请输入内容",background:"#000",bgOpacity:0.7,PANEL_CLASS:"pop_no_margin",reposition:true,impl:"Alert",layerZIndex:10000};j=M.mix(i,j);f.$parent.call(this,j);this.bindEvents()},b),g=null,h=$.noop;M.mix(f.prototype,{tpl:a,setAlertTitle:function(i){this.setContent(i)},setAlertContent:function(i){this.getPanel().find("._j_detail").text(i)},setAssureWords:function(i){this.getPanel().find(".popbtn-submit").text(i)},setCloserHide:function(i){if(i){this.getPanel().find(".close-btn").hide()}else{this.getPanel().find(".close-btn").show()}},bindEvents:function(){var i=this.getPanel();i.on("keydown",".pop-btns ._j_close",function(j){if(j.keyCode==13){$(this).trigger("click")}}).on("click",".pop-btns ._j_close",function(j){i.data("btn_trigger",true)})}});var c=function(i,k,j){if(!g){g=new f();M.Event(g).on("afterhide",function(){var l=g.getPanel();if(typeof h=="function"){h.call(g,l)}l.data("btn_trigger",false)});M.Event(g).on("aftershow",function(){g.getPanel().find(".pop-btns ._j_close").focus()})}g.getLayer().toFront();if(M.isObject(i)){g.setAlertTitle(i.title);g.setAlertContent(i.content)}else{g.setAlertTitle(i);g.setAlertContent("")}if(M.isObject(i)){if(i.assureWords){g.setAssureWords(i.assureWords)}else{g.setAssureWords("确定")}if(i.hideCloser){g.setCloserHide(true)}else{g.setCloserHide(false)}}else{g.setAssureWords("确定");g.setCloserHide(false)}if(typeof k=="function"){h=k}else{h=$.noop}if(j){$("#_j_alertpopicon").children("i").attr("class","i"+j)}else{$("#_j_alertpopicon").children("i").attr("class","i"+1)}g.show();return g};d.pop=c;d.warning=function(i,j){c(i,j,1)};d.tip=function(i,j){c(i,j,3)}});M.define("FrequencyVerifyControl",function(c,b,d){function a(e){this.container=e.container;this.app=e.app;this.successHandler=$.noop;M.mix(this,e);this.init()}a.prototype={init:function(){this.initData();this.refreshImg();this.verifyCon.delegate("img,._j_change_img","click",$.proxy(function(e){this.refreshImg()},this));this.verifyCon.delegate("._j_fre_confirm","click",$.proxy(function(h){var g=this.verifyText.val();var f=g.length;if(f==0){this.showErro("您还没有输入验证码!");return false}else{if(f!==6){this.showErro("请输入正确的验证码!");return false}}var e=$(h.currentTarget);if(e.hasClass("waiting")){return false}e.addClass("waiting");$.post("/user/captcha/verify",{sCode:g,iApp:this.app},$.proxy(function(i){if(i){if(i.ret===1){this.successHandler(this.target);this.verifyCon.hide();this.hideErro()}else{if(i.ret===0){this.verifyText.val("");this.verifyText.focus();this.refreshImg();this.showErro("输入的验证码不正确!")}else{if(i.ret===-1){this.showErro("错误次数过多，请稍候尝试")}}}}e.removeClass("waiting")},this),"json")},this));this.verifyCon.delegate("._j_fre_text","keyup",$.proxy(function(e){if(e.keyCode==13){this.verifyCon.find("._j_fre_confirm").trigger("click")}},this))},showErro:function(e){this.errorCon.html(e);this.errorCon.show()},hideErro:function(){this.errorCon.hide()},initData:function(){this.verifyCon=this.container;this.verifyPo=this.verifyCon.find(".protectedYZM");this.verifyImg=this.verifyCon.find("img");this.verifyText=this.verifyCon.find("._j_fre_text");this.errorCon=this.verifyPo.find(".n-error")},refreshImg:function(){var e="/user/captcha/code?iApp="+this.app+"&s="+new Date().getTime();this.verifyImg.attr("src",e)}};d.exports=a});M.define("FrequencySystemVerify",function(f,e,g){var b=f("dialog/Dialog"),h=f("dialog/Layer"),d=f("FrequencyVerifyControl");var a='<div class="popYzm" style="z-index:inherit;position: relative;width:350px;height: 250px"><div class="protectedYZM" style="border: none;box-shadow: none;padding:25px 15px;"><p>亲爱的蜂蜂，你操作的速度有点像机器人<br>来证明下自己吧~</p><div class="YZMInput"><input class="_j_fre_text" type="text" placeHolder="验证码"></div><div class="YZMInput"><img src="http://images.mafengwo.net/images/home_new2015/verify.gif" width="150px" height="40px"><label><a href="javascript:void(0);" class="_j_change_img">看不清，换一张</a></label></div><div class="YZMSubmit"><a href="javascript:void(0);" class="_j_fre_confirm" title="确定">确定</a><span class="n-error">错误次数过多，请稍候尝试</span></div></div></div>';function c(i){this.app=i.app;this.init()}c.prototype={init:function(){var i=new b({content:a});if(h.getActive()){i.getLayer().setZIndex(h.getActive().getZIndex()+1)}i.show();var j=i.getPanel().find(".popYzm");new d({container:j,app:this.app,successHandler:$.proxy(function(){M.Event.fire("frequency:system:verify:success");i.close()},this)})}};g.exports=c});M.closure(function(d){var b=d("dialog/Dialog"),f=d("dialog/alert"),c=d("FrequencySystemVerify");window.show_login=a;$.ajaxSetup({dataFilter:function(i,h){try{var k=$.parseJSON(i);if(k&&k.unsafe==1){window.location.href="http://www.mafengwo.cn";return"{}"}if(k&&k.error&&k.error.msg=="login:required"){M.Event.fire("login:required");return"{}"}if(k&&k.error&&k.error.msg=="mobilebind:required"){f.pop({title:"依《网络安全法》要求，你需要在发布内容之前绑定手机号~",assureWords:"去绑定",hideCloser:true},function(m){location.href=window.Env.P_HTTP+"/setting/security/mobile/"});return{}}if(k&&k.resource&&k.resource.onload&&k.resource.onload.length){if(k.resource.onload[0]=='K.fire("login:required");'){M.Event.fire("login:required");return"{}"}}if(k&&k.error){var g=0;var l=0;if(typeof(k.error.errno)!=="undefined"){g=k.error.errno;l=k.error.error}else{if(typeof(k.error.code)!=="undefined"){g=k.error.code;l=k.error.msg}}if(g===10000){M.Event.fire("frequency:verify",l);return"{}"}}}catch(j){}return i},error:function(g){if(g.status==401){if(g.responseJSON&&g.responseJSON.data&&g.responseJSON.data.auth_type=="login"){M.Event.fire("login:required")}}}});var e=null;function a(){if($.browser.msie&&parseInt($.browser.version,10)<9){document.location.href=(window.Env&&window.Env.P_HTTP)||"https://passport.mafengwo.cn";return}if(!e){e=new b({PANEL_CLASS:"login_pop",content:'<iframe frameborder="no" border="0" scrolling="no" width="580" height="292" allowtransparency="true"></iframe>',background:"#aaa",bgOpacity:0.6,reposition:true,impl:"logindialog"})}e.show();if(!e.getPanel().find("iframe").attr("src")){M.Event(e).once("aftershow",function(){var g=window.Env.P_HTTP||"https://passport.mafengwo.cn";e.getPanel().find("iframe").attr("src",g+"/login-popup.html")})}}M.Event.on("login:required",a);M.Event.on("frequency:verify",function(g){new c({app:g})});if(M.Event.isFired("login:required")){a()}});M.define("ScrollObserver",function(e,g,c){var h=0,f={},a=false,b,d=true;g.addObserver=function(k){var j="ScrollObserver_"+h;h++;f[j]=k;d=false;return j};g.removeObserver=function(j){delete f[j];if(M.isEmpty(f)){d=true}};function i(){for(var j in f){if(f.hasOwnProperty(j)){f[j]()}}}$(window).scroll(function(){if(d){return}if(!a){b=setInterval(function(){if(a){a=false;clearTimeout(b);i()}},50)}a=true});return g});M.define("QRCode",function(b,a,c){c.exports={gen:function(e,d){var d={text:e,size:d.size||200,eclevel:d.evlevel||"H",logo:d.logo||"",__stk__:window.Env.CSTK};return"http://"+window.Env.WWW_HOST+"/qrcode.php?"+$.param(d)}}});M.closure(function(b){var l=b("ScrollObserver"),m=b("Storage"),d=window.Env||{},f=$("#_j_mfwtoolbar"),h=f.height(),a=$(window).height(),k=$(document).height(),g=$("#footer"),e=g.outerHeight();$("body").css("position","relative");$(window).resize(function(){a=$(window).height();k=$(document).height()});setInterval(function(){var n=$(document).height();if(n!=k){k=n;$(window).trigger("scroll")}},2000);if(!d.hideToolbar){if(!d.showToolbarDownArrow){f.children(".toolbar-item-down").remove()}else{f.children(".toolbar-item-down").show()}f.show();c();l.addObserver(c);f.on("click","._j_gotop",i);f.on("click","._j_gobottom",j);f.children(".toolbar-item-code").mouseenter(function(){$(this).addClass("hover")});f.children(".toolbar-item-code").mouseleave(function(){$(this).removeClass("hover")})}function c(){var n=$(window).scrollTop();if(n>500){f.children(".toolbar-item-top").show()}else{f.children(".toolbar-item-top").hide()}if(g.length){if(n+a>g.offset().top){f.css({position:"absolute",bottom:e+20})}else{f.css({position:"",bottom:""})}}}function i(){$("html, body").animate({scrollTop:0},500,function(){M.Event.fire("scroll to top")})}function j(){$("html, body").animate({scrollTop:k-a},500,function(){M.Event.fire("scroll to bottom")})}});(function(){var a=document.createElement("script"),b=window.Env&&window.Env.CNZZID||30065558;a.type="text/javascript";a.async=true;a.charset="utf-8";a.src=document.location.protocol+"//w.cnzz.com/c.php?id="+b+"&async=1";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c)})();M.closure(function(a){M.log("只要你有梦想，就加入我们\n你即将见证互联网最新趋势的快速成长\n马蜂窝的一切资源都会成为你成长路上的最大助力\n你可以和马蜂窝一起书写互联网的风云奇迹\n在这里有一群和你一样，疯狂地热爱互联网和旅行的人们\n马蜂窝能为你实现梦想提供最广阔的平台");M.log("请将简历发送至 %csuperhr@mafengwo.com%c（ 邮件标题请以“_console”结尾）","color:#4ae;","color:inherit;");M.log("职位介绍：http://www.mafengwo.cn/s/hr.html")});M.closure(function(a){$.get("/ajax/ajax_page_onload.php",{href:document.location.href,_t:+new Date()},function(b){if(b.payload&&b.payload.apps){var c=b.payload.apps;if(!M.isEmpty(c)){var d={css_list:c.css||[]};M.loadCssJsListSeq(d,function(){if(c.html){$("body").append(c.html)}if(c.js&&c.js.length){M.loadResource(c.js)}})}}},"json")});