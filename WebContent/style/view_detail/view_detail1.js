M.define("/js/Dropdown",function(c,b,d){function a(e){this.$nav=typeof e.nav==="string"?$(e.nav):e.nav;this.$panel=typeof e.panel==="string"?$(e.panel):e.panel;this.showCallback=e.showCallback;this.hideCallback=e.hideCallback;this.delay=e.delay||0;this.event=e.event||"mouseenterleave";this._isShow=false;this.init()}a.prototype={init:function(){if(this.event==="mouseenterleave"){this.$nav.on("mouseenter.dropdown",M.bind(function(e){this.show()},this)).on("mouseleave.dropdown",M.bind(function(e){if($(e.relatedTarget).closest(this.$panel).length===0){this.hide(true)}},this));this.$panel.on("mouseenter.dropdown",M.bind(function(e){this.show()},this)).on("mouseleave.dropdown",M.bind(function(e){if($(e.relatedTarget).closest(this.$nav).length===0){this.hide(false)}},this))}if(this.event==="click"){this.$nav.on("click.dropdown",M.bind(function(e){this.show()},this));$(document).on("click.dropdown",M.bind(function(e){if($(e.target).closest(this.$nav).length===0&&$(e.target).closest(this.$panel).length===0){this.hide(false)}},this))}},show:function(){this.$panel.show();this._isShow=true;if(M.isFunction(this.showCallback)){this.showCallback.call(this,this.$nav,this.$panel)}},hide:function(e){this._isShow=false;if(e&&this.delay>0){setTimeout(M.bind(function(){if(!this._isShow){this.$panel.hide();if(M.isFunction(this.hideCallback)){this.hideCallback.call(this,this.$nav,this.$panel)}}},this),this.delay)}else{this.$panel.hide();if(M.isFunction(this.hideCallback)){this.hideCallback.call(this,this.$nav,this.$panel)}}},destory:function(){if(this.event==="mouseenterleave"){this.$nav.off("mouseenter.dropdown").off("mouseleave.dropdown");this.$panel.off("mouseenter.dropdown").off("mouseleave.dropdown")}if(this.event==="click"){this.$nav.off("click.dropdown")}this.$panel.hide()}};d.exports=a});M.define("/js/pageletcommon/pageHeadUserInfoWWWNormal",function(c){var a=c("/js/Dropdown"),b=window.Env||{};return{events:{},init:function(){var k=$("#head-btn-daka");$(function(){$(".new_daka_tips").addClass("on")});$(".ndt_close").on("click",function(){$(this).parent().hide()});M.Event.on("afterDaka",l);function l(q){if(q&&q.dakaFlag){k.closest(".head-daka").addClass("daka-complete")}}var e=i("dakaday");if(e!==null){$(".head-btn-daka").attr("data-day",e)}function i(q){var s=new RegExp("(^|&)"+q+"=([^&]*)(&|$)");var t=window.location.search.substr(1).match(s);if(t!==null){return unescape(t[2])}return null}var g=new a({nav:"#_j_head_user",panel:"#_j_user_panel",showCallback:function(q,r){q.find(".drop-trigger").addClass("drop-trigger-active")},hideCallback:function(q,r){q.find(".drop-trigger").removeClass("drop-trigger-active")},delay:500});var d=0,p=$("#_j_head_msg"),o=$("#_j_msg_panel"),n=p.find(".head-msg-new"),j=$("#_j_msg_float_panel");var f=new a({nav:p.selector,panel:o.selector,showCallback:function(q,r){q.find(".drop-trigger").addClass("drop-trigger-active")},hideCallback:function(q,r){q.find(".drop-trigger").removeClass("drop-trigger-active")},delay:200});M.Event.on("get new msg",function(q){if(q.msg||d>0){o.find("ul").html(q.menu_index);h()}});o.on("click","a",function(q){M.Event.fire("update msg")});j.on("click","ul a",function(q){M.Event.fire("update msg")});j.on("click",".close-newmsg",function(q){m()});function m(){n.hide();j.hide();$.ajax({url:"http://"+b.WWW_HOST+"/ajax/ajax_msg.php",dataType:"jsonp",data:{a:"ignore",from:"1"},success:function(q){M.Event.fire("update msg")}})}window.close_msg_tips=m;function h(){var q="";d=0;o.find(".num").each(function(r,t){var s=$(t);d+=Number(s.html());q+="<li>"+s.closest("li").html()+"</li>"});if(d>0){n.html((d>99?"99+":d)).show();j.find("ul").html(q).end().show()}else{n.hide();j.hide()}}h()}}});
/*!
 * jQuery Templates Plugin 1.0.0pre
 * http://github.com/jquery/jquery-tmpl
 * Requires jQuery 1.4.2
 *
 * Copyright 2011, Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
(function(i,f){var t=i.fn.domManip,h="_tmplitem",u=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,p={},e={},y,x={key:0,data:{}},w=0,q=0,g=[];function k(B,A,D,E){var C={data:E||(E===0||E===false)?E:(A?A.data:{}),_wrap:A?A._wrap:null,tmpl:null,parent:A||null,nodes:[],calls:c,nest:b,wrap:n,html:r,update:z};if(B){i.extend(C,B,{nodes:[],parent:A})}if(D){C.tmpl=D;C._ctnt=C._ctnt||C.tmpl(i,C);C.key=++w;(g.length?e:p)[w]=C}return C}i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(A,B){i.fn[A]=function(C){var F=[],I=i(C),E,G,D,J,H=this.length===1&&this[0].parentNode;y=p||{};if(H&&H.nodeType===11&&H.childNodes.length===1&&I.length===1){I[B](this[0]);F=this}else{for(G=0,D=I.length;G<D;G++){q=G;E=(G>0?this.clone(true):this).get();i(I[G])[B](E);F=F.concat(E)}q=0;F=this.pushStack(F,A,I.selector)}J=y;y=null;i.tmpl.complete(J);return F}});i.fn.extend({tmpl:function(C,B,A){return i.tmpl(this[0],C,B,A)},tmplItem:function(){return i.tmplItem(this[0])},template:function(A){return i.template(A,this[0])},domManip:function(E,H,G,I){if(E[0]&&i.isArray(E[0])){var B=i.makeArray(arguments),A=E[0],F=A.length,C=0,D;while(C<F&&!(D=i.data(A[C++],"tmplItem"))){}if(D&&q){B[2]=function(J){i.tmpl.afterManip(this,J,G)}}t.apply(this,B)}else{t.apply(this,arguments)}q=0;if(!y){i.tmpl.complete(p)}return this}});i.extend({tmpl:function(C,F,E,B){var D,A=!B;if(A){B=x;C=i.template[C]||i.template(null,C);e={}}else{if(!C){C=B.tmpl;p[B.key]=B;B.nodes=[];if(B.wrapped){s(B,B.wrapped)}return i(m(B,null,B.tmpl(i,B)))}}if(!C){return[]}if(typeof F==="function"){F=F.call(B||{})}if(E&&E.wrapped){s(E,E.wrapped)}D=i.isArray(F)?i.map(F,function(G){return G?k(E,B,C,G):null}):[k(E,B,C,F)];return A?i(m(B,null,D)):D},tmplItem:function(B){var A;if(B instanceof i){B=B[0]}while(B&&B.nodeType===1&&!(A=i.data(B,"tmplItem"))&&(B=B.parentNode)){}return A||x},template:function(B,A){if(A){if(typeof A==="string"){A=l(A)}else{if(A instanceof i){A=A[0]||{}}}if(A.nodeType){A=i.data(A,"tmpl")||i.data(A,"tmpl",l(A.innerHTML))}return typeof B==="string"?(i.template[B]=A):A}return B?(typeof B!=="string"?i.template(null,B):(i.template[B]||i.template(null,u.test(B)?B:i(B)))):null},encode:function(A){return(""+A).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});i.extend(i.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(A){p={}},afterManip:function v(C,A,D){var B=A.nodeType===11?i.makeArray(A.childNodes):A.nodeType===1?[A]:[];D.call(C,A);o(B);q++}});function m(A,E,C){var D,B=C?i.map(C,function(F){return(typeof F==="string")?(A.key?F.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+h+'="'+A.key+'" $2'):F):m(F,A,F._ctnt)}):A;if(E){return B}B=B.join("");B.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(G,H,F,I){D=i(F).get();o(D);if(H){D=a(H).concat(D)}if(I){D=D.concat(a(I))}});return D?D:a(B)}function a(B){var A=document.createElement("div");A.innerHTML=B;return i.makeArray(A.childNodes)}function l(A){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+i.trim(A).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(I,C,G,D,E,J,F){var N=i.tmpl.tag[G],B,H,K;if(!N){throw"Unknown template tag: "+G}B=N._default||[];if(J&&!/\w$/.test(E)){E+=J;J=""}if(E){E=j(E);F=F?(","+j(F)+")"):(J?")":"");H=J?(E.indexOf(".")>-1?E+j(J):("("+E+").call($item"+F)):E;K=J?H:"(typeof("+E+")==='function'?("+E+").call($item):("+E+"))"}else{K=H=B.$1||"null"}D=j(D);return"');"+N[C?"close":"open"].split("$notnull_1").join(E?"typeof("+E+")!=='undefined' && ("+E+")!=null":"true").split("$1a").join(K).split("$1").join(H).split("$2").join(D||B.$2||"")+"__.push('"})+"');}return __;")}function s(B,A){B._wrap=m(B,true,i.isArray(A)?A:[u.test(A)?A:i(A).html()]).join("")}function j(A){return A?A.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function d(A){var B=document.createElement("div");B.appendChild(A.cloneNode(true));return B.innerHTML}function o(G){var I="_"+q,B,A,E={},F,D,C;for(F=0,D=G.length;F<D;F++){if((B=G[F]).nodeType!==1){continue}A=B.getElementsByTagName("*");for(C=A.length-1;C>=0;C--){H(A[C])}H(B)}function H(Q){var N,P=Q,O,J,K;if((K=Q.getAttribute(h))){while(P.parentNode&&(P=P.parentNode).nodeType===1&&!(N=P.getAttribute(h))){}if(N!==K){P=P.parentNode?(P.nodeType===11?0:(P.getAttribute(h)||0)):0;if(!(J=p[K])){J=e[K];J=k(J,p[P]||e[P]);J.key=++w;p[w]=J}if(q){R(K)}}Q.removeAttribute(h)}else{if(q&&(J=i.data(Q,"tmplItem"))){R(J.key);p[J.key]=J;P=i.data(Q.parentNode,"tmplItem");P=P?P.key:0}}if(J){O=J;while(O&&O.key!=P){O.nodes.push(Q);O=O.parent}delete J._ctnt;delete J._wrap;i.data(Q,"tmplItem",J)}function R(S){S=S+I;J=E[S]=(E[S]||k(J,p[J.parent.key+I]||J.parent))}}}function c(C,A,D,B){if(!C){return g.pop()}g.push({_:C,tmpl:A,item:this,data:D,options:B})}function b(A,C,B){return i.tmpl(i.template(A),C,B,this)}function n(C,A){var B=C.options||{};B.wrapped=A;return i.tmpl(i.template(C.tmpl),C.data,B,C.item)}function r(B,C){var A=this._wrap;return i.map(i(i.isArray(A)?A.join(""):A).filter(B||"*"),function(D){return C?D.innerText||D.textContent:D.outerHTML||d(D)})}function z(){var A=this.nodes;i.tmpl(null,null,null,this).insertBefore(A[0]);i(A).remove()}if(window.M&&typeof M.define=="function"){M.define("jq-tmpl",function(){return i})}})(jQuery);M.define("InputListener",function(c,b,d){var a={listen:function(f,e){f=$(f);f.each($.proxy(function(g,h){h=$(h);if(!h.is("input")&&!h.is("textarea")){throw new Error("input listener only apply to input or textarea")}this.initListen(h,e)},this))},unlisten:function(e){e=$(e);e.each($.proxy(function(h,k){k=$(k);if(!k.is("input")&&!k.is("textarea")){throw new Error("input listener only apply to input or textarea")}if(arguments.length==1){k.unbind("focus",this.getStartListenFunc());k.unbind("blur",this.getStopListenFunc());k.removeData("__input_listener_handlers")}else{if(typeof arguments[1]=="function"){var j=arguments[1],g=k.data("__input_listener_listeninterval");for(var h=0,f=g.length;h<f;h++){if(g[h]==j){g.splice(h,1);h--}}}}},this))},initListen:function(f,e){f.data("__input_listener_currentval",f.val());if(!f.data("__input_listener_handlers")){this.bindListenEvent(f)}this.addListenHandler(f,e);if(f.is(":focus")){f.blur();f.focus()}},bindListenEvent:function(e){e.data("__input_listener_handlers",[]);e.focus(this.getStartListenFunc());e.blur(this.getStopListenFunc())},getStartListenFunc:function(){if(!this.bindStartListenFunc){this.bindStartListenFunc=$.proxy(this.startListen,this)}return this.bindStartListenFunc},getStopListenFunc:function(){if(!this.bindStopListenFunc){this.bindStopListenFunc=$.proxy(this.stopListen,this)}return this.bindStopListenFunc},startListen:function(e){var f=$(e.target);f.data("__input_listener_currentval",f.val());f.data("__input_listener_listeninterval",setInterval($.proxy(function(){var h=f.data("__input_listener_currentval"),g=f.val();if(h!=g){f.data("__input_listener_currentval",g);this.triggerListenHandler(f)}},this),100))},stopListen:function(e){var f=$(e.target);clearInterval(f.data("__input_listener_listeninterval"))},addListenHandler:function(f,e){if(typeof e=="function"){f.data("__input_listener_handlers").push(e)}},triggerListenHandler:function(h){var f=h.data("__input_listener_handlers");for(var g=0,e=f.length;g<e;g++){f[g].call(null,{target:h.get(0)})}}};return a});M.define("SuggestionXHR",function(b,a,c){function d(e){this.URL=null;this.delay=200;this.dataType="text";$.extend(this,e);this.delayTimer=null;this.xhr=null;this.cache={};this.init()}d.prototype={init:function(){if(!this.URL){throw new Error("no url for suggestion")}},getSuggestion:function(g,h){var f=this.getQuery(g),e=this.cache[f];h=typeof h==="function"?h:$.noop;this.stop();if(e){h(e)}else{this.getXHRData(f,h)}},stop:function(){clearTimeout(this.delayTimer);if(this.xhr&&this.xhr.readyState!==4){this.xhr.abort()}},getQuery:function(h){var g="";if(typeof h=="string"){g=encodeURIComponent(h)}else{if(h&&typeof h=="object"){var e=[];for(var f in h){if(h.hasOwnProperty(f)){e.push(f+"="+encodeURIComponent(h[f]))}}g=e.join("&")}}return g},getXHRData:function(e,h){var f=this.xhr,g={url:this.URL,data:e,dataType:this.dataType,success:M.bind(function(i){h(i);this.cache[e]=i},this)};this.delayTimer=setTimeout(M.bind(function(){this.xhr=$.ajax(g)},this),this.delay)}};return d});M.define("DropList",function(c,b,d){var a=M.Event;function e(f){this.trigger=null;this.container=null;this.itemSelector="._j_listitem";this.itemHoverClass="on";this.firstItemHover=false;$.extend(this,f);this.trigger=$(this.trigger);this.container=$(this.container);this.mouseon=false;this.visible=false;this.init()}M.mix(e.prototype,{createContainer:$.noop,updateList:$.noop,init:function(){if(!this.trigger.length){M.error("no trigger for drop list")}if(!this.container.length){this.container=this.createContainer()}if(!this.container.length){M.error("no container for drop list")}this.bindEvents()},bindEvents:function(){this.trigger.on("keydown",$.proxy(function(g){var h=g.keyCode;if(this.visible&&h==13){var f=this.getFocusItem();if(f.length){this.selectItem(f);g.preventDefault()}}else{if(this.visible&&h==38){this.moveFocus(-1)}else{if(this.visible&&h==40){this.moveFocus(1)}}}},this));this.container.on("mouseenter",this.itemSelector,$.proxy(this.moveFocus,this)).on("click",this.itemSelector,$.proxy(this.clickItem,this)).on("mouseenter",$.proxy(this.mouseOverCnt,this)).on("mouseleave",$.proxy(this.mouseOutCnt,this))},show:function(g){this.updateList(g);this.container.show();if(this.firstItemHover){var f=this.container.find(this.itemSelector);if(f.length){this.moveFocus(1)}}this.visible=true},hide:function(){this.container.hide();this.visible=false},clickItem:function(g){var f=this.getFocusItem();this.selectItem(f);g.preventDefault()},selectItem:function(f){a(this).fire("itemselected",{item:f})},moveFocus:function(i){var h=this.container.find(this.itemSelector),j=this.getFocusItem(),g=j,f;if(i===-1){if(j.length){f=h.index(j)-1}if(!j.length||f==-1){g=h.last()}else{g=h.eq(f)}}else{if(i===1){if(j.length){f=h.index(j)+1}if(!j.length||f==h.length){g=h.first()}else{g=h.eq(f)}}else{if(i.currentTarget){g=$(i.currentTarget)}}}j.removeClass(this.itemHoverClass);g.addClass(this.itemHoverClass);a(this).fire("itemfocused",{prevItem:j,focusItem:g})},getFocusItem:function(){var f=this.container.find(this.itemSelector);return f.filter("."+this.itemHoverClass)},mouseOverCnt:function(){this.mouseon=true},mouseOutCnt:function(){this.mouseon=false}});return e});M.define("Suggestion",function(c){c("jq-tmpl");var a=c("InputListener");var b='{{each(i, item) list}}<li class="${listItemClass}" data-value="${item.value}">${item.text}</li>{{/each}}';function d(e){e.suggestionURL=e.url||$(e.input).data("suggestionurl");this.dropListClass="droplist";this.listItemSelector="._j_listitem";this.listItemHoverClass="on";this.listFirstItemHover=false;this.keyParamName="key";this.dataType="json";this.suggestionParams={};this.listContainer=null;M.mix(this,e);this.input=$(this.input);this.listTmpl=this.listTmpl||b;this.actOnList=false;this.init()}M.mix(d.prototype,{init:function(){a.listen(this.input,$.proxy(this.inputChange,this));this.input.blur($.proxy(function(f){var e=$(f.currentTarget);if(e.data("droplist")){setTimeout($.proxy(function(){if(!this.actOnList&&e.data("droplist")){e.data("droplist").hide()}this.actOnList=false},this),200)}},this));this.input.keyup($.proxy(function(f){var e=$(f.currentTarget);if(f.keyCode==40&&(!e.data("droplist")||!e.data("droplist").visible)){this.inputChange(f)}},this))},inputChange:function(i){var f=$(i.target),k=$.trim(f.val()),j=c("SuggestionXHR"),h=c("DropList");var g=f.data("droplist");if(!g){f.data("droplist",g=new h({trigger:f,itemSelector:this.listItemSelector,itemHoverClass:this.listItemHoverClass,firstItemHover:this.listFirstItemHover,container:this.listContainer,createContainer:$.proxy(function(){var l=this.createListContainer(f);this.listContainer=l;return l},this),updateList:$.proxy(this.updateList,this)}));M.Event(g).on("itemselected",$.proxy(function(l){this.dropItemSelected(f,l.item)},this));M.Event(g).on("itemfocused",$.proxy(function(l){M.Event(this).fire("itemfocused",l)},this))}g.hide=function(){setTimeout($.proxy(function(){if(M.windowFocused){this.container.hide();this.visible=false}},this),1)};var e=f.data("suggestion");if(!e){f.data("suggestion",e=new j({URL:this.suggestionURL,dataType:this.dataType}))}if(!k.length){e.stop();g.hide();M.Event(this).fire("after hide list")}else{this.suggestionParams[this.keyParamName]=k;M.Event(this).fire("before suggestion xhr");e.getSuggestion(this.suggestionParams,$.proxy(function(m){M.Event(this).fire("before show list");var l=this.handleSuggest(m);if(l){f.data("droplist").show(l)}},this))}},handleSuggest:function(f){var e="";if(this.dataType=="json"){e=$.tmpl(this.listTmpl,f)}return e},createListContainer:function(f){var g=$("<ul />"),e=f.position();g.css({display:"none",position:"absolute",left:e.left,top:e.top+f.outerHeight()}).addClass(this.dropListClass);g.insertAfter(f);return g},updateList:function(e){this.listContainer.html(e)},hideDropList:function(){this.input.data("droplist")&&this.input.data("droplist").hide()},dropItemSelected:function(e,f){a.unlisten(e);M.Event(this).fire("itemselected",{item:f,input:e});a.listen(e,$.proxy(this.inputChange,this))}});return d});M.define("MesSearchEvent",function(b,a,c){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(f,j){var l=e,h=[],g;j=j||l.length;if(f){for(g=0;g<f;g++){h[g]=l[0|Math.random()*j]}}else{var k;h[8]=h[13]=h[18]=h[23]="-";h[14]="4";for(g=0;g<36;g++){if(!h[g]){k=0|Math.random()*16;h[g]=l[(g==19)?(k&3)|8:k]}}}return h.join("")};Math.uuidFast=function(){var k=e,h=new Array(36),g=0,j;for(var f=0;f<36;f++){if(f==8||f==13||f==18||f==23){h[f]="-"}else{if(f==14){h[f]="4"}else{if(g<=2){g=33554432+(Math.random()*16777216)|0}j=g&15;g=g>>4;h[f]=k[(f==19)?(j&3)|8:j]}}}return h.join("")};Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(h){var g=Math.random()*16|0,f=h=="x"?g:(g&3|8);return f.toString(16)})};var d={uuid:function(){return Math.uuid()},search:function(f){var g=Math.uuid();f.id=g;!!mfwPageEvent&&mfwPageEvent("se","v2_search",f);return g},searchCache:function(f){var g=Math.uuid();f.id=g;!!mfwPageEvent&&mfwPageEvent("se","v2_search_cache",f);return g},resultClick:function(f){!!mfwPageEvent&&mfwPageEvent("se","v2_result_click",f);return f.id}};c.exports=d});M.define("/js/SiteSearch",function(e){var d="1.0.0",h=e("Suggestion"),f=e("MesSearchEvent"),g=M.cssSupport("transition"),b=M.cssSupport("transform"),c=window.Env||{};var a=function(C){var E=$("#"+C.input+""),U=!!C.submit?$("#"+C.submit+""):null,t=C.additionalClass?C.additionalClass:"",K=!!C.isRelevant,s=C.maxCount||0,z=C.hideOnScroll||false,n=false,J=false,i="",y="",l="",p="";if(C.input==="_j_index_search_input_all"){var H=[];if(E.val()===""&&H&&H.length){var T=Math.floor(Math.random()*H.length),I=H[T];E.val(I.name).data("url",I.url)}E.on("focus",function(W){if(E.data("url")){E.val("").data("url","")}})}if(c.is_async_site_search){n=true}var Q=new h({url:(c.WWW_HOST?window.location.protocol+"//"+c.WWW_HOST:"")+"/search/ss.php",suggestionParams:{isHeader:Number(K)},input:E,listItemHoverClass:"active",listFirstItemHover:false,dataType:"jsonp",createListContainer:function(){var W=$('<div class="m-search-suggest '+t+' hide"><ul class="mss-list"></ul></div>').appendTo("body");W.on("mouseenter",".mss-place .mss-title, .mss-place .mss-nav a",function(Y){var X=$(Y.currentTarget),Z=X.closest(".mss-place");Z.find(".mss-title").removeClass("active").removeClass("frozen").end().find(".mss-nav a").removeClass("active").end();X.addClass("active")}).on("mouseleave",".mss-place .mss-title, .mss-place .mss-nav a",function(Y){var X=$(Y.currentTarget);X.removeClass("active")});return W},handleSuggest:function(aC){i=aC.keyword;J=!!aC.is_hit;l="http://"+aC.www_host;var ax=aC.keyword_cut,az=aC.show_types,X=aC.hide_types;var ar=$("<ul>");var ab=aC.first_poi;if(!!ab){var am=ab,ak=$('<li class="mss-item _j_listitem" data-type="poi">').appendTo(ar),ap=$('<div class="mss-title">').appendTo(ak);ak.attr("data-url",am.url);ap.append('<span class="mss-fr">'+(!!am.mddname?am.mddname:"")+am.typename+"</span>");ap.append('<span class="mss-cn">'+am.dis_name+"</span>")}var ah=aC.article_info;if(ah&&ah.result){for(var at=0;at<ah.result.length;at++){var ag=ah.result[at],ak=$('<li class="mss-item _j_listitem" data-type="article_promoted">').appendTo(ar),ap=$('<div class="mss-title">').appendTo(ak);ak.attr("data-url",ag.link);ap.html(ag.name_display)}}var al=aC.mdd_info;if(al&&al.result){for(var at=0;at<al.result.length;at++){var aa=al.result[at],ak=$('<li class="mss-item _j_listitem" data-type="mdd">').appendTo(ar),ap=$('<div class="mss-title">').appendTo(ak);ak.attr("data-url",aa.url);if(!!aa.parent){ap.append('<span class="mss-fr">'+aa.parent+"</span>")}ap.append('<span class="mss-cn">'+aa.dis_name+"</span>");ap.append('<span class="mss-gl"> '+aa.infoname+"</span>")}}var ao=aC.hotel_info;if(ao&&ao.result&&!K){for(var at=0;at<ao.result.length;at++){var aA=ao.result[at],ak=$('<li class="mss-item _j_listitem" data-type="hotel_promoted">').appendTo(ar),ap=$('<div class="mss-title">').appendTo(ak);ak.attr("data-url",aA.url);ap.append('<span class="mss-fr">'+aA.typename+"</span>");ap.append('<span class="mss-cn">'+aA.title+"</span>");ap.append('<span class="mss-gl"> '+aA.infoname+"</span>")}}var ae=aC.gl_info;if(ae&&ae.result){for(var at=0;at<ae.result.length;at++){var aq=ae.result[at],ak=$('<li class="mss-item _j_listitem" data-type="sales_gonglve">').appendTo(ar),ap=$('<div class="mss-title">').appendTo(ak);ak.attr("data-url",aq.url);ap.append('<span class="mss-fr">'+aq.typename+"</span>");ap.append('<span class="mss-cn">'+aq.title+"</span>")}}var Z=aC.sales_info;if(Z&&Z.result&&!K){for(var at=0;at<Z.result.length;at++){var W=Z.result[at],ak=$('<li class="mss-item _j_listitem" data-type="sales_promoted">').appendTo(ar),ap=$('<div class="mss-title">').appendTo(ak);ak.attr("data-url",W.url);ap.append('<span class="mss-fr">'+W.typename+"</span>");ap.append('<span class="mss-cn">'+W.title+"</span>");ap.append('<span class="mss-gl"> '+W.infoname+"</span>")}}var af=aC.route_info;if(af&&af.result&&!K){for(var at=0;at<af.result.length;at++){var ay=af.result[at],ak=$('<li class="mss-item _j_listitem" data-type="route_promoted">').appendTo(ar),ap=$('<div class="mss-title">').appendTo(ak);ak.attr("data-url",ay.url);ap.append('<span class="mss-fr">'+ay.typename+"</span>");ap.append('<span class="mss-cn">'+ay.title+"</span>");ap.append('<span class="mss-gl"> '+ay.infoname+"</span>")}}var au=aC.qa_info;if(au&&au.result){for(var at=0;at<au.result.length;at++){var ai=au.result[at],ak=$('<li class="mss-item _j_listitem" data-type="wenda">').appendTo(ar),ap=$('<div class="mss-title">').appendTo(ak);ak.attr("data-url",ai.url);ap.append('<span class="mss-fr">'+ai.typename+"</span>");ap.append('<span class="mss-cn">'+ai.title+"</span>")}}var ad=aC.poi_info,aw=!K;if(M.isArray(az)&&M.indexOf(az,"poi")!==-1){aw=true}if(ad&&ad.result&&aw){for(var at=0;at<ad.result.length;at++){var am=ad.result[at],Y="hotel"===am.stype?"hotel":"poi",ak=$('<li class="mss-item _j_listitem" data-type="'+Y+'">').appendTo(ar),ap=$('<div class="mss-title">').appendTo(ak);ak.attr("data-url",am.url);ap.append('<span class="mss-fr">'+(!!am.mddname?am.mddname:"")+am.typename+"</span>");ap.append('<span class="mss-cn" style="color:#999;">'+am.dis_name+"</span>")}}var aj=aC.sekey_info,av=K;if(M.isArray(X)&&M.indexOf(X,"sekey")!==-1){av=false}if(aj&&aj.result&&av){for(var at=0;at<aj.result.length;at++){if(at>4){break}var aB=aj.result[at],ak=$('<li class="mss-item _j_listitem" data-type="sekey">').appendTo(ar);ak.attr("data-url",aB.url);ak.append('<div class="mss-title">'+aB.name+"</div>")}}var ac=aC.ginfo_num;if(!!ac){var ak=$('<li class="mss-item _j_listitem" data-type="info">').appendTo(ar);ak.append('<div class="mss-title">搜“<span class="mss-key">'+ax+'</span>”相关游记<span class="mss-num">'+ac+"篇</span></div>")}var an=aC.user_num;if(!!ac){var ak=$('<li class="mss-item _j_listitem" data-type="user">').appendTo(ar);ak.append('<div class="mss-title">搜“<span class="mss-key">'+ax+"</span>”相关用户</div>")}if(s>0){ar.find("._j_listitem").each(function(aD,aE){if(aD>s){$(aE).remove()}})}return ar.html()},updateList:function(W){this.listContainer.find(".mss-list").html(W);if(K){this.listContainer.find(".mss-list").addClass("shrink-list")}if(J){Q.input.data("droplist").moveFocus(1)}}});if(n){var A=e("InputListener"),w=e("SuggestionXHR"),D=new w({URL:(c.WWW_HOST?"http://"+c.WWW_HOST:"")+"/search/s.php",dataType:"json"}),v=$("#_j_mfw_search_main"),V=E.closest(".search-wrapper"),N=$('<div class="search-keyword-tip"></div>').appendTo(V),B=C.input==="_j_index_search_input_all",G=false,u,q,O,k,r;A.listen(E,function(X){var W=$(X.target),Y=$.trim(W.val());if(!G&&Y){G=true}N.hide()});M.Event(Q).on("before suggestion xhr",function(){var W=Q.suggestionParams[Q.keyParamName];if(W&&W!==y){D.getSuggestion({q:W,gall:1},$.proxy(function(Y){var ac=$.trim(E.val());if(!ac){return false}if(!Y||!Y.keyword||(!Y.result&&!Y.unmatch)){return false}if(Y.unmatch===1){N.hide()}else{y=W;if(V[0]){var Z=Y.keyword.length,X=Y.keyword.replace(/[A-Za-z0-9\s]/g,"").length,ab=Z-X;setTimeout(function(){N.html(Y.keyword).css("left",32+X*14+ab*7).show()},1)}v.html($(Y.result).css("minHeight",0).html());if(g&&b){v.find("> .wid").addClass("anim-climb");setTimeout(function(){v.find("> .wid").removeClass("anim-climb")},1)}var aa=c.search_type||"all";c.search_seid=R(W,aa);c.search_keyword=W;c.is_search_cache=true;c.is_search_updated=true}},Q))}})}M.Event(Q).on("before suggestion xhr",function(){S(E,Q.listContainer)});M.Event(Q).on("before show list",function(){Q.listContainer.find(".mss-list").show()});M.Event(Q).on("itemfocused",function(X){var W=X.prevItem,Y=X.focusItem,Z=Q.listContainer;if(1<Z.find(".mss-place").length){if(Y.hasClass("mss-place")){Z.find(".mss-place").removeClass("frozen")}if(!Y.hasClass("mss-place")&&!!W&&W.hasClass("mss-place")){Z.find(".mss-place").removeClass("frozen");W.addClass("frozen")}}if(Y.hasClass("mss-place")){Y.find(".mss-title").addClass("frozen")}});M.Event(Q).on("itemselected",function(Y){var aa=Y.item;if(aa.length){var Z=aa.data("type"),X=aa.data("url"),ac=E.attr("id")==="_j_head_search_input"?"header":"default";if(Z==="flight_hotel"||Z==="flight"||Z==="local"){Z="sales"}p=m(i,"all",ac,"suggest");if("info"===Z||"user"===Z){var ab=m(i,Z,ac,"suggest");location.href=l+"/search/s.php?q="+encodeURIComponent(i)+"&t="+Z+"&seid="+ab}else{var X=aa.data("url"),W=Q.listContainer.find(".mss-item").index(aa.closest(".mss-item"))+1;P(X,W,Z);location.href=aa.data("url")}}else{if(i!==""){location.href=l+"/search/s.php?q="+encodeURIComponent(i)}}});var x=E.closest(".head-search-wrapper");if(x[0]){E.on("focus",function(W){setTimeout(function(){x.addClass("head-search-focus")},1)}).on("blur",function(W){setTimeout(function(){if(M.windowFocused){x.removeClass("head-search-focus")}},1)})}if(U&&U[0]){U.on("click",function(Y){var X=$.trim(E.val());if(E.data("url")){if(E.data("url").indexOf("http")!==-1){location.href=E.data("url")}else{location.href=(c.WWW_HOST?"http://"+c.WWW_HOST:"")+E.data("url")}return true}if(X!==""){if(Q.listContainer){Q.listContainer.hide()}var aa=E.attr("id")==="_j_head_search_input"?"header":"default",ab=c.search_type||"all",Z=m(X,ab,aa,"form"),W=l+"/search/s.php?q="+encodeURIComponent(X);if(c.search_type&&location.pathname==="/search/s.php"){W+="&t="+c.search_type}W+="&seid="+Z;location.href=W}})}if(E&&E[0]){E.on("keydown",function(Y){if(Y.keyCode==13){var ab=Q.input.data("droplist");if(ab&&ab.getFocusItem().length){return true}var X=$.trim(E.val());if(X!==""){if(Q.listContainer){Q.listContainer.hide()}var aa=E.attr("id")==="_j_head_search_input"?"header":"default",ac=c.search_type||"all",Z=m(X,ac,aa,"form"),W=l+"/search/s.php?q="+encodeURIComponent(X);if(c.search_type&&location.pathname==="/search/s.php"){W+="&t="+c.search_type}W+="&seid="+Z;location.href=W}}})}$(window).resize(function(){if(Q.listContainer&&Q.listContainer.length&&Q.listContainer.is(":visible")){S(E,Q.listContainer)}});$(window).on("scroll",function(W){if(z){Q.hideDropList()}});function S(W,Y){var X=W.offset();Y.css({left:X.left+(C.input==="_j_index_search_input_all"?0:1),top:X.top+E.outerHeight()-2})}function m(W,aa,Z,Y){var X={keyword:W,content_category:aa,searchbox_category:"main_search",searchbox_position:Z,search_type:Y,version:d};return f.search(X)}function R(W,Y){var X={keyword:W,content_category:Y,version:d};return f.searchCache(X)}function P(Z,X,Y){var W={id:p,keyword:i,click_url:Z,index:X,content_category:Y,search_type:"suggest",version:d};return f.resultClick(W)}function F(X,ab){var Y=[],ad=X.split("|");ab=j(ab);for(var aa=0;aa<ad.length;aa++){var Z=$.trim(ad[aa]);if(Z=="search://"){var W=Y.length;Y[W]=ad[aa++];Y[W+1]=ad[aa++];Y[W+2]=ad[aa++];Y[W+3]=ad[aa++];Y[W+4]=ad[aa++];Y[W+5]=ad[aa];continue}if(Z){try{Z=Z.replace(new RegExp(ab,"ig"),function(ae){return'<span class="highlight">'+ae+"</span>"})}catch(ac){Z=Z.replace(ab,function(ae){return'<span class="highlight">'+ae+"</span>"})}Y[Y.length]=Z}}return Y}var o=$("<div/>");function j(W){return o.text(W).html()}};return a});M.closure(function(c){var r=$("#header");if(!r.length){return false}var o=c("/js/Dropdown");var n=c("/js/SiteSearch");new n({input:"_j_head_search_input",submit:"_j_head_search_link",isRelevant:true});$("#_j_nav_sales").find("[data-sales-nav]").on("click",function(){var t=$(this).data("salesNav");mfwPageEvent("sales","index_sales_nav",{name:t})});if(!window.showBarFlag){$("._j_sales_nav_show").off("hover")}else{var b=0,p=0;$("._j_sales_nav_show").hover(function(){clearTimeout(b);p=setTimeout(function(){$("._j_sales_nav_show").addClass("head-nav-hover");$("._j_sales_top").fadeIn(300)},200)},function(){clearTimeout(p);b=setTimeout(function(){$("._j_sales_nav_show").removeClass("head-nav-hover");$("._j_sales_top").fadeOut(300)},200)})}var m=0,f=0;$("._j_shequ_nav_show").hover(function(){clearTimeout(m);f=setTimeout(function(){$("._j_shequ_nav_show").addClass("head-nav-hover");$("._j_shequ_top").fadeIn(300)},200)},function(){clearTimeout(f);m=setTimeout(function(){$("._j_shequ_nav_show").removeClass("head-nav-hover");$("._j_shequ_top").fadeOut(300)},200)});var q=$("#_j_community_panel"),i=q.find(".panel-image").length,j=Math.floor(Math.random()*i);if(j===i){j--}q.find(".panel-image").eq(j).show();$("#_j_showlogin").click(function(t){if(window.location.host===Env.WWW_HOST){t.preventDefault()}M.Event.fire("login:required")});var g=window.location.hostname,k=window.location.pathname+window.location.search,a=$("#_j_head_nav");if(g.indexOf("www")===0){if(k===""||k==="/"){a.children("li:eq(0)").addClass("head-nav-active")}var h=new RegExp("^/(mdd|photo/mdd|poi|photo/poi|travel-scenic-spot|jd|cy|gw|yl|yj|xc|baike)/|sFrom=mdd.*|sFrom=smdd.*","i");if(h.test(k)){a.children("li:eq(1)").addClass("head-nav-active")}var e=new RegExp("^/gonglve/.*","i");if(e.test(k)){a.children("li:eq(2)").addClass("head-nav-active")}var d=window.Env&&window.Env.sales_title_tag;if(d){if(d==="flight_hotel"){a.children("li:eq(3)").find("ul>li:eq(0)>a").addClass("on")}else{if(d==="visa"){a.children("li:eq(3)").find("ul>li:eq(2)>a").addClass("on")}else{if(d==="localdeals"){a.children("li:eq(3)").find("ul>li:eq(1)>a").addClass("on")}else{if(d==="insurance"){a.children("li:eq(3)").find("ul>li:eq(4)>a").addClass("on")}}}}a.find("li:eq(3)").addClass("head-nav-active")}if(/^\/insurance\//i.test(k)){a.find("li:eq(3)").addClass("head-nav-active")}var s=new RegExp("^/hotel/(?!.*sFrom=mdd).*","ig");if(s.test(k)){a.children("li:eq(4)").addClass("head-nav-active");a.children("li:eq(4)").find(".head-act616").remove()}var l=new RegExp("^/(wenda|qa|mall|together|group|i|traveller|rudder|paimai|club|postal|school|photo_pk|focus)/(?!.*sFrom=mdd|s.php*).*","i");if(l.test(k)){a.children("li:eq(5)").addClass("head-nav-active")}}});
/*!
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2015 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.9.7
 *
 */
(function(c,b,a,e){var d=c(b);c.fn.lazyload=function(f){var h=this;var i;var g={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:false,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};function j(){var k=0;h.each(function(){var l=c(this);if(g.skip_invisible&&!l.is(":visible")){return}if(c.abovethetop(this,g)||c.leftofbegin(this,g)){}else{if(!c.belowthefold(this,g)&&!c.rightoffold(this,g)){l.trigger("appear");k=0}else{if(++k>g.failure_limit){return false}}}})}if(f){if(e!==f.failurelimit){f.failure_limit=f.failurelimit;delete f.failurelimit}if(e!==f.effectspeed){f.effect_speed=f.effectspeed;delete f.effectspeed}c.extend(g,f)}i=(g.container===e||g.container===b)?d:c(g.container);if(0===g.event.indexOf("scroll")){i.bind(g.event,function(){return j()})}this.each(function(){var k=this;var l=c(k);k.loaded=false;if(l.attr("src")===e||l.attr("src")===false){if(l.is("img")){l.attr("src",g.placeholder)}}l.one("appear",function(){if(!this.loaded){if(g.appear){var m=h.length;g.appear.call(k,m,g)}c("<img />").bind("load",function(){var o=l.attr("data-"+g.data_attribute);l.hide();if(l.is("img")){l.attr("src",o)}else{l.css("background-image","url('"+o+"')")}l[g.effect](g.effect_speed);k.loaded=true;var n=c.grep(h,function(q){return !q.loaded});h=c(n);if(g.load){var p=h.length;g.load.call(k,p,g)}}).attr("src",l.attr("data-"+g.data_attribute))}});if(0!==g.event.indexOf("scroll")){l.bind(g.event,function(){if(!k.loaded){l.trigger("appear")}})}});d.bind("resize",function(){j()});if((/(?:iphone|ipod|ipad).*os 5/gi).test(navigator.appVersion)){d.bind("pageshow",function(k){if(k.originalEvent&&k.originalEvent.persisted){h.each(function(){c(this).trigger("appear")})}})}c(a).ready(function(){j()});return this};c.belowthefold=function(g,h){var f;if(h.container===e||h.container===b){f=(b.innerHeight?b.innerHeight:d.height())+d.scrollTop()}else{f=c(h.container).offset().top+c(h.container).height()}return f<=c(g).offset().top-h.threshold};c.rightoffold=function(g,h){var f;if(h.container===e||h.container===b){f=d.width()+d.scrollLeft()}else{f=c(h.container).offset().left+c(h.container).width()}return f<=c(g).offset().left-h.threshold};c.abovethetop=function(g,h){var f;if(h.container===e||h.container===b){f=d.scrollTop()}else{f=c(h.container).offset().top}return f>=c(g).offset().top+h.threshold+c(g).height()};c.leftofbegin=function(g,h){var f;if(h.container===e||h.container===b){f=d.scrollLeft()}else{f=c(h.container).offset().left}return f>=c(g).offset().left+h.threshold+c(g).width()};c.inviewport=function(f,g){return !c.rightoffold(f,g)&&!c.leftofbegin(f,g)&&!c.belowthefold(f,g)&&!c.abovethetop(f,g)};c.extend(c.expr[":"],{"below-the-fold":function(f){return c.belowthefold(f,{threshold:0})},"above-the-top":function(f){return !c.belowthefold(f,{threshold:0})},"right-of-screen":function(f){return c.rightoffold(f,{threshold:0})},"left-of-screen":function(f){return !c.rightoffold(f,{threshold:0})},"in-viewport":function(f){return c.inviewport(f,{threshold:0})},"above-the-fold":function(f){return !c.belowthefold(f,{threshold:0})},"right-of-fold":function(f){return c.rightoffold(f,{threshold:0})},"left-of-fold":function(f){return !c.rightoffold(f,{threshold:0})}})})(jQuery,window,document);if(window.M&&typeof window.M.define=="function"){window.M.define("/js/jquery.lazyload",function(){return jQuery})}M.define("dialog/Layer",function(a){var g=0,f=550,d=(function(){return $.browser&&$.browser.msie&&parseInt($.browser.version,10)==7}()),c=(function(){return $.browser&&$.browser.msie&&parseInt($.browser.version,10)<7}());function b(){return g++}function e(h){this.opacity=0.8;this.background="#fff";this.impl="Dialog";this.fixed=true;M.mix(this,h);this.id="_j_layer_"+b();this.stacks=[];this.activeStackId=null;this.overflow=false;this.changeFixed=false;e.instances[this.id]=this;if(!e[this.impl]){e[this.impl]=[]}e[this.impl].push(this.id);this.init()}e.prototype={init:function(){this._createPanel()},_createPanel:function(){f++;var h={position:(!c&&this.fixed)?"fixed":"absolute",width:"100%",height:"100%",top:0,left:0},j=M.mix({},h,{"z-index":f,display:"none"}),k=M.mix({},h,{position:!c?"fixed":"absolute",background:this.background,opacity:this.opacity,"z-index":-1}),i=M.mix({},h,{"z-index":0},(!c&&this.fixed)?{"overflow-x":"hidden","overflow-y":"hidden"}:{overflow:"visible"});this._panel=$('<div id="'+this.id+'" class="layer _j_layer">                                <div class="layer_mask _j_mask"></div>                                <div class="layer_content _j_content"></div>                            </div>').css(j).appendTo("body");this._mask=this._panel.children("._j_mask").css(k);this._content=this._panel.children("._j_content").css(i)},setZIndex:function(h){f=h;this._panel.css("z-index",f)},getZIndex:function(){return +this._panel.css("z-index")},toFront:function(){this.setZIndex(f+1)},setFixed:function(h){h=!!h;if(this.fixed!=h){this.changeFixed=true;this.fixed=h;if(!c&&this.fixed){this._panel.css("position","fixed");this._content.css({position:"fixed","overflow-x":"hidden","overflow-y":"hidden"})}else{this._panel.css("position","absolute");this._content.css({position:"absolute","overflow-x":"","overflow-y":"",overflow:"visible"})}}else{this.changeFixed=false}},newStack:function(i){var h=$(i).appendTo(this._content);this.stacks.push(h);return this.stacks.length-1},getStack:function(h){return this.stacks[h]},getActiveStack:function(){return this.stacks[this.activeStackId]},setActiveStack:function(h){this.activeStackId=h},getPanel:function(){return this._panel},getMask:function(){return this._mask},getContent:function(){return this._content},show:function(j){var i=this;if(this.visible){typeof j==="function"&&j();return}e.activeId=this.id;this.visible=true;if(c){var h=document.documentElement&&document.documentElement.scrollHeight||document.body.scrollHeight;this._panel.css("height",h);this._mask.css("height",h)}this._panel.fadeIn(200,function(){typeof j==="function"&&j()})},hide:function(i){var h=this;if(!this.visible){typeof i==="function"&&i();return}this.visible=false;if(c){this._panel.css("height","");this._mask.css("height","")}this._panel.fadeOut(200,function(){typeof i==="function"&&i();h._recoverTopScroller()})},setOverFlow:function(h){this.overflow=h;if(h){if(!c&&this.fixed){this._hideTopScroller();this._content.css("overflow-y","auto")}}else{if(!c&&this.fixed){this._content.css("overflow-y","hidden")}}},_hideTopScroller:function(){if(d){$("html").css("overflow","hidden")}else{if(!c){$("body").css("overflow","hidden")}else{$("body").css("overflow-x","hidden");this._panel.height($(document).height()+20)}}},_recoverTopScroller:function(){if(d){$("html").css("overflow","")}else{if(!c){$("body").css("overflow","")}else{$("body").css("overflow-x","")}}},destroy:function(){this.hide($.proxy(function(){this._panel&&this._panel.remove();this._panel=null;if(M.indexOf(e[this.impl],this.id)!=-1){e[this.impl].splice(M.indexOf(e[this.impl],this.id),1)}delete e.instances[this.id]},this))},clear:function(){this._content.empty();this.stacks=[];this.activeStackId=null}};e.instances={};e.activeId=null;e.getInstance=function(h){return e.instances[h]};e.getActive=function(h){var i=e.getInstance(e.activeId);if(h&&i){i=i.impl===h?i:null}return i};e.getImplInstance=function(i){var h=e.getActive(i);if(!h&&M.is(e[i],"Array")&&e[i].length){h=e.getInstance(e[i][e[i].length-1])}return h};e.closeActive=function(){var h=e.getActive();if(h&&h.getActiveStack()){h.getActiveStack().trigger("close")}};$(document).keyup(function(h){if(h.keyCode==27){e.closeActive()}});$(document).unload(function(){M.forEach(e.instances,function(){e.destroy()})});return e});M.define("dialog/DialogBase",function(b){var e=b("dialog/Layer"),a=M.Event,d=(function(){return $.browser&&$.browser.msie&&parseInt($.browser.version,10)<7}());function c(f){this.newLayer=false;this.width="";this.height="";this.background="#000";this.panelBackground="#fff";this.bgOpacity=0.7;this.stackable=true;this.fixed=true;this.reposition=false;this.autoPosition=true;this.minTopOffset=20;this.layerZIndex=-1;this.impl="Dialog";M.mix(this,f);this.visible=false;this.destroyed=false;this.positioned=false;this.resizeTimer=0;this.init()}c.prototype={tpl:"<div />",init:function(){this._createDialog();this._bindEvents()},_createDialog:function(){this._panel=$(this.tpl).css({position:"absolute",opacity:0,display:"none",background:this.panelBackground,"z-index":0});this.setRect({width:this.width,height:this.height});this._layer=!this.newLayer&&e.getImplInstance(this.impl)||new e({impl:this.impl});if(this.layerZIndex>=0){this._layer.setZIndex(this.layerZIndex)}this._layer.setFixed(this.fixed);this._layer.getMask().css({background:this.background,opacity:this.bgOpacity});this._stackId=this._layer.newStack(this._panel);this.setPanelContent()},_bindEvents:function(){var f=this;$(window).resize($.proxy(this.resizePosition,this));M.Event(this).on("resize",$.proxy(this.resizePosition,this));this._panel.delegate("._j_close, a[data-dialog-button]","click",function(g){var h=$(g.currentTarget).attr("data-dialog-button");if(h=="hide"){f.hide()}else{f.close()}g.preventDefault()});this._panel.bind("close",function(g,h){f.close(h)})},resizePosition:function(){var f=this;clearTimeout(this.resizeTimer);if(f.visible&&f.autoPosition){this.resizeTimer=setTimeout(function(){f.setPosition()},100)}},addClass:function(f){this._panel.addClass(f)},removeClass:function(f){this._panel.removeClass(f)},setRect:function(f){if(f.width){this._panel.css("width",f.width);this.width=f.width}if(f.height){this._panel.css("height",f.height);this.height=f.height}},getPanel:function(){return this._panel},getLayer:function(){return this._layer},getMask:function(){return this._layer&&this._layer.getMask()},setPanelContent:function(){},_getPanelRect:function(){var f=this.getPanel(),g=f.outerHeight(),h=f.outerWidth();if(!f.is(":visible")){f.css({visibility:"hidden",display:"block"});var g=f.outerHeight(),h=f.outerWidth();f.css({visibility:"",display:""})}return{height:g,width:h}},_getNumric:function(f){f=parseInt(f,10);return isNaN(f)?0:f},setPosition:function(f){var g=this._getPanelRect(),h={width:$(window).width(),height:$(window).height()};var k=(h.width-(this._getNumric(this.width)>0?this._getNumric(this.width):g.width))/2,j=(h.height-(this._getNumric(this.height)>0?this._getNumric(this.height):g.height))*4/9;j=j<this.minTopOffset?this.minTopOffset:j;if(d||!this.fixed){var i=$(window).scrollTop();if(i>0){j+=i}}f={left:(f&&f.left)||k,top:(f&&f.top)||j};if(!d&&this.fixed){if(h.height-g.height<=f.top){this.getPanel().addClass("dialog_overflow");this._layer.setOverFlow(true)}else{this.getPanel().removeClass("dialog_overflow");this._layer.setOverFlow(false)}}var l=this.positioned?"animate":"css";$.fn[l].call(this.getPanel(),f,200);this.positioned=true;this.position=f},setFixed:function(f){this.fixed=!!f;this._layer.setFixed(this.fixed)},getPosition:function(){return this.position},show:function(f){if(this.visible){return}var h=this;a(this).fire("beforeshow");var g;if(this._layer.getActiveStack()){g=this._layer.getActiveStack();if(!this.reposition&&!f&&!this._layer.changeFixed){f=this._layer.getActiveStack().position()}}this._layer.show();this.getPanel().css({display:"","z-index":1});this.setPosition(f);g&&g.trigger("close",[true]);this.visible=true;this._layer.setActiveStack(this._stackId);this.getPanel().animate({opacity:1},{queue:false,duration:200,complete:function(){a(h).fire("aftershow")}})},close:function(){var f=this.stackable?"hide":"destroy";this[f].apply(this,Array.prototype.slice.call(arguments))},hide:function(g,f){if(typeof g=="function"){f=g;g=undefined}if(!this.visible){typeof f=="function"&&f();return}a(this).fire("beforeclose");a(this).fire("beforehide");this._layer.setActiveStack(null);this.visible=false;if(!g){this._layer.hide()}this.getPanel().animate({opacity:0},{queue:false,duration:200,complete:$.proxy(function(){this.getPanel().css({display:"none","z-index":0});a(this).fire("afterhide");a(this).fire("afterclose");typeof f=="function"&&f()},this)})},destroy:function(g,f){if(typeof g=="function"){f=g;g=undefined}if(this.destroyed){M.error("Dialog already destroyed!");typeof f=="function"&&f();return}a(this).fire("beforeclose");a(this).fire("beforedestroy");this.destroyed=true;this.hide(g,$.proxy(function(){if(this._panel.length){this._panel.undelegate();this._panel.unbind();this._panel.remove();this._panel=null}this._layer=null;a(this).fire("afterdestroy");a(this).fire("afterclose");typeof f=="function"&&f()},this))}};return c});M.define("dialog/Dialog",function(c){var d=c("dialog/DialogBase"),a='<div class="popup-box layer_dialog _j_dialog pop_no_margin">                    <div class="dialog_title" style="display:none"><div class="_j_title title"></div></div>                    <div class="dialog_body _j_content"></div>                    <a id="popup_close" class="close-btn _j_close"><i></i></a>                </div>';var b=M.extend(function(e){this.content="";this.title="";this.PANEL_CLASS="";this.MASK_CLASS="";b.$parent.call(this,e)},d);M.mix(b.prototype,{tpl:a,setPanelContent:function(){this._dialogTitle=this._panel.find("._j_title");this._dialogContent=this._panel.find("._j_content");this.setTitle(this.title);this.setContent(this.content);this.addClass(this.PANEL_CLASS);this.getMask().addClass(this.MASK_CLASS)},setTitle:function(e){if(e){this._dialogTitle.html(e).parent().css("display","")}else{this._dialogTitle.parent().css("display","none")}this.title=e},getTitle:function(){return this.title},setContent:function(e){this._dialogContent.empty().append(e)}});return b});M.define("dialog/alert",function(e,d){var b=e("dialog/Dialog"),a='<div id="popup_container" class="popup-box new-popbox"><a class="close-btn _j_close"><i></i></a><div class="pop-ico" id="_j_alertpopicon"><i class="i1"></i></div><div class="pop-ctn"><p class="hd _j_content"></p><p class="bd _j_detail"></p></div><div class="pop-btns"><a role="button" tabindex="0" class="popbtn popbtn-submit _j_close">&nbsp;确定&nbsp;</a></div></div>',f=M.extend(function(j){var i={width:420,content:"请输入内容",background:"#000",bgOpacity:0.7,PANEL_CLASS:"pop_no_margin",reposition:true,impl:"Alert",layerZIndex:10000};j=M.mix(i,j);f.$parent.call(this,j);this.bindEvents()},b),g=null,h=$.noop;M.mix(f.prototype,{tpl:a,setAlertTitle:function(i){this.setContent(i)},setAlertContent:function(i){this.getPanel().find("._j_detail").text(i)},setAssureWords:function(i){this.getPanel().find(".popbtn-submit").text(i)},setCloserHide:function(i){if(i){this.getPanel().find(".close-btn").hide()}else{this.getPanel().find(".close-btn").show()}},bindEvents:function(){var i=this.getPanel();i.on("keydown",".pop-btns ._j_close",function(j){if(j.keyCode==13){$(this).trigger("click")}}).on("click",".pop-btns ._j_close",function(j){i.data("btn_trigger",true)})}});var c=function(i,k,j){if(!g){g=new f();M.Event(g).on("afterhide",function(){var l=g.getPanel();if(typeof h=="function"){h.call(g,l)}l.data("btn_trigger",false)});M.Event(g).on("aftershow",function(){g.getPanel().find(".pop-btns ._j_close").focus()})}g.getLayer().toFront();if(M.isObject(i)){g.setAlertTitle(i.title);g.setAlertContent(i.content)}else{g.setAlertTitle(i);g.setAlertContent("")}if(M.isObject(i)){if(i.assureWords){g.setAssureWords(i.assureWords)}else{g.setAssureWords("确定")}if(i.hideCloser){g.setCloserHide(true)}else{g.setCloserHide(false)}}else{g.setAssureWords("确定");g.setCloserHide(false)}if(typeof k=="function"){h=k}else{h=$.noop}if(j){$("#_j_alertpopicon").children("i").attr("class","i"+j)}else{$("#_j_alertpopicon").children("i").attr("class","i"+1)}g.show();return g};d.pop=c;d.warning=function(i,j){c(i,j,1)};d.tip=function(i,j){c(i,j,3)}});M.closure(function(a){a("/js/jquery.lazyload");M.Event.on("pagelet loaded",function(j){b();i(j.pagelet.container)});function b(){$("div[data-anchor=recommend] .row").each(function(j,k){$(k)[j%2==0?"addClass":"removeClass"]("row-bg")})}function i(j){$.fn.lazyload&&$(j).find("img.lazy").lazyload({threshold:400})}b();i(document);var d=a("dialog/alert"),h=$(".album .list"),c=1,e=1,f=+$("#photo_total").text();function g(k,l){var j="/mdd/ajax_photolist.php?act=getPoiPhotoList&mddid="+window.Env.mddid+"&poiid="+window.Env.poiid+"&page="+k+"&is_new_gw=1";if(e<f){$.get(j,function(m){if(m.replace(/(\s*)/g,"")==""){e=c*20+1;c++;g(c)}else{h.html(m);if(l==1){h.find("li:first").addClass("show")}else{h.find("li:last").addClass("show")}}},"text")}}$(".album .btn-right").click(function(){var j=h.find(".show:first").next();if(e>=f){d.pop("已到最后一张");return}e++;if(j.parent().attr("class")=="list"){h.find("li").removeClass("show");j.addClass("show")}else{c++;g(c,1)}$("#page_count").text(e)});$(".album .btn-left").click(function(){var j=h.find(".show:first").prev();if(e<=1){d.pop("已到第一张");return}e--;if(j.parent().attr("class")=="list"){h.find("li").removeClass("show");j.addClass("show")}else{c--;g(c,2)}$("#page_count").text(e)});if(f>=e){$("#page_count").text(e)}g(c,1)});$(function(){$(".mod-detail dd").each(function(){var e=$(this),d=this.scrollHeight,c=parseFloat(e.css("line-height"));if(!e.find(".map-container").length&&Math.floor(d/c)>3){$('<div style="text-align:center;"><a title="展开全部">展开全部></a></div>').click(function(){$(this).hide().prev().css({"max-height":"none",overflow:"initial"})}).appendTo(e.html('<div style="max-height: '+(2*c)+'px;overflow:hidden;">'+e.html()+"</div>"))}});var b=0,a=$(".mod-discount .list li").length;$(".mod-discount .btn-arr.btn-right").click(function(){if(b+3>=a){return}$(".mod-discount .list li[data-id='"+b+"']").hide();b++});$(".mod-discount .btn-arr.btn-left").click(function(){if(b<=0){return}$(".mod-discount .list li[data-id='"+(b-1)+"']").show();b--})});(function(b,a){if(!!b.M&&!!b.M.define){M.define("/js/hotel/mfwmap/mfwmap-util",function(d,c,e){e.exports=a(b)})}else{b.mfwmap={};b.mfwmap.util=a(b)}}(window,function(b){function c(l,m){if(m<72.004||m>137.8347||l<0.8293||l>55.8271){return{lat:0,lng:0}}var j=6378245,d=0.006693421622965943,k=m-105,g=l-35;var f=-100+2*k+3*g+0.2*g*g+0.1*k*g+0.2*Math.sqrt(Math.abs(k));f+=(20*Math.sin(6*k*Math.PI)+20*Math.sin(2*k*Math.PI))*2/3;f+=(20*Math.sin(g*Math.PI)+40*Math.sin(g/3*Math.PI))*2/3;f+=(160*Math.sin(g/12*Math.PI)+320*Math.sin(g*Math.PI/30))*2/3;var h=300+k+2*g+0.1*k*k+0.1*k*g+0.1*Math.sqrt(Math.abs(k));h+=(20*Math.sin(6*k*Math.PI)+20*Math.sin(2*k*Math.PI))*2/3;h+=(20*Math.sin(k*Math.PI)+40*Math.sin(k/3*Math.PI))*2/3;h+=(150*Math.sin(k/12*Math.PI)+300*Math.sin(k/30*Math.PI))*2/3;var e=l/180*Math.PI,i=Math.sin(e);i=1-d*i*i;f=(f*180)/((j*(1-d))/(i*Math.sqrt(i))*Math.PI);h=(h*180)/(j/Math.sqrt(i)*Math.cos(e)*Math.PI);return{lat:f,lng:h}}var a={decodePath:function(f){var h=f?f.length:f,l=Array(Math.floor(f.length/2)),g=0,i=0,k=0;for(var j=0;g<h;++j){var m=1,d=0,e;do{e=f.charCodeAt(g++)-63-1;m+=e<<d;d+=5}while(31<=e);i+=m&1?~(m>>1):m>>1;m=1;d=0;do{e=f.charCodeAt(g++)-63-1;m+=e<<d;d+=5}while(31<=e);k+=m&1?~(m>>1):m>>1;l[j]={lat:0.00001*i,lng:0.00001*k}}l.length=j;return l},extend:function(f,d){var e=function(){};e.prototype=d.prototype;f.prototype=new e();f.prototype.constructor=f;f.__super__=d.prototype},clone:function(g){if(null==g||"object"!=typeof g){return g}if(g instanceof Date){var h=new Date();h.setTime(g.getTime());return h}if(g instanceof Array){var h=[];for(var f=0,e=g.length;f<e;f++){h[f]=a.clone(g[f])}return h}if(g instanceof Object){var h={};for(var d in g){h[d]=a.clone(g[d])}return h}throw new Error("Unable to copy obj! Its type isn't supported.")},bind:function(e,d){if(!!Function.prototype.bind){return Function.prototype.bind.apply(e,[d].concat(Array.prototype.slice.call(arguments,2)))}else{if(typeof e!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var i=Array.prototype.slice.call(arguments,2),h=e,f=function(){},g=function(){return h.apply(e instanceof f&&d?e:d||b,i.concat(Array.prototype.slice.call(arguments)))};f.prototype=e.prototype;g.prototype=new f();return g}},includes:function(j,g){if(!!Array.prototype.includes){return Array.prototype.includes.call(j,g)}else{var h=Object(j);var d=parseInt(h.length)||0;if(d===0){return false}var i=parseInt(arguments[2])||0;var e;if(i>=0){e=i}else{e=d+i;if(e<0){e=0}}var f;while(e<d){f=h[e];if(g===f||(g!==g&&f!==f)){return true}e++}return false}},pick:function(g,f){var h={};for(var e=0;e<f.length;e++){var d=f[e];if(d in g){h[d]=g[d]}}return h},mapping:function(f,e){if(typeof f==="string"){if(!!e[f]){return e[f]}else{return f}}if(typeof f==="object"&&f!==null){var g={};for(var d in f){if(!!e[d]){g[e[d]]=f[d]}else{g[d]=f[d]}}return g}},uuid:function(d,g){var j="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var f=[],e;g=g||j.length;if(d){for(e=0;e<d;e++){f[e]=j[0|Math.random()*g]}}else{var h;f[8]=f[13]=f[18]=f[23]="-";f[14]="4";for(e=0;e<36;e++){if(!f[e]){h=0|Math.random()*16;f[e]=j[(e==19)?(h&3)|8:h]}}}return f.join("")},debounce:function(f,h,e){var k,j,d,i,l;var g=function(){var m=(new Date().getTime())-i;if(m<h){k=setTimeout(g,h-m)}else{k=null;if(!e){l=f.apply(d,j);d=j=null}}};return function(){d=this;j=arguments;i=(new Date().getTime());var m=e&&!k;if(!k){k=setTimeout(g,h)}if(m){l=f.apply(d,j);d=j=null}return l}},wgs2gcj:function(f,d){var e=c(f,d);return{lat:f+e.lat,lng:d+e.lng}},gcj2wgs:function(f,d){var e=c(f,d);return{lat:f-e.lat,lng:d-e.lng}}};return a}));(function(b,a){if(!!b.M&&!!b.M.define){M.define("/js/hotel/mfwmap/mfwmap-event",function(e,d,f){var c=e("/js/hotel/mfwmap/mfwmap-util");f.exports=a(b,c)})}else{b.mfwmap.event=a(b,b.mfwmap.util)}}(window,function(d,a){var c={};var e=c.EventListener=function(g,f){this.event=g;this._eventListener=f};var b=["click","dblclick","mouseover","mouseout"];c.eventFunc={addListener:function(h,g,f){if(!a.includes(h,g)){throw new ReferenceError("unsupport event: "+g)}if(a.includes(b,g)){return this._addMouseListener(g,f)}return this._addListener(g,f)},addListenerOnce:function(h,g,f){if(!a.includes(h,g)){throw new ReferenceError("unsupport event: "+g)}if(a.includes(b,g)){return this._addMouseListenerOnce(g,f)}return this._addListenerOnce(g,f)},removeListener:function(f){if(!f instanceof e){throw new TypeError(f+" is not an instance of mfwmap.EventListener")}this._removeListener(f)},trigger:function(g,f,h){if(!a.includes(g,f)){throw new ReferenceError("unsupport event: "+f)}return this._trigger(f,h)}};return c}));(function(b,a){if(!!b.M&&!!b.M.define){M.define("/js/hotel/mfwmap/mfwmap-runtime-google",function(e,d,f){var c=e("/js/hotel/mfwmap/mfwmap-util"),g=e("/js/hotel/mfwmap/mfwmap-event");f.exports=a(b,c,g)})}else{b.mfwmap.googleRuntime=a(b,b.mfwmap.util,b.mfwmap.event)}}(window,function(p,a,s){var w={util:a,event:s};var e=false,u=$.Deferred(),c=10000;p.initGoogleMap=function(){u.resolve()};function t(C){var B=document.getElementsByTagName("head")[0],A=B.insertBefore,y=B.appendChild;B.insertBefore=function(E,D){if(E.href&&E.href.indexOf(location.protocol+"//fonts.googleapis.com/css?family=Roboto")===0){return}A.call(B,E,D)};B.appendChild=function(D){if(D.href&&D.href.indexOf(location.protocol+"//fonts.googleapis.com/css?family=Roboto")===0){return}y.call(B,D)};var z=document.createElement("script");z.type="text/javascript";z.src=location.protocol+"//maps.google.cn/maps/api/js?language=zh-CN&libraries=geometry&callback=initGoogleMap&key="+((window.Env&&window.Env.GOOGLE_MAP_KEY)||"AIzaSyD-Su0x_rPy1xehlMBcMyTqWkU49Bk53nQ");if("onerror" in z){z.onerror=function(D){u.reject()}}document.body.appendChild(z);setTimeout(function(){try{if(u.state()==="pending"){u.reject()}}catch(D){u.reject()}},C)}var h={hasInited:e,init:function(z){if(!e){e=true;var y=Number(z)>0?Number(z):c;t(y)}},getInitPromise:function(){return u.promise()}};var g=h.implement={};var i={_addListener:function(A,z){var y=google.maps.event.addListener(this._inst,A,z);return new w.event.EventListener(A,y)},_addListenerOnce:function(A,z){var y=google.maps.event.addListenerOnce(this._inst,A,z);return new w.event.EventListener(A,y)},_addMouseListener:function(B,A){var z=this._inst;var y=google.maps.event.addListener(this._inst,B,function(C){A.call(z,C,{lat:C.latLng.lat(),lng:C.latLng.lng()})});return new w.event.EventListener(B,y)},_addMouseListenerOnce:function(B,A){var z=this._inst;var y=google.maps.event.addListenerOnce(this._inst,B,function(C){A.call(z,C,{lat:C.latLng.lat(),lng:C.latLng.lng()})});return new w.event.EventListener(B,y)},_removeListener:function(y){google.maps.event.removeListener(y._eventListener);return this},_trigger:function(y,z){google.maps.event.trigger(this._inst,y,z);return this}};function o(){var y=[{featureType:"water",stylers:[{saturation:44},{lightness:10},{hue:"#0099ff"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.highway",stylers:[{weight:0.4}]},{featureType:"transit.line",stylers:[{weight:0.3}]},{featureType:"landscape",stylers:[{saturation:-80},{lightness:40}]},{featureType:"poi.park",elementType:"geometry",stylers:[{saturation:-26},{lightness:20}]}];return y}var l=navigator.userAgent.toLowerCase().match(/msie [\d.]+/),d=l?parseFloat(l[0].substr(5)):false,j=d&&d<=9;function r(y){if(j){google.maps.event.addListenerOnce(y,"idle",function(){setTimeout(function(){var z=$(".gm-style > .gmnoprint:first",$(y.getDiv()));if(z[0]){z[0].style.width=null}},200)})}}function m(y){google.maps.event.addListenerOnce(y,"idle",function(){$("body").children().each(function(A,C){var D=$(C),B=parseFloat(D.css("fontSize")),z=D.css("fontFamily");if(B>64&&z&&z.toLowerCase().indexOf("roboto")!==-1){D.hide()}})})}g.map={initialize:function(z){z=$.extend(true,{},{control:{mapType:{visible:true,position:google.maps.ControlPosition.RIGHT_BOTTOM},zoom:{visible:true,position:google.maps.ControlPosition.LEFT_TOP}}},z);var y={mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(z.lat,z.lng),zoom:z.zoom,styles:o(),panControl:false,streetViewControl:false,scaleControl:true,mapTypeControl:z.control.mapType.visible,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE],position:z.control.mapType.position},zoomControl:z.control.zoom.visible,zoomControlOptions:{position:z.control.zoom.position},draggable:z.draggable,scrollwheel:z.scrollwheel,disableDoubleClickZoom:z.disableDoubleClickZoom};this._inst=new google.maps.Map(z.element,y);r(this._inst);m(this._inst)},setCenter:function(z,y){this._inst.setCenter(new google.maps.LatLng(z,y));return this},getCenter:function(){var y=this._inst.getCenter();return{lat:y.lat(),lng:y.lng()}},setZoom:function(y){this._inst.setZoom(y);return this},getZoom:function(){return this._inst.getZoom()},panTo:function(z,y){this._inst.panTo(new google.maps.LatLng(z,y));return this},panBy:function(z,A){this._inst.panBy(z,A);return this},fitBounds:function(y){this._inst.fitBounds(y._inst);return this},computeDistanceBetween:function(B,A){var z=new google.maps.LatLng(B.lat,B.lng),y=new google.maps.LatLng(A.lat,A.lng);return google.maps.geometry.spherical.computeDistanceBetween(z,y)}};g.map=$.extend({},i,g.map);g.latLngBounds={initialize:function(z){if(!!z.latLngBounds){this._inst=z.latLngBounds}else{var y,A;if(!!z.northEast){y=new google.maps.LatLng(z.northEast.lat,z.northEast.lng)}if(!!z.southWest){A=new google.maps.LatLng(z.southWest.lat,z.southWest.lng)}this._inst=new google.maps.LatLngBounds(y,A)}},getCenter:function(){var y=this._inst.getCenter();return{lat:y.lat(),lng:y.lng()}},getNorthEast:function(){var y=this._inst.getNorthEast();return{lat:y.lat(),lng:y.lng()}},getSouthWest:function(){var y=this._inst.getSouthWest();return{lat:y.lat(),lng:y.lng()}},extend:function(z,y){this._inst.extend(new google.maps.LatLng(z,y));return this},contains:function(z,y){return this._inst.contains(new google.maps.LatLng(z,y))}};var q=["title","zIndex","opacity","clickable","draggable","icon"];g.marker={initialize:function(z){var y=$.extend({},a.pick(z,q),{map:this.map._inst,position:new google.maps.LatLng(z.lat,z.lng)});var A=y.icon;if(!!A){this.icon=A;if(typeof A==="object"){y.icon={url:A.url,size:new google.maps.Size(A.size[0],A.size[1]),origin:!!A.origin?new google.maps.Point(A.origin[0],A.origin[1]):undefined,anchor:!!A.anchor?new google.maps.Point(A.anchor[0],A.anchor[1]):undefined}}}this._inst=new google.maps.Marker(y)},getMap:function(){return this.map},setPosition:function(z,y){this._inst.setPosition(new google.maps.LatLng({lat:z,lng:y}));return this},getPosition:function(){var y=this._inst.getPosition();return{lat:y.lat(),lng:y.lng()}},setIcon:function(z){if(typeof z==="string"){this.icon=z;this._inst.setIcon(z)}if(typeof z==="object"){if(typeof this.icon!=="object"){this.icon=z}else{$.extend(this.icon,z)}var y={};y.url=this.icon.url;if(!!this.icon.size){y.size=new google.maps.Size(this.icon.size[0],this.icon.size[1])}if(!!this.icon.origin){y.origin=new google.maps.Point(this.icon.origin[0],this.icon.origin[1])}if(!!this.icon.anchor){y.anchor=new google.maps.Point(this.icon.anchor[0],this.icon.anchor[1])}this._inst.setIcon(y)}return this},getIcon:function(){return this.icon},setZIndex:function(y){this._inst.setZIndex(y);return this},getZIndex:function(){return this._inst.getZIndex()},show:function(){this._inst.setVisible(true);return this},hide:function(){this._inst.setVisible(false);return this},remove:function(){this._inst.setMap(null)}};g.marker=$.extend({},i,g.marker);var n=["content","maxWidth","pixelOffset","disableAutoPan","zIndex"];g.infoWindow={initialize:function(z){var y=z.pixelOffset;if(!!y){z.pixelOffset=new google.maps.Size(y[0],y[1])}var A=$.extend({},a.pick(z,n),{map:this.map._inst,position:new google.maps.LatLng(z.lat,z.lng)})},remove:function(){this._inst.setMap(null)}};g.infoWindow=$.extend({},i,g.infoWindow);var f=["strokeColor","strokeOpacity","strokeWeight","clickable"];g.polyline={initialize:function(A){var D=A.paths,C=[];for(var B=0;B<D.length;B++){var y=D[B];C.push(new google.maps.LatLng(y.lat,y.lng))}var z=$.extend({},a.pick(A,f),{map:this.map._inst,path:C});this._inst=new google.maps.Polyline(z)},getMap:function(){return this.map},getPath:function(){var z=this._inst.getPath().getArray(),A=[];for(var y=0;y<z.length;y++){A.push({lat:z[y].lat(),lng:z[y].lng()})}return A},setOptions:function(z){var y=a.pick(z,f);this._inst.setOptions(y);return this},show:function(){this._inst.setVisible(true);return this},hide:function(){this._inst.setVisible(false);return this},remove:function(){this._inst.setMap(null)}};g.polyline=$.extend({},i,g.polyline);var x=["strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","clickable"];g.circle={initialize:function(y){var z=$.extend({},a.pick(y,x),{map:this.map._inst,center:new google.maps.LatLng(y.lat,y.lng),radius:y.radius});this._inst=new google.maps.Circle(z)},getMap:function(){return this.map},getCenter:function(){var y=this._inst.getCenter();return{lat:y.lat(),lng:y.lng()}},setRadius:function(y){this._inst.setRadius(y);return this},getRadius:function(){return this._inst.getRadius()},setOptions:function(y){var z=a.pick(y,x);this._inst.setOptions(z);return this},show:function(){this._inst.setVisible(true);return this},hide:function(){this._inst.setVisible(false);return this},remove:function(){this._inst.setMap(null)}};g.circle=$.extend({},i,g.circle);var k=["strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","clickable","zIndex"];g.polygon={initialize:function(A){var D=A.paths,C=[];for(var B=0;B<D.length;B++){var y=D[B];C.push(new google.maps.LatLng(y.lat,y.lng))}var z=$.extend({},a.pick(A,k),{map:this.map._inst,paths:C});this._inst=new google.maps.Polygon(z)},getMap:function(){return this.map},getPath:function(){var z=this._inst.getPath().getArray(),A=[];for(var y=0;y<z.length;y++){A.push({lat:z[y].lat(),lng:z[y].lng()})}return A},setOptions:function(z){var y=a.pick(z,k);this._inst.setOptions(y);return this},show:function(){this._inst.setVisible(true);return this},hide:function(){this._inst.setVisible(false);return this},remove:function(){this._inst.setMap(null)}};g.polygon=$.extend({},i,g.polygon);var v={};u.then(function(){var y=function(z){this.map=z.map._inst;this.lat=z.lat;this.lng=z.lng;this.type="marker";this.$node=null;this.position=null;this.initialize(z);this.createNode();this.setMap(this.map)};a.extend(y,google.maps.OverlayView);y.prototype.onAdd=function(){this.$node.css("position","absolute");var z;switch(this.type){case"marker":z=this.getPanes().overlayMouseTarget;break;case"infoWindow":z=this.getPanes().floatPane;break;default:}z.appendChild(this.$node[0])};y.prototype.draw=function(){var z=new google.maps.LatLng(this.lat,this.lng),A=this.getProjection().fromLatLngToDivPixel(z);this.renderNode(A);this.$node.css({left:this.position.x,top:this.position.y})};y.prototype.onRemove=function(){this.destoryNode()};y.prototype.getPosition=function(){return{lat:this.lat,lng:this.lng}};v._base=y});var b=h.addOverlayView=function(A,z){var y=function(B){y.__super__.constructor.call(this,B)};a.extend(y,v._base);$.extend(y.prototype,z);v[A]=y};g.overlayView={initialize:function(y){this._inst=new v[this._cid](y)},getMap:function(){return this.map},getPosition:function(){return this._inst.getPosition()},reset:function(){if(this._inst.$node.is(":visible")){this._inst.draw()}return this},remove:function(){this._inst.setMap(null)}};g.overlayView=$.extend({},i,g.overlayView);g.geocoder={initialize:function(y){this._inst=new google.maps.Geocoder()},geocode:function(y,z){this._inst.geocode({address:y.address},function(F,B){var A=[],C={results:F,status:B};if(B==google.maps.GeocoderStatus.OK){if(M.isArray(F)){for(var E=0;E<F.length;E++){var G=F[E],D={formattedAddress:G.formatted_address};if(G.geometry&&G.geometry.location&&M.isFunction(G.geometry.location.lat)&&M.isFunction(G.geometry.location.lng)){D.location={lat:G.geometry.location.lat(),lng:G.geometry.location.lng()}}A.push(D)}}}else{}z.call(null,A,C)})}};return h}));(function(b,a){if(!!b.M&&!!b.M.define){M.define("/js/hotel/mfwmap/mfwmap-runtime-amap",function(e,d,f){var c=e("/js/hotel/mfwmap/mfwmap-util"),g=e("/js/hotel/mfwmap/mfwmap-event");f.exports=a(b,c,g)})}else{b.mfwmap.amapRuntime=a(b,b.mfwmap.util,b.mfwmap.event)}}(window,function(o,a,r){var u={util:a,event:r};var d=false,t=$.Deferred(),b=4000;o.initAMap=function(){t.resolve()};function s(x){var w=document.createElement("script");w.type="text/javascript";w.src=location.protocol+"//webapi.amap.com/maps?v=1.3&key=b2cf7b957c24323add8c497ed3512e15&callback=initAMap";if("onerror" in w){w.onerror=function(y){t.reject()}}document.body.appendChild(w);setTimeout(function(){try{if(t.state()==="pending"){t.reject()}}catch(y){t.reject()}},x)}var c={hasInited:d,init:function(x){if(!d){d=true;var w=Number(x)>0?Number(x):b;s(w)}},getInitPromise:function(){return t.promise()},controlPosition:{TOP_LEFT:1,TOP_RIGHT:3,BOTTOM_LEFT:10,BOTTOM_RIGHT:12}};var h=c.implement={};var j={zoom_changed:"zoomchange"};var i={_addListener:function(z,y){var x=a.mapping(z,j);var w=AMap.event.addListener(this._inst,x,y);return new u.event.EventListener(z,w)},_addListenerOnce:function(z,y){var x=a.mapping(z,j);var w=AMap.event.addListenerOnce(this._inst,x,y);return new u.event.EventListener(z,w)},_addMouseListener:function(A,z){var x=a.mapping(A,j);var y=this._inst;var w=AMap.event.addListener(y,x,function(B){z.call(y,B)});return new u.event.EventListener(A,w)},_addMouseListenerOnce:function(A,z){var x=a.mapping(A,j);var y=this._inst;var w=AMap.event.addListenerOnce(y,x,function(B){z.call(y,B)});return new u.event.EventListener(A,w)},_removeListener:function(w){AMap.event.removeListener(w._eventListener);return this},_trigger:function(x,y){var w=a.mapping(x,j);AMap.event.trigger(this._inst,w,y);return this}};h.map={initialize:function(x){x=$.extend(true,{},{control:{mapType:{visible:true},zoom:{visible:true,amapRuler:true,amapOffset:[10,10],amapLiteStyle:false}}},x);var w={view:new AMap.View2D({center:new AMap.LngLat(x.lng,x.lat),zoom:x.zoom}),mapStyle:"normal",dragEnable:x.draggable,scrollWheel:x.scrollwheel,doubleClickZoom:!x.disableDoubleClickZoom};x.element.id=x.element.id||"_j_map_container_"+a.uuid(8,16);this._inst=new AMap.Map(x.element.id,w);var y=this._inst;y.plugin(["AMap.Scale","AMap.ToolBar"],function(){var C=new AMap.Scale();y.addControl(C);var B=x.control.zoom,z;switch(B.position){case c.controlPosition.TOP_LEFT:z="LT";break;case c.controlPosition.TOP_RIGHT:z="RT";break;case c.controlPosition.BOTTOM_LEFT:z="BL";break;case c.controlPosition.BOTTOM_RIGHT:z="BR";break;default:z="LT"}var A=new AMap.ToolBar({position:z,offset:new AMap.Pixel(B.amapOffset[0],B.amapOffset[1]),ruler:B.amapRuler,direction:false,autoPosition:false,liteStyle:B.amapLiteStyle});if(B.visible){y.addControl(A)}})},setCenter:function(x,w){this._inst.setCenter(new AMap.LngLat(w,x));return this},getCenter:function(){var w=this._inst.getCenter();return{lat:w.getLat(),lng:w.getLng()}},setZoom:function(w){this._inst.setZoom(w);return this},getZoom:function(){return this._inst.getZoom()},panTo:function(x,w){this._inst.panTo(new AMap.LngLat(w,x));return this},panBy:function(w,z){this._inst.panBy(-w,-z);return this},fitBounds:function(w){this._inst.setBounds(w._inst);return this}};h.map=$.extend({},i,h.map);h.latLngBounds={initialize:function(x){if(!!x.northEast&&!!x.southWest){var y=new AMap.LngLat(x.southWest.lng,x.southWest.lat),w=new AMap.LngLat(x.northEast.lng,x.northEast.lat);this._inst=new AMap.Bounds(y,w)}},getCenter:function(){if(!!this._inst){var w=this._inst.getCenter();return{lat:w.getLat(),lng:w.getLng()}}return false},getNorthEast:function(){if(!!this._inst){var w=this._inst.getNorthEast();return{lat:w.getLat(),lng:w.getLng()}}return null},getSouthWest:function(){if(!!this._inst){var w=this._inst.getSouthWest();return{lat:w.getLat(),lng:w.getLng()}}return null},extend:function(B,E){var A,z,C,F;if(!!this._inst){var x=this._inst.getSouthWest().getLng(),H=this._inst.getNorthEast().getLng(),D=this._inst.getNorthEast().getLat(),G=this._inst.getSouthWest().getLat();A=x<=E?x:E;z=H>=E?H:E;C=D>=B?D:B;F=G<=B?G:B}else{A=z=E;C=F=B}var w=new AMap.LngLat(A,F),y=new AMap.LngLat(z,C);this._inst=new AMap.Bounds(w,y);return this},contains:function(x,w){if(!!this._inst){return this._inst.contains(new AMap.LngLat(w,x))}return false}};var p=["title","zIndex","clickable","draggable","icon","offset","content"],m={};h.marker={initialize:function(x){var y=x.icon,z=x.content,A;if(!!y){this.icon=y;if(typeof y==="object"){x.icon=new AMap.Icon({image:y.url,size:new AMap.Size(y.size[0],y.size[1]),imageOffset:!!y.origin?new AMap.Pixel(-y.origin[0],-y.origin[1]):undefined})}}if(!!z){this.content=z}if(!!x.offset){A=new AMap.Pixel(-x.offset[0],-x.offset[1])}var w=$.extend({},a.mapping(a.pick(x,p),m),{map:this.map._inst,position:new AMap.LngLat(x.lng,x.lat),offset:A});this._inst=new AMap.Marker(w)},getMap:function(){return this.map},setPosition:function(x,w){this._inst.setPosition(new AMap.LngLat(w,x));return this},getPosition:function(){var w=this._inst.getPosition();return{lat:w.getLat(),lng:w.getLng()}},setIcon:function(x){if(typeof x==="string"){this.icon=x;this._inst.setIcon(x)}if(typeof x==="object"){if(typeof this.icon!=="object"){this.icon=x}else{$.extend(this.icon,x)}var w={};w.image=this.icon.url;if(!!this.icon.size){w.size=new AMap.Size(this.icon.size[0],this.icon.size[1])}if(!!this.icon.origin){w.imageOffset=new AMap.Pixel(-this.icon.origin[0],-this.icon.origin[1])}this._inst.setIcon(new AMap.Icon(w))}return this},getIcon:function(){return this.icon},setOffset:function(w,z){this._inst.setOffset(new AMap.Pixel(-w,-z));return this},getOffset:function(){var w=this._inst.getOffset();return{x:-w.getX(),y:-w.getY()}},setZIndex:function(w){this._inst.setzIndex(w+100);return this},getZIndex:function(){return this._inst.getzIndex()-100},setContent:function(w){this.content=w;this._inst.setContent(w);return this},getContent:function(){return this.content},show:function(){this._inst.show();return this},hide:function(){this._inst.hide();return this},remove:function(){this._inst.setMap(null)}};h.marker=$.extend({},i,h.marker);var n=["content","pixelOffset","disableAutoPan"],e={pixelOffset:"offset",disableAutoPan:"autoMove"};h.infoWindow={initialize:function(x){if("disableAutoPan" in x){x.disableAutoPan=!x.disableAutoPan}var w=x.pixelOffset;if(!!w){x.pixelOffset=new AMap.Pixel(w[0],w[1])}var y=$.extend({},a.mapping(a.pick(x,n),e),{map:this.map._inst,position:new AMap.LngLat(x.lng,x.lat),isCustom:true});this._inst=new AMap.InfoWindow(y);this._inst.open()},getMap:function(){return this.map},getPosition:function(){var w=this._inst.getPosition();return{lat:w.getLat(),lng:w.getLng()}},setContent:function(w){this._inst.setContent(w);return this},getContent:function(){return this._inst.getContent()},show:function(){this._inst.show();return this},hide:function(){this._inst.hide();return this},remove:function(){this._inst.setMap(null)}};h.infoWindow=$.extend({},i,h.infoWindow);var g=["strokeColor","strokeOpacity","strokeWeight"],l={};h.polyline={initialize:function(y){var B=y.paths,A=[];for(var z=0;z<B.length;z++){var w=B[z];A.push(new AMap.LngLat(w.lng,w.lat))}var x=$.extend({},a.mapping(a.pick(y,g),l),{map:this.map._inst,path:A});this._inst=new AMap.Polyline(x)},getMap:function(){return this.map},getPath:function(){var x=this._inst.getPath(),y=[];for(var w=0;w<x.length;w++){y.push({lat:x[w].getLat(),lng:x[w].getLng()})}return y},setOptions:function(x){var w=a.mapping(a.pick(x,g),l);this._inst.setOptions(w);return this},show:function(){this._inst.show();return this},hide:function(){this._inst.hide();return this},remove:function(){this._inst.setMap(null)}};h.polyline=$.extend({},i,h.polyline);var v=["strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity"],f={};h.circle={initialize:function(w){var x=$.extend({},a.mapping(a.pick(w,v),f),{map:this.map._inst,center:new AMap.LngLat(w.lng,w.lat),radius:w.radius});this._inst=new AMap.Circle(x)},getMap:function(){return this.map},getCenter:function(){var w=this._inst.getCenter();return{lat:w.getLat(),lng:w.getLng()}},setRadius:function(w){this._inst.setRadius(w);return this},getRadius:function(){return this._inst.getRadius()},setOptions:function(w){var x=a.mapping(a.pick(w,v),f);this._inst.setOptions(x);return this},show:function(){this._inst.show();return this},hide:function(){this._inst.hide();return this},remove:function(){this._inst.setMap(null)}};h.circle=$.extend({},i,h.circle);var k=["strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","zIndex"],q={};h.polygon={initialize:function(y){var B=y.paths,A=[];for(var z=0;z<B.length;z++){var w=B[z];A.push(new AMap.LngLat(w.lng,w.lat))}var x=$.extend({},a.mapping(a.pick(y,k),q),{map:this.map._inst,path:A});this._inst=new AMap.Polygon(x)},getMap:function(){return this.map},getPath:function(){var x=this._inst.getPath(),y=[];for(var w=0;w<x.length;w++){y.push({lat:x[w].getLat(),lng:x[w].getLng()})}return y},setOptions:function(x){var w=a.mapping(a.pick(x,k),q);this._inst.setOptions(w);return this},show:function(){this._inst.show();return this},hide:function(){this._inst.hide();return this},remove:function(){this._inst.setMap(null)}};h.polygon=$.extend({},i,h.polygon);h.overlayView={};h.geocoder={initialize:function(w){},geocode:function(w,x){AMap.service("AMap.Geocoder",function(){var y=new AMap.Geocoder();y.getLocation(w.address,function(B,z){var A=[],C={result:z,status:B};if(B==="complete"&&z.info==="OK"){if(M.isArray(z.geocodes)){for(var E=0;E<z.geocodes.length;E++){var F=z.geocodes[E],D={formattedAddress:F.formattedAddress};if(F.location){D.location={lat:F.location.lat,lng:F.location.lng}}A.push(D)}}}else{}x.call(null,A,C)})})}};return c}));(function(b,a){if(!!b.M&&!!b.M.define){M.define("/js/hotel/mfwmap/mfwmap-runtime-leaflet",function(e,d,f){var c=e("/js/hotel/mfwmap/mfwmap-util"),g=e("/js/hotel/mfwmap/mfwmap-event");f.exports=a(b,c,g)})}else{b.mfwmap.leafletRuntime=a(b,b.mfwmap.util,b.mfwmap.event)}}(window,function(m,a,p){var u={util:a,event:p};var d=false,s=$.Deferred(),c=4000;function q(w){if(!!m.M){m.M.fetchCSSJS(["/css/plugins/leaflet/leaflet.css","/js/plugins/leaflet.js"],function(){L.Icon.Default.imagePath="http://images.mafengwo.net/images/plugins/leaflet/";s.resolve()})}else{if(!!window.L){s.resolve()}}setTimeout(function(){try{if(s.state()==="pending"){s.reject()}}catch(x){s.reject()}},w)}var r={hasInited:d,init:function(x){if(!d){d=true;var w=Number(x)>0?Number(x):c;q(w)}},getInitPromise:function(){return s.promise()},controlPosition:{TOP_LEFT:1,TOP_RIGHT:3,BOTTOM_LEFT:10,BOTTOM_RIGHT:12}};var g=r.implement={};var i={zoom_changed:"zoomend"};var h={_addListener:function(y,x){var w=a.mapping(y,i);this._inst.addEventListener(w,x);return new u.event.EventListener(y,{event:y,handler:x})},_addListenerOnce:function(y,x){var w=a.mapping(y,i);this._inst.addOneTimeEventListener(w,x);return new u.event.EventListener(y,{event:y,handler:x})},_addMouseListener:function(A,z){var x=a.mapping(A,i);var y=this._inst,w=function(B){z.call(y,B,{lat:B.latlng.lat,lng:B.latlng.lng})};this._inst.addEventListener(x,w);return new u.event.EventListener(A,{event:A,handler:w})},_addMouseListenerOnce:function(A,z){var x=a.mapping(A,i);var y=this._inst,w=function(B){z.call(y,B,{lat:B.latlng.lat,lng:B.latlng.lng})};this._inst.addOneTimeEventListener(x,w);return new u.event.EventListener(A,{event:A,handler:w})},_removeListener:function(w){this._inst.removeEventListener(w.event,w.handler);return this},_trigger:function(w,x){this._inst.fireEvent(w,x);return this}};var l=["draggable","scrollwheel","disableDoubleClickZoom"],n={draggable:"dragging",scrollwheel:"scrollWheelZoom",disableDoubleClickZoom:"doubleClickZoom"};g.map={initialize:function(z){this._view={center:null,zoom:null};this._setView=a.debounce(a.bind(function(){var C=this._view.center,D=this._view.zoom;if(!!C&&!!D){this._inst.setView(L.latLng(C.lat,C.lng),D)}else{if(!!C){this._inst.panTo(L.latLng(C.lat,C.lng))}if(!!D){this._inst.setZoom(D)}}C=null;D=null},this),1);z=$.extend(true,{},{control:{mapType:{visible:true},zoom:{visible:true,position:r.controlPosition.TOP_LEFT}}},z);var y=a.mapping(a.pick(z,l),n);y.doubleClickZoom=!y.doubleClickZoom;y.zoomControl=false;this._inst=L.map(z.element,y).setView([z.lat,z.lng],z.zoom);var B="https://maps.google.cn/maps/vt/pb=!1m5!1m4!1i{z}!2i{x}!3i{y}!4i256!2m3!1e0!2sm!3i258145710!5m1!5f2!3m2!2szh-CN!3sCN",x="Map data &copy;Google";L.tileLayer(B,{maxZoom:18,attribution:x}).addTo(this._inst);var A=z.control.zoom,w;switch(A.position){case r.controlPosition.TOP_LEFT:w="topleft";break;case r.controlPosition.TOP_RIGHT:w="topright";break;case r.controlPosition.BOTTOM_LEFT:w="bottomleft";break;case r.controlPosition.BOTTOM_RIGHT:w="bottomright";break;default:w="topleft"}if(A.visible){L.control.zoom({position:w}).addTo(this._inst)}L.control.scale({imperial:false}).addTo(this._inst);this._inst.attributionControl.setPrefix(false)},setCenter:function(x,w){this._view.center={lat:x,lng:w};this._setView.call(this);return this},getCenter:function(){var w=this._inst.getCenter();return{lat:w.lat,lng:w.lng}},setZoom:function(w){this._inst.setZoom(w);return this},getZoom:function(){return this._inst.getZoom()},panTo:function(x,w){this._inst.panTo(L.latLng(x,w));return this},panBy:function(w,z){this._inst.panBy(L.point(w,z));return this},fitBounds:function(w){this._inst.fitBounds(w._inst);return this},computeDistanceBetween:function(z,y){var x=L.latLng(z.lat,z.lng),w=L.latLng(y.lat,y.lng);return x.distanceTo(w)}};g.map=$.extend({},h,g.map);g.latLngBounds={initialize:function(x){if(!!x.latLngBounds){this._inst=x.latLngBounds}else{if(!!x.northEast&&!!x.southWest){var y=L.latLng(x.southWest.lat,x.southWest.lng),w=L.latLng(x.northEast.lat,x.northEast.lng);this._inst=L.latLngBounds(y,w)}else{this._inst=L.latLngBounds([])}}},getCenter:function(){if(!!this._inst){var w=this._inst.getCenter();return{lat:w.lat,lng:w.lng}}return false},getNorthEast:function(){if(!!this._inst){var w=this._inst.getNorthEast();return{lat:w.lat,lng:w.lng}}return null},getSouthWest:function(){if(!!this._inst){var w=this._inst.getSouthWest();return{lat:w.lat,lng:w.lng}}return null},extend:function(x,w){this._inst.extend(L.latLng(x,w));return this},contains:function(x,w){return this._inst.contains(L.latLng(x,w))}};var f=["strokeColor","strokeOpacity","strokeWeight","clickable"],k={strokeColor:"color",strokeOpacity:"opacity",strokeWeight:"weight"};g.polyline={initialize:function(y){var B=y.paths,A=[];for(var z=0;z<B.length;z++){var w=B[z];A.push(L.latLng(w.lat,w.lng))}var x=a.mapping(a.pick(y,f),k);this._inst=L.polyline(A,x).addTo(this.map._inst)},getMap:function(){return this.map},getPath:function(){var x=this._inst.getLatLngs(),y=[];for(var w=0;w<x.length;w++){y.push({lat:x[w].lat,lng:x[w].lng})}return y},setOptions:function(x){var w=a.mapping(a.pick(x,f),k);this._inst.setStyle(w);return this},show:function(){this._inst.addTo(this.map._inst);return this},hide:function(){this.remove();return this},remove:function(){this.map._inst.removeLayer(this._inst)}};g.polyline=$.extend({},h,g.polyline);var v=["strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","clickable"],e={strokeColor:"color",strokeOpacity:"opacity",strokeWeight:"weight"};g.circle={initialize:function(w){var x=a.mapping(a.pick(w,v),e);this._inst=L.circle(L.latLng(w.lat,w.lng),w.radius,x).addTo(this.map._inst)},getMap:function(){return this.map},getCenter:function(){var w=this._inst.getCenter();return{lat:w.lat,lng:w.lng}},setRadius:function(w){this._inst.setRadius(w);return this},getRadius:function(){return this._inst.getRadius()},setOptions:function(w){var x=a.mapping(a.pick(w,v),e);this._inst.setStyle(x);return this},show:function(){this._inst.addTo(this.map._inst);return this},hide:function(){this.remove();return this},remove:function(){this.map._inst.removeLayer(this._inst)}};g.circle=$.extend({},h,g.circle);var j=["strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","clickable"],o={strokeColor:"color",strokeOpacity:"opacity",strokeWeight:"weight"};g.polygon={initialize:function(y){var B=y.paths,A=[];for(var z=0;z<B.length;z++){var w=B[z];A.push(L.latLng(w.lat,w.lng))}var x=a.mapping(a.pick(y,j),o);this._inst=L.polygon(A,x).addTo(this.map._inst)},getMap:function(){return this.map},getPath:function(){var x=this._inst.getLatLngs(),y=[];for(var w=0;w<x.length;w++){y.push({lat:x[w].lat,lng:x[w].lng})}return y},setOptions:function(x){var w=a.mapping(a.pick(x,j),o);this._inst.setStyle(w);return this},show:function(){this._inst.addTo(this.map._inst);return this},hide:function(){this.remove();return this},remove:function(){this.map._inst.removeLayer(this._inst)}};g.polygon=$.extend({},h,g.polygon);var t={};var b=r.addOverlayView=function(y,x){var w=L.Class.extend({initialize:function(z){this.map=z.map._inst;this.lat=z.lat;this.lng=z.lng;this.type="marker";this.$node=null;this.position=null;this._initialize(z);this.createNode()},onAdd:function(z){var A;switch(this.type){case"marker":A=z.getPanes().markerPane;break;case"infoWindow":A=z.getPanes().popupPane;this.$node.css("position","absolute");break;default:}A.appendChild(this.$node[0]);z.on("viewreset",this._reset,this);this._reset()},onRemove:function(z){var A;switch(this.type){case"marker":A=z.getPanes().markerPane;break;case"infoWindow":A=z.getPanes().popupPane;break;default:}A.removeChild(this.$node[0]);z.off("viewreset",this._reset,this)},_reset:function(){var z=this.map.latLngToLayerPoint(L.latLng(this.lat,this.lng));this.renderNode(z);L.DomUtil.setPosition(this.$node[0],this.position)}});x._initialize=x.initialize;delete x.initialize;$.extend(w.prototype,x);t[y]=w};g.overlayView={initialize:function(w){this._inst=new t[this._cid](w);this.map._inst.addLayer(this._inst)},getMap:function(){return this.map},getPosition:function(){return{lat:this._inst.lat,lng:this._inst.lng}},reset:function(){if(this._inst.$node.is(":visible")){this._inst._reset()}return this},remove:function(){this.map._inst.removeLayer(this._inst)}};g.overlayView=$.extend({},h,g.overlayView);g.geocoder={};return r}));(function(b,a){if(!!b.M&&!!b.M.define){M.define("/js/hotel/mfwmap/mfwmap",function(e,d,f){var c=e("/js/hotel/mfwmap/mfwmap-util"),h=e("/js/hotel/mfwmap/mfwmap-event"),j=e("/js/hotel/mfwmap/mfwmap-runtime-google"),i=e("/js/hotel/mfwmap/mfwmap-runtime-amap"),g=e("/js/hotel/mfwmap/mfwmap-runtime-leaflet");f.exports=a(b,c,h,j,i,g)})}else{b.mfwmap=a(b,b.mfwmap.util,b.mfwmap.event,b.mfwmap.googleRuntime,b.mfwmap.amapRuntime,b.mfwmap.leafletRuntime)}}(window,function(s,c,t,m,h,v){var u={google:m,amap:h,leaflet:v};var x={createMap:function(D){var A=$.Deferred(),F=null,C=c.clone(D.runtimes),B=D.channelType||"unknown",z=D.pageType||"unknown",E=function(){var H=C.shift();if(H==="google"&&B!=="hotel"&&!(B==="poi"&&(z==="add"||z==="edit"))){E();return false}if(!!H){var G=u[H].getInitPromise();u[H].init();G.then(function(){D.mapType=H;F=new j(D);if("google"===H){google.maps.event.addListenerOnce(F._inst,"idle",function(){A.resolve(F)})}else{A.resolve(F)}var I=H==="leaflet"?"osm":H;!!window.mfwPageEvent&&window.mfwPageEvent("default","map",{map_type:I,channel_type:B,page_type:z});!!window.mfwPageEvent&&window.mfwPageEvent("hotel","mfwmap",{runtimes:D.runtimes,map_type:H,channel_type:B,page_type:z,is_success:1})},function(I){E()})}else{A.reject(new Error("create mfwmap failed!"));!!window.mfwPageEvent&&window.mfwPageEvent("hotel","mfwmap",{runtimes:D.runtimes,channel_type:B,page_type:z,is_success:0})}};E();return A.promise()},controlPosition:{TOP:2,TOP_CENTER:2,TOP_LEFT:1,TOP_RIGHT:3,LEFT:5,LEFT_BOTTOM:6,LEFT_CENTER:4,LEFT_TOP:5,RIGHT:7,RIGHT_BOTTOM:9,RIGHT_CENTER:8,RIGHT_TOP:7,BOTTOM:11,BOTTOM_CENTER:11,BOTTOM_LEFT:10,BOTTOM_RIGHT:12,CENTER:13},isWGS84:function(z){if(z==="leaflet"){return true}return false},isSupportOverlayView:function(z){if(c.includes(["google","leaflet"],z)){return true}return false},util:c};var j=function(z){z=$.extend({},j.DEFAULT,z);this.runtimes=z.runtimes;this.mapType=z.mapType;this.inject();this.initialize(z)};j.DEFAULT={draggable:true,scrollwheel:true,disableDoubleClickZoom:false};var e=["click","dblclick","mouseover","mouseout","drag","dragstart","dragend","zoom_changed","resize"];j.prototype.inject=function(){for(var z in t.eventFunc){if(c.includes(["addListener","addListenerOnce","trigger"],z)){this[z]=c.bind(t.eventFunc[z],this,e)}else{this[z]=c.bind(t.eventFunc[z],this)}}var A=u[this.mapType].implement.map;for(var z in A){this[z]=c.bind(A[z],this)}};j.prototype.getBounds=function(){return new o({map:this,latLngBounds:this._inst.getBounds()})};var o=x.LatLngBounds=function(z){this.map=z.map;this.inject();this.initialize(z)};o.prototype.inject=function(){var A=u[this.map.mapType].implement.latLngBounds;for(var z in A){this[z]=c.bind(A[z],this)}};var k=x.Marker=function(z){z=$.extend({},k.DEFAULT,z);this.map=z.map;this.icon=null;this.content="";this.inject();this.initialize(z)};k.DEFAULT={title:"",opacity:1,clickable:true,draggable:false};var f=["click","dblclick","mouseover","mouseout","drag","dragstart","dragend"];k.prototype.inject=function(){for(var z in t.eventFunc){if(c.includes(["addListener","addListenerOnce","trigger"],z)){this[z]=c.bind(t.eventFunc[z],this,f)}else{this[z]=c.bind(t.eventFunc[z],this)}}var A=u[this.map.mapType].implement.marker;for(var z in A){this[z]=c.bind(A[z],this)}};var l=x.InfoWindow=function(z){z=$.extend({},l.DEFAULT,z);this.map=z.map;this.icon=null;this.inject();this.initialize(z)};l.DEFAULT={};var a=["click","dblclick","mouseover","mouseout"];l.prototype.inject=function(){for(var z in t.eventFunc){if(c.includes(["addListener","addListenerOnce","trigger"],z)){this[z]=c.bind(t.eventFunc[z],this,a)}else{this[z]=c.bind(t.eventFunc[z],this)}}var A=u[this.map.mapType].implement.infoWindow;for(var z in A){this[z]=c.bind(A[z],this)}};var q=x.Polyline=function(z){z=$.extend({},q.DEFAULT,z);this.map=z.map;this.inject();this.initialize(z)};q.DEFAULT={strokeColor:"#0a89e4",strokeOpacity:1,strokeWeight:2,clickable:true};var g=["click","dblclick","mouseover","mouseout"];q.prototype.inject=function(){for(var z in t.eventFunc){if(c.includes(["addListener","addListenerOnce","trigger"],z)){this[z]=c.bind(t.eventFunc[z],this,g)}else{this[z]=c.bind(t.eventFunc[z],this)}}var A=u[this.map.mapType].implement.polyline;for(var z in A){this[z]=c.bind(A[z],this)}};var r=x.Circle=function(z){z=$.extend({},r.DEFAULT,z);this.map=z.map;this.inject();this.initialize(z)};r.DEFAULT={strokeColor:"#29b5EF",strokeOpacity:1,strokeWeight:1,fillColor:"#0a89e4",fillOpacity:0,clickable:true};var w=["click","dblclick","mouseover","mouseout"];r.prototype.inject=function(){for(var z in t.eventFunc){if(c.includes(["addListener","addListenerOnce","trigger"],z)){this[z]=c.bind(t.eventFunc[z],this,w)}else{this[z]=c.bind(t.eventFunc[z],this)}}var A=u[this.map.mapType].implement.circle;for(var z in A){this[z]=c.bind(A[z],this)}};r.prototype.getBounds=function(){return new o({map:this.map,latLngBounds:this._inst.getBounds()})};var b=x.Polygon=function(z){z=$.extend({},b.DEFAULT,z);this.map=z.map;this.inject();this.initialize(z)};b.DEFAULT={strokeColor:"#0a89e4",strokeOpacity:1,strokeWeight:2,fillColor:"#0a89e4",fillOpacity:0,clickable:true};var p=["click","dblclick","mouseover","mouseout"];b.prototype.inject=function(){for(var z in t.eventFunc){if(c.includes(["addListener","addListenerOnce","trigger"],z)){this[z]=c.bind(t.eventFunc[z],this,p)}else{this[z]=c.bind(t.eventFunc[z],this)}}var A=u[this.map.mapType].implement.polygon;for(var z in A){this[z]=c.bind(A[z],this)}};var y=x.OverlayView=function(z){this.map=z.map;this.inject();!!this.initialize&&this.initialize(z)};var i=["click","dblclick","mouseover","mouseout"];y.prototype.inject=function(){for(var z in t.eventFunc){if(c.includes(["addListener","addListenerOnce","trigger"],z)){this[z]=c.bind(t.eventFunc[z],this,i)}else{this[z]=c.bind(t.eventFunc[z],this)}}var A=u[this.map.mapType].implement.overlayView;for(var z in A){this[z]=c.bind(A[z],this)}};var d=["initialize","createNode","renderNode","destoryNode"];y.implement=function(A){var z=this,C=c.uuid(),B=function(){this._cid=C;return z.apply(this,arguments)};u.google.getInitPromise().then(function(){u.google.addOverlayView(C,A)});u.leaflet.getInitPromise().then(function(){u.leaflet.addOverlayView(C,A)});c.extend(B,z);return B};var n=x.Geocoder=function(z){this.map=z.map;this.inject();this.initialize(z)};n.prototype.inject=function(){var A=u[this.map.mapType].implement.geocoder;for(var z in A){this[z]=c.bind(A[z],this)}};return x}));(function(b,a){if(!!b.M){M.define("/js/hotel/mfwmap/mfwmap-overlays",function(e,d,f){var c=e("/js/hotel/mfwmap/mfwmap");f.exports=a(b,c)})}else{b.mfwmap.overlays=a(b,b.mfwmap)}}(window,function(a,K){var o={},e={mouseover:"mouseenter",mouseout:"mouseleave"};var D=function(U){this.isSupportOverlayView=K.isSupportOverlayView(U.map.mapType);this._impl=null};D.prototype.remove=function(){this._impl.remove()};D.prototype.addListener=function(W){if(this.isSupportOverlayView){var U=this._impl._inst.$node,V=[];if(W in e){W=e[W]}V.push(W);V=V.concat(Array.prototype.slice.call(arguments,1));U.on.apply(U,V)}else{if(arguments.length===2){this._impl.addListener.apply(this._impl,arguments)}}};D.prototype.trigger=function(W){if(this.isSupportOverlayView){var U=this._impl._inst.$node,V=[];if(W in e){W=e[W]}V.push(W);V=V.concat(Array.prototype.slice.call(arguments,1));U.trigger.apply(U,V)}else{this._impl.trigger.apply(this._impl,arguments)}};var J=function(U){J.__super__.constructor.call(this,U);this.id=null;this.isFocus=false;this.isBigger=U.isBigger||false;this.biggerLightOrigin=null;this.smallerLightOrigin=null;this.biggerNormalOrigin=null;this.smallerNormalOrigin=null};K.util.extend(J,D);J.prototype.getId=function(){return this.id};J.prototype.show=function(){if(this.isSupportOverlayView){this._impl._inst.$node.show()}else{this._impl.show()}};J.prototype.hide=function(){if(this.isSupportOverlayView){this._impl._inst.$node.hide()}else{this._impl.hide()}};J.prototype.getFocus=function(){this.isFocus=true;if(this.isSupportOverlayView){this._impl._inst.isFocus=true;this._impl._inst.$node.addClass("on").addClass("focus").css("z-index",50);this._impl.reset()}else{this._impl.setIcon({origin:this.biggerLightOrigin});this._impl.setZIndex(50)}};J.prototype.getBlur=function(){this.isFocus=false;if(this.isSupportOverlayView){this._impl._inst.isFocus=false;this._impl._inst.$node.removeClass("focus").css("z-index",40);if(!this._impl._inst.isBigger){this._impl._inst.$node.removeClass("on").css("z-index",0)}this._impl.reset()}else{if(this.isBigger){this._impl.setIcon({origin:this.biggerNormalOrigin})}else{this._impl.setIcon({origin:this.smallerNormalOrigin})}this._impl.setZIndex(0)}};J.prototype.getBigger=function(){this.isBigger=true;if(this.isSupportOverlayView){this._impl._inst.isBigger=true;this._impl._inst.$node.addClass("on").css("z-index",40);this._impl.reset()}else{this._impl.setIcon({origin:this.biggerNormalOrigin});this._impl.setZIndex(40)}};J.prototype.getSmaller=function(){this.isBigger=false;if(this.isSupportOverlayView){this._impl._inst.isBigger=false;this._impl._inst.$node.removeClass("on").css("z-index",0);this._impl.reset()}else{this._impl.setIcon({origin:this.smallerNormalOrigin});this._impl.setZIndex(0)}};J.prototype.getHighlight=function(){if(!this.isSupportOverlayView){if(this.isBigger){this._impl.setIcon({origin:this.biggerLightOrigin})}else{this._impl.setIcon({origin:this.smallerLightOrigin})}}};J.prototype.getNormallight=function(){if(!this.isSupportOverlayView&&!this.isFocus){if(this.isBigger){this._impl.setIcon({origin:this.biggerNormalOrigin})}else{this._impl.setIcon({origin:this.smallerNormalOrigin})}}};J.prototype.setZIndex=function(U){if(!this.isSupportOverlayView){this._impl.setZIndex(U)}};J.prototype.setContent=function(V,U){if(!this.isSupportOverlayView){this._impl.setContent(V)}};J.prototype.getContent=function(U){if(!this.isSupportOverlayView){return this._impl.getContent()}};var p=o.PoiMiniInfoWindow=function(U){p.__super__.constructor.call(this,U);U.content=p.tmpl(U);if(this.isSupportOverlayView){this._impl=new A(U)}else{var V=U.offset||[0,0];this._impl=new K.InfoWindow({map:U.map,lat:U.lat,lng:U.lng,content:U.content,pixelOffset:[0+V[0],-15+V[1]],disableAutoPan:true})}};p.tmpl=function(W){var V=W.name,U=$('<div class="m-popHover _j_map_overlay _j_poi_mini_info_window"><a class="title" href="javascript:;">'+V+'</a><span class="icon-arr"><i></i></span></div>');var X=$("<div>").html(U);return X.html()};K.util.extend(p,D);var A=K.OverlayView.implement({initialize:function(U){this.type="infoWindow";this.content=U.content;this.offset=U.offset||[0,0]},createNode:function(){this.$node=$(this.content)},renderNode:function(U){this.position={x:U.x-this.$node.width()/2+this.offset[0],y:U.y-this.$node.height()-20+this.offset[1]}},destoryNode:function(){this.$node.remove()}});var u=o.PoiBlackMiniInfoWindow=function(U){u.__super__.constructor.call(this,U);U.content=u.tmpl(U);if(this.isSupportOverlayView){this._impl=new d(U)}else{var V=U.offset||[0,0];this._impl=new K.InfoWindow({map:U.map,lat:U.lat,lng:U.lng,content:U.content,pixelOffset:[0+V[0],-15+V[1]],disableAutoPan:true})}};u.tmpl=function(V){var W=V.content,U=$('<div class="m-pop-poi-black _j_map_overlay _j_poi_black_mini_info_window"><a href="javascript:;">'+W+"</a><i></i></div>");var X=$("<div>").html(U);return X.html()};K.util.extend(u,D);var d=K.OverlayView.implement({initialize:function(U){this.type="infoWindow";this.content=U.content;this.offset=U.offset||[0,0]},createNode:function(){this.$node=$(this.content)},renderNode:function(U){this.position={x:U.x-this.$node.width()/2+this.offset[0],y:U.y-this.$node.height()-10+this.offset[1]}},destoryNode:function(){this.$node.remove()}});var v=o.HotelMarker=function(U){v.__super__.constructor.call(this,U);this.id=U.id;this.isMiddle=U.isMiddle||false;this.biggerLightOrigin=[25,90];this.smallerLightOrigin=[50,90];this.biggerNormalOrigin=[0,90];this.smallerNormalOrigin=[50,90];if(this.isSupportOverlayView){this._impl=new T(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,title:U.title,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon6.png",size:this.isBigger?[20,30]:[7,7],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?[10,30]:[4,4]})}};K.util.extend(v,J);v.prototype.getFocus=function(){this.isFocus=true;if(this.isSupportOverlayView){this._impl._inst.isFocus=true;if(this.isMiddle){this._impl._inst.$node.removeClass("mark-round16").addClass("mark-hotel").find(".m-icon").css("display","block")}this._impl._inst.$node.addClass("on").addClass("focus").css("z-index",50);this._impl.reset()}else{this._impl.setIcon({origin:this.biggerLightOrigin});this._impl.setZIndex(50)}};v.prototype.getBlur=function(){this.isFocus=false;if(this.isSupportOverlayView){this._impl._inst.isFocus=false;this._impl._inst.$node.removeClass("focus").css("z-index",40);if(!this._impl._inst.isBigger){this._impl._inst.$node.removeClass("on").css("z-index",0)}if(this._impl._inst.isMiddle){this._impl._inst.$node.removeClass("mark-hotel").find(".m-icon").hide().end().addClass("mark-round16").css("z-index",40)}this._impl.reset()}else{if(this.isBigger){this._impl.setIcon({origin:this.biggerNormalOrigin})}else{this._impl.setIcon({origin:this.smallerNormalOrigin})}this._impl.setZIndex(0)}};v.prototype.getBigger=function(){this.isBigger=true;if(this.isSupportOverlayView){this._impl._inst.isBigger=true;if(this.isMiddle){this.isMiddle=false;this._impl._inst.isMiddle=false;this._impl._inst.$node.removeClass("mark-round16").addClass("mark-hotel").find(".m-icon").css("display","block")}this._impl._inst.$node.addClass("on").css("z-index",40);this._impl.reset()}else{this._impl.setIcon({origin:this.biggerNormalOrigin});this._impl.setZIndex(40)}};v.prototype.getSmaller=function(){this.isBigger=false;if(this.isSupportOverlayView){this._impl._inst.isBigger=false;if(this.isMiddle){this.isMiddle=false;this._impl._inst.isMiddle=false;this._impl._inst.$node.removeClass("mark-round16").addClass("mark-hotel").find(".m-icon").css("display","block")}this._impl._inst.$node.removeClass("on").css("z-index",0);this._impl.reset()}else{this._impl.setIcon({origin:this.smallerNormalOrigin});this._impl.setZIndex(0)}};v.prototype.getMiddle=function(){this.isBigger=false;this.isMiddle=true;if(this.isSupportOverlayView){this._impl._inst.isBigger=false;this._impl._inst.isMiddle=true;this._impl._inst.$node.removeClass("mark-hotel").removeClass("on").css("z-index",0).find(".m-icon").hide().end().addClass("mark-round16").css("z-index",40);this._impl.reset()}};var T=K.OverlayView.implement({initialize:function(U){this.id=U.id;this.isFocus=false;this.isBigger=U.isBigger||false;this.isMiddle=U.isMiddle||false},createNode:function(){if(this.isMiddle){this.$node=$('<div class="map-mark mark-round16 _j_map_overlay _j_hotel_marker"><span class="m-icon clickstat" data-cs-p="酒店map标记" data-cs-d="酒店map标记" style="display:none;"></span></div>')}else{this.$node=$('<div class="map-mark mark-hotel '+(this.isBigger?"on":"")+' _j_map_overlay _j_hotel_marker"><span class="m-icon clickstat" data-cs-p="酒店map标记" data-cs-d="酒店map标记"></span></div>')}},renderNode:function(U){if(this.isFocus||this.isBigger){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()+3}}else{this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var H=o.HotelPointMarker=function(U){H.__super__.constructor.call(this,U);this.id=U.id;this.biggerNormalOrigin=[0,172];this.smallerNormalOrigin=[0,172];if(this.isSupportOverlayView){this._impl=new f(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,title:U.title,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon6.png",size:[26,26],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin}})}};K.util.extend(H,J);var f=K.OverlayView.implement({initialize:function(U){this.id=U.id},createNode:function(){this.$node=$('<div class="map-mark mark-hotel _j_map_overlay _j_hotel_marker"><span class="m-icon-point"></span></div>').css("z-index",35)},renderNode:function(U){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()}},destoryNode:function(){this.$node.remove()}});var r=o.HotelInfoWindow=function(U){r.__super__.constructor.call(this,U);this.id=U.id;U.content=r.tmpl(U);if(this.isSupportOverlayView){this._impl=new N(U)}else{var V=U.offset||[0,0];this._impl=new K.InfoWindow({map:U.map,lat:U.lat,lng:U.lng,content:U.content,pixelOffset:[0+V[0],-15+V[1]],disableAutoPan:true})}};r.tmpl=function(V){var ad=V.id,U=V.cname,ai=V.imgW160H125,ag=V.defaultImg,am=V.star,ac=V.starStr,W=V.isBest,ak=V.bookingPreferred,Y=V.numComment,Z=V.numGinfo,ae=V.isAirbnb,X=V.airbnbInfo,af=V.price,ao=V.bookingInfo,aj=V.searchParam,ab=V.dateParam,al=$('<div class="m-pop _j_map_overlay _j_hotel_info_window" data-cs-p="酒店map信息窗" data-cs-d="酒店map信息窗"></div>');al.append('<span class="close"><a class="btn-close" href="javascript:;"><i></i></a></span>').append('<div class="pop-desc"></div>').append('<span class="icon-arr"><i></i></span>');var aa=$(".pop-desc",al);aa.append('<a class="image" href="/hotel/'+ad+".html"+(!!aj?"?"+aj:"")+(!!ab?"#"+ab:"")+'" target="_blank"><img src="'+ag+'" data-image="'+ai+'"></a>').append('<h3 class="overflow_ellipsis"><a href="/hotel/'+ad+".html"+(!!aj?"?"+aj:"")+(!!ab?"#"+ab:"")+'" target="_blank">'+U+"</a></h3>");if(!ae){aa.append('<p><a class="num-comment" href="/hotel/'+ad+".html"+(!!aj?"?"+aj:"")+"#anchor=comment"+(!!ab?"&"+ab:"")+'" target="_blank">蜂蜂评价<em>'+Y+'</em></a><a class="num-post" href="/hotel/'+ad+".html"+(!!aj?"?"+aj:"")+"#anchor=comment"+(!!ab?"&"+ab:"")+'" target="_blank">游记<em>'+Z+"</em></a></p>");var an=$('<p class="hotel-icons">');an.append('<span class="hotel-star">'+ac+"</span>");if(!!W){an.append('<i class="icon-bird"></i>')}if(!!ak){an.append('<i class="icon-hand"></i>')}aa.append(an)}if(ae){aa.append('<p><a class="num-comment" href="/hotel/'+ad+".html"+(!!aj?"?"+aj:"")+"#anchor=comment"+(!!ab?"&"+ab:"")+'" target="_blank">airbnb评价<em>'+X.base.reviews_count+"</em></a></p>").append('<p class="p-airbnb"><span>'+X.base.room_type+"</span><span>"+X.base.person_capacity+"位房客</span></p>")}aa.append('<hr><a class="hm-btn" href="/hotel/'+ad+".html"+(!!aj?"?"+aj:"")+(!!ab?"#"+ab:"")+'" target="_blank"'+(ae&&ao&&ao.airbnb?'data-url="'+ao.airbnb.url+'"':"")+'>预订</a><span class="price">¥ <span>'+af+"</span>");var ah=$("<div>").html(al);return ah.html()};K.util.extend(r,D);r.prototype.getId=function(){return this.id};r.prototype.updatePrice=function(W){if(this.isSupportOverlayView){this._impl._inst.$node.find(".price span").html(W)}else{var V=this._impl.getContent(),U=$(V);U.find(".price span").html(W);var X=$("<div>").html(U);this._impl.setContent(X.html())}};var N=K.OverlayView.implement({initialize:function(U){this.type="infoWindow";this.content=U.content},createNode:function(){this.$node=$(this.content)},renderNode:function(W){this.position={x:W.x-this.$node.width()/2,y:W.y-this.$node.height()-45};this.$node.css("zIndex",10);var V=this.$node.find(".image img"),U=V.data("image");if(!!U){$("<img>").bind("load",function(X){V.attr("src",U)}).attr("src",U)}},destoryNode:function(){this.$node.remove()}});var h=o.HotelMiniInfoWindow=function(U){h.__super__.constructor.call(this,U);this.id=U.id;U.content=h.tmpl(U);if(this.isSupportOverlayView){this._impl=new I(U)}else{var V=U.offset||[0,0];this._impl=new K.InfoWindow({map:U.map,lat:U.lat,lng:U.lng,content:U.content,pixelOffset:[0+V[0],-15+V[1]],disableAutoPan:true})}};h.tmpl=function(W){var Z=W.id,V=W.name,X=W.price,U=$('<div class="m-popHover _j_map_overlay _j_hotel_mini_info_window" data-cs-p="酒店map气泡" data-cs-d="酒店map气泡"><a class="title" href="javascript:;">'+V+"</a>"+(!!X&&X>0?'<span class="price">￥<span>'+X+"</span></span>":"")+'<span class="icon-arr"><i></i></span></div>');var Y=$("<div>").html(U);return Y.html()};K.util.extend(h,D);h.prototype.getId=function(U){return this.id};h.prototype.updatePrice=function(W){if(this.isSupportOverlayView){this._impl._inst.$node.find(".price span").html(W)}else{var V=this._impl.getContent(),U=$(V);U.find(".price span").html(W);var X=$("<div>").html(U);this._impl.setContent(X.html())}};var I=K.OverlayView.implement({initialize:function(U){this.type="infoWindow";this.content=U.content;this.offset=U.offset||[0,0]},createNode:function(){this.$node=$(this.content)},renderNode:function(U){this.position={x:U.x-this.$node.width()/2+this.offset[0],y:U.y-this.$node.height()-20+this.offset[1]}},destoryNode:function(){this.$node.remove()}});var m=o.StationMarker=function(U){m.__super__.constructor.call(this,U);this.id=U.id;this.isHot=U.isHot;this.biggerLightOrigin=[25,180];this.smallerLightOrigin=[50,180];this.biggerNormalOrigin=[0,180];this.smallerNormalOrigin=[50,180];if(this.isSupportOverlayView){this._impl=new E(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon6.png",size:this.isBigger?[20,30]:[7,7],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?[10,30]:[4,4]})}};K.util.extend(m,J);var E=K.OverlayView.implement({initialize:function(U){this.id=U.id;this.isHot=U.isHot;this.isFocus=false;this.isBigger=U.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-metro '+(this.isBigger?"on":"")+' _j_map_overlay _j_station_marker"><span class="m-icon clickstat" data-cs-p="车站map标记" data-cs-d="车站map标记"></span></div>')},renderNode:function(U){if(this.isFocus||this.isBigger){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()+3}}else{this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var B=o.StationMiniInfoWindow=function(U){B.__super__.constructor.call(this,U);U.content=B.tmpl(U);if(this.isSupportOverlayView){this._impl=new F(U)}else{var V=U.offset||[0,0];this._impl=new K.InfoWindow({map:U.map,lat:U.lat,lng:U.lng,content:U.content,pixelOffset:[0+V[0],-15+V[1]],disableAutoPan:true})}};B.tmpl=function(X){var W=X.name,ab=!!X.isTransfer,U=X.lines,V=$('<div class="m-popHover _j_map_overlay _j_station_mini_info_window" data-cs-p="车站map气泡" data-cs-d="车站map气泡"><a class="title" href="javascript:;">'+W+(ab?'<i class="i-transfer"></i>':"")+'</a><span class="icon-arr"><i></i></span></div>');if(!!U&&U.length>0){var aa=$('<div class="transfer-metro">').insertBefore(V.find(".icon-arr"));for(var Y=0;Y<U.length;Y++){aa.append("<span>"+U[Y]+"</span>")}}var Z=$("<div>").html(V);return Z.html()};K.util.extend(B,D);var F=K.OverlayView.implement({initialize:function(U){this.type="infoWindow";this.content=U.content;this.offset=U.offset||[0,0]},createNode:function(){this.$node=$(this.content)},renderNode:function(U){this.position={x:U.x-this.$node.width()/2+this.offset[0],y:U.y-this.$node.height()-20+this.offset[1]}},destoryNode:function(){this.$node.remove()}});var g=o.AirportMarker=function(U){g.__super__.constructor.call(this,U);this.id=U.id;this.biggerLightOrigin=[25,150];this.smallerLightOrigin=[50,150];this.biggerNormalOrigin=[0,150];this.smallerNormalOrigin=[50,150];if(this.isSupportOverlayView){this._impl=new l(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon6.png",size:this.isBigger?[20,30]:[7,7],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?[10,30]:[4,4]})}};K.util.extend(g,J);var l=K.OverlayView.implement({initialize:function(U){this.id=U.id;this.isFocus=false;this.isBigger=U.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-airport '+(this.isBigger?"on":"")+' _j_map_overlay _j_airport_marker"><span class="m-icon clickstat" data-cs-p="机场map标记" data-cs-d="机场map标记"></span></div>')},renderNode:function(U){if(this.isFocus||this.isBigger){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()}}else{this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var i=o.RailwayStationMarker=function(U){i.__super__.constructor.call(this,U);this.id=U.id;this.biggerLightOrigin=[25,120];this.smallerLightOrigin=[50,120];this.biggerNormalOrigin=[0,120];this.smallerNormalOrigin=[50,120];if(this.isSupportOverlayView){this._impl=new P(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon6.png",size:this.isBigger?[20,30]:[7,7],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?[10,30]:[4,4]})}};K.util.extend(i,J);var P=K.OverlayView.implement({initialize:function(U){this.id=U.id;this.isFocus=false;this.isBigger=U.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-train '+(this.isBigger?"on":"")+' _j_map_overlay _j_railwaystation_marker"><span class="m-icon clickstat" data-cs-p="火车站map标记" data-cs-d="火车站map标记"></span></div>')},renderNode:function(U){if(this.isFocus||this.isBigger){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()}}else{this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var C=o.ScenicMarker=function(U){C.__super__.constructor.call(this,U);this.id=U.id;this.biggerLightOrigin=[25,0];this.smallerLightOrigin=[50,0];this.biggerNormalOrigin=[0,0];this.smallerNormalOrigin=[50,0];if(this.isSupportOverlayView){this._impl=new s(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon6.png",size:this.isBigger?[20,30]:[7,7],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?[10,30]:[4,4]})}};K.util.extend(C,J);var s=K.OverlayView.implement({initialize:function(U){this.id=U.id;this.isFocus=false;this.isBigger=U.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-scenic '+(this.isBigger?"on":"")+' _j_map_overlay _j_scenic_marker"><span class="m-icon clickstat" data-cs-p="景点map标记" data-cs-d="景点map标记"></span></div>')},renderNode:function(U){if(this.isFocus||this.isBigger){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()+3}}else{this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var k=o.FoodMarker=function(U){k.__super__.constructor.call(this,U);this.id=U.id;this.biggerLightOrigin=[25,60];this.smallerLightOrigin=[50,60];this.biggerNormalOrigin=[0,60];this.smallerNormalOrigin=[50,60];if(this.isSupportOverlayView){this._impl=new R(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon6.png",size:this.isBigger?[20,30]:[7,7],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?[10,30]:[4,4]})}};K.util.extend(k,J);var R=K.OverlayView.implement({initialize:function(U){this.id=U.id;this.isFocus=false;this.isBigger=U.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-food '+(this.isBigger?"on":"")+' _j_map_overlay _j_food_marker"><span class="m-icon clickstat"></span></div>')},renderNode:function(U){if(this.isFocus||this.isBigger){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()+3}}else{this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var t=o.ShoppingMarker=function(U){t.__super__.constructor.call(this,U);this.id=U.id;this.biggerLightOrigin=[25,30];this.smallerLightOrigin=[50,30];this.biggerNormalOrigin=[0,30];this.smallerNormalOrigin=[50,30];if(this.isSupportOverlayView){this._impl=new O(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon6.png",size:this.isBigger?[20,30]:[7,7],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?[10,30]:[4,4]})}};K.util.extend(t,J);var O=K.OverlayView.implement({initialize:function(U){this.id=U.id;this.isFocus=false;this.isBigger=U.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-shopping '+(this.isBigger?"on":"")+' _j_map_overlay _j_shopping_marker"><span class="m-icon clickstat"></span></div>')},renderNode:function(U){if(this.isFocus||this.isBigger){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()+3}}else{this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var n=o.MddMarker=function(U){n.__super__.constructor.call(this,U);this.id=U.id;if(this.isSupportOverlayView){this._impl=new c(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,icon:{url:"http://css.mafengwo.net/images/maps-nearbyHotel.png",size:[40,42],origin:[0,90]}})}};K.util.extend(n,D);var c=K.OverlayView.implement({initialize:function(U){this.id=U.id},createNode:function(){this.$node=$('<div class="m-mapNearby _j_map_overlay _j_mdd_marker"><div class="micon-nearby clickstat" data-cs-p="目的地map标记" data-cs-d="目的地map标记"></div></div>')},renderNode:function(U){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()}},destoryNode:function(){this.$node.remove()}});var q=o.MddMiniInfoWindow=function(U){q.__super__.constructor.call(this,U);this.id=U.id;U.content=q.tmpl(U);if(this.isSupportOverlayView){this._impl=new j(U)}else{this._impl=new K.InfoWindow({map:U.map,lat:U.lat,lng:U.lng,content:U.content,pixelOffset:[0,-15],disableAutoPan:true})}};q.tmpl=function(Y){var ab=Y.id,X=Y.cname,aa=Y.numHotel,W=Y.defaultImg,V=Y.img||Y.defaultImg,U=$('<div class="_j_map_overlay _j_mdd_mini_info_window" style="position:relative;" data-cs-p="目的地map气泡" data-cs-d="目的地map气泡"><div class="mpop-nearby"><a href="/hotel/list_map.php?mddid='+ab+'"><span class="image"><img src="'+W+'" data-image="'+V+'" height="65" width="95"></span><h3 class="overflow_ellipsis">'+X+'</h3><p class="overflow_ellipsis">本区域有<em>'+aa+"</em>家酒店</p></a></div></div>");var Z=$("<div>").html(U);return Z.html()};K.util.extend(q,D);q.prototype.getId=function(U){return this.id};var j=K.OverlayView.implement({initialize:function(U){this.type="infoWindow";this.content=U.content},createNode:function(){this.$node=$(this.content)},renderNode:function(W){this.position={x:W.x-this.$node.width()/2-20,y:W.y-this.$node.height()+15};var V=this.$node.find(".image img"),U=V.data("image");if(!!U){$("<img>").bind("load",function(X){V.attr("src",U)}).attr("src",U)}},destoryNode:function(){this.$node.remove()}});var z=o.AreaInfoWindow=function(U){z.__super__.constructor.call(this,U);U.content=z.tmpl(U);if(this.isSupportOverlayView){this._impl=new S(U)}else{this._impl=new K.InfoWindow({map:U.map,lat:U.lat,lng:U.lng,content:U.content,disableAutoPan:true})}};z.tmpl=function(W){var V=W.name;if(W.isComplex){var Y=Number(W.orderPercent),U=$('<div class="info-window-area _j_map_overlay _j_area_info_window"></div>');U.append("<strong>"+V+"</strong>");if(Y>0){U.append("<span><em>"+Y+"%</em>的人住在这里</span>");if(Y>20){U.append('<i class="i-hot"></i>')}}}else{U=$('<div class="m-area-info-window _j_map_overlay _j_area_info_window">'+V+"</div>")}var X=$("<div>").html(U);return X.html()};K.util.extend(z,D);var S=K.OverlayView.implement({initialize:function(U){this.type="infoWindow";this.content=U.content},createNode:function(){this.$node=$(this.content)},renderNode:function(U){this.position={x:U.x-this.$node.width()/2,y:U.y};this.$node.css("cursor","default")},destoryNode:function(){this.$node.remove()}});var G=o.MddRoutePoiMarker=function(U){G.__super__.constructor.call(this,U);this.id=U.id;this.biggerLightOrigin=[1,314];this.smallerLightOrigin=[1,314];this.biggerNormalOrigin=[1,314];this.smallerNormalOrigin=[1,314];if(this.isSupportOverlayView){this._impl=new x(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon6.png",size:this.isBigger?[12,12]:[12,12],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?[6,6]:[6,6]})}};K.util.extend(G,J);var x=K.OverlayView.implement({initialize:function(U){this.id=U.id;this.isFocus=false;this.isBigger=U.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-route _j_map_overlay _j_mdd_route_poi_marker"><span class="m-icon clickstat"></span></div>')},renderNode:function(U){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()/2}},destoryNode:function(){this.$node.remove()}});var Q=o.CustomMarker=function(U){Q.__super__.constructor.call(this,U);this.id=U.id;this.biggerLightOrigin=[25,0];this.smallerLightOrigin=[50,0];this.biggerNormalOrigin=[0,0];this.smallerNormalOrigin=[50,0];if(this.isSupportOverlayView){this._impl=new b(U)}else{this._impl=new K.Marker({map:U.map,lat:U.lat,lng:U.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon6.png",size:this.isBigger?[20,30]:[7,7],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},content:U.content,offset:U.offset||[0,0]})}};K.util.extend(Q,J);var b=K.OverlayView.implement({initialize:function(U){this.id=U.id;this.isFocus=false;this.isBigger=U.isBigger||false;this.content=U.content||'<div class="map-mark mark-scenic _j_map_overlay _j_scenic_marker"><span class="m-icon clickstat" data-cs-p="景点map标记" data-cs-d="景点map标记"></span></div>'},createNode:function(){this.$node=$(this.content)},renderNode:function(U){this.position={x:U.x-this.$node.width()/2,y:U.y-this.$node.height()}},destoryNode:function(){this.$node.remove()}});Q.prototype.getFocus=function(U){this.isFocus=true;if(this.isSupportOverlayView){this._impl._inst.isFocus=true;this._impl._inst.$node.addClass(U)}};Q.prototype.getBlur=function(U){this.isFocus=false;if(this.isSupportOverlayView){this._impl._inst.isFocus=false;this._impl._inst.$node.removeClass(U)}else{}};var y=o.CustomMiniInfoWindow=function(U){y.__super__.constructor.call(this,U);U.content=y.tmpl(U);if(this.isSupportOverlayView){this._impl=new w(U)}else{var V=U.offset||[0,0];this._impl=new K.InfoWindow({map:U.map,lat:U.lat,lng:U.lng,content:U.content,pixelOffset:[-V[0],-V[1]],disableAutoPan:typeof(U.disableAutoPan)==="undefined"?true:U.disableAutoPan})}};y.tmpl=function(V){var W=V.content,U=$(W);var X=$("<div>").html(U);return X.html()};K.util.extend(y,D);var w=K.OverlayView.implement({initialize:function(U){this.type="infoWindow";this.content=U.content;this.offset=U.offset||[0,0]},createNode:function(){this.$node=$(this.content)},renderNode:function(U){this.position={x:U.x-this.$node.outerWidth()/2-this.offset[0],y:U.y-this.$node.outerHeight()-this.offset[1]}},destoryNode:function(){this.$node.remove()}});return o}));(function(b,a){if(!!b.M&&!!b.M.define){M.define("/js/hotel/mfwmap/mfwmap-widgets",function(d,c,e){var g=d("/js/hotel/mfwmap/mfwmap"),f=d("/js/hotel/mfwmap/mfwmap-overlays");e.exports=a(b,g,f)})}else{b.mfwmap=a(b,b.mfwmap,b.mfwmap.overlays)}}(window,function(d,f,e){var c={};var b=$.Deferred();var g=c.HotelInfoMap=function(h){this.data={hotel:h.hotel,scenic:[],traffic:[]};this.map=null;this.overlays={miniInfoWindow:null,poiMarkers:{}};if("pending"===b.state()){d.M.fetchCSSJS(["/css/mdd/map-mark.v2.css"],function(){b.resolve()})}var i=$.Deferred();$.ajax({url:"/hotel/ajax.php",data:{sAction:"getNearbyPois",iPoiId:this.data.hotel.id},dataType:"json"}).done(M.bind(function(k){if(!!k.scenic&&k.scenic.length>0){this.data.scenic=k.scenic}if(!!k.traffic&&k.traffic.length>0){this.data.traffic=k.traffic}i.resolve()},this));var j=f.createMap({element:h.mapContainer,lat:h.hotel.lat,lng:h.hotel.lng,zoom:14,runtimes:Env.isCnmain===21536?["amap","google","leaflet"]:["google","leaflet"],leafletTileType:h.countryMddid===10183?"arcgis":"mfw",scrollwheel:false,channelType:h.channelType,pageType:h.pageType});j.then(M.bind(function(k){this.map=k},this));$.when(i,j).then(M.bind(function(){var t=this.data.hotel,u=this.data.scenic,q=this.data.traffic,m=this.map,l=this.overlays,s=l.miniInfoWindow,o=l.poiMarkers;if(h.isCnmain&&f.isWGS84(m.mapType)){var r=f.util.gcj2wgs(t.lat,t.lng);t.lat=r.lat;t.lng=r.lng;m.panTo(t.lat,t.lng);for(var v=0;v<u.length;v++){var p=u[v],r=f.util.gcj2wgs(p.lat,p.lng);p.lat=r.lat;p.lng=r.lng}for(var v=0;v<q.length;v++){var p=q[v],r=f.util.gcj2wgs(p.lat,p.lng);p.lat=r.lat;p.lng=r.lng}}var k=new f.LatLngBounds({map:m});var w=l.hotelMarker=new e.HotelMarker({map:m,lat:t.lat,lng:t.lng,id:t.id,isBigger:true});w.getFocus();w.addListener("mouseover",function(){s=new e.HotelMiniInfoWindow({map:m,lat:t.lat,lng:t.lng,name:t.name,offset:[0,-25]})});w.addListener("mouseout",function(){s.remove()});k.extend(t.lat,t.lng);for(var v=0;v<u.length;v++){var p=u[v];var n=new e.ScenicMarker({map:m,lat:p.lat,lng:p.lng,id:p.id,isBigger:true});(function(y,z){M.Event(y).on("focus",function(){m.panTo(z.lat,z.lng)});M.Event(y).on("highlight",function(){y.getHighlight();s=new e.PoiMiniInfoWindow({map:m,lat:z.lat,lng:z.lng,name:z.name,offset:[0,-25]})});M.Event(y).on("normallight",function(){y.getNormallight();s.remove()});y.addListener("mouseover",function(){M.Event(y).fire("highlight")});y.addListener("mouseout",function(){M.Event(y).fire("normallight")})})(n,p);o[p.id]=n;k.extend(p.lat,p.lng)}for(var v=0;v<q.length;v++){var p=q[v];var x=new e.StationMarker({map:m,lat:p.lat,lng:p.lng,id:p.id,isBigger:true});(function(y,z){M.Event(y).on("focus",function(){m.panTo(z.lat,z.lng)});M.Event(y).on("highlight",function(){y.getHighlight();s=new e.PoiMiniInfoWindow({map:m,lat:z.lat,lng:z.lng,name:z.name,offset:[0,-25]})});M.Event(y).on("normallight",function(){y.getNormallight();s.remove()});y.addListener("mouseover",function(){M.Event(y).fire("highlight")});y.addListener("mouseout",function(){M.Event(y).fire("normallight")})})(x,p);o[p.id]=x;k.extend(p.lat,p.lng)}if(u.length>0||q.length>0){m.fitBounds(k)}},this));this.initPromise=$.when(b,i,j)};var a=c.PoiInfoMap=function(h){this.data={centerPoi:h.centerPoi,pois:{}};this.map=null;this.overlays={miniInfoWindow:null,poiMarkers:{}};this.isCnmain=false;if("pending"===b.state()){d.M.fetchCSSJS(["/css/mdd/map-mark.v2.css"],function(){console.log("poi info map css resolved");b.resolve()})}var i=f.createMap({element:h.mapContainer,lat:h.centerPoi.lat,lng:h.centerPoi.lng,zoom:14,runtimes:h.isCnmain?["amap","google","leaflet"]:["google","leaflet"],leafletTileType:h.countryMddid===10183?"arcgis":"mfw",scrollwheel:false,channelType:h.channelType,pageType:h.pageType});i.then(M.bind(function(k){console.log("poi info map js resolved");this.map=k;var j=this.createPoiMarker(this.data.centerPoi);j&&j.getFocus()},this));this.initPromise=$.when(b,i);this.bindEvents()};a.prototype.bindEvents=function(){M.Event(this).on("focus poi",M.bind(function(i){var j=this.data.pois[i.id],h=this.overlays.poiMarkers[i.id];if(j&&h){h.getFocus();this.createMiniInfoWindow(j)}},this));M.Event(this).on("blur poi",M.bind(function(i){var j=this.data.pois[i.id],h=this.overlays.poiMarkers[i.id];if(j&&h){h.getBlur();this.removeMiniInfoWindow(j)}},this));M.Event(this).on("pan to poi",M.bind(function(i){var j=this.data.pois[i.id],h=this.overlays.poiMarkers[i.id];if(j){this.map.panTo(j.lat,j.lng)}},this))};a.prototype.addPoi=function(i){if(!i||!i.id||!i.name||!i.type||!M.is(i.lat,"Number")||!M.is(i.lng,"Number")){return false}if(this.isCnmain&&f.isWGS84(this.map.mapType)){var h=f.util.gcj2wgs(i.lat,i.lng);i.lat=h.lat;i.lng=h.lng}this.data.pois[i.id]=i;this.createPoiMarker(i)};a.prototype.createPoiMarker=function(i){var h;switch(i.type){case 1:h=new e.FoodMarker({map:this.map,lat:i.lat,lng:i.lng,id:i.id,isBigger:true});break;case 2:h=new e.HotelMarker({map:this.map,lat:i.lat,lng:i.lng,id:i.id,isBigger:true});break;case 3:h=new e.ScenicMarker({map:this.map,lat:i.lat,lng:i.lng,id:i.id,isBigger:true});break;case 4:h=new e.ShoppingMarker({map:this.map,lat:i.lat,lng:i.lng,id:i.id,isBigger:true});break;case 6:if(i.tags&&$.inArray(11440,i.tags)!=-1){h=new e.AirportMarker({map:this.map,lat:i.lat,lng:i.lng,id:i.id,isBigger:true})}else{if(i.tags&&$.inArray(11441,i.tags)!=-1){h=new e.RailwayStationMarker({map:this.map,lat:i.lat,lng:i.lng,id:i.id,isBigger:true})}else{if(i.tags&&$.inArray(13653,i.tags)!=-1){h=new e.StationMarker({map:this.map,lat:i.lat,lng:i.lng,id:i.id,isBigger:true})}}}break;default:return false}if(h){(M.bind(function(j,k){j.addListener("mouseover",M.bind(function(){j.getHighlight();this.createMiniInfoWindow(k)},this));j.addListener("mouseout",M.bind(function(){j.getNormallight();this.removeMiniInfoWindow()},this))},this))(h,i);this.overlays.poiMarkers[i.id]=h}return h};a.prototype.createMiniInfoWindow=function(h){this.overlays.miniInfoWindow&&this.overlays.miniInfoWindow.remove();this.overlays.miniInfoWindow=new e.PoiMiniInfoWindow({map:this.map,lat:h.lat,lng:h.lng,name:h.name,offset:[0,-25]})};a.prototype.removeMiniInfoWindow=function(){this.overlays.miniInfoWindow&&this.overlays.miniInfoWindow.remove()};return c}));M.define("/js/poi/ControllerPoiLocation",function(b){var c=b("/js/hotel/mfwmap/mfwmap-widgets"),d,a=["未定义","美食","住宿","景点","购物","娱乐","交通","商户"];return{init:function(){var e=this;d=new c.PoiInfoMap({mapContainer:e.container.find(".maps")[0],countryMddid:e.data.poi.country_mddid,isCnmain:e.data.poi.is_cnmain,channelType:"poi",pageType:a[e.data.poi.type],centerPoi:{id:e.data.poi.id,name:e.data.poi.name,type:e.data.poi.type,lat:e.data.poi.lat,lng:e.data.poi.lng}});d.initPromise.then(M.bind(function(){$.each(e.container.find(".m-poi li"),function(f,g){g=$(g);d.addPoi({id:+g.data("id"),name:g.data("name"),type:+g.data("type"),lat:+g.data("lat"),lng:+g.data("lng"),tags:g.data("traffictag")?[+g.data("traffictag")]:undefined})});e.container.on("mouseenter",".m-poi li a",function(f){var g=$(this).closest("li").data("id");M.Event(d).fire("pan to poi",{id:g});M.Event(d).fire("focus poi",{id:g})}).on("mouseleave",".m-poi li a",function(f){M.Event(d).fire("blur poi",{id:$(this).closest("li").data("id")})})},this))}}});M.define("/js/poi/ControllerPoiSubPoi",function(){var a,b;return{events:{"click,.btn-subpoi":"getMore",},init:function(){a=this.container;b=a.find(".mod-innerScenic ul")},getMore:function(){var c=this.container.find(".btn-subpoi").attr("data-page");this.setSyncParams({page:parseInt(c)+1},true)},syncHtml:function(c){b.append(c)},syncData:function(c){M.mix(this.data,c);this.container.find(".more-subpoi a").attr("data-page",c.curPage);if(!c.hasMore){this.container.find(".more-subpoi").hide()}}}});(function(a){a.fn.mfwUseful=function(b){var c=a.extend({},b);return this.each(function(){var e=a(this),f=e.find(".useful-btn"),d=e.find(".useful-num");e.click(function(){var g={act:"CommentVote",comment_id:e.data("id"),poi_id:window.Env.poiid};a.post("/gonglve/ajax.php",g,function(h){if(h.ret=="1"){e.UpNum("+1",function(){var i=d.text()==""?0:d.text()*1;d.text(i+1).css("color","red")});typeof c.success=="function"&&c.success.apply(e,[])}else{if(h.ret=="21"){show_login()}else{if(h.ret=="23"){alert("一条点评只能投票一次哦")}else{alert(h.msg)}}}},"json")})})}})(jQuery);if(window.M&&typeof window.M.define=="function"){window.M.define("/js/jquery.mfwUseful",function(){return jQuery})}(function(a){a.fn.mfwCommentReply=function(b){var c=a.extend({min_height:20,max_height:70,tmpl:a("#comment_tmpl")},b);return this.each(function(){var n=a(this),m=false,e=n.find(".show_reply"),h=n.find(".comment_reply"),i=n.find(".submit_reply"),j=n.find(".btn_submit_reply"),l=n.find(".comment_more"),k=n.find(".ar-bd"),f=n.find(".more_reply_box");h.css({overflow:"hidden",color:"#CCC"});function g(){if(!h.is(":animated")&&h.val()==""&&m==false){h.animate({height:c.min_height},"fast","linear",function(){h.css({color:"#CCC",overflow:"hidden"}).removeClass("focus")});i.hide()}}function d(){if(!h.is(":animated")&&!h.hasClass("focus")){h.animate({height:c.max_height},{duration:"fast",complete:function(){h.addClass("focus").val("").css({overflow:"",color:"#000"})}});i.show()}}n.delegate(".comment_reply","focus",function(){d()}).delegate(".comment_reply","blur",function(){g()}).delegate(".re_reply","click",function(p){var o=a(p.srcElement||p.target);h.data("parent_id",o.data("id"));h.data("parent_username",o.data("username"));h.data("parent_uid",o.data("uid"));h.get(0).focus()}).delegate(".re_reply","mouseenter",function(){m=true}).delegate(".re_reply","mouseleave",function(){m=false}).delegate(".btn_submit_reply","mouseenter",function(){m=true}).delegate(".btn_submit_reply","mouseleave",function(){m=false}).delegate(".btn_submit_reply","click",function(){var o={act:"CommentReply",poi_id:window.Env.poiid,content:h.val(),comment_id:h.data("comment_id"),parent_id:h.data("parent_id"),parent_uid:h.data("parent_uid"),parent_username:h.data("parent_username")};if(o.content==""){alert("回复内容不能为空");return false}i.hide();j.after('<img style="float:right" src="http://file.mafengwo.net/images/loading.gif">');a.post("/gonglve/ajax.php",o,function(p){if(p.ret=="21"){M.Event.fire("login:required")}else{if(p.ret==1){var t=p.html;var s=new Date();var r=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+s.getHours()+":"+s.getMinutes();h.val("");m=false;g();var q={comment_id:o.comment_id,reply_id:t,reply_uid:window.Env.UID,reply_name:window.Env.uname,reply_user_logo:window.Env.ulogo,to_name:o.parent_username,to_uid:o.parent_uid,content:o.content,ctime:r};a(c.tmpl).tmpl(q).appendTo(f)}else{alert(p.msg);j.show()}}j.next("img").remove()},"json")}).delegate(".show_reply","click",function(){if(k.is(":visible")){var o=k.find(".reply_item").size();if(o>0){e.text("回复("+o+")")}else{e.text("回复")}k.hide()}else{a(e).text("收起回复");k.show()}}).delegate(".more_reply","click",function(){l.hide().next().children("li").show()})})}})(jQuery);if(window.M&&typeof window.M.define=="function"){window.M.define("/js/jquery.mfwCommentReply",function(){return jQuery})}M.define("/js/poi/ControllerPoiComment",function(e){e("/js/jquery.mfwUseful");e("/js/jquery.mfwCommentReply");var b,d,c,a=1,i,g,f,h=$("#poi-navbar");return{events:{"click,.review-nav li":"commentFilter","click,._j_comment":"comment","click,._j_reply":"commentReply","click,._j_editcomment":"commentEdit","click,._j_morereply":"showMoreReply","blur,.comment_reply":"replyFormFade"},init:function(){var j=this;i=j.container;g=i.find("._j_commentlist");f=i.find(".reply_tmpl");M.Event.on("comment published",function(){i.find(".review-nav li:first").click()});M.Event(j).on("content sync success",function(){j.bindReplyAndUseful();j.renderPageBar()});M.Event(j).fire("content sync success")},get_comments:function(){var j=i.offset().top;if(h.length&&h.is(".fixed")){j-=h.height()}i.find(".loading-img").show();$("html,body").stop().animate({scrollTop:j},500);this.setSyncParams({type:b,order:d,category:c,page:a,just_comment:1},true)},commentFilter:function(l){var j=$(l.currentTarget),k=j.data();b=k.type;c=k.category;j.addClass("on").siblings().removeClass("on");this.get_comments(a=1)},syncHtml:function(j){i.find(".loading-img").hide();g.html(j);if(g.find(".comment-item").length){i.find(">.review-nav").show()}},bindReplyAndUseful:function(){g.find(".add-reply").mfwCommentReply({tmpl:f});g.find(".useful").mfwUseful({success:function(){$(this).addClass("on")}})},showMoreReply:function(j){$(j.currentTarget).hide().siblings().removeClass("hide")},renderPageBar:function(){var j=this;i.find(".m-pagination a[data-page]").on("click",function(){j.get_comments(a=+$(this).data("page"))})},comment:function(j){var k=$(j.currentTarget).closest(".comment-item").find(">.add-reply").show().find(".reply-form").show().find(".comment_reply");k.data({parent_id:"",parent_username:"",parent_uid:""});if(k.data("last-parent_id")!=k.data("parent_id")){k.val("")}k.attr("placeholder","发表评论：").select()},commentReply:function(k){var j=$(k.currentTarget),l=j.closest(".comment-item").find(">.add-reply").show().find(".reply-form").show().find(".comment_reply");if(l.data("last-parent_id")!=l.data("parent_id")){l.val("")}l.attr("placeholder","回复"+j.data("username")+"：").select()},replyFormFade:function(k){var j=$(k.currentTarget).closest(".add-reply"),l=j.find(".comment_reply");j.find(".reply-form").fadeOut(function(){!j.find(">ul li").length&&j.hide()});l.data("last-parent_id",l.data("parent_id"))},commentEdit:function(j){M.Event.fire("comment editComment",this.data.poi_id)}}});M.define("/js/poi/ControllerPoiSales",function(a){return{init:function(){if(!this.container.is(":empty")){$('<li data-scroll="recommend"><a title="热门推荐">热门推荐</a></li>').insertAfter($('[data-scroll="commentlist"]'))}}}});(function(b,a){if(!!b.M){M.define("/js/hotel/mfwmap/mfwmap-overlays-v2",function(e,d,f){var c=e("/js/hotel/mfwmap/mfwmap");f.exports=a(b,c)})}else{b.mfwmap.overlays=a(b,b.mfwmap)}}(window,function(a,H){var n={},d={mouseover:"mouseenter",mouseout:"mouseleave"};var A=function(Q){this.isSupportOverlayView=H.isSupportOverlayView(Q.map.mapType);this._impl=null};A.prototype.remove=function(){this._impl.remove()};A.prototype.addListener=function(S){if(this.isSupportOverlayView){var Q=this._impl._inst.$node,R=[];if(S in d){S=d[S]}R.push(S);R=R.concat(Array.prototype.slice.call(arguments,1));Q.on.apply(Q,R)}else{if(arguments.length===2){this._impl.addListener.apply(this._impl,arguments)}}};var G=function(Q){G.__super__.constructor.call(this,Q);this.id=null;this.isFocus=false;this.isBigger=Q.isBigger||false;this.biggerSize=[20,30];this.smallerSize=[15,15];this.biggerOffset=[10,30];this.smallerOffset=[8,8];this.biggerLightOrigin=null;this.smallerLightOrigin=null;this.biggerNormalOrigin=null;this.smallerNormalOrigin=null};H.util.extend(G,A);G.prototype.getId=function(){return this.id};G.prototype.show=function(){if(this.isSupportOverlayView){this._impl._inst.$node.show()}else{this._impl.show()}};G.prototype.hide=function(){if(this.isSupportOverlayView){this._impl._inst.$node.hide()}else{this._impl.hide()}};G.prototype.getFocus=function(){this.isFocus=true;if(this.isSupportOverlayView){this._impl._inst.isFocus=true;this._impl._inst.$node.addClass("on").addClass("focus").css("z-index",50);this._impl.reset()}else{this._impl.setIcon({origin:this.biggerLightOrigin,size:this.biggerSize});this._impl.setOffset(this.biggerOffset[0],this.biggerOffset[1]);this._impl.setZIndex(50)}};G.prototype.getBlur=function(){this.isFocus=false;if(this.isSupportOverlayView){this._impl._inst.isFocus=false;this._impl._inst.$node.removeClass("focus").css("z-index",40);if(!this._impl._inst.isBigger){this._impl._inst.$node.removeClass("on").css("z-index",0)}this._impl.reset()}else{if(this.isBigger){this._impl.setIcon({origin:this.biggerNormalOrigin,size:this.biggerSize});this._impl.setOffset(this.biggerOffset[0],this.biggerOffset[1])}else{this._impl.setIcon({origin:this.smallerNormalOrigin,size:this.smallerSize});this._impl.setOffset(this.smallerOffset[0],this.smallerOffset[1])}this._impl.setZIndex(0)}};G.prototype.getBigger=function(){this.isBigger=true;if(this.isSupportOverlayView){this._impl._inst.isBigger=true;this._impl._inst.$node.addClass("on").css("z-index",40);this._impl.reset()}else{this._impl.setIcon({origin:this.biggerNormalOrigin,size:this.biggerSize});this._impl.setOffset(this.biggerOffset[0],this.biggerOffset[1]);this._impl.setZIndex(40)}};G.prototype.getSmaller=function(){this.isBigger=false;if(this.isSupportOverlayView){this._impl._inst.isBigger=false;this._impl._inst.$node.removeClass("on").css("z-index",0);this._impl.reset()}else{this._impl.setIcon({origin:this.smallerNormalOrigin,size:this.smallerSize});this._impl.setOffset(this.smallerOffset[0],this.smallerOffset[1]);this._impl.setZIndex(0)}};G.prototype.getHighlight=function(){if(!this.isSupportOverlayView){if(this.isBigger){this._impl.setIcon({origin:this.biggerLightOrigin})}else{this._impl.setIcon({origin:this.smallerLightOrigin})}}};G.prototype.getNormallight=function(){if(!this.isSupportOverlayView&&!this.isFocus){if(this.isBigger){this._impl.setIcon({origin:this.biggerNormalOrigin})}else{this._impl.setIcon({origin:this.smallerNormalOrigin})}}};var o=n.PoiMiniInfoWindow=function(Q){o.__super__.constructor.call(this,Q);Q.content=o.tmpl(Q);if(this.isSupportOverlayView){this._impl=new x(Q)}else{var R=Q.offset||[0,0];this._impl=new H.InfoWindow({map:Q.map,lat:Q.lat,lng:Q.lng,content:Q.content,pixelOffset:[0+R[0],-15+R[1]],disableAutoPan:true})}};o.tmpl=function(S){var R=S.name,Q=$('<div class="m-popHover _j_map_overlay _j_poi_mini_info_window"><a class="title" href="javascript:;">'+R+'</a><span class="icon-arr"><i></i></span></div>');var T=$("<div>").html(Q);return T.html()};H.util.extend(o,A);var x=H.OverlayView.implement({initialize:function(Q){this.type="infoWindow";this.content=Q.content;this.offset=Q.offset||[0,0]},createNode:function(){this.$node=$(this.content)},renderNode:function(Q){this.position={x:Q.x-this.$node.width()/2+this.offset[0],y:Q.y-this.$node.height()-20+this.offset[1]}},destoryNode:function(){this.$node.remove()}});var t=n.PoiBlackMiniInfoWindow=function(Q){t.__super__.constructor.call(this,Q);Q.content=t.tmpl(Q);if(this.isSupportOverlayView){this._impl=new c(Q)}else{var R=Q.offset||[0,0];this._impl=new H.InfoWindow({map:Q.map,lat:Q.lat,lng:Q.lng,content:Q.content,pixelOffset:[0+R[0],-15+R[1]],disableAutoPan:true})}};t.tmpl=function(R){var S=R.content,Q=$('<div class="m-pop-poi-black _j_map_overlay _j_poi_black_mini_info_window"><a href="javascript:;">'+S+"</a><i></i></div>");var T=$("<div>").html(Q);return T.html()};H.util.extend(t,A);var c=H.OverlayView.implement({initialize:function(Q){this.type="infoWindow";this.content=Q.content;this.offset=Q.offset||[0,0]},createNode:function(){this.$node=$(this.content)},renderNode:function(Q){this.position={x:Q.x-this.$node.width()/2+this.offset[0],y:Q.y-this.$node.height()-10+this.offset[1]}},destoryNode:function(){this.$node.remove()}});var u=n.HotelMarker=function(Q){u.__super__.constructor.call(this,Q);this.id=Q.id;this.isMiddle=Q.isMiddle||false;this.biggerLightOrigin=[25,90];this.smallerLightOrigin=[66,90];this.biggerNormalOrigin=[0,90];this.smallerNormalOrigin=[66,90];if(this.isSupportOverlayView){this._impl=new P(Q)}else{this._impl=new H.Marker({map:Q.map,lat:Q.lat,lng:Q.lng,title:Q.title,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon7.png",size:this.isBigger?this.biggerSize:this.smallerSize,origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?this.biggerOffset:this.smallerOffset})}};H.util.extend(u,G);u.prototype.getFocus=function(){this.isFocus=true;if(this.isSupportOverlayView){this._impl._inst.isFocus=true;if(this.isMiddle){this._impl._inst.$node.removeClass("mark-round16").addClass("mark-hotel").addClass("sdw").find(".m-icon").css("display","block")}this._impl._inst.$node.addClass("on").addClass("focus").css("z-index",50);this._impl.reset()}else{this._impl.setIcon({origin:this.biggerLightOrigin});this._impl.setZIndex(50)}};u.prototype.getBlur=function(){this.isFocus=false;if(this.isSupportOverlayView){this._impl._inst.isFocus=false;this._impl._inst.$node.removeClass("focus").css("z-index",40);if(!this._impl._inst.isBigger){this._impl._inst.$node.removeClass("on").css("z-index",0)}if(this._impl._inst.isMiddle){this._impl._inst.$node.removeClass("mark-hotel").removeClass("sdw").find(".m-icon").hide().end().addClass("mark-round16").css("z-index",40)}this._impl.reset()}else{if(this.isBigger){this._impl.setIcon({origin:this.biggerNormalOrigin})}else{this._impl.setIcon({origin:this.smallerNormalOrigin})}this._impl.setZIndex(0)}};u.prototype.getBigger=function(){this.isBigger=true;if(this.isSupportOverlayView){this._impl._inst.isBigger=true;if(this.isMiddle){this.isMiddle=false;this._impl._inst.isMiddle=false;this._impl._inst.$node.removeClass("mark-round16").addClass("mark-hotel").addClass("sdw").find(".m-icon").css("display","block")}this._impl._inst.$node.addClass("on").css("z-index",40);this._impl.reset()}else{this._impl.setIcon({origin:this.biggerNormalOrigin});this._impl.setZIndex(40)}};u.prototype.getSmaller=function(){this.isBigger=false;if(this.isSupportOverlayView){this._impl._inst.isBigger=false;if(this.isMiddle){this.isMiddle=false;this._impl._inst.isMiddle=false;this._impl._inst.$node.removeClass("mark-round16").addClass("mark-hotel").addClass("sdw").find(".m-icon").css("display","block")}this._impl._inst.$node.removeClass("on").css("z-index",0);this._impl.reset()}else{this._impl.setIcon({origin:this.smallerNormalOrigin});this._impl.setZIndex(0)}};u.prototype.getMiddle=function(){this.isBigger=false;this.isMiddle=true;if(this.isSupportOverlayView){this._impl._inst.isBigger=false;this._impl._inst.isMiddle=true;this._impl._inst.$node.removeClass("mark-hotel").removeClass("sdw").removeClass("on").css("z-index",0).find(".m-icon").hide().end().addClass("mark-round16").css("z-index",40);this._impl.reset()}};var P=H.OverlayView.implement({initialize:function(Q){this.id=Q.id;this.isFocus=false;this.isBigger=Q.isBigger||false;this.isMiddle=Q.isMiddle||false},createNode:function(){if(this.isMiddle){this.$node=$('<div class="map-mark mark-round16 _j_map_overlay _j_hotel_marker"><span class="m-icon clickstat" style="display:none;"></span></div>')}else{this.$node=$('<div class="map-mark mark-hotel sdw '+(this.isBigger?"on":"")+' _j_map_overlay _j_hotel_marker"><span class="m-icon clickstat"></span></div>')}},renderNode:function(Q){if(this.isFocus||this.isBigger){this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()+3}}else{this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var E=n.HotelPointMarker=function(Q){E.__super__.constructor.call(this,Q);this.id=Q.id;this.biggerNormalOrigin=[0,172];this.smallerNormalOrigin=[0,172];if(this.isSupportOverlayView){this._impl=new e(Q)}else{this._impl=new H.Marker({map:Q.map,lat:Q.lat,lng:Q.lng,title:Q.title,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon7.png",size:[26,26],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin}})}};H.util.extend(E,G);var e=H.OverlayView.implement({initialize:function(Q){this.id=Q.id},createNode:function(){this.$node=$('<div class="map-mark mark-hotel _j_map_overlay _j_hotel_marker"><span class="m-icon-point"></span></div>').css("z-index",35)},renderNode:function(Q){this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()}},destoryNode:function(){this.$node.remove()}});var q=n.HotelInfoWindow=function(Q){q.__super__.constructor.call(this,Q);this.id=Q.id;Q.content=q.tmpl(Q);if(this.isSupportOverlayView){this._impl=new I(Q)}else{var R=Q.offset||[0,0];this._impl=new H.InfoWindow({map:Q.map,lat:Q.lat,lng:Q.lng,content:Q.content,pixelOffset:[0+R[0],-15+R[1]],disableAutoPan:true})}};q.tmpl=function(R){var Z=R.id,Q=R.cname,ae=R.imgW160H125,ac=R.defaultImg,ai=R.star,Y=R.starStr,S=R.isBest,ag=R.bookingPreferred,U=R.numComment,V=R.numGinfo,aa=R.isAirbnb,T=R.airbnbInfo,ab=R.price,ak=R.bookingInfo,af=R.searchParam,X=R.dateParam,ah=$('<div class="m-pop _j_map_overlay _j_hotel_info_window"></div>');ah.append('<span class="close"><a class="btn-close" href="javascript:;"><i></i></a></span>').append('<div class="pop-desc"></div>').append('<span class="icon-arr"><i></i></span>');var W=$(".pop-desc",ah);W.append('<a class="image" href="/hotel/'+Z+".html"+(!!af?"?"+af:"")+(!!X?"#"+X:"")+'" target="_blank"><img src="'+ac+'" data-image="'+ae+'"></a>').append('<h3 class="overflow_ellipsis"><a href="/hotel/'+Z+".html"+(!!af?"?"+af:"")+(!!X?"#"+X:"")+'" target="_blank">'+Q+"</a></h3>");if(!aa){W.append('<p><a class="num-comment" href="/hotel/'+Z+".html"+(!!af?"?"+af:"")+"#anchor=comment"+(!!X?"&"+X:"")+'" target="_blank">蜂蜂评价<em>'+U+'</em></a><a class="num-post" href="/hotel/'+Z+".html"+(!!af?"?"+af:"")+"#anchor=comment"+(!!X?"&"+X:"")+'" target="_blank">游记<em>'+V+"</em></a></p>");var aj=$('<p class="hotel-icons">');aj.append('<span class="hotel-star">'+Y+"</span>");if(!!S){aj.append('<i class="icon-bird"></i>')}if(!!ag){aj.append('<i class="icon-hand"></i>')}W.append(aj)}if(aa){W.append('<p><a class="num-comment" href="/hotel/'+Z+".html"+(!!af?"?"+af:"")+"#anchor=comment"+(!!X?"&"+X:"")+'" target="_blank">airbnb评价<em>'+T.base.reviews_count+"</em></a></p>").append('<p class="p-airbnb"><span>'+T.base.room_type+"</span><span>"+T.base.person_capacity+"位房客</span></p>")}W.append('<hr><a class="hm-btn" href="/hotel/'+Z+".html"+(!!af?"?"+af:"")+(!!X?"#"+X:"")+'" target="_blank"'+(aa?'data-url="'+ak.airbnb.url+'"':"")+'>预订</a><span class="price">¥ <span>'+ab+"</span>");var ad=$("<div>").html(ah);return ad.html()};H.util.extend(q,A);q.prototype.getId=function(){return this.id};q.prototype.updatePrice=function(S){if(this.isSupportOverlayView){this._impl._inst.$node.find(".price span").html(S)}else{var R=this._impl.getContent(),Q=$(R);Q.find(".price span").html(S);var T=$("<div>").html(Q);this._impl.setContent(T.html())}};var I=H.OverlayView.implement({initialize:function(Q){this.type="infoWindow";this.content=Q.content},createNode:function(){this.$node=$(this.content)},renderNode:function(S){this.position={x:S.x-this.$node.width()/2,y:S.y-this.$node.height()-45};this.$node.css("zIndex",10);var R=this.$node.find(".image img"),Q=R.data("image");if(!!Q){$("<img>").bind("load",function(T){R.attr("src",Q)}).attr("src",Q)}},destoryNode:function(){this.$node.remove()}});var g=n.HotelMiniInfoWindow=function(Q){g.__super__.constructor.call(this,Q);this.id=Q.id;Q.content=g.tmpl(Q);if(this.isSupportOverlayView){this._impl=new F(Q)}else{var R=Q.offset||[0,0];this._impl=new H.InfoWindow({map:Q.map,lat:Q.lat,lng:Q.lng,content:Q.content,pixelOffset:[0+R[0],-15+R[1]],disableAutoPan:true})}};g.tmpl=function(S){var V=S.id,R=S.name,T=S.price,Q=$('<div class="m-popHover _j_map_overlay _j_hotel_mini_info_window"><a class="title" href="javascript:;">'+R+"</a>"+(!!T&&T>0?'<span class="price">￥<span>'+T+"</span></span>":"")+'<span class="icon-arr"><i></i></span></div>');var U=$("<div>").html(Q);return U.html()};H.util.extend(g,A);g.prototype.getId=function(Q){return this.id};g.prototype.updatePrice=function(S){if(this.isSupportOverlayView){this._impl._inst.$node.find(".price span").html(S)}else{var R=this._impl.getContent(),Q=$(R);Q.find(".price span").html(S);var T=$("<div>").html(Q);this._impl.setContent(T.html())}};var F=H.OverlayView.implement({initialize:function(Q){this.type="infoWindow";this.content=Q.content;this.offset=Q.offset||[0,0]},createNode:function(){this.$node=$(this.content)},renderNode:function(Q){this.position={x:Q.x-this.$node.width()/2+this.offset[0],y:Q.y-this.$node.height()-20+this.offset[1]}},destoryNode:function(){this.$node.remove()}});var l=n.StationMarker=function(Q){l.__super__.constructor.call(this,Q);this.id=Q.id;this.isHot=Q.isHot;this.biggerLightOrigin=[25,180];this.smallerLightOrigin=[66,180];this.biggerNormalOrigin=[0,180];this.smallerNormalOrigin=[66,180];if(this.isSupportOverlayView){this._impl=new B(Q)}else{this._impl=new H.Marker({map:Q.map,lat:Q.lat,lng:Q.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon7.png",size:this.isBigger?this.biggerSize:this.smallerSize,origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?this.biggerOffset:this.smallerOffset})}};H.util.extend(l,G);var B=H.OverlayView.implement({initialize:function(Q){this.id=Q.id;this.isHot=Q.isHot;this.isFocus=false;this.isBigger=Q.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-metro sdw '+(this.isBigger?"on":"")+' _j_map_overlay _j_station_marker"><span class="m-icon clickstat"></span></div>')},renderNode:function(Q){if(this.isFocus||this.isBigger){this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()+3}}else{this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var y=n.StationMiniInfoWindow=function(Q){y.__super__.constructor.call(this,Q);Q.content=y.tmpl(Q);if(this.isSupportOverlayView){this._impl=new C(Q)}else{var R=Q.offset||[0,0];this._impl=new H.InfoWindow({map:Q.map,lat:Q.lat,lng:Q.lng,content:Q.content,pixelOffset:[0+R[0],-15+R[1]],disableAutoPan:true})}};y.tmpl=function(T){var S=T.name,X=!!T.isTransfer,Q=T.lines,R=$('<div class="m-popHover _j_map_overlay _j_station_mini_info_window"><a class="title" href="javascript:;">'+S+(X?'<i class="i-transfer"></i>':"")+'</a><span class="icon-arr"><i></i></span></div>');if(!!Q&&Q.length>0){var W=$('<div class="transfer-metro">').insertBefore(R.find(".icon-arr"));for(var U=0;U<Q.length;U++){W.append("<span>"+Q[U]+"</span>")}}var V=$("<div>").html(R);return V.html()};H.util.extend(y,A);var C=H.OverlayView.implement({initialize:function(Q){this.type="infoWindow";this.content=Q.content;this.offset=Q.offset||[0,0]},createNode:function(){this.$node=$(this.content)},renderNode:function(Q){this.position={x:Q.x-this.$node.width()/2+this.offset[0],y:Q.y-this.$node.height()-20+this.offset[1]}},destoryNode:function(){this.$node.remove()}});var f=n.AirportMarker=function(Q){f.__super__.constructor.call(this,Q);this.id=Q.id;this.biggerLightOrigin=[25,150];this.smallerLightOrigin=[66,150];this.biggerNormalOrigin=[0,150];this.smallerNormalOrigin=[66,150];if(this.isSupportOverlayView){this._impl=new k(Q)}else{this._impl=new H.Marker({map:Q.map,lat:Q.lat,lng:Q.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon7.png",size:this.isBigger?this.biggerSize:this.smallerSize,origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?this.biggerOffset:this.smallerOffset})}};H.util.extend(f,G);var k=H.OverlayView.implement({initialize:function(Q){this.id=Q.id;this.isFocus=false;this.isBigger=Q.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-airport sdw '+(this.isBigger?"on":"")+' _j_map_overlay _j_airport_marker"><span class="m-icon clickstat"></span></div>')},renderNode:function(Q){if(this.isFocus||this.isBigger){this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()}}else{this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var h=n.RailwayStationMarker=function(Q){h.__super__.constructor.call(this,Q);this.id=Q.id;this.biggerLightOrigin=[25,120];this.smallerLightOrigin=[66,120];this.biggerNormalOrigin=[0,120];this.smallerNormalOrigin=[66,120];if(this.isSupportOverlayView){this._impl=new K(Q)}else{this._impl=new H.Marker({map:Q.map,lat:Q.lat,lng:Q.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon7.png",size:this.isBigger?this.biggerSize:this.smallerSize,origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?this.biggerOffset:this.smallerOffset})}};H.util.extend(h,G);var K=H.OverlayView.implement({initialize:function(Q){this.id=Q.id;this.isFocus=false;this.isBigger=Q.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-train sdw '+(this.isBigger?"on":"")+' _j_map_overlay _j_railwaystation_marker"><span class="m-icon clickstat"></span></div>')},renderNode:function(Q){if(this.isFocus||this.isBigger){this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()}}else{this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var z=n.ScenicMarker=function(Q){z.__super__.constructor.call(this,Q);this.id=Q.id;this.biggerLightOrigin=[25,0];this.smallerLightOrigin=[66,0];this.biggerNormalOrigin=[0,0];this.smallerNormalOrigin=[66,0];if(this.isSupportOverlayView){this._impl=new r(Q)}else{this._impl=new H.Marker({map:Q.map,lat:Q.lat,lng:Q.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon7.png",size:this.isBigger?this.biggerSize:this.smallerSize,origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?this.biggerOffset:this.smallerOffset})}};H.util.extend(z,G);var r=H.OverlayView.implement({initialize:function(Q){this.id=Q.id;this.isFocus=false;this.isBigger=Q.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-scenic sdw '+(this.isBigger?"on":"")+' _j_map_overlay _j_scenic_marker"><span class="m-icon clickstat"></span></div>')},renderNode:function(Q){if(this.isFocus||this.isBigger){this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()+3}}else{this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var j=n.FoodMarker=function(Q){j.__super__.constructor.call(this,Q);this.id=Q.id;this.biggerLightOrigin=[25,60];this.smallerLightOrigin=[66,60];this.biggerNormalOrigin=[0,60];this.smallerNormalOrigin=[66,60];if(this.isSupportOverlayView){this._impl=new N(Q)}else{this._impl=new H.Marker({map:Q.map,lat:Q.lat,lng:Q.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon7.png",size:this.isBigger?this.biggerSize:this.smallerSize,origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?this.biggerOffset:this.smallerOffset})}};H.util.extend(j,G);var N=H.OverlayView.implement({initialize:function(Q){this.id=Q.id;this.isFocus=false;this.isBigger=Q.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-food sdw '+(this.isBigger?"on":"")+' _j_map_overlay _j_food_marker"><span class="m-icon clickstat"></span></div>')},renderNode:function(Q){if(this.isFocus||this.isBigger){this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()+3}}else{this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var s=n.ShoppingMarker=function(Q){s.__super__.constructor.call(this,Q);this.id=Q.id;this.biggerLightOrigin=[25,30];this.smallerLightOrigin=[66,30];this.biggerNormalOrigin=[0,30];this.smallerNormalOrigin=[66,30];if(this.isSupportOverlayView){this._impl=new J(Q)}else{this._impl=new H.Marker({map:Q.map,lat:Q.lat,lng:Q.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon7.png",size:this.isBigger?this.biggerSize:this.smallerSize,origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?this.biggerOffset:this.smallerOffset})}};H.util.extend(s,G);var J=H.OverlayView.implement({initialize:function(Q){this.id=Q.id;this.isFocus=false;this.isBigger=Q.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-shopping sdw '+(this.isBigger?"on":"")+' _j_map_overlay _j_shopping_marker"><span class="m-icon clickstat"></span></div>')},renderNode:function(Q){if(this.isFocus||this.isBigger){this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()+3}}else{this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()/2}}},destoryNode:function(){this.$node.remove()}});var m=n.MddMarker=function(Q){m.__super__.constructor.call(this,Q);this.id=Q.id;if(this.isSupportOverlayView){this._impl=new b(Q)}else{this._impl=new H.Marker({map:Q.map,lat:Q.lat,lng:Q.lng,icon:{url:"http://css.mafengwo.net/images/maps-nearbyHotel.png",size:[40,42],origin:[0,90]}})}};H.util.extend(m,A);var b=H.OverlayView.implement({initialize:function(Q){this.id=Q.id},createNode:function(){this.$node=$('<div class="m-mapNearby _j_map_overlay _j_mdd_marker"><div class="micon-nearby clickstat"></div></div>')},renderNode:function(Q){this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()}},destoryNode:function(){this.$node.remove()}});var p=n.MddMiniInfoWindow=function(Q){p.__super__.constructor.call(this,Q);this.id=Q.id;Q.content=p.tmpl(Q);if(this.isSupportOverlayView){this._impl=new i(Q)}else{this._impl=new H.InfoWindow({map:Q.map,lat:Q.lat,lng:Q.lng,content:Q.content,pixelOffset:[0,-15],disableAutoPan:true})}};p.tmpl=function(U){var X=U.id,T=U.cname,W=U.numHotel,S=U.defaultImg,R=U.img||U.defaultImg,Q=$('<div class="_j_map_overlay _j_mdd_mini_info_window" style="position:relative;"><div class="mpop-nearby"><a href="/hotel/list_map.php?mddid='+X+'"><span class="image"><img src="'+S+'" data-image="'+R+'" height="65" width="95"></span><h3 class="overflow_ellipsis">'+T+'</h3><p class="overflow_ellipsis">本区域有<em>'+W+"</em>家酒店</p></a></div></div>");var V=$("<div>").html(Q);return V.html()};H.util.extend(p,A);p.prototype.getId=function(Q){return this.id};var i=H.OverlayView.implement({initialize:function(Q){this.type="infoWindow";this.content=Q.content},createNode:function(){this.$node=$(this.content)},renderNode:function(S){this.position={x:S.x-this.$node.width()/2-20,y:S.y-this.$node.height()+15};var R=this.$node.find(".image img"),Q=R.data("image");if(!!Q){$("<img>").bind("load",function(T){R.attr("src",Q)}).attr("src",Q)}},destoryNode:function(){this.$node.remove()}});var w=n.AreaInfoWindow=function(Q){w.__super__.constructor.call(this,Q);Q.content=w.tmpl(Q);if(this.isSupportOverlayView){this._impl=new O(Q)}else{this._impl=new H.InfoWindow({map:Q.map,lat:Q.lat,lng:Q.lng,content:Q.content,disableAutoPan:true})}};w.tmpl=function(S){var R=S.name;if(S.isComplex){var U=Number(S.orderPercent),Q=$('<div class="info-window-area _j_map_overlay _j_area_info_window"></div>');Q.append("<strong>"+R+"</strong>");if(U>0){Q.append("<span><em>"+U+"%</em>的人住在这里</span>");if(U>20){Q.append('<i class="i-hot"></i>')}}}else{Q=$('<div class="m-area-info-window _j_map_overlay _j_area_info_window">'+R+"</div>")}var T=$("<div>").html(Q);return T.html()};H.util.extend(w,A);var O=H.OverlayView.implement({initialize:function(Q){this.type="infoWindow";this.content=Q.content},createNode:function(){this.$node=$(this.content)},renderNode:function(Q){this.position={x:Q.x-this.$node.width()/2,y:Q.y};this.$node.css("cursor","default")},destoryNode:function(){this.$node.remove()}});var D=n.MddRoutePoiMarker=function(Q){D.__super__.constructor.call(this,Q);this.id=Q.id;this.biggerLightOrigin=[1,314];this.smallerLightOrigin=[1,314];this.biggerNormalOrigin=[1,314];this.smallerNormalOrigin=[1,314];if(this.isSupportOverlayView){this._impl=new v(Q)}else{this._impl=new H.Marker({map:Q.map,lat:Q.lat,lng:Q.lng,icon:{url:"http://css.mafengwo.net/images/hotel/hotel-maps-icon7.png",size:this.isBigger?[12,12]:[12,12],origin:this.isBigger?this.biggerNormalOrigin:this.smallerNormalOrigin},offset:this.isBigger?[6,6]:[6,6]})}};H.util.extend(D,G);var v=H.OverlayView.implement({initialize:function(Q){this.id=Q.id;this.isFocus=false;this.isBigger=Q.isBigger||false},createNode:function(){this.$node=$('<div class="map-mark mark-route _j_map_overlay _j_mdd_route_poi_marker"><span class="m-icon clickstat"></span></div>')},renderNode:function(Q){this.position={x:Q.x-this.$node.width()/2,y:Q.y-this.$node.height()/2}},destoryNode:function(){this.$node.remove()}});return n}));M.define("/js/poi/ControllerPoiAround",function(a){var c=a("/js/hotel/mfwmap/mfwmap"),b=a("/js/hotel/mfwmap/mfwmap-overlays-v2");return{init:function(){var g=this;var j=g.container.find("li.item-large[data-areaid]"),i=j.data("mddid"),h=j.data("areaid"),e,f,k;if(h){$.getJSON("/hotel/ajax.php",{sAction:"getGMapArea",iMddId:i},function(l){e=l;d()})}function d(){c.createMap({element:j[0],lat:g.data.poi.lat,lng:g.data.poi.lng,zoom:6,runtimes:g.data.poi.is_cnmain?["amap","google","leaflet"]:["google","leaflet"],scrollwheel:false,channelType:"poi",pageType:"hotel",control:{mapType:{visible:false},zoom:{position:c.controlPosition.TOP_RIGHT,amapRuler:false,amapOffset:[0,40]}}}).then(function(s){f=s;if(g.data.poi.is_cnmain&&c.isWGS84(f.mapType)){var p=c.util.gcj2wgs(g.data.poi.lat,g.data.poi.lng);f.panTo(p.lat,p.lng)}for(var n in e){if(n==0){continue}var o=e[n],m=new c.Polygon({map:f,paths:o.paths,strokeWeight:2,strokeColor:n==h?"#a979cd":"#0a89e4",strokeOpacity:0.7,fillColor:n==h?"#a979cd":"#0a89e4",fillOpacity:n==h?0.1:0,zIndex:n==h?5:0});(function(t){m.addListener("mouseover",function(w,v){for(var u in e){if(u!=h&&e[u].ploygon){e[u].ploygon.setOptions({strokeWeight:2,zIndex:0})}}if(k){k.remove()}if(e[t].ploygon){e[t].ploygon.setOptions({strokeWeight:4,fillOpacity:0.19,zIndex:10});k=new b.AreaInfoWindow({map:f,lat:e[t].lat,lng:e[t].lng,name:e[t].name})}});m.addListener("mouseout",function(){for(var u in e){if(u!=h&&e[u].ploygon){e[u].ploygon.setOptions({strokeWeight:2,strokeColor:"#0a89e4",fillOpacity:0,zIndex:0})}}if(k&&t!=h){k.remove();k=new b.AreaInfoWindow({map:f,lat:e[h].lat,lng:e[h].lng,name:e[h].name})}});m.addListener("click",function(){window.open("/hotel/area_"+t+".html","_blank")});e[t].ploygon=m})(n);if(n==h){var r=new c.LatLngBounds({map:f});for(var l=0;l<o.paths.length;l++){var q=o.paths[l];r.extend(q.lat,q.lng)}f.fitBounds(r)}}k=new b.AreaInfoWindow({map:f,lat:e[h].lat,lng:e[h].lng,name:e[h].name})})}}}});M.define("StarRating",function(c,b,d){function a(f){var e=$(f.context||"body"),g=f.starClassPrefix||"star";if(!f.blockSelector||!f.starCountSelector||!f.starItemSelector){M.log("blockSelect, starCountSelector, starItemSelector must be defined");return false}e.delegate(f.starItemSelector,"mouseenter",$.proxy(function(i){var j=$(i.currentTarget),k=j.closest(f.blockSelector),h=j.index();j.closest(f.blockSelector).find(f.starCountSelector).removeClass(function(){var n=this.className.split(/\s+/);for(var l=0,m=n.length;l<m;l++){if(n[l].indexOf(g)===0){return n[l]}}}).addClass(g+(h+1));M.Event(this).fire("enterrating",{star:h+1,block:k,starItem:j})},this));e.delegate(f.blockSelector,"mouseleave",$.proxy(function(h){var j=$(h.currentTarget),k=j.closest(f.blockSelector),i=j.data("star")||0;j.find(f.starCountSelector).removeClass(function(){var n=this.className.split(/\s+/);for(var l=0,m=n.length;l<m;l++){if(n[l].indexOf(g)===0){return n[l]}}}).addClass(g+i);M.Event(this).fire("leaverating",{star:i,block:k,starItem:j})},this));e.delegate(f.starItemSelector,"click",$.proxy(function(i){var j=$(i.currentTarget),k=j.closest(f.blockSelector),h=j.index();k.data("star",h+1);M.Event(this).fire("onrating",{star:h+1,block:k,starItem:j});i.preventDefault()},this))}d.exports=a});M.define("KeyListener",function(c,b){var f={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40};b.listen=function(l,j,h,m,g){var k,g=g||window,i=a(h);if((i.holdKey||i.keyCode)&&(j==="keydown"||j==="keyup")&&(typeof m==="function")){$(l).bind(j,function(n){if(d(n,i.holdKey)){if(e(n,i.holdKey,i.keyCode)){m.apply(g,arguments)}}})}};function a(h){var i={},g,k,j;if(M.is(h,"String")){g=h.split("+");if(g.length===1){j=$.trim(g[0])}else{if(g.length===2){k=$.trim(g[0]);j=$.trim(g[1])}}if(k){i.holdKey=[];g=k.split(",");M.forEach(g,function(m,l){m=$.trim(m);if(M.indexOf(["ctrl","alt","shift"],m)!==-1&&M.indexOf(i.holdKey,m)===-1){i.holdKey=i.holdKey.concat(m)}});if(i.holdKey.length===0){delete i.holdKey}}if(j){i.keyCode=isNaN(j)?f[j]:parseInt(j,10)}}return i}function d(l,j){var g=true,h;if(M.isArray(j)){for(h=0;h<j.length;h++){var k=j[h]=="ctrl"?(l.ctrlKey||l.metaKey):l[j[h]+"Key"];if(!k){g=false;break}}}return g}function e(l,j,m){var k=true,h,g;if(M.isArray(j)){for(h=0;h<j.length;h++){if(f[j[h]]===l.keyCode){k=false;break}}k=k&&(!m||(m&&l.keyCode===m))}else{k=m&&l.keyCode===m}return k}});M.define("Toggle",function(b,a,c){function d(e){this.context="body";this.trigger=null;this.board=null;this.handler=$.noop;this.triggerHandler=$.noop;this.boardHandler=$.noop;M.mix(this,e);this.inner=false;this.init()}d.prototype={init:function(){if(typeof this.trigger==="string"){$(this.context).delegate(this.trigger,"click",$.proxy(function(e){this.triggerHandler(e);this.inner=true},this))}else{$(this.trigger).click($.proxy(function(e){this.triggerHandler(e);this.inner=true},this))}if(typeof this.board==="string"){$(this.context).delegate(this.board,"click",$.proxy(function(e){this.inner=true},this))}else{$(this.board).click($.proxy(function(e){this.inner=true},this))}$(this.context).click($.proxy(function(e){if(!this.inner){this.handler()}else{this.inner=false}},this))}};c.exports=d});M.define("Select",function(a){var b=a("KeyListener"),d=a("Toggle");function c(f){this.valueBox=null;this.dropTrigger=null;this.dropListCnt=null;this.optionSelector="._j_option";this.selectedClass="_j_selected";this.disabledClass="disabled";M.mix(this,f);this.valueBox=$(this.valueBox);this.dropTrigger=$(this.dropTrigger);this.dropListCnt=$(this.dropListCnt);this.dropListInnerCnt=this.dropListInnerCnt?$(this.dropListInnerCnt):this.dropListCnt;this.value=this.valueBox.data("value")||"";this.input=$('<input type="hidden" name="'+this.valueBox.attr("name")+'" value="'+this.value+'" />').insertAfter(this.valueBox);if(!this.value){this.valueBox.addClass("default")}else{this.valueBox.removeClass("default");var e=this.dropListCnt.find('[data-value="'+this.value+'"]'),g=typeof e.data("text")!="undefined"?e.data("text"):e.text();this.setValueBox({value:this.value,text:g})}this.init()}c.prototype={init:function(){this.setFocusItem();this.bindEvents()},setFocusItem:function(){var e=this.dropListCnt.find(this.optionSelector),f=e.filter('[data-value="'+this.value+'"]');if(!f.length){f=e.first()}if(!f.hasClass(this.selectedClass)){f.siblings().removeClass(this.selectedClass);f.addClass(this.selectedClass);this.focusItem=f}},bindEvents:function(){var f=this;this.dropTrigger.click($.proxy(this.dropClick,this));this.valueBox.click($.proxy(function(){setTimeout($.proxy(function(){this.dropTrigger.trigger("click")},this),1)},this));b.listen(this.dropTrigger,"keydown","up",$.proxy(function(g){if(!$(g.currentTarget).hasClass(this.disabledClass)){this.moveSelect(-1)}g.preventDefault()},this));b.listen(this.dropTrigger,"keydown","down",$.proxy(function(g){if(!$(g.currentTarget).hasClass(this.disabledClass)){this.moveSelect(1)}g.preventDefault()},this));b.listen(this.dropTrigger,"keydown","enter",$.proxy(function(g){if(!$(g.currentTarget).hasClass(this.disabledClass)){this.selectItem(this.focusItem)}g.preventDefault()},this));this.dropListCnt.delegate(this.optionSelector,"mouseenter",$.proxy(this.hoverItem,this)).delegate(this.optionSelector,"click",$.proxy(function(g){this.selectItem($(g.currentTarget));g.preventDefault()},this));var e=new d({trigger:this.dropTrigger,board:this.dropListCnt,handler:function(){this.board.hide();M.Event(this).fire("hide")}})},dropClick:function(e){if(!$(e.currentTarget).hasClass(this.disabledClass)){this.dropTrigger.focus();this.drop()}e.preventDefault()},disable:function(){this.dropTrigger.addClass(this.disabledClass)},enable:function(){this.dropTrigger.removeClass(this.disabledClass)},selectItem:function(e){this.setSelect(e);this.dropListCnt.hide();this.dropTrigger.focus();this.valueBox.removeClass("default")},moveSelect:function(g){var f=this.dropListCnt.find(this.optionSelector),h=this.focusItem||f.first(),e=h;if(g===-1){e=h.prev(this.optionSelector);if(!e.length){e=f.last()}}else{if(g===1){e=h.next(this.optionSelector);if(!e.length){e=f.first()}}}this.setSelect(e)},setSelect:function(f){var e=f.data("value"),g=typeof f.data("text")!="undefined"?f.data("text"):f.text();this.focusItem&&this.focusItem.removeClass(this.selectedClass);f.addClass(this.selectedClass);this.focusItem=f;this.value=e;this.input.val(e);this.setValueBox({value:e,text:g});M.Event(this).fire("change",{data:{value:e}});this.viewFocusItem()},setValueBox:function(e){if(this.valueBox.is("input")){this.valueBox.val(e.text)}else{this.valueBox.text(e.text)}this.valueBox.data("value",e.value)},hoverItem:function(e){var f=$(e.currentTarget);this.focusItem.removeClass(this.selectedClass);f.addClass(this.selectedClass);this.focusItem=f},drop:function(){if(this.dropListCnt.css("display")==="none"){this.dropListCnt.show();this.setFocusItem();this.viewFocusItem();M.Event(this).fire("show")}else{this.dropListCnt.hide();M.Event(this).fire("hide")}},viewFocusItem:function(){if(!this.focusItem.length){return}var g=this.dropListInnerCnt[0],h=g.scrollTop,i=g.clientHeight,e=this.focusItem[0].offsetTop,f=e+this.focusItem.height();if(e<h){this.scroll(e)}else{if(f>(h+i)){this.scroll(f-i)}}},scroll:function(e){this.dropListInnerCnt.scrollTop(e)}};return c});M.define("dialog/BindMobileAlert",function(b,a){var c=b("dialog/alert");return{pop:function(d,e){!!mfwPageEvent&&mfwPageEvent("ugc","needbindmobile",{act:"show"});return c.pop(d,e)}}});M.define("dialog/confirm",function(c,e){var g=c("dialog/Dialog"),a='<div id="popup_container" class="popup-box new-popbox"><a class="close-btn _j_close _j_false"><i></i></a><div class="pop-ico" id="popup_icon"><i class="i2"></i></div><div class="pop-ctn"><p class="hd _j_content"></p><p class="bd _j_detail"></p></div><div class="pop-btns"><a role="button" tabindex="0" class="popbtn popbtn-cancel popbtn-half _j_close _j_false">&nbsp;取消&nbsp;</a><a role="button" tabindex="0" class="popbtn popbtn-submit popbtn-half _j_close _j_true">&nbsp;确定&nbsp;</a></div></div>',h=M.extend(function(k){var j={width:420,content:"请输入内容",background:"#000",bgOpacity:0.7,PANEL_CLASS:"pop_no_margin",reposition:true,impl:"Confirm",layerZIndex:10000};k=M.mix(j,k);h.$parent.call(this,k);this.bindEvents()},g),d=null,b=$.noop,i=$.noop,f=false;M.mix(h.prototype,{tpl:a,setConfirmTitle:function(j){this.setContent(j)},setConfirmContent:function(j){this.getPanel().find("._j_detail").text(j)},setAssureWords:function(j){this.getPanel().find(".popbtn-submit").text(j)},setCancelWords:function(j){this.getPanel().find(".popbtn-cancel").text(j)},bindEvents:function(){this.getPanel().on("click","._j_false",function(){f=false}).on("click","._j_true",function(){f=true}).on("keydown","._j_false",function(j){if(j.keyCode==13){$(this).trigger("click")}else{if(j.keyCode==39){$(this).next().focus()}}}).on("keydown","._j_true",function(j){if(j.keyCode==13){$(this).trigger("click")}else{if(j.keyCode==37){$(this).prev().focus()}}})}});e.pop=function(k,j,l){if(!d){d=new h();M.Event(d).on("afterhide",function(){if(f){b()}else{i()}});M.Event(d).on("aftershow",function(){d.getPanel().find("._j_true").focus()})}d.getLayer().toFront();if(M.isObject(k)){d.setConfirmTitle(k.title);d.setConfirmContent(k.content)}else{d.setConfirmTitle(k);d.setConfirmContent("")}if(M.isObject(k)){if(k.assureWords){d.setAssureWords(k.assureWords)}else{d.setAssureWords("确定")}if(k.cancelWords){d.setCancelWords(k.cancelWords)}else{d.setCancelWords("取消")}}else{d.setAssureWords("确定");d.setCancelWords("取消")}if(typeof j=="function"){b=j}else{b=$.noop}if(typeof l=="function"){i=l}else{i=$.noop}d.show();return d}});(function(b,g){var d={};function c(m,n){var l,j=[];for(var k=0;k<m.length;++k){l=d[m[k]]||e(m[k]);if(!l){throw"module definition dependecy not found: "+m[k]}j.push(l)}n.apply(null,j)}function h(k,j,i){if(typeof k!=="string"){throw"invalid module definition, module id must be defined and be a string"}if(j===g){throw"invalid module definition, dependencies must be specified"}if(i===g){throw"invalid module definition, definition function must be specified"}c(j,function(){d[k]=i.apply(null,arguments)})}function f(i){return !!d[i]}function e(l){var j=b;var i=l.split(/[.\/]/);for(var k=0;k<i.length;++k){if(!j[i[k]]){return}j=j[i[k]]}return j}function a(l){for(var k=0;k<l.length;k++){var m=b;var o=l[k];var j=o.split(/[.\/]/);for(var n=0;n<j.length-1;++n){if(m[j[n]]===g){m[j[n]]={}}m=m[j[n]]}m[j[j.length-1]]=d[o]}}h("moxie/core/utils/Basic",[],function(){var r=function(w){var v;if(w===v){return"undefined"}else{if(w===null){return"null"}else{if(w.nodeType){return"node"}}}return({}).toString.call(w).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()};var n=function(w){var v;p(arguments,function(x,y){if(y>0){p(x,function(A,z){if(A!==v){if(r(w[z])===r(A)&&!!~u(r(A),["array","object"])){n(w[z],A)}else{w[z]=A}}})}});return w};var p=function(A,B){var z,x,w,y;if(A){try{z=A.length}catch(v){z=y}if(z===y){for(x in A){if(A.hasOwnProperty(x)){if(B(A[x],x)===false){return}}}}else{for(w=0;w<z;w++){if(B(A[w],w)===false){return}}}}};var s=function(v){var w;if(!v||r(v)!=="object"){return true}for(w in v){return false}return true};var l=function(w,v){var x=0,y=w.length;if(r(v)!=="function"){v=function(){}}if(!w||!w.length){v()}function z(A){if(r(w[A])==="function"){w[A](function(B){++A<y&&!B?z(A):v(B)})}}z(x)};var i=function(w,v){var y=0,x=w.length,z=new Array(x);p(w,function(B,A){B(function(D){if(D){return v(D)}var C=[].slice.call(arguments);C.shift();z[A]=C;y++;if(y===x){z.unshift(null);v.apply(this,z)}})})};var u=function(x,y){if(y){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(y,x)}for(var v=0,w=y.length;v<w;v++){if(y[v]===x){return v}}}return -1};var q=function(w,y){var x=[];if(r(w)!=="array"){w=[w]}if(r(y)!=="array"){y=[y]}for(var v in w){if(u(w[v],y)===-1){x.push(w[v])}}return x.length?x:false};var t=function(x,w){var v=[];p(x,function(y){if(u(y,w)!==-1){v.push(y)}});return v.length?v:null};var m=function(x){var w,v=[];for(w=0;w<x.length;w++){v[w]=x[w]}return v};var o=(function(){var v=0;return function(y){var w=new Date().getTime().toString(32),x;for(x=0;x<5;x++){w+=Math.floor(Math.random()*65535).toString(32)}return(y||"o_")+w+(v++).toString(32)}}());var j=function(v){if(!v){return v}return String.prototype.trim?String.prototype.trim.call(v):v.toString().replace(/^\s*/,"").replace(/\s*$/,"")};var k=function(v){if(typeof(v)!=="string"){return v}var x={t:1099511627776,g:1073741824,m:1048576,k:1024},w;v=/^([0-9]+)([mgk]?)$/.exec(v.toLowerCase().replace(/[^0-9mkg]/g,""));w=v[2];v=+v[1];if(x.hasOwnProperty(w)){v*=x[w]}return v};return{guid:o,typeOf:r,extend:n,each:p,isEmptyObj:s,inSeries:l,inParallel:i,inArray:u,arrayDiff:q,arrayIntersect:t,toArray:m,trim:j,parseSizeStr:k}});h("moxie/core/I18n",["moxie/core/utils/Basic"],function(j){var i={};return{addI18n:function(k){return j.extend(i,k)},translate:function(k){return i[k]||k},_:function(k){return this.translate(k)},sprintf:function(l){var k=[].slice.call(arguments,1);return l.replace(/%[a-z]/g,function(){var m=k.shift();return j.typeOf(m)!=="undefined"?m:""})}}});h("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(l,k){var i="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-word,doc,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe";var j={mimes:{},extensions:{},addMimeType:function(m){var n=m.split(/,/),o,q,p;for(o=0;o<n.length;o+=2){p=n[o+1].split(/ /);for(q=0;q<p.length;q++){this.mimes[p[q]]=n[o]}this.extensions[n[o]]=p}},extList2mimes:function(s,t){var n=this,r,o,q,p,m=[];for(o=0;o<s.length;o++){r=s[o].extensions.split(/\s*,\s*/);for(q=0;q<r.length;q++){if(r[q]==="*"){return[]}p=n.mimes[r[q]];if(!p){if(t&&/^\w+$/.test(r[q])){m.push("."+r[q])}else{return[]}}else{if(l.inArray(p,m)===-1){m.push(p)}}}}return m},mimes2exts:function(m){var n=this,o=[];l.each(m,function(q){if(q==="*"){o=[];return false}var p=q.match(/^(\w+)\/(\*|\w+)$/);if(p){if(p[2]==="*"){l.each(n.extensions,function(r,s){if((new RegExp("^"+p[1]+"/")).test(s)){[].push.apply(o,n.extensions[s])}})}else{if(n.extensions[q]){[].push.apply(o,n.extensions[q])}}}});return o},mimes2extList:function(m){var o=[],n=[];if(l.typeOf(m)==="string"){m=l.trim(m).split(/\s*,\s*/)}n=this.mimes2exts(m);o.push({title:k.translate("Files"),extensions:n.length?n.join(","):"*"});o.mimes=m;return o},getFileExtension:function(n){var m=n&&n.match(/\.([^.]+)$/);if(m){return m[1].toLowerCase()}return""},getFileMime:function(m){return this.mimes[this.getFileExtension(m)]||""}};j.addMimeType(i);return j});h("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(m){var k=(function(r){var H="",G="?",B="function",t="undefined",p="object",q="major",C="model",s="name",y="type",w="vendor",E="version",n="architecture",u="console",A="mobile",F="tablet";var o={has:function(J,I){return I.toLowerCase().indexOf(J.toLowerCase())!==-1},lowerize:function(I){return I.toLowerCase()}};var D={rgx:function(){for(var U,O=0,N,K,J,I,P,Q,R=arguments;O<R.length;O+=2){var T=R[O],S=R[O+1];if(typeof(U)===t){U={};for(J in S){I=S[J];if(typeof(I)===p){U[I[0]]=r}else{U[I]=r}}}for(N=K=0;N<T.length;N++){P=T[N].exec(this.getUA());if(!!P){for(J=0;J<S.length;J++){Q=P[++K];I=S[J];if(typeof(I)===p&&I.length>0){if(I.length==2){if(typeof(I[1])==B){U[I[0]]=I[1].call(this,Q)}else{U[I[0]]=I[1]}}else{if(I.length==3){if(typeof(I[1])===B&&!(I[1].exec&&I[1].test)){U[I[0]]=Q?I[1].call(this,Q,I[2]):r}else{U[I[0]]=Q?Q.replace(I[1],I[2]):r}}else{if(I.length==4){U[I[0]]=Q?I[3].call(this,Q.replace(I[1],I[2])):r}}}}else{U[I]=Q?Q:r}}break}}if(!!P){break}}return U},str:function(N,K){for(var J in K){if(typeof(K[J])===p&&K[J].length>0){for(var I=0;I<K[J].length;I++){if(o.has(K[J][I],N)){return(J===G)?r:J}}}else{if(o.has(K[J],N)){return(J===G)?r:J}}}return N}};var z={browser:{oldsafari:{major:{"1":["/8","/1","/3"],"2":"/4","?":"/"},version:{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0","2000":"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0","7":"NT 6.1","8":"NT 6.2","8.1":"NT 6.3",RT:"ARM"}}}};var x={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[s,E,q],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[s,"Opera"],E,q],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[s,E,q],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[s,"IE"],E,q],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[s,"Yandex"],E,q],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[s,/_/g," "],E,q],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[s,E,q],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[s,"Dolphin"],E,q],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[s,"Chrome"],E,q],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[s,"Android Browser"],E,q],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[E,q,[s,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[E,q,s],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[s,[q,D.str,z.browser.oldsafari.major],[E,D.str,z.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[s,E,q],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[s,"Netscape"],E,q],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[s,E,q]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[s,E],[/rv\:([\w\.]+).*(gecko)/i],[E,s]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[s,[E,D.str,z.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[s,"Windows"],[E,D.str,z.os.windows.version]],[/\((bb)(10);/i],[[s,"BlackBerry"],E],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[s,E],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[s,"Symbian"],E],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[s,"Firefox OS"],E],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[s,E],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[s,"Chromium OS"],E],[/(sunos)\s?([\w\.]+\d)*/i],[[s,"Solaris"],E],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[s,E],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[s,"iOS"],[E,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[s,[E,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[s,E]]};var v=function(I){var J=I||((window&&window.navigator&&window.navigator.userAgent)?window.navigator.userAgent:H);this.getBrowser=function(){return D.rgx.apply(this,x.browser)};this.getEngine=function(){return D.rgx.apply(this,x.engine)};this.getOS=function(){return D.rgx.apply(this,x.os)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return J};this.setUA=function(K){J=K;return this};this.setUA(J)};return new v().getResult()})();function j(v,t,o){var s=0,u=0,n=0,p={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},q=function(w){w=(""+w).replace(/[_\-+]/g,".");w=w.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,".");return(!w.length?[-8]:w.split("."))},r=function(w){return !w?0:(isNaN(w)?p[w]||-7:parseInt(w,10))};v=q(v);t=q(t);u=Math.max(v.length,t.length);for(s=0;s<u;s++){if(v[s]==t[s]){continue}v[s]=r(v[s]);t[s]=r(t[s]);if(v[s]<t[s]){n=-1;break}else{if(v[s]>t[s]){n=1;break}}}if(!o){return n}switch(o){case">":case"gt":return(n>0);case">=":case"ge":return(n>=0);case"<=":case"le":return(n<=0);case"==":case"=":case"eq":return(n===0);case"<>":case"!=":case"ne":return(n!==0);case"":case"<":case"lt":return(n<0);default:return null}}var l=(function(){var n={define_property:(function(){return false}()),create_canvas:(function(){var o=document.createElement("canvas");return !!(o.getContext&&o.getContext("2d"))}()),return_response_type:function(o){try{if(m.inArray(o,["","text","document"])!==-1){return true}else{if(window.XMLHttpRequest){var q=new XMLHttpRequest();q.open("get","/");if("responseType" in q){q.responseType=o;if(q.responseType!==o){return false}return true}}}}catch(p){}return false},use_data_uri:(function(){var o=new Image();o.onload=function(){n.use_data_uri=(o.width===1&&o.height===1)};setTimeout(function(){o.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1);return false}()),use_data_uri_over32kb:function(){return n.use_data_uri&&(i.browser!=="IE"||i.version>=9)},use_data_uri_of:function(o){return(n.use_data_uri&&o<33000||n.use_data_uri_over32kb())},use_fileinput:function(){var o=document.createElement("input");o.setAttribute("type","file");return !o.disabled}};return function(p){var o=[].slice.call(arguments);o.shift();return m.typeOf(n[p])==="function"?n[p].apply(this,o):!!n[p]}}());var i={can:l,browser:k.browser.name,version:parseFloat(k.browser.major),os:k.os.name,osVersion:k.os.version,verComp:j,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};i.OS=i.os;return i});h("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(j){var k=function(q){if(typeof q!=="string"){return q}return document.getElementById(q)};var l=function(s,r){if(!s.className){return false}var q=new RegExp("(^|\\s+)"+r+"(\\s+|$)");return q.test(s.className)};var m=function(r,q){if(!l(r,q)){r.className=!r.className?q:r.className.replace(/\s+$/,"")+" "+q}};var p=function(s,r){if(s.className){var q=new RegExp("(^|\\s+)"+r+"(\\s+|$)");s.className=s.className.replace(q,function(u,t,v){return t===" "&&v===" "?" ":""})}};var i=function(r,q){if(r.currentStyle){return r.currentStyle[q]}else{if(window.getComputedStyle){return window.getComputedStyle(r,null)[q]}}};var o=function(r,v){var w=0,u=0,A,z=document,s,t;r=r;v=v||z.body;function q(E){var C,D,B=0,F=0;if(E){D=E.getBoundingClientRect();C=z.compatMode==="CSS1Compat"?z.documentElement:z.body;B=D.left+C.scrollLeft;F=D.top+C.scrollTop}return{x:B,y:F}}if(r&&r.getBoundingClientRect&&j.browser==="IE"&&(!z.documentMode||z.documentMode<8)){s=q(r);t=q(v);return{x:s.x-t.x,y:s.y-t.y}}A=r;while(A&&A!=v&&A.nodeType){w+=A.offsetLeft||0;u+=A.offsetTop||0;A=A.offsetParent}A=r.parentNode;while(A&&A!=v&&A.nodeType){w-=A.scrollLeft||0;u-=A.scrollTop||0;A=A.parentNode}return{x:w,y:u}};var n=function(q){return{w:q.offsetWidth||q.clientWidth,h:q.offsetHeight||q.clientHeight}};return{get:k,hasClass:l,addClass:m,removeClass:p,getStyle:i,getPos:o,getSize:n}});h("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(j){function i(m,l){var k;for(k in m){if(m[k]===l){return k}}return null}return{RuntimeError:(function(){var k={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};function l(m){this.code=m;this.name=i(k,m);this.message=this.name+": RuntimeError "+this.code}j.extend(l,k);l.prototype=Error.prototype;return l}()),OperationNotAllowedException:(function(){function k(l){this.code=l;this.name="OperationNotAllowedException"}j.extend(k,{NOT_ALLOWED_ERR:1});k.prototype=Error.prototype;return k}()),ImageError:(function(){var k={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};function l(m){this.code=m;this.name=i(k,m);this.message=this.name+": ImageError "+this.code}j.extend(l,k);l.prototype=Error.prototype;return l}()),FileException:(function(){var k={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};function l(m){this.code=m;this.name=i(k,m);this.message=this.name+": FileException "+this.code}j.extend(l,k);l.prototype=Error.prototype;return l}()),DOMException:(function(){var k={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function l(m){this.code=m;this.name=i(k,m);this.message=this.name+": DOMException "+this.code}j.extend(l,k);l.prototype=Error.prototype;return l}()),EventException:(function(){function k(l){this.code=l;this.name="EventException"}j.extend(k,{UNSPECIFIED_EVENT_TYPE_ERR:0});k.prototype=Error.prototype;return k}())}});h("moxie/core/EventTarget",["moxie/core/Exceptions","moxie/core/utils/Basic"],function(i,j){function k(){var l={};j.extend(this,{uid:null,init:function(){if(!this.uid){this.uid=j.guid("uid_")}},addEventListener:function(q,p,n,o){var m=this,r;q=j.trim(q);if(/\s/.test(q)){j.each(q.split(/\s+/),function(s){m.addEventListener(s,p,n,o)});return}q=q.toLowerCase();n=parseInt(n,10)||0;r=l[this.uid]&&l[this.uid][q]||[];r.push({fn:p,priority:n,scope:o||this});if(!l[this.uid]){l[this.uid]={}}l[this.uid][q]=r},hasEventListener:function(m){return m?!!(l[this.uid]&&l[this.uid][m]):!!l[this.uid]},removeEventListener:function(o,n){o=o.toLowerCase();var p=l[this.uid]&&l[this.uid][o],m;if(p){if(n){for(m=p.length-1;m>=0;m--){if(p[m].fn===n){p.splice(m,1);break}}}else{p=[]}if(!p.length){delete l[this.uid][o];if(j.isEmptyObj(l[this.uid])){delete l[this.uid]}}}},removeAllEventListeners:function(){if(l[this.uid]){delete l[this.uid]}},dispatchEvent:function(r){var o,p,q,s,t={},u=true,m;if(j.typeOf(r)!=="string"){s=r;if(j.typeOf(s.type)==="string"){r=s.type;if(s.total!==m&&s.loaded!==m){t.total=s.total;t.loaded=s.loaded}t.async=s.async||false}else{throw new i.EventException(i.EventException.UNSPECIFIED_EVENT_TYPE_ERR)}}if(r.indexOf("::")!==-1){(function(v){o=v[0];r=v[1]}(r.split("::")))}else{o=this.uid}r=r.toLowerCase();p=l[o]&&l[o][r];if(p){p.sort(function(w,v){return v.priority-w.priority});q=[].slice.call(arguments);q.shift();t.type=r;q.unshift(t);var n=[];j.each(p,function(v){q[0].target=v.scope;if(t.async){n.push(function(w){setTimeout(function(){w(v.fn.apply(v.scope,q)===false)},1)})}else{n.push(function(w){w(v.fn.apply(v.scope,q)===false)})}});if(n.length){j.inSeries(n,function(v){u=!v})}}return u},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(m){var o;if(j.typeOf(m)!=="array"){m=[m]}for(var n=0;n<m.length;n++){o="on"+m[n];if(j.typeOf(this[o])==="function"){this.addEventListener(m[n],this[o])}else{if(j.typeOf(this[o])==="undefined"){this[o]=null}}}}})}k.instance=new k();return k});h("moxie/core/utils/Encode",[],function(){var k=function(m){return unescape(encodeURIComponent(m))};var l=function(m){return decodeURIComponent(escape(m))};var j=function(t,y){if(typeof(window.atob)==="function"){return y?l(window.atob(t)):window.atob(t)}var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o,n,m,x,w,v,u,z,s=0,A=0,q="",r=[];if(!t){return t}t+="";do{x=p.indexOf(t.charAt(s++));w=p.indexOf(t.charAt(s++));v=p.indexOf(t.charAt(s++));u=p.indexOf(t.charAt(s++));z=x<<18|w<<12|v<<6|u;o=z>>16&255;n=z>>8&255;m=z&255;if(v==64){r[A++]=String.fromCharCode(o)}else{if(u==64){r[A++]=String.fromCharCode(o,n)}else{r[A++]=String.fromCharCode(o,n,m)}}}while(s<t.length);q=r.join("");return y?l(q):q};var i=function(v,A){if(A){k(v)}if(typeof(window.btoa)==="function"){return window.btoa(v)}var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var p,o,n,z,y,x,w,B,u=0,C=0,t="",s=[];if(!v){return v}do{p=v.charCodeAt(u++);o=v.charCodeAt(u++);n=v.charCodeAt(u++);B=p<<16|o<<8|n;z=B>>18&63;y=B>>12&63;x=B>>6&63;w=B&63;s[C++]=q.charAt(z)+q.charAt(y)+q.charAt(x)+q.charAt(w)}while(u<v.length);t=s.join("");var m=v.length%3;return(m?t.slice(0,m-3):t)+"===".slice(m||3)};return{utf8_encode:k,utf8_decode:l,atob:j,btoa:i}});h("moxie/runtime/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(m,l,n){var i={},j={};function k(w,t,r,q,p){var v=this,o,u=m.guid(t+"_"),s=p||"browser";w=w||{};j[u]=this;r=m.extend({access_binary:false,access_image_binary:false,display_media:false,do_cors:false,drag_and_drop:false,filter_by_extension:true,resize_image:false,report_upload_progress:false,return_response_headers:false,return_response_type:false,return_status_code:true,send_custom_headers:false,select_file:false,select_folder:false,select_multiple:true,send_binary_string:false,send_browser_cookies:true,send_multipart:true,slice_blob:false,stream_upload:false,summon_file_dialog:false,upload_filesize:true,use_http_method:true},r);if(w.preferred_caps){s=k.getMode(q,w.preferred_caps,s)}o=(function(){var x={};return{exec:function(A,y,B,z){if(o[y]){if(!x[A]){x[A]={context:this,instance:new o[y]()}}if(x[A].instance[B]){return x[A].instance[B].apply(this,z)}}},removeInstance:function(y){delete x[y]},removeAllInstances:function(){var y=this;m.each(x,function(A,z){if(m.typeOf(A.instance.destroy)==="function"){A.instance.destroy.call(A.context)}y.removeInstance(z)})}}}());m.extend(this,{initialized:false,uid:u,type:t,mode:k.getMode(q,(w.required_caps),s),shimid:u+"_container",clients:0,options:w,can:function(z,A){var x=arguments[2]||r;if(m.typeOf(z)==="string"&&m.typeOf(A)==="undefined"){z=k.parseCaps(z)}if(m.typeOf(z)==="object"){for(var y in z){if(!this.can(y,z[y],x)){return false}}return true}if(m.typeOf(x[z])==="function"){return x[z].call(this,A)}else{return(A===x[z])}},getShimContainer:function(){var x,y=l.get(this.shimid);if(!y){x=this.options.container?l.get(this.options.container):document.body;y=document.createElement("div");y.id=this.shimid;y.className="moxie-shim moxie-shim-"+this.type;m.extend(y.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});x.appendChild(y);x=null}return y},getShim:function(){return o},shimExec:function(y,z){var x=[].slice.call(arguments,2);return v.getShim().exec.call(this,this.uid,y,z,x)},exec:function(y,z){var x=[].slice.call(arguments,2);if(v[y]&&v[y][z]){return v[y][z].apply(this,x)}return v.shimExec.apply(this,arguments)},destroy:function(){if(!v){return}var x=l.get(this.shimid);if(x){x.parentNode.removeChild(x)}if(o){o.removeAllInstances()}this.unbindAll();delete j[this.uid];this.uid=null;u=v=o=x=null}});if(this.mode&&w.required_caps&&!this.can(w.required_caps)){this.mode=false}}k.order="html5,flash,silverlight,html4";k.getRuntime=function(o){return j[o]?j[o]:false};k.addConstructor=function(p,o){o.prototype=n.instance;i[p]=o};k.getConstructor=function(o){return i[o]||null};k.getInfo=function(o){var p=k.getRuntime(o);if(p){return{uid:p.uid,type:p.type,mode:p.mode,can:function(){return p.can.apply(p,arguments)}}}return null};k.parseCaps=function(o){var p={};if(m.typeOf(o)!=="string"){return o||{}}m.each(o.split(","),function(q){p[q]=true});return p};k.can=function(p,r){var q,o=k.getConstructor(p),s;if(o){q=new o({required_caps:r});s=q.mode;q.destroy();return !!s}return false};k.thatCan=function(q,r){var p=(r||k.order).split(/\s*,\s*/);for(var o in p){if(k.can(p[o],q)){return p[o]}}return null};k.getMode=function(o,r,p){var q=null;if(m.typeOf(p)==="undefined"){p="browser"}if(r&&!m.isEmptyObj(o)){m.each(r,function(u,s){if(o.hasOwnProperty(s)){var t=o[s](u);if(typeof(t)==="string"){t=[t]}if(!q){q=t}else{if(!(q=m.arrayIntersect(q,t))){return(q=false)}}}});if(q){return m.inArray(p,q)!==-1?p:q[0]}else{if(q===false){return false}}}return p};k.capTrue=function(){return true};k.capFalse=function(){return false};k.capTest=function(o){return function(){return !!o}};return k});h("moxie/runtime/RuntimeClient",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(i,l,k){return function j(){var m;l.extend(this,{connectRuntime:function(q){var o=this,p;function n(r){var t,s;if(!r.length){o.trigger("RuntimeError",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR));m=null;return}t=r.shift();s=k.getConstructor(t);if(!s){n(r);return}m=new s(q);m.bind("Init",function(){m.initialized=true;setTimeout(function(){m.clients++;o.trigger("RuntimeInit",m)},1)});m.bind("Error",function(){m.destroy();n(r)});if(!m.mode){m.trigger("Error");return}m.init()}if(l.typeOf(q)==="string"){p=q}else{if(l.typeOf(q.ruid)==="string"){p=q.ruid}}if(p){m=k.getRuntime(p);if(m){m.clients++;return m}else{throw new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR)}}n((q.runtime_order||k.order).split(/\s*,\s*/))},getRuntime:function(){if(m&&m.uid){return m}m=null;return null},disconnectRuntime:function(){if(m&&--m.clients<=0){m.destroy();m=null}}})}});h("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(l,j,k){var i={};function m(p,o){function n(u,q,s){var r,t=i[this.uid];if(l.typeOf(t)!=="string"||!t.length){return null}r=new m(null,{type:s,size:q-u});r.detach(t.substr(u,r.size));return r}k.call(this);if(p){this.connectRuntime(p)}if(!o){o={}}else{if(l.typeOf(o)==="string"){o={data:o}}}l.extend(this,{uid:o.uid||l.guid("uid_"),ruid:p,size:o.size||0,type:o.type||"",slice:function(s,q,r){if(this.isDetached()){return n.apply(this,arguments)}return this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),s,q,r)},getSource:function(){if(!i[this.uid]){return null}return i[this.uid]},detach:function(r){if(this.ruid){this.getRuntime().exec.call(this,"Blob","destroy");this.disconnectRuntime();this.ruid=null}r=r||"";var q=r.match(/^data:([^;]*);base64,/);if(q){this.type=q[1];r=j.atob(r.substring(r.indexOf("base64,")+7))}this.size=r.length;i[this.uid]=r},isDetached:function(){return !this.ruid&&l.typeOf(i[this.uid])==="string"},destroy:function(){this.detach();delete i[this.uid]}});if(o.data){this.detach(o.data)}else{i[this.uid]=o}}return m});h("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(k,j,l){function i(n,o){var m,p;if(!o){o={}}if(o.type&&o.type!==""){p=o.type}else{p=j.getFileMime(o.name)}if(o.name){m=o.name.replace(/\\/g,"/");m=m.substr(m.lastIndexOf("/")+1)}else{var q=p.split("/")[0];m=k.guid((q!==""?q:"file")+"_");if(j.extensions[p]){m+="."+j.extensions[p][0]}}l.apply(this,arguments);k.extend(this,{type:p||"",name:m||k.guid("file_"),lastModifiedDate:o.lastModifiedDate||(new Date()).toLocaleString()})}i.prototype=l.prototype;return i});h("moxie/file/FileInput",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/I18n","moxie/file/File","moxie/runtime/Runtime","moxie/runtime/RuntimeClient"],function(j,m,l,q,s,k,o,i,p){var r=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];function n(w){var u=this,t,v,x;if(j.inArray(j.typeOf(w),["string","node"])!==-1){w={browse_button:w}}v=l.get(w.browse_button);if(!v){throw new q.DOMException(q.DOMException.NOT_FOUND_ERR)}x={accept:[{title:k.translate("All Files"),extensions:"*"}],name:"file",multiple:false,required_caps:false,container:v.parentNode||document.body};w=j.extend({},x,w);if(typeof(w.required_caps)==="string"){w.required_caps=i.parseCaps(w.required_caps)}if(typeof(w.accept)==="string"){w.accept=m.mimes2extList(w.accept)}t=l.get(w.container);if(!t){t=document.body}if(l.getStyle(t,"position")==="static"){t.style.position="relative"}t=v=null;p.call(u);j.extend(u,{uid:j.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){u.convertEventPropsToHandlers(r);u.bind("RuntimeInit",function(z,y){u.ruid=y.uid;u.shimid=y.shimid;u.bind("Ready",function(){u.trigger("Refresh")},999);u.bind("Change",function(){var A=y.exec.call(u,"FileInput","getFiles");u.files=[];j.each(A,function(B){if(B.size===0){return true}u.files.push(new o(u.ruid,B))})},999);u.bind("Refresh",function(){var D,C,B,A;B=l.get(w.browse_button);A=l.get(y.shimid);if(B){D=l.getPos(B,l.get(w.container));C=l.getSize(B);if(A){j.extend(A.style,{top:D.y+"px",left:D.x+"px",width:C.w+"px",height:C.h+"px"})}}A=B=null});y.exec.call(u,"FileInput","init",w)});u.connectRuntime(j.extend({},w,{required_caps:{select_file:true}}))},disable:function(z){var y=this.getRuntime();if(y){y.exec.call(this,"FileInput","disable",j.typeOf(z)==="undefined"?true:z)}},refresh:function(){u.trigger("Refresh")},destroy:function(){var y=this.getRuntime();if(y){y.exec.call(this,"FileInput","destroy");this.disconnectRuntime()}if(j.typeOf(this.files)==="array"){j.each(this.files,function(z){z.destroy()})}this.files=null}})}n.prototype=s.instance;return n});h("moxie/file/FileDrop",["moxie/core/I18n","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/File","moxie/runtime/RuntimeClient","moxie/core/EventTarget","moxie/core/utils/Mime"],function(k,l,p,i,n,o,r,m){var q=["ready","dragenter","dragleave","drop","error"];function j(t){var s=this,u;if(typeof(t)==="string"){t={drop_zone:t}}u={accept:[{title:k.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:true}};t=typeof(t)==="object"?i.extend({},u,t):u;t.container=l.get(t.drop_zone)||document.body;if(l.getStyle(t.container,"position")==="static"){t.container.style.position="relative"}if(typeof(t.accept)==="string"){t.accept=m.mimes2extList(t.accept)}o.call(s);i.extend(s,{uid:i.guid("uid_"),ruid:null,files:null,init:function(){s.convertEventPropsToHandlers(q);s.bind("RuntimeInit",function(w,v){s.ruid=v.uid;s.bind("Drop",function(){var x=v.exec.call(s,"FileDrop","getFiles");s.files=[];i.each(x,function(y){s.files.push(new n(s.ruid,y))})},999);v.exec.call(s,"FileDrop","init",t);s.dispatchEvent("ready")});s.connectRuntime(t)},destroy:function(){var v=this.getRuntime();if(v){v.exec.call(this,"FileDrop","destroy");this.disconnectRuntime()}this.files=null}})}j.prototype=r.instance;return j});h("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(k,j,l){function i(){this.uid=k.guid("uid_");j.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}i.prototype=l.instance;return i});h("moxie/file/FileReader",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/Exceptions","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/runtime/RuntimeTarget"],function(i,m,o,q,l,n,k){var p=["loadstart","progress","load","abort","error","loadend"];function j(){var r=this,t;i.extend(this,{uid:i.guid("uid_"),readyState:j.EMPTY,result:null,error:null,readAsBinaryString:function(u){s.call(this,"readAsBinaryString",u)},readAsDataURL:function(u){s.call(this,"readAsDataURL",u)},readAsText:function(u){s.call(this,"readAsText",u)},abort:function(){this.result=null;if(i.inArray(this.readyState,[j.EMPTY,j.DONE])!==-1){return}else{if(this.readyState===j.LOADING){this.readyState=j.DONE}}if(t){t.getRuntime().exec.call(this,"FileReader","abort")}this.trigger("abort");this.trigger("loadend")},destroy:function(){this.abort();if(t){t.getRuntime().exec.call(this,"FileReader","destroy");t.disconnectRuntime()}r=t=null}});function s(z,v){t=new k();function x(A){r.readyState=j.DONE;r.error=A;r.trigger("error");w()}function w(){t.destroy();t=null;r.trigger("loadend")}function u(A){t.bind("Error",function(C,B){x(B)});t.bind("Progress",function(B){r.result=A.exec.call(t,"FileReader","getResult");r.trigger(B)});t.bind("Load",function(B){r.readyState=j.DONE;r.result=A.exec.call(t,"FileReader","getResult");r.trigger(B);w()});A.exec.call(t,"FileReader","read",z,v)}this.convertEventPropsToHandlers(p);if(this.readyState===j.LOADING){return x(new o.DOMException(o.DOMException.INVALID_STATE_ERR))}this.readyState=j.LOADING;this.trigger("loadstart");if(v instanceof l){if(v.isDetached()){var y=v.getSource();switch(z){case"readAsText":case"readAsBinaryString":this.result=y;break;case"readAsDataURL":this.result="data:"+v.type+";base64,"+m.btoa(y);break}this.readyState=j.DONE;this.trigger("load");w()}else{u(t.connectRuntime(v.ruid))}}else{x(new o.DOMException(o.DOMException.NOT_FOUND_ERR))}}}j.EMPTY=0;j.LOADING=1;j.DONE=2;j.prototype=q.instance;return j});h("moxie/core/utils/Url",[],function(){var i=function(l,t){var s=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],p=s.length,q={http:80,https:443},n={},r=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,o=r.exec(l||"");while(p--){if(o[p]){n[s[p]]=o[p]}}if(!n.scheme){if(!t||typeof(t)==="string"){t=i(t||document.location.href)}n.scheme=t.scheme;n.host=t.host;n.port=t.port;var u="";if(/^[^\/]/.test(n.path)){u=t.path;if(!/(\/|\/[^\.]+)$/.test(u)){u=u.replace(/\/[^\/]+$/,"/")}else{u+="/"}}n.path=u+(n.path||"")}if(!n.port){n.port=q[n.scheme]||80}n.port=parseInt(n.port,10);if(!n.path){n.path="/"}delete n.source;return n};var k=function(m){var n={http:80,https:443},l=i(m);return l.scheme+"://"+l.host+(l.port!==n[l.scheme]?":"+l.port:"")+l.path+(l.query?l.query:"")};var j=function(m){function l(n){return[n.scheme,n.host,n.port].join("/")}if(typeof m==="string"){m=i(m)}return l(i())===l(m)};return{parseUrl:i,resolveUrl:k,hasSameOrigin:j}});h("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(k,j,i){return function(){j.call(this);k.extend(this,{uid:k.guid("uid_"),readAsBinaryString:function(m){return l.call(this,"readAsBinaryString",m)},readAsDataURL:function(m){return l.call(this,"readAsDataURL",m)},readAsText:function(m){return l.call(this,"readAsText",m)}});function l(s,o){if(o.isDetached()){var r=o.getSource();switch(s){case"readAsBinaryString":return r;case"readAsDataURL":return"data:"+o.type+";base64,"+i.btoa(r);case"readAsText":var n="";for(var p=0,q=r.length;p<q;p++){n+=String.fromCharCode(r[p])}return n}}else{var m=this.connectRuntime(o.ruid).exec.call(this,"FileReaderSync","read",s,o);this.disconnectRuntime();return m}}}});h("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(i,j,l){function k(){var m,n=[];j.extend(this,{append:function(p,q){var o=this,r=j.typeOf(q);if(q instanceof l){m={name:p,value:q}}else{if("array"===r){p+="[]";j.each(q,function(s){o.append(p,s)})}else{if("object"===r){j.each(q,function(t,s){o.append(p+"["+s+"]",t)})}else{if("null"===r||"undefined"===r||"number"===r&&isNaN(q)){o.append(p,"false")}else{n.push({name:p,value:q.toString()})}}}}},hasBlob:function(){return !!this.getBlob()},getBlob:function(){return m&&m.value||null},getBlobName:function(){return m&&m.name||null},each:function(o){j.each(n,function(p){o(p.value,p.name)});if(m){o(m.value,m.name)}},destroy:function(){m=null;n=[]}})}return k});h("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(q,r,p,y,u,o,s,n,w,z,i,t){var j={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};function m(){this.uid=q.guid("uid_")}m.prototype=p.instance;var l=["loadstart","progress","abort","error","load","timeout","loadend"];var k=1,A=2;function v(){var T=this,E={timeout:0,readyState:v.UNSENT,withCredentials:false,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},Z=true,J,R,S={},U,G,I=null,K=null,ac=false,B=false,x=false,N=false,D=false,H=false,P,Y,X=null,aa=null,V={},Q,W="",C;q.extend(this,E,{uid:q.guid("uid_"),upload:new m(),open:function(ai,ag,ah,ae,af){var ad;if(!ai||!ag){throw new r.DOMException(r.DOMException.SYNTAX_ERR)}if(/[\u0100-\uffff]/.test(ai)||y.utf8_encode(ai)!==ai){throw new r.DOMException(r.DOMException.SYNTAX_ERR)}if(!!~q.inArray(ai.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])){R=ai.toUpperCase()}if(!!~q.inArray(R,["CONNECT","TRACE","TRACK"])){throw new r.DOMException(r.DOMException.SECURITY_ERR)}ag=y.utf8_encode(ag);ad=u.parseUrl(ag);H=u.hasSameOrigin(ad);J=u.resolveUrl(ag);if((ae||af)&&!H){throw new r.DOMException(r.DOMException.INVALID_ACCESS_ERR)}U=ae||ad.user;G=af||ad.pass;Z=ah||true;if(Z===false&&(ab("timeout")||ab("withCredentials")||ab("responseType")!=="")){throw new r.DOMException(r.DOMException.INVALID_ACCESS_ERR)}ac=!Z;B=false;S={};O.call(this);ab("readyState",v.OPENED);this.convertEventPropsToHandlers(["readystatechange"]);this.dispatchEvent("readystatechange")},setRequestHeader:function(af,ae){var ad=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(ab("readyState")!==v.OPENED||B){throw new r.DOMException(r.DOMException.INVALID_STATE_ERR)}if(/[\u0100-\uffff]/.test(af)||y.utf8_encode(af)!==af){throw new r.DOMException(r.DOMException.SYNTAX_ERR)}af=q.trim(af).toLowerCase();if(!!~q.inArray(af,ad)||/^(proxy\-|sec\-)/.test(af)){return false}if(!S[af]){S[af]=ae}else{S[af]+=", "+ae}return true},getAllResponseHeaders:function(){return W||""},getResponseHeader:function(ad){ad=ad.toLowerCase();if(D||!!~q.inArray(ad,["set-cookie","set-cookie2"])){return null}if(W&&W!==""){if(!C){C={};q.each(W.split(/\r\n/),function(ae){var af=ae.split(/:\s+/);if(af.length===2){af[0]=q.trim(af[0]);C[af[0].toLowerCase()]={header:af[0],value:q.trim(af[1])}}})}if(C.hasOwnProperty(ad)){return C[ad].header+": "+C[ad].value}}return null},overrideMimeType:function(ae){var ad,af;if(!!~q.inArray(ab("readyState"),[v.LOADING,v.DONE])){throw new r.DOMException(r.DOMException.INVALID_STATE_ERR)}ae=q.trim(ae.toLowerCase());if(/;/.test(ae)&&(ad=ae.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))){ae=ad[1];if(ad[2]){af=ad[2]}}if(!t.mimes[ae]){throw new r.DOMException(r.DOMException.SYNTAX_ERR)}X=ae;aa=af},send:function(af,ae){if(q.typeOf(ae)==="string"){V={ruid:ae}}else{if(!ae){V={}}else{V=ae}}this.convertEventPropsToHandlers(l);this.upload.convertEventPropsToHandlers(l);if(this.readyState!==v.OPENED||B){throw new r.DOMException(r.DOMException.INVALID_STATE_ERR)}if(af instanceof n){V.ruid=af.ruid;K=af.type||"application/octet-stream"}else{if(af instanceof z){if(af.hasBlob()){var ad=af.getBlob();V.ruid=ad.ruid;K=ad.type||"application/octet-stream"}}else{if(typeof af==="string"){I="UTF-8";K="text/plain;charset=UTF-8";af=y.utf8_encode(af)}}}if(!this.withCredentials){this.withCredentials=(V.required_caps&&V.required_caps.send_browser_cookies)&&!H}x=(!ac&&this.upload.hasEventListener());D=false;N=!af;if(!ac){B=true}F.call(this,af)},abort:function(){D=true;ac=false;if(!~q.inArray(ab("readyState"),[v.UNSENT,v.OPENED,v.DONE])){ab("readyState",v.DONE);B=false;if(Q){Q.getRuntime().exec.call(Q,"XMLHttpRequest","abort",N)}else{throw new r.DOMException(r.DOMException.INVALID_STATE_ERR)}N=true}else{ab("readyState",v.UNSENT)}},destroy:function(){if(Q){if(q.typeOf(Q.destroy)==="function"){Q.destroy()}Q=null}this.unbindAll();if(this.upload){this.upload.unbindAll();this.upload=null}}});function ab(ae,ad){if(!E.hasOwnProperty(ae)){return}if(arguments.length===1){return i.can("define_property")?E[ae]:T[ae]}else{if(i.can("define_property")){E[ae]=ad}else{T[ae]=ad}}}function F(ag){var ae=this;P=new Date().getTime();Q=new s();function af(){if(Q){Q.destroy();Q=null}ae.dispatchEvent("loadend");ae=null}function ad(ah){Q.bind("LoadStart",function(ai){ab("readyState",v.LOADING);ae.dispatchEvent("readystatechange");ae.dispatchEvent(ai);if(x){ae.upload.dispatchEvent(ai)}});Q.bind("Progress",function(ai){if(ab("readyState")!==v.LOADING){ab("readyState",v.LOADING);ae.dispatchEvent("readystatechange")}ae.dispatchEvent(ai)});Q.bind("UploadProgress",function(ai){if(x){ae.upload.dispatchEvent({type:"progress",lengthComputable:false,total:ai.total,loaded:ai.loaded})}});Q.bind("Load",function(ai){ab("readyState",v.DONE);ab("status",Number(ah.exec.call(Q,"XMLHttpRequest","getStatus")||0));ab("statusText",j[ab("status")]||"");ab("response",ah.exec.call(Q,"XMLHttpRequest","getResponse",ab("responseType")));if(!!~q.inArray(ab("responseType"),["text",""])){ab("responseText",ab("response"))}else{if(ab("responseType")==="document"){ab("responseXML",ab("response"))}}W=ah.exec.call(Q,"XMLHttpRequest","getAllResponseHeaders");ae.dispatchEvent("readystatechange");if(ab("status")>0){if(x){ae.upload.dispatchEvent(ai)}ae.dispatchEvent(ai)}else{D=true;ae.dispatchEvent("error")}af()});Q.bind("Abort",function(ai){ae.dispatchEvent(ai);af()});Q.bind("Error",function(ai){D=true;ab("readyState",v.DONE);ae.dispatchEvent("readystatechange");N=true;ae.dispatchEvent(ai);af()});ah.exec.call(Q,"XMLHttpRequest","send",{url:J,method:R,async:Z,user:U,password:G,headers:S,mimeType:K,encoding:I,responseType:ae.responseType,withCredentials:ae.withCredentials,options:V},ag)}if(typeof(V.required_caps)==="string"){V.required_caps=o.parseCaps(V.required_caps)}V.required_caps=q.extend({},V.required_caps,{return_response_type:ae.responseType});if(ag instanceof z){V.required_caps.send_multipart=true}if(!H){V.required_caps.do_cors=true}if(V.ruid){ad(Q.connectRuntime(V))}else{Q.bind("RuntimeInit",function(ai,ah){ad(ah)});Q.bind("RuntimeError",function(ai,ah){ae.dispatchEvent("RuntimeError",ah)});Q.connectRuntime(V)}}function O(){ab("responseText","");ab("responseXML",null);ab("response",null);ab("status",0);ab("statusText","");P=Y=null}}v.UNSENT=0;v.OPENED=1;v.HEADERS_RECEIVED=2;v.LOADING=3;v.DONE=4;v.prototype=p.instance;return v});h("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(l,i,j,m){function k(){var r,p,n,s,v,u;j.call(this);l.extend(this,{uid:l.guid("uid_"),state:k.IDLE,result:null,transport:function(A,z,y){var x=this;y=l.extend({chunk_size:204798},y);if((r=y.chunk_size%3)){y.chunk_size+=3-r}u=y.chunk_size;t.call(this);n=A;s=A.length;if(l.typeOf(y)==="string"||y.ruid){q.call(x,z,this.connectRuntime(y))}else{var w=function(C,B){x.unbind("RuntimeInit",w);q.call(x,z,B)};this.bind("RuntimeInit",w);this.connectRuntime(y)}},abort:function(){var w=this;w.state=k.IDLE;if(p){p.exec.call(w,"Transporter","clear");w.trigger("TransportingAborted")}t.call(w)},destroy:function(){this.unbindAll();p=null;this.disconnectRuntime();t.call(this)}});function t(){s=v=0;n=this.result=null}function q(x,y){var w=this;p=y;w.bind("TransportingProgress",function(z){v=z.loaded;if(v<s&&l.inArray(w.state,[k.IDLE,k.DONE])===-1){o.call(w)}},999);w.bind("TransportingComplete",function(){v=s;w.state=k.DONE;n=null;w.result=p.exec.call(w,"Transporter","getAsBlob",x||"")},999);w.state=k.BUSY;w.trigger("TransportingStarted");o.call(w)}function o(){var w=this,x,y=s-v;if(u>y){u=y}x=i.btoa(n.substr(v,u));p.exec.call(w,"Transporter","receive",x,s)}}k.IDLE=0;k.BUSY=1;k.DONE=2;k.prototype=m.instance;return k});h("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode"],function(k,n,t,r,u,j,s,m,q,w,l,p,o){var v=["progress","load","error","resize","embedded"];function i(){s.call(this);k.extend(this,{uid:k.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){y.call(this)},999);this.convertEventPropsToHandlers(v);z.apply(this,arguments)},downsize:function(D){var E={width:this.width,height:this.height,crop:false,preserveHeaders:true};if(typeof(D)==="object"){D=k.extend(E,D)}else{D=k.extend(E,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]})}try{if(!this.size){throw new t.DOMException(t.DOMException.INVALID_STATE_ERR)}if(this.width>i.MAX_RESIZE_WIDTH||this.height>i.MAX_RESIZE_HEIGHT){throw new t.ImageError(t.ImageError.MAX_RESOLUTION_ERR)}this.getRuntime().exec.call(this,"Image","downsize",D.width,D.height,D.crop,D.preserveHeaders)}catch(C){this.trigger("error",C.code)}},crop:function(E,C,D){this.downsize(E,C,true,D)},getAsCanvas:function(){if(!q.can("create_canvas")){throw new t.RuntimeError(t.RuntimeError.NOT_SUPPORTED_ERR)}var C=this.connectRuntime(this.ruid);return C.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(C,D){if(!this.size){throw new t.DOMException(t.DOMException.INVALID_STATE_ERR)}if(!C){C="image/jpeg"}if(C==="image/jpeg"&&!D){D=90}return this.getRuntime().exec.call(this,"Image","getAsBlob",C,D)},getAsDataURL:function(C,D){if(!this.size){throw new t.DOMException(t.DOMException.INVALID_STATE_ERR)}return this.getRuntime().exec.call(this,"Image","getAsDataURL",C,D)},getAsBinaryString:function(C,E){var D=this.getAsDataURL(C,E);return o.atob(D.substring(D.indexOf("base64,")+7))},embed:function(F){var P=this,K,J,N,H,Q=arguments[1]||{},E=this.width,O=this.height,G;function D(){if(q.can("create_canvas")){var R=K.getAsCanvas();if(R){F.appendChild(R);R=null;K.destroy();P.trigger("embedded");return}}var T=K.getAsDataURL(J,N);if(!T){throw new t.ImageError(t.ImageError.WRONG_FORMAT)}if(q.can("use_data_uri_of",T.length)){F.innerHTML='<img src="'+T+'" width="'+K.width+'" height="'+K.height+'" />';K.destroy();P.trigger("embedded")}else{var S=new m();S.bind("TransportingComplete",function(){G=P.connectRuntime(this.result.ruid);P.bind("Embedded",function(){k.extend(G.getShimContainer().style,{top:"0px",left:"0px",width:K.width+"px",height:K.height+"px"});G=null},999);G.exec.call(P,"ImageView","display",this.result.uid,E,O);K.destroy()});S.transport(o.atob(T.substring(T.indexOf("base64,")+7)),J,k.extend({},Q,{required_caps:{display_media:true},runtime_order:"flash,silverlight",container:F}))}}try{if(!(F=n.get(F))){throw new t.DOMException(t.DOMException.INVALID_NODE_TYPE_ERR)}if(!this.size){throw new t.DOMException(t.DOMException.INVALID_STATE_ERR)}if(this.width>i.MAX_RESIZE_WIDTH||this.height>i.MAX_RESIZE_HEIGHT){throw new t.ImageError(t.ImageError.MAX_RESOLUTION_ERR)}J=Q.type||this.type||"image/jpeg";N=Q.quality||90;H=k.typeOf(Q.crop)!=="undefined"?Q.crop:false;if(Q.width){E=Q.width;O=Q.height||E}else{var C=n.getSize(F);if(C.w&&C.h){E=C.w;O=C.h}}K=new i();K.bind("Resize",function(){D.call(P)});K.bind("Load",function(){K.downsize(E,O,H,false)});K.clone(this,false);return K}catch(I){this.trigger("error",I.code)}},destroy:function(){if(this.ruid){this.getRuntime().exec.call(this,"Image","destroy");this.disconnectRuntime()}this.unbindAll()}});function y(C){if(!C){C=this.getRuntime().exec.call(this,"Image","getInfo")}this.size=C.size;this.width=C.width;this.height=C.height;this.type=C.type;this.meta=C.meta;if(this.name===""){this.name=C.name}}function z(E){var D=k.typeOf(E);try{if(E instanceof i){if(!E.size){throw new t.DOMException(t.DOMException.INVALID_STATE_ERR)}x.apply(this,arguments)}else{if(E instanceof l){if(!~k.inArray(E.type,["image/jpeg","image/png"])){throw new t.ImageError(t.ImageError.WRONG_FORMAT)}A.apply(this,arguments)}else{if(k.inArray(D,["blob","file"])!==-1){z.call(this,new p(null,E),arguments[1])}else{if(D==="string"){if(/^data:[^;]*;base64,/.test(E)){z.call(this,new l(null,{data:E}),arguments[1])}else{B.apply(this,arguments)}}else{if(D==="node"&&E.nodeName.toLowerCase()==="img"){z.call(this,E.src,arguments[1])}else{throw new t.DOMException(t.DOMException.TYPE_MISMATCH_ERR)}}}}}}catch(C){this.trigger("error",C.code)}}function x(C,D){var E=this.connectRuntime(C.ruid);this.ruid=E.uid;E.exec.call(this,"Image","loadFromImage",C,(k.typeOf(D)==="undefined"?true:D))}function A(E,F){var D=this;D.name=E.name||"";function C(G){D.ruid=G.uid;G.exec.call(D,"Image","loadFromBlob",E)}if(E.isDetached()){this.bind("RuntimeInit",function(H,G){C(G)});if(F&&typeof(F.required_caps)==="string"){F.required_caps=j.parseCaps(F.required_caps)}this.connectRuntime(k.extend({required_caps:{access_image_binary:true,resize_image:true}},F))}else{C(this.connectRuntime(E.ruid))}}function B(E,D){var C=this,F;F=new u();F.open("get",E);F.responseType="blob";F.onprogress=function(G){C.trigger(G)};F.onload=function(){A.call(C,F.response,true)};F.onerror=function(G){C.trigger(G)};F.onloadend=function(){F.destroy()};F.bind("RuntimeError",function(H,G){C.trigger("RuntimeError",G)});F.send(null,D)}}i.MAX_RESIZE_WIDTH=6500;i.MAX_RESIZE_HEIGHT=6500;i.prototype=w.instance;return i});h("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(n,i,k,j){var m="html5",l={};function o(q){var p=this,t=k.capTest,s=k.capTrue;var r=n.extend({access_binary:t(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return p.can("access_binary")&&!!l.Image},display_media:t(j.can("create_canvas")||j.can("use_data_uri_over32kb")),do_cors:t(window.XMLHttpRequest&&"withCredentials" in new XMLHttpRequest()),drag_and_drop:t(function(){var u=document.createElement("div");return(("draggable" in u)||("ondragstart" in u&&"ondrop" in u))&&(j.browser!=="IE"||j.version>9)}()),filter_by_extension:t(function(){return(j.browser==="Chrome"&&j.version>=28)||(j.browser==="IE"&&j.version>=10)}()),return_response_headers:s,return_response_type:function(u){if(u==="json"&&!!window.JSON){return true}return j.can("return_response_type",u)},return_status_code:s,report_upload_progress:t(window.XMLHttpRequest&&new XMLHttpRequest().upload),resize_image:function(){return p.can("access_binary")&&j.can("create_canvas")},select_file:function(){return j.can("use_fileinput")&&window.File},select_folder:function(){return p.can("select_file")&&j.browser==="Chrome"&&j.version>=21},select_multiple:function(){return p.can("select_file")&&!(j.browser==="Safari"&&j.os==="Windows")&&!(j.os==="iOS"&&j.verComp(j.osVersion,"7.0.4","<"))},send_binary_string:t(window.XMLHttpRequest&&(new XMLHttpRequest().sendAsBinary||(window.Uint8Array&&window.ArrayBuffer))),send_custom_headers:t(window.XMLHttpRequest),send_multipart:function(){return !!(window.XMLHttpRequest&&new XMLHttpRequest().upload&&window.FormData)||p.can("send_binary_string")},slice_blob:t(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return p.can("slice_blob")&&p.can("send_multipart")},summon_file_dialog:t(function(){return(j.browser==="Firefox"&&j.version>=4)||(j.browser==="Opera"&&j.version>=12)||(j.browser==="IE"&&j.version>=10)||!!~n.inArray(j.browser,["Chrome","Safari"])}()),upload_filesize:s},arguments[2]);k.call(this,q,(arguments[1]||m),r);n.extend(this,{init:function(){this.trigger("Init")},destroy:(function(u){return function(){u.call(p);u=p=null}}(this.destroy))});n.extend(this.getShim(),l)}k.addConstructor(m,o);return l});h("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(j,k){function i(){function l(n,q,m){var o;if(window.File.prototype.slice){try{n.slice();return n.slice(q,m)}catch(p){return n.slice(q,m-q)}}else{if((o=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)){return o.call(n,q,m)}else{return null}}}this.slice=function(){return new k(this.getRuntime().uid,l.apply(this,arguments))}}return(j.Blob=i)});h("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(o){var p={},l="moxie_"+o.guid();function k(){this.returnValue=false}function j(){this.cancelBubble=true}var m=function(u,q,v,s){var t,r;q=q.toLowerCase();if(u.addEventListener){t=v;u.addEventListener(q,t,false)}else{if(u.attachEvent){t=function(){var w=window.event;if(!w.target){w.target=w.srcElement}w.preventDefault=k;w.stopPropagation=j;v(w)};u.attachEvent("on"+q,t)}}if(!u[l]){u[l]=o.guid()}if(!p.hasOwnProperty(u[l])){p[u[l]]={}}r=p[u[l]];if(!r.hasOwnProperty(q)){r[q]=[]}r[q].push({func:t,orig:v,key:s})};var n=function(v,q,w){var t,s;q=q.toLowerCase();if(v[l]&&p[v[l]]&&p[v[l]][q]){t=p[v[l]][q]}else{return}for(var r=t.length-1;r>=0;r--){if(t[r].orig===w||t[r].key===w){if(v.removeEventListener){v.removeEventListener(q,t[r].func,false)}else{if(v.detachEvent){v.detachEvent("on"+q,t[r].func)}}t[r].orig=null;t[r].func=null;t.splice(r,1);if(w!==s){break}}}if(!t.length){delete p[v[l]][q]}if(o.isEmptyObj(p[v[l]])){delete p[v[l]];try{delete v[l]}catch(u){v[l]=s}}};var i=function(r,q){if(!r||!r[l]){return}o.each(p[r[l]],function(t,s){n(r,s,q)})};return{addEvent:m,removeEvent:n,removeAllEvents:i}});h("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(m,o,l,j,k,i){function n(){var q=[],p;o.extend(this,{init:function(A){var r=this,y=r.getRuntime(),x,t,u,z,w,v;p=A;q=[];u=p.accept.mimes||k.extList2mimes(p.accept,y.can("filter_by_extension"));t=y.getShimContainer();t.innerHTML='<input id="'+y.uid+'" type="file" style="font-size:999px;opacity:0;"'+(p.multiple&&y.can("select_multiple")?"multiple":"")+(p.directory&&y.can("select_folder")?"webkitdirectory directory":"")+(u?' accept="'+u.join(",")+'"':"")+" />";x=l.get(y.uid);o.extend(x.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});z=l.get(p.browse_button);w=parseInt(l.getStyle(z,"z-index"),10)||0;if(y.can("summon_file_dialog")){if(l.getStyle(z,"position")==="static"){z.style.position="relative"}t.style.zIndex=w-1;j.addEvent(z,"click",function(C){var B=l.get(y.uid);if(B&&!B.disabled){B.click()}C.preventDefault()},r.uid)}else{t.style.zIndex=w}v=y.can("summon_file_dialog")?z:t;j.addEvent(v,"mouseover",function(){r.trigger("mouseenter")},r.uid);j.addEvent(v,"mouseout",function(){r.trigger("mouseleave")},r.uid);j.addEvent(v,"mousedown",function(){r.trigger("mousedown")},r.uid);j.addEvent(l.get(p.container),"mouseup",function(){r.trigger("mouseup")},r.uid);x.onchange=function s(){q=[];if(p.directory){o.each(this.files,function(C){if(C.name!=="."){q.push(C)}})}else{q=[].slice.call(this.files)}if(i.browser!=="IE"&&i.browser!=="IEMobile"){this.value=""}else{var B=this.cloneNode(true);this.parentNode.replaceChild(B,this);B.onchange=s}r.trigger("change")};r.trigger({type:"ready",async:true});t=null},getFiles:function(){return q},disable:function(t){var s=this.getRuntime(),r;if((r=l.get(s.uid))){r.disabled=!!t}},destroy:function(){var s=this.getRuntime(),t=s.getShim(),r=s.getShimContainer();j.removeAllEvents(r,this.uid);j.removeAllEvents(p&&l.get(p.container),this.uid);j.removeAllEvents(p&&l.get(p.browse_button),this.uid);if(r){r.innerHTML=""}t.removeInstance(this.uid);q=p=r=t=null}})}return(m.FileInput=n)});h("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(l,m,k,i,j){function n(){var p=[],s=[],w;m.extend(this,{init:function(z){var y=this,A;w=z;s=r(w.accept);A=w.container;i.addEvent(A,"dragover",function(B){if(!q(B)){return}B.preventDefault();B.dataTransfer.dropEffect="copy"},y.uid);i.addEvent(A,"drop",function(B){if(!q(B)){return}B.preventDefault();p=[];if(B.dataTransfer.items&&B.dataTransfer.items[0].webkitGetAsEntry){v(B.dataTransfer.items,function(){y.trigger("drop")})}else{m.each(B.dataTransfer.files,function(C){if(u(C)){p.push(C)}});y.trigger("drop")}},y.uid);i.addEvent(A,"dragenter",function(B){y.trigger("dragenter")},y.uid);i.addEvent(A,"dragleave",function(B){y.trigger("dragleave")},y.uid)},getFiles:function(){return p},destroy:function(){i.removeAllEvents(w&&k.get(w.container),this.uid);p=s=w=null}});function q(z){if(!z.dataTransfer||!z.dataTransfer.types){return false}var y=m.toArray(z.dataTransfer.types||[]);return m.inArray("Files",y)!==-1||m.inArray("public.file-url",y)!==-1||m.inArray("application/x-moz-file",y)!==-1}function r(A){var z=[];for(var y=0;y<A.length;y++){[].push.apply(z,A[y].extensions.split(/\s*,\s*/))}return m.inArray("*",z)===-1?z:[]}function u(y){if(!s.length){return true}var z=j.getFileExtension(y.name);return !z||m.inArray(z,s)!==-1}function v(A,z){var y=[];m.each(A,function(D){var C=D.webkitGetAsEntry();if(C){if(C.isFile){var B=D.getAsFile();if(u(B)){p.push(B)}}else{y.push(C)}}});if(y.length){t(y,z)}else{z()}}function t(A,z){var y=[];m.each(A,function(B){y.push(function(C){o(B,C)})});m.inSeries(y,function(){z()})}function o(z,y){if(z.isFile){z.file(function(A){if(u(A)){p.push(A)}y()},function(){y()})}else{if(z.isDirectory){x(z,y)}else{y()}}}function x(C,z){var y=[],B=C.createReader();function A(D){B.readEntries(function(E){if(E.length){[].push.apply(y,E);A(D)}else{D()}},D)}A(function(){t(y,z)})}}return(l.FileDrop=n)});h("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(j,i,l){function k(){var n,o=false;l.extend(this,{read:function(r,p){var q=this;n=new window.FileReader();n.addEventListener("progress",function(s){q.trigger(s)});n.addEventListener("load",function(s){q.trigger(s)});n.addEventListener("error",function(s){q.trigger(s,n.error)});n.addEventListener("loadend",function(){n=null});if(l.typeOf(n[r])==="function"){o=false;n[r](p.getSource())}else{if(r==="readAsBinaryString"){o=true;n.readAsDataURL(p.getSource())}}},getResult:function(){return n&&n.result?(o?m(n.result):n.result):null},abort:function(){if(n){n.abort()}},destroy:function(){n=null}});function m(p){return i.atob(p.substring(p.indexOf("base64,")+7))}}return(j.FileReader=k)});h("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(o,j,l,i,n,k,r,p,m){function q(){var u=this,y,w;j.extend(this,{send:function(G,D){var F=this,C=(m.browser==="Mozilla"&&m.version>=4&&m.version<7),z=m.browser==="Android Browser",E=false;w=G.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase();y=x();y.open(G.method,G.url,G.async,G.user,G.password);if(D instanceof k){if(D.isDetached()){E=true}D=D.getSource()}else{if(D instanceof r){if(D.hasBlob()){if(D.getBlob().isDetached()){D=v.call(F,D);E=true}else{if((C||z)&&j.typeOf(D.getBlob().getSource())==="blob"&&window.FileReader){s.call(F,G,D);return}}}if(D instanceof r){var B=new window.FormData();D.each(function(I,H){if(I instanceof k){B.append(H,I.getSource())}else{B.append(H,I)}});D=B}}}if(y.upload){if(G.withCredentials){y.withCredentials=true}y.addEventListener("load",function(H){F.trigger(H)});y.addEventListener("error",function(H){F.trigger(H)});y.addEventListener("progress",function(H){F.trigger(H)});y.upload.addEventListener("progress",function(H){F.trigger({type:"UploadProgress",loaded:H.loaded,total:H.total})})}else{y.onreadystatechange=function A(){switch(y.readyState){case 1:break;case 2:break;case 3:var J,H;try{if(i.hasSameOrigin(G.url)){J=y.getResponseHeader("Content-Length")||0}if(y.responseText){H=y.responseText.length}}catch(I){J=H=0}F.trigger({type:"progress",lengthComputable:!!J,total:parseInt(J,10),loaded:H});break;case 4:y.onreadystatechange=function(){};if(y.status===0){F.trigger("error")}else{F.trigger("load")}break}}}if(!j.isEmptyObj(G.headers)){j.each(G.headers,function(H,I){y.setRequestHeader(I,H)})}if(""!==G.responseType&&"responseType" in y){if("json"===G.responseType&&!m.can("return_response_type","json")){y.responseType="text"}else{y.responseType=G.responseType}}if(!E){y.send(D)}else{if(y.sendAsBinary){y.sendAsBinary(D)}else{(function(){var H=new Uint8Array(D.length);for(var I=0;I<D.length;I++){H[I]=(D.charCodeAt(I)&255)}y.send(H.buffer)}())}}F.trigger("loadstart")},getStatus:function(){try{if(y){return y.status}}catch(z){}return 0},getResponse:function(B){var A=this.getRuntime();try{switch(B){case"blob":var D=new n(A.uid,y.response);var E=y.getResponseHeader("Content-Disposition");if(E){var z=E.match(/filename=([\'\"'])([^\1]+)\1/);if(z){w=z[2]}}D.name=w;if(!D.type){D.type=l.getFileMime(w)}return D;case"json":if(!m.can("return_response_type","json")){return y.status===200&&!!window.JSON?JSON.parse(y.responseText):null}return y.response;case"document":return t(y);default:return y.responseText!==""?y.responseText:null}}catch(C){return null}},getAllResponseHeaders:function(){try{return y.getAllResponseHeaders()}catch(z){}return""},abort:function(){if(y){y.abort()}},destroy:function(){u=w=null}});function s(D,B){var C=this,A,z;A=B.getBlob().getSource();z=new window.FileReader();z.onload=function(){B.append(B.getBlobName(),new k(null,{type:A.type,data:z.result}));u.send.call(C,D,B)};z.readAsBinaryString(A)}function x(){if(window.XMLHttpRequest&&!(m.browser==="IE"&&m.version<8)){return new window.XMLHttpRequest()}else{return(function(){var z=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"];for(var B=0;B<z.length;B++){try{return new ActiveXObject(z[B])}catch(A){}}})()}}function t(A){var B=A.responseXML;var z=A.responseText;if(m.browser==="IE"&&z&&B&&!B.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(A.getResponseHeader("Content-Type"))){B=new window.ActiveXObject("Microsoft.XMLDOM");B.async=false;B.validateOnParse=false;B.loadXML(z)}if(B){if((m.browser==="IE"&&B.parseError!==0)||!B.documentElement||B.documentElement.tagName==="parsererror"){return null}}return B}function v(B){var E="----moxieboundary"+new Date().getTime(),C="--",D="\r\n",z="",A=this.getRuntime();if(!A.can("send_binary_string")){throw new p.RuntimeError(p.RuntimeError.NOT_SUPPORTED_ERR)}y.setRequestHeader("Content-Type","multipart/form-data; boundary="+E);B.each(function(G,F){if(G instanceof k){z+=C+E+D+'Content-Disposition: form-data; name="'+F+'"; filename="'+unescape(encodeURIComponent(G.name||"blob"))+'"'+D+"Content-Type: "+(G.type||"application/octet-stream")+D+D+G.getSource()+D}else{z+=C+E+D+'Content-Disposition: form-data; name="'+F+'"'+D+D+unescape(encodeURIComponent(G))+D}});z+=C+E+C+D;return z}}return(o.XMLHttpRequest=q)});h("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){var l=false,j;function m(o,q){var n=l?0:-8*(q-1),r=0,p;for(p=0;p<q;p++){r|=(j.charCodeAt(o+p)<<Math.abs(n+p*8))}return r}function i(p,n,o){o=arguments.length===3?o:j.length-n-1;j=j.substr(0,n)+p+j.substr(o+n)}function k(o,p,r){var s="",n=l?0:-8*(r-1),q;for(q=0;q<r;q++){s+=String.fromCharCode((p>>Math.abs(n+q*8))&255)}i(s,o,r)}return{II:function(n){if(n===g){return l}else{l=n}},init:function(n){l=false;j=n},SEGMENT:function(n,p,o){switch(arguments.length){case 1:return j.substr(n,j.length-n-1);case 2:return j.substr(n,p);case 3:i(o,n,p);break;default:return j}},BYTE:function(n){return m(n,1)},SHORT:function(n){return m(n,2)},LONG:function(n,o){if(o===g){return m(n,4)}else{k(n,o,4)}},SLONG:function(n){var o=m(n,4);return(o>2147483647?o-4294967296:o)},STRING:function(n,o){var p="";for(o+=n;n<o;n++){p+=String.fromCharCode(m(n,1))}return p}}}});h("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],function(j){return function i(o){var p=[],n,k,l,m=0;n=new j();n.init(o);if(n.SHORT(0)!==65496){return}k=2;while(k<=o.length){l=n.SHORT(k);if(l>=65488&&l<=65495){k+=2;continue}if(l===65498||l===65497){break}m=n.SHORT(k+2)+2;if(l>=65505&&l<=65519){p.push({hex:l,name:"APP"+(l&15),start:k,length:m,segment:n.SEGMENT(k,m)})}k+=m}n.init(null);return{headers:p,restore:function(s){var q,r;n.init(s);k=n.SHORT(2)==65504?4+n.SHORT(4):2;for(r=0,q=p.length;r<q;r++){if(p[r].name=="APP2"&&p[r].segment.indexOf("ProPhoto RGB")>0){continue}else{n.SEGMENT(k,0,p[r].segment);k+=p[r].length}}s=n.SEGMENT();n.init(null);return s},strip:function(s){var t,q,r;q=new i(s);t=q.headers;q.purge();n.init(s);r=t.length;while(r--){n.SEGMENT(t[r].start,t[r].length,"")}s=n.SEGMENT();n.init(null);return s},get:function(r){var t=[];for(var s=0,q=p.length;s<q;s++){if(p[s].name===r.toUpperCase()){t.push(p[s].segment)}}return t},set:function(r,u){var v=[],s,t,q;if(typeof(u)==="string"){v.push(u)}else{v=u}for(s=t=0,q=p.length;s<q;s++){if(p[s].name===r.toUpperCase()){p[s].segment=v[t];p[s].length=v[t].length;t++}if(t>=v.length){break}}},purge:function(){p=[];n.init(null);n=null}}}});h("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(k,j){return function i(){var p,m,l,n={},s;p=new j();m={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};s={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};function o(t,B){var v=p.SHORT(t),y,E,F,A,z,u,w,C,D=[],x={};for(y=0;y<v;y++){w=u=t+12*y+2;F=B[p.SHORT(w)];if(F===g){continue}A=p.SHORT(w+=2);z=p.LONG(w+=2);w+=4;D=[];switch(A){case 1:case 7:if(z>4){w=p.LONG(w)+n.tiffHeader}for(E=0;E<z;E++){D[E]=p.BYTE(w+E)}break;case 2:if(z>4){w=p.LONG(w)+n.tiffHeader}x[F]=p.STRING(w,z-1);continue;case 3:if(z>2){w=p.LONG(w)+n.tiffHeader}for(E=0;E<z;E++){D[E]=p.SHORT(w+E*2)}break;case 4:if(z>1){w=p.LONG(w)+n.tiffHeader}for(E=0;E<z;E++){D[E]=p.LONG(w+E*4)}break;case 5:w=p.LONG(w)+n.tiffHeader;for(E=0;E<z;E++){D[E]=p.LONG(w+E*4)/p.LONG(w+E*4+4)}break;case 9:w=p.LONG(w)+n.tiffHeader;for(E=0;E<z;E++){D[E]=p.SLONG(w+E*4)}break;case 10:w=p.LONG(w)+n.tiffHeader;for(E=0;E<z;E++){D[E]=p.SLONG(w+E*4)/p.SLONG(w+E*4+4)}break;default:continue}C=(z==1?D[0]:D);if(s.hasOwnProperty(F)&&typeof C!="object"){x[F]=s[F][C]}else{x[F]=C}}return x}function r(){var t=n.tiffHeader;p.II(p.SHORT(t)==18761);if(p.SHORT(t+=2)!==42){return false}n.IFD0=n.tiffHeader+p.LONG(t+=2);l=o(n.IFD0,m.tiff);if("ExifIFDPointer" in l){n.exifIFD=n.tiffHeader+l.ExifIFDPointer;delete l.ExifIFDPointer}if("GPSInfoIFDPointer" in l){n.gpsIFD=n.tiffHeader+l.GPSInfoIFDPointer;delete l.GPSInfoIFDPointer}return true}function q(A,C,z){var x,v,u,t=0;if(typeof(C)==="string"){var B=m[A.toLowerCase()];for(var w in B){if(B[w]===C){C=w;break}}}x=n[A.toLowerCase()+"IFD"];v=p.SHORT(x);for(var y=0;y<v;y++){u=x+12*y+2;if(p.SHORT(u)==C){t=u+8;break}}if(!t){return false}p.LONG(t,z);return true}return{init:function(t){n={tiffHeader:10};if(t===g||!t.length){return false}p.init(t);if(p.SHORT(0)===65505&&p.STRING(4,5).toUpperCase()==="EXIF\0"){return r()}return false},TIFF:function(){return l},EXIF:function(){var u;u=o(n.exifIFD,m.exif);if(u.ExifVersion&&k.typeOf(u.ExifVersion)==="array"){for(var v=0,t="";v<u.ExifVersion.length;v++){t+=String.fromCharCode(u.ExifVersion[v])}u.ExifVersion=t}return u},GPS:function(){var t;t=o(n.gpsIFD,m.gps);if(t.GPSVersionID&&k.typeOf(t.GPSVersionID)==="array"){t.GPSVersionID=t.GPSVersionID.join(".")}return t},setExif:function(t,u){if(t!=="PixelXDimension"&&t!=="PixelYDimension"){return false}return q("exif",t,u)},getBinary:function(){return p.SEGMENT()},purge:function(){p.init(null);p=l=null;n={}}}}});h("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(n,i,k,m,j){function l(w){var p,r,t,s,v,o;function u(){var x=0,y,z;while(x<=p.length){y=r.SHORT(x+=2);if(y>=65472&&y<=65475){x+=5;return{height:r.SHORT(x),width:r.SHORT(x+=2)}}z=r.SHORT(x+=2);x+=z-2}return null}p=w;r=new m();r.init(p);if(r.SHORT(0)!==65496){throw new i.ImageError(i.ImageError.WRONG_FORMAT)}t=new k(w);s=new j();o=!!s.init(t.get("app1")[0]);v=u.call(this);n.extend(this,{type:"image/jpeg",size:p.length,width:v&&v.width||0,height:v&&v.height||0,setExif:function(x,y){if(!o){return false}if(n.typeOf(x)==="object"){n.each(x,function(A,z){s.setExif(z,A)})}else{s.setExif(x,y)}t.set("app1",s.getBinary())},writeHeaders:function(){if(!arguments.length){return(p=t.restore(p))}return t.restore(arguments[0])},stripHeaders:function(x){return t.strip(x)},purge:function(){q.call(this)}});if(o){this.meta={tiff:s.TIFF(),exif:s.EXIF(),gps:s.GPS()}}function q(){if(!s||!t||!r){return}s.purge();t.purge();r.init(null);p=v=t=s=r=null}}return l});h("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(i,l,k){function j(u){var n,p,r,q,t;n=u;p=new k();p.init(n);(function(){var v=0,x=0,w=[35152,20039,3338,6666];for(x=0;x<w.length;x++,v+=2){if(w[x]!=p.SHORT(v)){throw new i.ImageError(i.ImageError.WRONG_FORMAT)}}}());function s(){var w,v;w=m.call(this,8);if(w.type=="IHDR"){v=w.start;return{width:p.LONG(v),height:p.LONG(v+=4)}}return null}function o(){if(!p){return}p.init(null);n=t=r=q=p=null}t=s.call(this);l.extend(this,{type:"image/png",size:n.length,width:t.width,height:t.height,purge:function(){o.call(this)}});o.call(this);function m(v){var y,x,z,w;y=p.LONG(v);x=p.STRING(v+=4,4);z=v+=4;w=p.LONG(v+y);return{length:y,type:x,start:z,CRC:w}}}return j});h("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(l,i,k,j){return function(n){var o=[k,j],m;m=(function(){for(var q=0;q<o.length;q++){try{return new o[q](n)}catch(p){}}throw new i.ImageError(i.ImageError.WRONG_FORMAT)}());l.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(p){return p},stripHeaders:function(p){return p},purge:function(){}});l.extend(this,m);this.purge=function(){m.purge();m=null}}});h("moxie/runtime/html5/image/MegaPixel",[],function(){function i(I,m,n){var p=I.naturalWidth,v=I.naturalHeight;var C=n.width,z=n.height;var r=n.x||0,q=n.y||0;var D=m.getContext("2d");if(j(I)){p/=2;v/=2}var G=1024;var l=document.createElement("canvas");l.width=l.height=G;var o=l.getContext("2d");var E=k(I,p,v);var w=0;while(w<v){var H=w+G>v?v-w:G;var A=0;while(A<p){var B=A+G>p?p-A:G;o.clearRect(0,0,G,G);o.drawImage(I,-A,-w);var t=(A*C/p+r)<<0;var u=Math.ceil(B*C/p);var s=(w*z/v/E+q)<<0;var F=Math.ceil(H*z/v/E);D.drawImage(l,0,0,B,H,t,s,u,F);A+=G}w+=G}l=o=null}function j(n){var m=n.naturalWidth,p=n.naturalHeight;if(m*p>1024*1024){var o=document.createElement("canvas");o.width=o.height=1;var l=o.getContext("2d");l.drawImage(n,-m+1,0);return l.getImageData(0,0,1,1).data[3]===0}else{return false}}function k(p,m,u){var l=document.createElement("canvas");l.width=1;l.height=u;var v=l.getContext("2d");v.drawImage(p,0,0);var o=v.getImageData(0,0,1,u).data;var s=0;var q=u;var t=u;while(t>s){var n=o[(t-1)*4+3];if(n===0){q=t}else{s=t}t=(q+s)>>1}l=null;var r=(t/u);return(r===0)?1:r}return{isSubsampled:j,renderTo:i}});h("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/File","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/MegaPixel","moxie/core/utils/Mime","moxie/core/utils/Env"],function(o,i,p,k,m,r,q,j,l){function n(){var C=this,B,G,A,w,E,I=false,t=true;i.extend(this,{loadFromBlob:function(N){var K=this,O=K.getRuntime(),J=arguments.length>1?arguments[1]:true;if(!O.can("access_binary")){throw new p.RuntimeError(p.RuntimeError.NOT_SUPPORTED_ERR)}E=N;if(N.isDetached()){w=N.getSource();z.call(this,w);return}else{F.call(this,N.getSource(),function(P){if(J){w=H(P)}z.call(K,P)})}},loadFromImage:function(J,K){this.meta=J.meta;E=new m(null,{name:J.name,size:J.size,type:J.type});z.call(this,K?(w=J.getAsBinaryString()):J.getAsDataURL())},getInfo:function(){var J=this.getRuntime(),K;if(!G&&w&&J.can("access_image_binary")){G=new r(w)}K={width:x().width||0,height:x().height||0,type:E.type||j.getFileMime(E.name),size:w&&w.length||E.size||0,name:E.name||"",meta:G&&G.meta||this.meta||{}};return K},downsize:function(){s.apply(this,arguments)},getAsCanvas:function(){if(A){A.id=this.uid+"_canvas"}return A},getAsBlob:function(J,K){if(J!==this.type){s.call(this,this.width,this.height,false)}return new m(null,{name:E.name||"",type:J,data:C.getAsBinaryString.call(this,J,K)})},getAsDataURL:function(K){var N=arguments[1]||90;if(!I){return B.src}if("image/jpeg"!==K){return A.toDataURL("image/png")}else{try{return A.toDataURL("image/jpeg",N/100)}catch(J){return A.toDataURL("image/jpeg")}}},getAsBinaryString:function(K,O){if(!I){if(!w){w=H(C.getAsDataURL(K,O))}return w}if("image/jpeg"!==K){w=H(C.getAsDataURL(K,O))}else{var N;if(!O){O=90}try{N=A.toDataURL("image/jpeg",O/100)}catch(J){N=A.toDataURL("image/jpeg")}w=H(N);if(G){w=G.stripHeaders(w);if(t){if(G.meta&&G.meta.exif){G.setExif({PixelXDimension:this.width,PixelYDimension:this.height})}w=G.writeHeaders(w)}G.purge();G=null}}I=false;return w},destroy:function(){C=null;u.call(this);this.getRuntime().getShim().removeInstance(this.uid)}});function x(){if(!A&&!B){throw new p.ImageError(p.DOMException.INVALID_STATE_ERR)}return A||B}function H(J){return k.atob(J.substring(J.indexOf("base64,")+7))}function D(K,J){return"data:"+(J||"")+";base64,"+k.btoa(K)}function z(K){var J=this;B=new Image();B.onerror=function(){u.call(this);J.trigger("error",p.ImageError.WRONG_FORMAT)};B.onload=function(){J.trigger("load")};B.src=/^data:[^;]*;base64,/.test(K)?K:D(K,E.type)}function F(N,O){var K=this,J;if(window.FileReader){J=new FileReader();J.onload=function(){O(this.result)};J.onerror=function(){K.trigger("error",p.ImageError.WRONG_FORMAT)};J.readAsDataURL(N)}else{return O(N.getAsDataURL())}}function s(K,X,S,U){var Y=this,P,O,V=0,T=0,R,W,N,J;t=U;J=(this.meta&&this.meta.tiff&&this.meta.tiff.Orientation)||1;if(i.inArray(J,[5,6,7,8])!==-1){var Q=K;K=X;X=Q}R=x();if(!S){P=Math.min(K/R.width,X/R.height)}else{K=Math.min(K,R.width);X=Math.min(X,R.height);P=Math.max(K/R.width,X/R.height)}if(P>1&&!S&&U){this.trigger("Resize");return}if(!A){A=document.createElement("canvas")}W=Math.round(R.width*P);N=Math.round(R.height*P);if(S){A.width=K;A.height=X;if(W>K){V=Math.round((W-K)/2)}if(N>X){T=Math.round((N-X)/2)}}else{A.width=W;A.height=N}if(!t){y(A.width,A.height,J)}v.call(this,R,A,-V,-T,W,N);this.width=A.width;this.height=A.height;I=true;Y.trigger("Resize")}function v(O,P,J,R,N,Q){if(l.OS==="iOS"){q.renderTo(O,P,{width:N,height:Q,x:J,y:R})}else{var K=P.getContext("2d");K.drawImage(O,J,R,N,Q)}}function y(O,J,N){switch(N){case 5:case 6:case 7:case 8:A.width=J;A.height=O;break;default:A.width=O;A.height=J}var K=A.getContext("2d");switch(N){case 2:K.translate(O,0);K.scale(-1,1);break;case 3:K.translate(O,J);K.rotate(Math.PI);break;case 4:K.translate(0,J);K.scale(1,-1);break;case 5:K.rotate(0.5*Math.PI);K.scale(1,-1);break;case 6:K.rotate(0.5*Math.PI);K.translate(0,-J);break;case 7:K.rotate(0.5*Math.PI);K.translate(O,-J);K.scale(-1,1);break;case 8:K.rotate(-0.5*Math.PI);K.translate(-O,0);break}}function u(){if(G){G.purge();G=null}w=B=A=E=null;I=false}}return(o.Image=n)});h("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(j,m,k,p,i){var n="flash",o={};function l(){var r;try{r=navigator.plugins["Shockwave Flash"];r=r.description}catch(t){try{r=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(s){r="0.0"}}r=r.match(/\d+/g);return parseFloat(r[0]+"."+r[1])}function q(s){var r=this,t;s=j.extend({swf_url:m.swf_url},s);i.call(this,s,n,{access_binary:function(u){return u&&r.mode==="browser"},access_image_binary:function(u){return u&&r.mode==="browser"},display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:false,report_upload_progress:function(){return r.mode==="client"},resize_image:i.capTrue,return_response_headers:false,return_response_type:function(u){if(u==="json"&&!!window.JSON){return true}return !j.arrayDiff(u,["","text","document"])||r.mode==="browser"},return_status_code:function(u){return r.mode==="browser"||!j.arrayDiff(u,[200,404])},select_file:i.capTrue,select_multiple:i.capTrue,send_binary_string:function(u){return u&&r.mode==="browser"},send_browser_cookies:function(u){return u&&r.mode==="browser"},send_custom_headers:function(u){return u&&r.mode==="browser"},send_multipart:i.capTrue,slice_blob:function(u){return u&&r.mode==="browser"},stream_upload:function(u){return u&&r.mode==="browser"},summon_file_dialog:false,upload_filesize:function(u){return j.parseSizeStr(u)<=2097152||r.mode==="client"},use_http_method:function(u){return !j.arrayDiff(u,["GET","POST"])}},{access_binary:function(u){return u?"browser":"client"},access_image_binary:function(u){return u?"browser":"client"},report_upload_progress:function(u){return u?"browser":"client"},return_response_type:function(u){return j.arrayDiff(u,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(u){return j.arrayDiff(u,[200,404])?"browser":["client","browser"]},send_binary_string:function(u){return u?"browser":"client"},send_browser_cookies:function(u){return u?"browser":"client"},send_custom_headers:function(u){return u?"browser":"client"},stream_upload:function(u){return u?"client":"browser"},upload_filesize:function(u){return j.parseSizeStr(u)>=2097152?"client":"browser"}},"client");if(l()<10){this.mode=false}j.extend(this,{getShim:function(){return k.get(this.uid)},shimExec:function(v,w){var u=[].slice.call(arguments,2);return r.getShim().exec(this.uid,v,w,u)},init:function(){var v,w,u;u=this.getShimContainer();j.extend(u.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});v='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+s.swf_url+'" ';if(m.browser==="IE"){v+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}v+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+s.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+m.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';if(m.browser==="IE"){w=document.createElement("div");u.appendChild(w);w.outerHTML=v;w=u=null}else{u.innerHTML=v}t=setTimeout(function(){if(r&&!r.initialized){r.trigger("Error",new p.RuntimeError(p.RuntimeError.NOT_INIT_ERR))}},5000)},destroy:(function(u){return function(){u.call(r);clearTimeout(t);s=t=u=r=null}}(this.destroy))},o)}i.addConstructor(n,q);return o});h("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(j,k){var i={slice:function(n,p,l,o){var m=this.getRuntime();if(p<0){p=Math.max(n.size+p,0)}else{if(p>0){p=Math.min(p,n.size)}}if(l<0){l=Math.max(n.size+l,0)}else{if(l>0){l=Math.min(l,n.size)}}n=m.shimExec.call(this,"Blob","slice",p,l,o||"");if(n){n=new k(m.uid,n)}return n}};return(j.Blob=i)});h("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime"],function(i){var j={init:function(k){this.getRuntime().shimExec.call(this,"FileInput","init",{name:k.name,accept:k.accept,multiple:k.multiple});this.trigger("ready")}};return(i.FileInput=j)});h("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(l,i){var j="";function k(n,o){switch(o){case"readAsText":return i.atob(n,"utf8");case"readAsBinaryString":return i.atob(n);case"readAsDataURL":return n}return null}var m={read:function(q,o){var p=this,n=p.getRuntime();if(q==="readAsDataURL"){j="data:"+(o.type||"")+";base64,"}p.bind("Progress",function(s,r){if(r){j+=k(r,q)}});return n.shimExec.call(this,"FileReader","readAsBase64",o.uid)},getResult:function(){return j},destroy:function(){j=null}};return(l.FileReader=m)});h("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(k,i){function j(m,n){switch(n){case"readAsText":return i.atob(m,"utf8");case"readAsBinaryString":return i.atob(m);case"readAsDataURL":return m}return null}var l={read:function(p,o){var m,n=this.getRuntime();m=n.shimExec.call(this,"FileReaderSync","readAsBase64",o.uid);if(!m){return null}if(p==="readAsDataURL"){m="data:"+(o.type||"")+";base64,"+m}return j(m,p,o.type)}};return(k.FileReaderSync=l)});h("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter"],function(j,m,p,i,o,n,l){var k={send:function(x,s){var u=this,y=u.getRuntime();function r(){x.transport=y.mode;y.shimExec.call(u,"XMLHttpRequest","send",x,s)}function t(A,z){y.shimExec.call(u,"XMLHttpRequest","appendBlob",A,z.uid);s=null;r()}function v(A,z){var B=new l();B.bind("TransportingComplete",function(){z(this.result)});B.transport(A.getSource(),A.type,{ruid:y.uid})}if(!m.isEmptyObj(x.headers)){m.each(x.headers,function(z,A){y.shimExec.call(u,"XMLHttpRequest","setRequestHeader",A,z.toString())})}if(s instanceof n){var w;s.each(function(A,z){if(A instanceof p){w=z}else{y.shimExec.call(u,"XMLHttpRequest","append",z,A)}});if(!s.hasBlob()){s=null;r()}else{var q=s.getBlob();if(q.isDetached()){v(q,function(z){q.destroy();t(w,z)})}else{t(w,q)}}}else{if(s instanceof p){if(s.isDetached()){v(s,function(z){s.destroy();s=z.uid;r()})}else{s=s.uid;r()}}else{r()}}},getResponse:function(t){var q,s,r=this.getRuntime();s=r.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob");if(s){s=new i(r.uid,s);if("blob"===t){return s}try{q=new o();if(!!~m.inArray(t,["","text"])){return q.readAsText(s)}else{if("json"===t&&!!window.JSON){return JSON.parse(q.readAsText(s))}}}finally{s.destroy()}}return null},abort:function(r){var q=this.getRuntime();q.shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}};return(j.XMLHttpRequest=k)});h("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(i,k){var j={getAsBlob:function(n){var m=this.getRuntime(),l=m.shimExec.call(this,"Transporter","getAsBlob",n);if(l){return new k(m.uid,l)}return null}};return(i.Transporter=j)});h("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(j,l,k,n,m){var i={loadFromBlob:function(r){var q=this,p=q.getRuntime();function o(t){p.shimExec.call(q,"Image","loadFromBlob",t.uid);q=p=null}if(r.isDetached()){var s=new k();s.bind("TransportingComplete",function(){o(s.result.getSource())});s.transport(r.getSource(),r.type,{ruid:p.uid})}else{o(r.getSource())}},loadFromImage:function(p){var o=this.getRuntime();return o.shimExec.call(this,"Image","loadFromImage",p.uid)},getAsBlob:function(q,r){var p=this.getRuntime(),o=p.shimExec.call(this,"Image","getAsBlob",q,r);if(o){return new n(p.uid,o)}return null},getAsDataURL:function(){var q=this.getRuntime(),p=q.Image.getAsBlob.apply(this,arguments),o;if(!p){return null}o=new m();return o.readAsDataURL(p)}};return(j.Image=i)});h("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(j,m,l,p,i){var n="silverlight",o={};function q(z){var C=false,v=null,r,s,t,B,u,x=0;try{try{v=new ActiveXObject("AgControl.AgControl");if(v.IsVersionSupported(z)){C=true}v=null}catch(y){var w=navigator.plugins["Silverlight Plug-In"];if(w){r=w.description;if(r==="1.0.30226.2"){r="2.0.30226.2"}s=r.split(".");while(s.length>3){s.pop()}while(s.length<4){s.push(0)}t=z.split(".");while(t.length>4){t.pop()}do{B=parseInt(t[x],10);u=parseInt(s[x],10);x++}while(x<t.length&&B===u);if(B<=u&&!isNaN(B)){C=true}}}}catch(A){C=false}return C}function k(s){var r=this,t;s=j.extend({xap_url:m.xap_url},s);i.call(this,s,n,{access_binary:i.capTrue,access_image_binary:i.capTrue,display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:false,report_upload_progress:i.capTrue,resize_image:i.capTrue,return_response_headers:function(u){return u&&r.mode==="client"},return_response_type:function(u){if(u!=="json"){return true}else{return !!window.JSON}},return_status_code:function(u){return r.mode==="client"||!j.arrayDiff(u,[200,404])},select_file:i.capTrue,select_multiple:i.capTrue,send_binary_string:i.capTrue,send_browser_cookies:function(u){return u&&r.mode==="browser"},send_custom_headers:function(u){return u&&r.mode==="client"},send_multipart:i.capTrue,slice_blob:i.capTrue,stream_upload:true,summon_file_dialog:false,upload_filesize:i.capTrue,use_http_method:function(u){return r.mode==="client"||!j.arrayDiff(u,["GET","POST"])}},{return_response_headers:function(u){return u?"client":"browser"},return_status_code:function(u){return j.arrayDiff(u,[200,404])?"client":["client","browser"]},send_browser_cookies:function(u){return u?"browser":"client"},send_custom_headers:function(u){return u?"client":"browser"},use_http_method:function(u){return j.arrayDiff(u,["GET","POST"])?"client":["client","browser"]}});if(!q("2.0.31005.0")||m.browser==="Opera"){this.mode=false}j.extend(this,{getShim:function(){return l.get(this.uid).content.Moxie},shimExec:function(v,w){var u=[].slice.call(arguments,2);return r.getShim().exec(this.uid,v,w,u)},init:function(){var u;u=this.getShimContainer();u.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+s.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+m.global_event_dispatcher+'"/></object>';t=setTimeout(function(){if(r&&!r.initialized){r.trigger("Error",new p.RuntimeError(p.RuntimeError.NOT_INIT_ERR))}},m.OS!=="Windows"?10000:5000)},destroy:(function(u){return function(){u.call(r);clearTimeout(t);s=t=u=r=null}}(this.destroy))},o)}i.addConstructor(n,k);return o});h("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(i,j,k){return(i.Blob=j.extend({},k))});h("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(i){var j={init:function(l){function k(n){var o="";for(var m=0;m<n.length;m++){o+=(o!==""?"|":"")+n[m].title+" | *."+n[m].extensions.replace(/,/g,";*.")}return o}this.getRuntime().shimExec.call(this,"FileInput","init",k(l.accept),l.name,l.multiple);this.trigger("ready")}};return(i.FileInput=j)});h("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(k,j,i){var l={init:function(){var n=this,m=n.getRuntime(),o;o=m.getShimContainer();i.addEvent(o,"dragover",function(p){p.preventDefault();p.stopPropagation();p.dataTransfer.dropEffect="copy"},n.uid);i.addEvent(o,"dragenter",function(q){q.preventDefault();var p=j.get(m.uid).dragEnter(q);if(p){q.stopPropagation()}},n.uid);i.addEvent(o,"drop",function(q){q.preventDefault();var p=j.get(m.uid).dragDrop(q);if(p){q.stopPropagation()}},n.uid);return m.shimExec.call(this,"FileDrop","init")}};return(k.FileDrop=l)});h("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(i,k,j){return(i.FileReader=k.extend({},j))});h("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(i,j,k){return(i.FileReaderSync=j.extend({},k))});h("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(i,k,j){return(i.XMLHttpRequest=k.extend({},j))});h("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(i,k,j){return(i.Transporter=k.extend({},j))});h("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(j,k,i){return(j.Image=k.extend({},i,{getInfo:function(){var m=this.getRuntime(),n=["tiff","exif","gps"],o={meta:{}},l=m.shimExec.call(this,"Image","getInfo");if(l.meta){k.each(n,function(q){var u=l.meta[q],p,r,s,t;if(u&&u.keys){o.meta[q]={};for(r=0,s=u.keys.length;r<s;r++){p=u.keys[r];t=u[p];if(t){if(/^(\d|[1-9]\d+)$/.test(t)){t=parseInt(t,10)}else{if(/^\d*\.\d+$/.test(t)){t=parseFloat(t)}}o.meta[q][p]=t}}}})}o.width=parseInt(l.width,10);o.height=parseInt(l.height,10);o.size=parseInt(l.size,10);o.type=l.type;o.name=l.name;return o}}))});h("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(o,i,l,k){var n="html4",m={};function j(q){var p=this,s=l.capTest,r=l.capTrue;l.call(this,q,n,{access_binary:s(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:false,display_media:s(m.Image&&(k.can("create_canvas")||k.can("use_data_uri_over32kb"))),do_cors:false,drag_and_drop:false,filter_by_extension:s(function(){return(k.browser==="Chrome"&&k.version>=28)||(k.browser==="IE"&&k.version>=10)}()),resize_image:function(){return m.Image&&p.can("access_binary")&&k.can("create_canvas")},report_upload_progress:false,return_response_headers:false,return_response_type:function(t){if(t==="json"&&!!window.JSON){return true}return !!~o.inArray(t,["text","document",""])},return_status_code:function(t){return !o.arrayDiff(t,[200,404])},select_file:function(){return k.can("use_fileinput")},select_multiple:false,send_binary_string:false,send_custom_headers:false,send_multipart:true,slice_blob:false,stream_upload:function(){return p.can("select_file")},summon_file_dialog:s(function(){return(k.browser==="Firefox"&&k.version>=4)||(k.browser==="Opera"&&k.version>=12)||!!~o.inArray(k.browser,["Chrome","Safari"])}()),upload_filesize:r,use_http_method:function(t){return !o.arrayDiff(t,["GET","POST"])}});o.extend(this,{init:function(){this.trigger("Init")},destroy:(function(t){return function(){t.call(p);t=p=null}}(this.destroy))});o.extend(this.getShim(),m)}l.addConstructor(n,j);return m});h("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(m,o,l,j,k,i){function n(){var s,q=[],t=[],p;function r(){var w=this,z=w.getRuntime(),y,x,u,B,v,A;A=o.guid("uid_");y=z.getShimContainer();if(s){u=l.get(s+"_form");if(u){o.extend(u.style,{top:"100%"})}}B=document.createElement("form");B.setAttribute("id",A+"_form");B.setAttribute("method","post");B.setAttribute("enctype","multipart/form-data");B.setAttribute("encoding","multipart/form-data");o.extend(B.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});v=document.createElement("input");v.setAttribute("id",A);v.setAttribute("type","file");v.setAttribute("name",p.name||"Filedata");v.setAttribute("accept",t.join(","));o.extend(v.style,{fontSize:"999px",opacity:0});B.appendChild(v);y.appendChild(B);o.extend(v.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});if(i.browser==="IE"&&i.version<10){o.extend(v.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"})}v.onchange=function(){var D;if(!this.value){return}if(this.files){D=this.files[0]}else{D={name:this.value}}q=[D];this.onchange=function(){};r.call(w);w.bind("change",function C(){var E=l.get(A),G=l.get(A+"_form"),F;w.unbind("change",C);if(w.files.length&&E&&G){F=w.files[0];E.setAttribute("id",F.uid);G.setAttribute("id",F.uid+"_form");G.setAttribute("target",F.uid+"_iframe")}E=G=null},998);v=B=null;w.trigger("change")};if(z.can("summon_file_dialog")){x=l.get(p.browse_button);j.removeEvent(x,"click",w.uid);j.addEvent(x,"click",function(C){if(v&&!v.disabled){v.click()}C.preventDefault()},w.uid)}s=A;y=u=x=null}o.extend(this,{init:function(x){var u=this,w=u.getRuntime(),v;p=x;t=x.accept.mimes||k.extList2mimes(x.accept,w.can("filter_by_extension"));v=w.getShimContainer();(function(){var y,A,z;y=l.get(x.browse_button);A=parseInt(l.getStyle(y,"z-index"),10)||0;if(w.can("summon_file_dialog")){if(l.getStyle(y,"position")==="static"){y.style.position="relative"}v.style.zIndex=A-1}else{v.style.zIndex=A}z=w.can("summon_file_dialog")?y:v;j.addEvent(z,"mouseover",function(){u.trigger("mouseenter")},u.uid);j.addEvent(z,"mouseout",function(){u.trigger("mouseleave")},u.uid);j.addEvent(z,"mousedown",function(){u.trigger("mousedown")},u.uid);j.addEvent(l.get(x.container),"mouseup",function(){u.trigger("mouseup")},u.uid);y=null}());r.call(this);v=null;u.trigger({type:"ready",async:true})},getFiles:function(){return q},disable:function(v){var u;if((u=l.get(s))){u.disabled=!!v}},destroy:function(){var v=this.getRuntime(),w=v.getShim(),u=v.getShimContainer();j.removeAllEvents(u,this.uid);j.removeAllEvents(p&&l.get(p.container),this.uid);j.removeAllEvents(p&&l.get(p.browse_button),this.uid);if(u){u.innerHTML=""}w.removeInstance(this.uid);s=q=t=p=u=w=null}})}return(m.FileInput=n)});h("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(i,j){return(i.FileReader=j)});h("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(m,j,l,i,n,p,k,q){function o(){var t,r,u;function s(v){var A=this,y,z,w,x,B=false;if(!u){return}y=u.id.replace(/_iframe$/,"");z=l.get(y+"_form");if(z){w=z.getElementsByTagName("input");x=w.length;while(x--){switch(w[x].getAttribute("type")){case"hidden":w[x].parentNode.removeChild(w[x]);break;case"file":B=true;break}}w=[];if(!B){z.parentNode.removeChild(z)}z=null}setTimeout(function(){p.removeEvent(u,"load",A.uid);if(u.parentNode){u.parentNode.removeChild(u)}var C=A.getRuntime().getShimContainer();if(!C.children.length){C.parentNode.removeChild(C)}C=u=null;v()},1)}j.extend(this,{send:function(D,x){var z=this,C=z.getRuntime(),y,w,B,v;t=r=null;function A(){var E=C.getShimContainer()||document.body,F=document.createElement("div");F.innerHTML='<iframe id="'+y+'_iframe" name="'+y+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';u=F.firstChild;E.appendChild(u);p.addEvent(u,"load",function(){var H;try{H=u.contentWindow.document||u.contentDocument||window.frames[u.id].document;if(/^4(0[0-9]|1[0-7]|2[2346])\s/.test(H.title)){t=H.title.replace(/^(\d+).*$/,"$1")}else{t=200;r=j.trim(H.body.innerHTML);z.trigger({type:"progress",loaded:r.length,total:r.length});if(v){z.trigger({type:"uploadprogress",loaded:v.size||1025,total:v.size||1025})}}}catch(G){if(i.hasSameOrigin(D.url)){t=404}else{s.call(z,function(){z.trigger("error")});return}}s.call(z,function(){z.trigger("load")})},z.uid)}if(x instanceof q&&x.hasBlob()){v=x.getBlob();y=v.uid;B=l.get(y);w=l.get(y+"_form");if(!w){throw new n.DOMException(n.DOMException.NOT_FOUND_ERR)}}else{y=j.guid("uid_");w=document.createElement("form");w.setAttribute("id",y+"_form");w.setAttribute("method",D.method);w.setAttribute("enctype","multipart/form-data");w.setAttribute("encoding","multipart/form-data");w.setAttribute("target",y+"_iframe");C.getShimContainer().appendChild(w)}if(x instanceof q){x.each(function(G,E){if(G instanceof k){if(B){B.setAttribute("name",E)}}else{var F=document.createElement("input");j.extend(F,{type:"hidden",name:E,value:G});if(B){w.insertBefore(F,B)}else{w.appendChild(F)}}})}w.setAttribute("action",D.url);A();w.submit();z.trigger("loadstart")},getStatus:function(){return t},getResponse:function(v){if("json"===v){if(j.typeOf(r)==="string"&&!!window.JSON){try{return JSON.parse(r.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(w){return null}}}else{if("document"===v){}}return r},abort:function(){var v=this;if(u&&u.contentWindow){if(u.contentWindow.stop){u.contentWindow.stop()}else{if(u.contentWindow.document.execCommand){u.contentWindow.document.execCommand("Stop")}else{u.src="about:blank"}}}s.call(this,function(){v.dispatchEvent("abort")})}})}return(m.XMLHttpRequest=o)});h("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(j,i){return(j.Image=i)});a(["moxie/core/utils/Basic","moxie/core/I18n","moxie/core/utils/Mime","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/file/File","moxie/file/FileInput","moxie/file/FileDrop","moxie/runtime/RuntimeTarget","moxie/file/FileReader","moxie/core/utils/Url","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/image/Image","moxie/core/utils/Events"])})(this);(function(a){var d={},c=a.moxie.core.utils.Basic.inArray;(function b(f){var e,g;for(e in f){g=typeof(f[e]);if(g==="object"&&!~c(e,["Exceptions","Env","Mime"])){b(f[e])}else{if(g==="function"){d[e]=f[e]}}}})(a.moxie);d.Env=a.moxie.core.utils.Env;d.Mime=a.moxie.core.utils.Mime;d.Exceptions=a.moxie.core.Exceptions;a.mOxie=d;if(!a.o){a.o=d}return d})(this);(function(f,h,e){var d=f.setTimeout,g={};function a(j){var i=j.required_features,k={};function l(n,o,m){var p={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};if(p[n]){k[p[n]]=o}else{if(!m){k[n]=o}}}if(typeof(i)==="string"){c.each(i.split(/\s*,\s*/),function(m){l(m,true)})}else{if(typeof(i)==="object"){c.each(i,function(n,m){l(m,n)})}else{if(i===true){if(j.chunk_size>0){k.slice_blob=true}if(j.resize.enabled||!j.multipart){k.send_binary_string=true}c.each(j,function(n,m){l(m,!!n,true)})}}}return k}var c={VERSION:"2.1.2",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:h.mimes,ua:h.ua,typeOf:h.typeOf,extend:h.extend,guid:h.guid,get:function b(m){var k=[],l;if(h.typeOf(m)!=="array"){m=[m]}var j=m.length;while(j--){l=h.get(m[j]);if(l){k.push(l)}}return k.length?k:null},each:h.each,getPos:h.getPos,getSize:h.getSize,xmlEncode:function(j){var k={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},i=/[<>&\"\']/g;return j?(""+j).replace(i,function(l){return k[l]?"&"+k[l]+";":l}):j},toArray:h.toArray,inArray:h.inArray,addI18n:h.addI18n,translate:h.translate,isEmptyObj:h.isEmptyObj,hasClass:h.hasClass,addClass:h.addClass,removeClass:h.removeClass,getStyle:h.getStyle,addEvent:h.addEvent,removeEvent:h.removeEvent,removeAllEvents:h.removeAllEvents,cleanName:function(j){var k,l;l=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(k=0;k<l.length;k+=2){j=j.replace(l[k],l[k+1])}j=j.replace(/\s+/g,"_");j=j.replace(/[^a-z0-9_\-\.]+/gi,"");return j},buildUrl:function(j,i){var k="";c.each(i,function(m,l){k+=(k?"&":"")+encodeURIComponent(l)+"="+encodeURIComponent(m)});if(k){j+=(j.indexOf("?")>0?"&":"?")+k}return j},formatSize:function(j){if(j===e||/\D/.test(j)){return c.translate("N/A")}function i(m,l){return Math.round(m*Math.pow(10,l))/Math.pow(10,l)}var k=Math.pow(1024,4);if(j>k){return i(j/k,1)+" "+c.translate("tb")}if(j>(k/=1024)){return i(j/k,1)+" "+c.translate("gb")}if(j>(k/=1024)){return i(j/k,1)+" "+c.translate("mb")}if(j>1024){return Math.round(j/1024)+" "+c.translate("kb")}return j+" "+c.translate("b")},parseSize:h.parseSizeStr,predictRuntime:function(k,j){var i,l;i=new c.Uploader(k);l=h.Runtime.thatCan(i.getOption().required_features,j||k.runtimes);i.destroy();return l},addFileFilter:function(j,i){g[j]=i}};c.addFileFilter("mime_types",function(k,j,i){if(k.length&&k.regexp&&!k.regexp.test(j.name)){this.trigger("Error",{code:c.FILE_EXTENSION_ERROR,message:c.translate("File extension error."),file:j});i(false)}else{i(true)}});c.addFileFilter("max_file_size",function(l,j,i){var k;l=c.parseSize(l);if(j.size!==k&&l&&j.size>l){this.trigger("Error",{code:c.FILE_SIZE_ERROR,message:c.translate("File size error."),file:j});i(false)}else{i(true)}});c.addFileFilter("prevent_duplicates",function(l,j,i){if(l){var k=this.files.length;while(k--){if(j.name===this.files[k].name&&j.size===this.files[k].size){this.trigger("Error",{code:c.FILE_DUPLICATE_ERROR,message:c.translate("Duplicate file error."),file:j});i(false);return}}}i(true)});c.Uploader=function(l){var t=c.guid(),G,p=[],x={},F=[],w=[],C,J,n=false,v;function I(){var N,O=0,K;if(this.state==c.STARTED){for(K=0;K<p.length;K++){if(!N&&p[K].status==c.QUEUED){N=p[K];if(this.trigger("BeforeUpload",N)){N.status=c.UPLOADING;this.trigger("UploadFile",N)}}else{O++}}if(O==p.length){if(this.state!==c.STOPPED){this.state=c.STOPPED;this.trigger("StateChanged")}this.trigger("UploadComplete",p)}}}function k(K){K.percent=K.size>0?Math.ceil(K.loaded/K.size*100):100;j()}function j(){var N,K;J.reset();for(N=0;N<p.length;N++){K=p[N];if(K.size!==e){J.size+=K.origSize;J.loaded+=K.loaded*K.origSize/K.size}else{J.size=e}if(K.status==c.DONE){J.uploaded++}else{if(K.status==c.FAILED){J.failed++}else{J.queued++}}}if(J.size===e){J.percent=p.length>0?Math.ceil(J.uploaded/p.length*100):0}else{J.bytesPerSec=Math.ceil(J.loaded/((+new Date()-C||1)/1000));J.percent=J.size>0?Math.ceil(J.loaded/J.size*100):0}}function H(){var K=F[0]||w[0];if(K){return K.getRuntime().uid}return false}function E(N,K){if(N.ruid){var O=h.Runtime.getInfo(N.ruid);if(O){return O.can(K)}}return false}function y(){this.bind("FilesAdded FilesRemoved",function(K){K.trigger("QueueChanged");K.refresh()});this.bind("CancelUpload",i);this.bind("BeforeUpload",B);this.bind("UploadFile",D);this.bind("UploadProgress",u);this.bind("StateChanged",A);this.bind("QueueChanged",j);this.bind("Error",r);this.bind("FileUploaded",s);this.bind("Destroy",q)}function z(R,O){var P=this,N=0,K=[];var Q={runtime_order:R.runtimes,required_caps:R.required_features,preferred_caps:x,swf_url:R.flash_swf_url,xap_url:R.silverlight_xap_url};c.each(R.runtimes.split(/\s*,\s*/),function(S){if(R[S]){Q[S]=R[S]}});if(R.browse_button){c.each(R.browse_button,function(S){K.push(function(T){var U=new h.FileInput(c.extend({},Q,{accept:R.filters.mime_types,name:R.file_data_name,multiple:R.multi_selection,container:R.container,browse_button:S}));U.onready=function(){var V=h.Runtime.getInfo(this.ruid);h.extend(P.features,{chunks:V.can("slice_blob"),multipart:V.can("send_multipart"),multi_selection:V.can("select_multiple")});N++;F.push(this);T()};U.onchange=function(){P.addFile(this.files)};U.bind("mouseenter mouseleave mousedown mouseup",function(V){if(!n){if(R.browse_button_hover){if("mouseenter"===V.type){h.addClass(S,R.browse_button_hover)}else{if("mouseleave"===V.type){h.removeClass(S,R.browse_button_hover)}}}if(R.browse_button_active){if("mousedown"===V.type){h.addClass(S,R.browse_button_active)}else{if("mouseup"===V.type){h.removeClass(S,R.browse_button_active)}}}}});U.bind("mousedown",function(){P.trigger("Browse")});U.bind("error runtimeerror",function(){U=null;T()});U.init()})})}if(R.drop_element){c.each(R.drop_element,function(S){K.push(function(T){var U=new h.FileDrop(c.extend({},Q,{drop_zone:S}));U.onready=function(){var V=h.Runtime.getInfo(this.ruid);P.features.dragdrop=V.can("drag_and_drop");N++;w.push(this);T()};U.ondrop=function(){P.addFile(this.files)};U.bind("error runtimeerror",function(){U=null;T()});U.init()})})}h.inSeries(K,function(){if(typeof(O)==="function"){O(N)}})}function o(O,Q,K){var N=new h.Image();try{N.onload=function(){if(Q.width>this.width&&Q.height>this.height&&Q.quality===e&&Q.preserve_headers&&!Q.crop){this.destroy();return K(O)}N.downsize(Q.width,Q.height,Q.crop,Q.preserve_headers)};N.onresize=function(){K(this.getAsBlob(O.type,Q.quality));this.destroy()};N.onerror=function(){K(O)};N.load(O)}catch(P){K(O)}}function m(O,Q,R){var N=this,K=false;function P(T,U,V){var S=G[T];switch(T){case"max_file_size":if(T==="max_file_size"){G.max_file_size=G.filters.max_file_size=U}break;case"chunk_size":if(U=c.parseSize(U)){G[T]=U;G.send_file_name=true}break;case"multipart":G[T]=U;if(!U){G.send_file_name=true}break;case"unique_names":G[T]=U;if(U){G.send_file_name=true}break;case"filters":if(c.typeOf(U)==="array"){U={mime_types:U}}if(V){c.extend(G.filters,U)}else{G.filters=U}if(U.mime_types){G.filters.mime_types.regexp=(function(W){var X=[];c.each(W,function(Y){Y.extensions&&c.each(Y.extensions.split(/,/),function(Z){if(/^\s*\*\s*$/.test(Z)){X.push("\\.*")}else{X.push("\\."+Z.replace(new RegExp("["+("/^$.*+?|()[]{}\\".replace(/./g,"\\$&"))+"]","g"),"\\$&"))}})});return new RegExp("("+X.join("|")+")$","i")}(G.filters.mime_types))}break;case"resize":if(V){c.extend(G.resize,U,{enabled:true})}else{G.resize=U}break;case"prevent_duplicates":G.prevent_duplicates=G.filters.prevent_duplicates=!!U;break;case"browse_button":case"drop_element":U=c.get(U);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":G[T]=U;if(!V){K=true}break;default:G[T]=U}if(!V){N.trigger("OptionChanged",T,U,S)}}if(typeof(O)==="object"){c.each(O,function(T,S){P(S,T,R)})}else{P(O,Q,R)}if(R){G.required_features=a(c.extend({},G));x=a(c.extend({},G,{required_features:true}))}else{if(K){N.trigger("Destroy");z.call(N,G,function(S){if(S){N.runtime=h.Runtime.getInfo(H()).type;N.trigger("Init",{runtime:N.runtime});N.trigger("PostInit")}else{N.trigger("Error",{code:c.INIT_ERROR,message:c.translate("Init error.")})}})}}}function B(K,N){if(K.settings.unique_names){var P=N.name.match(/\.([^.]+)$/),O="part";if(P){O=P[1]}N.target_name=N.id+"."+O}}function D(U,R){var O=U.settings.url,S=U.settings.chunk_size,V=U.settings.max_retries,P=U.features,T=0,K;if(R.loaded){T=R.loaded=S?S*Math.floor(R.loaded/S):0}function Q(){if(V-->0){d(N,1000)}else{R.loaded=T;U.trigger("Error",{code:c.HTTP_ERROR,message:c.translate("HTTP Error."),file:R,response:v.responseText,status:v.status,responseHeaders:v.getAllResponseHeaders()})}}function N(){var Y,X,W={},aa;if(R.status!==c.UPLOADING||U.state===c.STOPPED){return}if(U.settings.send_file_name){W.name=R.target_name||R.name}if(S&&P.chunks&&K.size>S){aa=Math.min(S,K.size-T);Y=K.slice(T,T+aa)}else{aa=K.size;Y=K}if(S&&P.chunks){if(U.settings.send_chunk_number){W.chunk=Math.ceil(T/S);W.chunks=Math.ceil(K.size/S)}else{W.offset=T;W.total=K.size}}v=new h.XMLHttpRequest();if(v.upload){v.upload.onprogress=function(ab){R.loaded=Math.min(R.size,T+ab.loaded);U.trigger("UploadProgress",R)}}var Z=v;v.onload=function(){if(Z.status>=400){Q();return}V=U.settings.max_retries;if(aa<K.size){Y.destroy();T+=aa;R.loaded=Math.min(T,K.size);U.trigger("ChunkUploaded",R,{offset:R.loaded,total:K.size,response:Z.responseText,status:Z.status,responseHeaders:Z.getAllResponseHeaders()});if(h.Env.browser==="Android Browser"){U.trigger("UploadProgress",R)}}else{R.loaded=R.size}Y=X=null;if(!T||T>=K.size){if(R.size!=R.origSize){K.destroy();K=null}U.trigger("UploadProgress",R);R.status=c.DONE;U.trigger("FileUploaded",R,{response:Z.responseText,status:Z.status,responseHeaders:Z.getAllResponseHeaders()})}else{d(N,1)}};v.onerror=function(){Q()};v.onloadend=function(){this.destroy();Z=null};if(U.settings.multipart&&P.multipart){v.open("post",O,true);c.each(U.settings.headers,function(ac,ab){v.setRequestHeader(ab,ac)});X=new h.FormData();c.each(c.extend(W,U.settings.multipart_params),function(ac,ab){X.append(ab,ac)});X.append(U.settings.file_data_name,Y);v.send(X,{runtime_order:U.settings.runtimes,required_caps:U.settings.required_features,preferred_caps:x,swf_url:U.settings.flash_swf_url,xap_url:U.settings.silverlight_xap_url})}else{O=c.buildUrl(U.settings.url,c.extend(W,U.settings.multipart_params));v.open("post",O,true);v.setRequestHeader("Content-Type","application/octet-stream");c.each(U.settings.headers,function(ac,ab){v.setRequestHeader(ab,ac)});v.send(Y,{runtime_order:U.settings.runtimes,required_caps:U.settings.required_features,preferred_caps:x,swf_url:U.settings.flash_swf_url,xap_url:U.settings.silverlight_xap_url})}}K=R.getSource();if(U.settings.resize.enabled&&E(K,"send_binary_string")&&!!~h.inArray(K.type,["image/jpeg","image/png"])){o.call(this,K,U.settings.resize,function(W){K=W;R.size=W.size;N()})}else{N()}}function u(K,N){k(N)}function A(K){if(K.state==c.STARTED){C=(+new Date())}else{if(K.state==c.STOPPED){for(var N=K.files.length-1;N>=0;N--){if(K.files[N].status==c.UPLOADING){K.files[N].status=c.QUEUED;j()}}}}}function i(){if(v){v.abort()}}function s(K){j();d(function(){I.call(K)},1)}function r(K,N){if(N.code===c.INIT_ERROR){K.destroy()}else{if(N.file){N.file.status=c.FAILED;k(N.file);if(K.state==c.STARTED){K.trigger("CancelUpload");d(function(){I.call(K)},1)}}}}function q(K){K.stop();c.each(p,function(N){N.destroy()});p=[];if(F.length){c.each(F,function(N){N.destroy()});F=[]}if(w.length){c.each(w,function(N){N.destroy()});w=[]}x={};n=false;C=v=null;J.reset()}G={runtimes:h.Runtime.order,max_retries:0,chunk_size:0,multipart:true,multi_selection:true,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:false,max_file_size:0},resize:{enabled:false,preserve_headers:true,crop:false},send_file_name:true,send_chunk_number:true};m.call(this,l,null,true);J=new c.QueueProgress();c.extend(this,{id:t,uid:t,state:c.STOPPED,features:{},runtime:null,files:p,settings:G,total:J,init:function(){var K=this;if(typeof(G.preinit)=="function"){G.preinit(K)}else{c.each(G.preinit,function(O,N){K.bind(N,O)})}y.call(this);if(!G.browse_button||!G.url){this.trigger("Error",{code:c.INIT_ERROR,message:c.translate("Init error.")});return}z.call(this,G,function(N){if(typeof(G.init)=="function"){G.init(K)}else{c.each(G.init,function(P,O){K.bind(O,P)})}if(N){K.runtime=h.Runtime.getInfo(H()).type;K.trigger("Init",{runtime:K.runtime});K.trigger("PostInit")}else{K.trigger("Error",{code:c.INIT_ERROR,message:c.translate("Init error.")})}})},setOption:function(K,N){m.call(this,K,N,!this.runtime)},getOption:function(K){if(!K){return G}return G[K]},refresh:function(){if(F.length){c.each(F,function(K){K.trigger("Refresh")})}this.trigger("Refresh")},start:function(){if(this.state!=c.STARTED){this.state=c.STARTED;this.trigger("StateChanged");I.call(this)}},stop:function(){if(this.state!=c.STOPPED){this.state=c.STOPPED;this.trigger("StateChanged");this.trigger("CancelUpload")}},disableBrowse:function(){n=arguments[0]!==e?arguments[0]:true;if(F.length){c.each(F,function(K){K.disable(n)})}this.trigger("DisableBrowse",n)},getFile:function(N){var K;for(K=p.length-1;K>=0;K--){if(p[K].id===N){return p[K]}}},addFile:function(R,T){var O=this,K=[],N=[],P;function S(W,V){var U=[];h.each(O.settings.filters,function(Y,X){if(g[X]){U.push(function(Z){g[X].call(O,Y,W,function(aa){Z(!aa)})})}});h.inSeries(U,V)}function Q(U){var V=h.typeOf(U);if(U instanceof h.File){if(!U.ruid&&!U.isDetached()){if(!P){return false}U.ruid=P;U.connectRuntime(P)}Q(new c.File(U))}else{if(U instanceof h.Blob){Q(U.getSource());U.destroy()}else{if(U instanceof c.File){if(T){U.name=T}K.push(function(W){S(U,function(X){if(!X){p.push(U);N.push(U);O.trigger("FileFiltered",U)}d(W,1)})})}else{if(h.inArray(V,["file","blob"])!==-1){Q(new h.File(null,U))}else{if(V==="node"&&h.typeOf(U.files)==="filelist"){h.each(U.files,Q)}else{if(V==="array"){T=null;h.each(U,Q)}}}}}}}P=H();Q(R);if(K.length){h.inSeries(K,function(){if(N.length){O.trigger("FilesAdded",N)}})}},removeFile:function(N){var O=typeof(N)==="string"?N:N.id;for(var K=p.length-1;K>=0;K--){if(p[K].id===O){return this.splice(K,1)[0]}}},splice:function(P,K){var N=p.splice(P===e?0:P,K===e?p.length:K);var O=false;if(this.state==c.STARTED){c.each(N,function(Q){if(Q.status===c.UPLOADING){O=true;return false}});if(O){this.stop()}}this.trigger("FilesRemoved",N);c.each(N,function(Q){Q.destroy()});if(O){this.start()}return N},bind:function(N,P,O){var K=this;c.Uploader.prototype.bind.call(this,N,function(){var Q=[].slice.call(arguments);Q.splice(0,1,K);return P.apply(this,Q)},0,O)},destroy:function(){this.trigger("Destroy");G=J=null;this.unbindAll()}})};c.Uploader.prototype=h.EventTarget.instance;c.File=(function(){var j={};function i(k){c.extend(this,{id:c.guid(),name:k.name||k.fileName,type:k.type||"",size:k.size||k.fileSize,origSize:k.size||k.fileSize,loaded:0,percent:0,status:c.QUEUED,lastModifiedDate:k.lastModifiedDate||(new Date()).toLocaleString(),getNative:function(){var l=this.getSource().getSource();return h.inArray(h.typeOf(l),["blob","file"])!==-1?l:null},getSource:function(){if(!j[this.id]){return null}return j[this.id]},destroy:function(){var l=this.getSource();if(l){l.destroy();delete j[this.id]}}});j[this.id]=k}return i}());c.QueueProgress=function(){var i=this;i.size=0;i.loaded=0;i.uploaded=0;i.failed=0;i.queued=0;i.percent=0;i.bytesPerSec=0;i.reset=function(){i.size=i.loaded=i.uploaded=i.failed=i.queued=i.percent=i.bytesPerSec=0}};f.plupload=c}(window,mOxie));if(window.M&&typeof M.define=="function"){M.define("/js/plupload",function(){return window.plupload})}M.define("/js/module/uploader/Pluploader",function(f,d,g){var e=f("/js/plupload"),b=0;function c(){b+=1;return"_j_pluplader_btn_container_"+b}function a(j,i,m,k){var n=$(j).parent(),o=n.attr("id"),h=o||c();j=$(j).get(0);if(!o){n.attr("id",h)}var l=new e.Uploader(M.mix({multipart:"form-data",browse_button:j,container:h},i));l.init();M.forEach(m,function(q,p){l.bind(p,M.bind(q,k))});return l}return a});M.define("/js/common/CommentPicDialog",function(e,c,g){e("jq-tmpl");var f=e("dialog/alert"),a=e("dialog/Dialog"),b='<div class="bd"><ul class="_j_imglist"></ul></div>    	                          <div class="action"><a class="btn-large _j_commit" role="button">提交</a><span>共<em class="_j_imglength"></em>张照片</span></div>',d='<li data-id="${img.id}" data-imgstr="${img.imgstr}" class="_j_imgitem _j_imgitem_${img.id}{{if !img.src}} _j_waiting{{/if}}">                                <div class="img">                                    {{if img.src}}<img class="_j_uploadimg" style="width: 100px;height: 100px" src="${img.src}" />{{else}}                                    <div class="mask"></div>                                    <div class="bar uploderate">                                        <i class="bg"></i>                                        <span class="start">等待上传</span>                                        <em class="progress_bar" style="width:0;"></em>                                    </div>{{/if}}                                </div>                                <textarea class="_j_piccomment" placeholder="照片描述？在哪拍的？">${img.title}</textarea>                                <a class="btn-remove _j_remove_li" role="button"></a>                            </li>';function h(j){var m=j.imgs;if(!m.length){M.error("comment pic dialog has no pics");return false}var i=new a({PANEL_CLASS:"popup-box pop-upload",content:b,bgOpacity:0,stackable:false,layerZIndex:2000,impl:"COMMENT_PIC"}),k=i.getPanel();var l=k.find("._j_imglist");M.forEach(m,function(n,o){$.tmpl(d,{img:n}).appendTo(l)});k.find("._j_imglength").text(m.length);if(j.waiting){M.Event(this).on("img upload progress updated",function(n){if(n.percent>0){var o=k.find("._j_imgitem_"+n.id);if(o.length){o.find(".start").text(n.percent+"%");o.find(".progress_bar").width(n.percent+"%")}}});M.Event(this).on("img upload finish",function(n){var o=k.find("._j_imgitem_"+n.id);if(o.length){o.children(".img").prepend('<img class="_j_uploadimg" style="width: 100px;height: 100px" src="'+n.src+'" />');o.find(".uploderate").addClass("hide");o.data("imgstr",n.imgstr);o.data("id",0);o.removeClass("_j_waiting")}})}if(j.edit){k.find("._j_remove_li").addClass("hide")}this.dialog=i;this.bindEvents(k)}M.mix(h.prototype,{show:function(){this.dialog.show()},bindEvents:function(i){i.on("click","._j_remove_li",$.proxy(function(n){var k=$(n.currentTarget),j=k.parent(),m=i.find("._j_imglength"),l=(+m.text())-1;m.text(l);M.Event(this).fire("img removed",{file_id:j.data("id")});j.remove();if(l===0){this.dialog.close()}},this)).on("click","._j_commit",$.proxy(function(k){var j=i.find("._j_waiting");if(j.length){f.pop("图片正在上传中，请稍后...");return false}var m=i.find("._j_imgitem"),l=[];m.each(function(n,o){o=$(o);l.push({id:o.data("id"),imgstr:o.data("imgstr"),src:o.find("._j_uploadimg").attr("src"),title:o.children("._j_piccomment").val()})});M.Event(this).fire("imgs committed",{imgs:l});this.dialog.close()},this))}});g.exports=h});M.define("/js/common/CommentPicUploader",function(c,b,e){var a=c("/js/module/uploader/Pluploader"),f=c("/js/common/CommentPicDialog"),d=c("dialog/alert");function g(h){this.trigger=h.trigger;this.commentPicDialog=null;this.commentPluploader=null;this.init()}M.mix(g.prototype,{settings:{runtimes:"html5,flash,html4",max_file_size:"8mb",url:"/interface/Iupload.php",flash_swf_url:"/swf/plupload/Moxie.swf",filters:[{title:"选择照片",extensions:"jpeg,jpg,gif,png,JPEG"}],file_data_name:"Filedata",multipart_params:{cat:"rbook_comment",rtype:"w290_h195"}},init:function(){this.commentPluploader=new a(this.trigger,this.settings,this.eventHandlers,this)},eventHandlers:{FilesAdded:function(h,i){this.commentPicDialog=new f({waiting:true,imgs:i});M.Event(this.commentPicDialog).on("img removed",$.proxy(function(j){this.commentPluploader.stop();this.commentPluploader.removeFile(j.file_id);this.commentPluploader.start()},this));M.Event(this.commentPicDialog).on("imgs committed",$.proxy(function(j){M.Event(this).fire("imgs committed",j)},this));this.commentPicDialog.show()},UploadProgress:function(h,i){M.Event(this.commentPicDialog).fire("img upload progress updated",i)},QueueChanged:function(h){setTimeout(function(){h.start()},500)},FileUploaded:function(h,i,k){var j=k.response.split(",");M.Event(this.commentPicDialog).fire("img upload finish",{id:i.id,imgstr:$.trim(j[0]),src:$.trim(j[2])})},Error:function(h,i){if(i.message=="File size error."){d.pop("请上传小于8M的图片")}M.error(i)}}});e.exports=g});M.define("/js/common/Comment",function(e,f,b){var c=e("StarRating"),k=e("InputListener"),a=e("Select"),h=e("dialog/alert"),g=e("dialog/BindMobileAlert"),l=e("dialog/confirm"),i=e("/js/common/CommentPicUploader"),j=e("/js/common/CommentPicDialog"),n='<dd class="_j_picitem" data-imgstr="${imgstr}" data-picid="${id}">                        <div class="place">                            <div class="img"><img class="_j_edit_src" src="${src}" style="width:120px;height:120px"></div>                            <div class="title"><h4 class="_j_edit_title">${title}</h4></div>                            <div class="mask-operate"><a class="btn-edit _j_edit_dd"></a><a class="btn-remove _j_remove_dd"></a></div>                        </div>                    </dd>';function d(o){this.container=$(o.container);this.delPicIds=[];this.init();M.Event.fire("comment form loaded",{poi_id:this.container.find('input[name="poiid"]').val()})}M.mix(d.prototype,{init:function(){this.bindEvents(this.container)},bindEvents:function(o){var q=o.find("._j_commentdialogform");var v=new c({context:o,blockSelector:"._j_rankblock",starCountSelector:"._j_starcount",starItemSelector:"._j_starlist a"});M.Event(v).on("onrating",function(z){var B=z.block,y=B.next("._j_startip"),A=B.find("._j_starlist a").eq(z.star-1).attr("title");y.text(A).data("originText",A);B.children("input").val(z.star)});M.Event(v).on("enterrating",function(z){var B=z.block,y=B.next("._j_startip"),A=B.find("._j_starlist a").eq(z.star-1).attr("title");y.text(A)});M.Event(v).on("leaverating",function(z){var A=z.block,y=A.next("._j_startip");y.text(y.data("originText"))});o.find("._j_rankblock").each(function(){if($(this).data("star")>0){var z=$(this).find("._j_starlist a").eq($(this).data("star")-1).attr("title");$(this).next("._j_startip").text(z)}var y=$(this).next("._j_startip");y.data("originText",y.text())});var p=o.find("._j_commentarea"),r=o.find("._j_commentcounttip");k.listen(p,function(y){m(r,$.trim(p.val()).length)});var w=new a({valueBox:o.find("._j_timevaluebox"),dropTrigger:o.find("._j_droptrigger"),dropListCnt:o.find("._j_timeselectdroplist")});o.find("._j_viewbox").click(function(y){if($(y.target).is("._j_viewbox")){setTimeout(function(){o.find("._j_droptrigger").trigger("click")},1)}});o.on("click","._j_radio",function(A){var B=$(A.currentTarget),z=B.attr("name"),y=$('input[name="'+z+'"]');if($(this).hasClass("on")){$(this).removeClass("on");y.val("")}else{$(this).addClass("on").siblings().removeClass("on");y.val($(this).data("value"))}});o.on("click","._j_checkbox","click",function(A){var B=$(A.currentTarget),z=B.attr("name");if($(this).hasClass("select")){$(this).removeClass("select")}else{$(this).addClass("select")}var y=[];$(this).siblings().add(this).filter(".select").each(function(){y.push($(this).data("value"))});$('input[name="'+z+'"]').val(y.join(","))});o.find("._j_needinitselect").each(function(){var A=$(this),z=A.data("type"),y=A.attr("name"),B=$.trim(A.val());if(B){if(z=="checkbox"){B=M.map(B.split(","),function(C){return +C})}$('._j_selectitem[name="'+y+'"]').each(function(){if(z=="checkbox"){if(M.indexOf(B,$(this).data("value"))!==-1){$(this).addClass("select")}}else{if(B==$(this).data("value")){$(this).addClass("on")}}})}});o.on("focus","._j_commentarea",function(y){if(!window.Env.MOBILE_BINDED){g.pop({title:"依《网络安全法》要求，你需要在发布内容之前绑定手机号~",assureWords:"去绑定"},function(z){if(z.data("btn_trigger")){location.href=window.Env.P_HTTP+"/setting/security/mobile/"}});y.preventDefault()}});o.on("click","._j_submit",function(y){q.submit()});var s=$("#_j_addpicbtns"),u=s.children("a"),x=new i({trigger:u}),t=q.find("._j_piclist");M.Event(x).on("imgs committed",function(y){var z=y.imgs.reverse();M.forEach(z,function(A){$.tmpl(n,A).insertAfter(s)});M.Event.fire("comment form add imgs")});M.Event.on("out img insert",function(y){var z=y.imgs.reverse();M.forEach(z,function(A){$.tmpl(n,A).insertAfter(s)});M.Event.fire("comment form add imgs")});t.on("click","._j_remove_dd",$.proxy(function(z){var A=$(z.currentTarget),y=A.closest("._j_picitem");l.pop("确认删除该图片吗？",$.proxy(function(){if(y.data("picid")>0){this.delPicIds.push(y.data("picid"))}y.remove()},this))},this)).on("click","._j_edit_dd",function(C){var D=$(C.currentTarget),y=D.closest("._j_picitem"),B=y.find("._j_edit_title"),A=y.find("._j_edit_src"),E=y.data("picid");var z=new j({edit:true,imgs:[{id:E,imgstr:y.data("imgstr"),src:A.attr("src"),title:B.text()}]});M.Event(z).on("imgs committed",function(F){var G=F.imgs;if(G.length==1&&G[0].id==E){B.text(G[0].title);$.post("/path/ajax.php",{act:"updateAlbum",id:E,title:G[0].title})}});z.show()});q.submit($.proxy(function(F){if(q.data("locking")){return false}F.preventDefault();var H=q.data("typeid"),B=q.serializeArray(),y=true;for(var D=0,E=B.length;D<E;D++){var I=B[D],C=$(q.get(0)[I.name]),G=$.trim(I.value);if(C.attr("essential")){if(!G){y=false;h.pop("请先完善"+C.data("inputname"));break}}if(C.data("minlen")){if(G.length<C.data("minlen")){y=false;h.pop(C.data("inputname")+"不能少于"+C.data("minlen")+"个字");break}}if(C.data("maxlen")){if(G.length>C.data("maxlen")){y=false;h.pop(C.data("inputname")+"不能超过"+C.data("maxlen")+"个字");break}}if(C.data("type")=="number"){G=+G;if(!M.is(G,"Number")&&!isNaN(G)){y=false;h.pop(C.data("inputname")+"需要填写数字");break}}}if(y){q.data("locking",true);if(this.delPicIds.length){if(!q.children('[name="del_aids"]').length){q.append('<input type="hidden" name="del_aids" value="" />')}q.children('[name="del_aids"]').val(this.delPicIds.join(","))}else{q.children('[name="del_aids"]').val("")}var z=q.find("._j_picitem"),A=[];z.each(function(J,K){K=$(K);if(!K.data("picid")){A.push({img:K.data("imgstr"),title:K.find("._j_edit_title").text()})}});if(A.length){if(!q.children('[name="add_imgs"]').length){q.append('<input type="hidden" name="add_imgs" value="" />')}q.children('[name="add_imgs"]').val(JSON.stringify(A))}else{q.children('[name="add_imgs"]').val("")}$.post(q.attr("action"),q.serialize(),function(J){if(!J.error&&J.data){var K=J.data;K.rank=q.get(0).rank.value;K.comment=q.get(0).comment.value;M.Event.fire("comment published",{info:K})}else{if(J.error){h.pop('<span style="padding:10px 30px; display:inline-block">'+(J.error.msg||"暂时无法点评，请稍后再试.")+"</a>")}}setTimeout(function(){q.data("locking",false)},100)},"json")}},this))}});function m(o,p){if(p>0&&p<15){o.css("color","#f00").text("还需要输入"+(15-p)+"个字")}else{if(p>2000){o.css("color","#f00").text("超出"+(p-2000)+"个字")}else{o.css("color","").text("15-1000个字，已输入"+p+"个字")}}}b.exports=d});M.define("TopTip",function(b,a,c){c.exports={show:function(d){var d=$('<div id="over_container"><div id="over_message">'+d+"</div></div>").appendTo("body");setTimeout(function(){d.hide("fast",function(){d.remove()})},3000)}}});M.define("PageAdmin",function(b){var e={},c=d();e.uuid=window.Env&&window.Env.uPageId||a();function a(){var f=c();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(h){var g=(f+Math.random()*16)%16|0;f=Math.floor(f/16);return(h==="x"?g:(g&3|8)).toString(16)})}function d(){var f=window.performance||{},g=f.now||f.mozNow||f.msNow||f.oNow||f.webkitNow||Date.now||function(){return new Date().getTime()};return g}return e});M.define("Storage",function(e,g,b){var n=document;var d=c();var f={_element:null,_expires:null,_file:document.location.hostname,init:function(){if(!this._element){try{this._element=n.createElement("input");this._element.type="hidden";this._element.addBehavior("#default#userData");n.body.appendChild(this._element);this.setItem("__detectUserDataStorage",1);this.removeItem("__detectUserDataStorage");return{setItem:this.setItem,getItem:this.getItem,removeItem:this.removeItem}}catch(p){M.error(p)}}return true},setItem:function(s,t,q){var p=j(q);this._element.expires=p.toUTCString();this._element.load(this._file);var r=a(this._element.getAttribute(s)),u=i(t,+p);this._element.setAttribute(s,u);this._element.save(this._file);k({key:s,newValue:u,oldValue:r,url:window.location.href})},getItem:function(p){this._element.load(this._file);var q=a(this._element.getAttribute(p));return q&&q.value},removeItem:function(p){this._element.load(this._file);this._element.removeAttribute(p);this._element.save(this._file)}};var l={setItem:function(r,s,q){if(!d){return}var p=j(q);localStorage.setItem(r,i(s,+p))},getItem:function(p){if(!d){return}var r=+new Date(),q=a(localStorage.getItem(p));if(q){if(r>q.timestamp){localStorage.removeItem(p);q=null}else{q=q.value}}return q},removeItem:function(p){if(!d){return}localStorage.removeItem(p)}};var h={},m={on:function(q,r){var p=h[q]||(h[q]=[]);p.push(r)},off:function(q,r){var p=h[q];if(!!p){if(!!r){M.forEach(p,function(t,s){if(t==r){p.splice(s,1)}})}else{p=[]}}return this}};M.mix(f,m);M.mix(l,m);if(window.addEventListener){window.addEventListener("storage",k,false)}else{if(window.attachEvent){window.attachEvent("onstorage",k)}}function k(u){if(!u){u=window.event}var p=M.mix({},u),w=u.newValue&&a(u.newValue),q=u.oldValue&&a(u.oldValue),v=+new Date();p.newValue=w&&w.value;if(!!q&&v<q.timestamp){p.oldValue=q.value}else{p.oldValue=null}var t=u.key,s=h[t],r=0;if(!t||!s||0===s.length){return}while(r<s.length){s[r++].call(window,p)}}function j(p){if(Object.prototype.toString.call(p)!="[object Date]"){var q=typeof p==="number"&&p>0?p:86400;p=new Date();p.setTime(+p+q*1000)}return p}function i(q,p){var r={value:q,timestamp:p};return JSON.stringify(r)}function a(p){if(p){try{p=JSON.parse(p);if(!("value" in p)||!("timestamp" in p)){p={value:p,timestamp:+j()}}}catch(q){p={value:p,timestamp:+j()}}}return p}function c(){if(window.localStorage){try{localStorage.setItem("__detectLocalStorage",1);localStorage.removeItem("__detectLocalStorage");return true}catch(p){return false}}return false}var o=window.localStorage?l:f.init();b.exports=M.mix(o,{isAvailable:c,isSupport:window.localStorage?d:("setItem" in o)})});M.define("Cookie",function(f,h,e){var g=/\+/g;var i=navigator.cookieEnabled;if(!i){document.cookie="__detectCookieEnabled=1;";i=document.cookie.indexOf("__detectCookieEnabled")!=-1?true:false;if(i){document.cookie="__detectCookieEnabled=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}}if(!i){return{isSupport:false}}var d={isSupport:true,set:function(m,n,k){k=(typeof k=="object"&&k!==null)?k:{};if(typeof k.expires==="number"){var o=k.expires,l=k.expires=new Date();l.setTime(+l+o*1000)}return(document.cookie=[j(m),"=",j(String(n)),k.expires?"; expires="+k.expires.toUTCString():"",k.path?"; path="+k.path:"",k.domain?"; domain="+k.domain:"",k.secure?"; secure":""].join(""))},get:function(q){var k=q?undefined:{};var r=document.cookie?document.cookie.split("; "):[];for(var p=0,m=r.length;p<m;p++){var s=r[p].split("=");var n=a(s.shift());var o=s.join("=");if(q&&q===n){k=b(o);break}if(!q&&(o=b(o))!==undefined){k[n]=o}}return k},remove:function(l,k){if(this.get(l)===undefined){return false}k=(typeof k=="object"&&k!==null)?k:{};k.expires=-1;this.set(l,"",k)}};function j(k){return encodeURIComponent(k)}function a(k){return decodeURIComponent(k)}function c(k){if(k.indexOf('"')===0){k=k.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{k=decodeURIComponent(k.replace(g," "));return k}catch(l){}}function b(k){var l=c(k);return l}e.exports=d});M.define("ResourceKeeper",function(d){var m=b();if(!m){return{isSupport:false}}var c=[];if(window.addEventListener){window.addEventListener("onbeforeunload",l,false)}else{if(window.attachEvent){window.attachEvent("onbeforeunload",l)}}function l(){M.forEach(c,function(n){n.release()})}var e=d("PageAdmin").uuid,j="default_resource",h="__resource_keeper",f=1000,k=2000;function a(n){n=""+n;n=n||j;this.keeping=false;this.resourceKeeperStorageKey=h+"_"+n;this.keepingRefreshInterval=0;this._initStorageListener();c.push(this)}M.mix(a.prototype,{keep:function(){this._requestKeep();return this.keeping},forceKeep:function(n){this._startKeep(n)},release:function(){if(this.keeping){var n=+new Date(),o=g(this.resourceKeeperStorageKey);if(o.currentKeeperPageUUID==e&&o.expire>n){m.remove(this.resourceKeeperStorageKey);this._setKeeping(false)}}},_initStorageListener:function(){M.Event(m).on("resource_keeper_change",M.bind(function(n){if(this.keeping&&n.key==this.resourceKeeperStorageKey&&n.pageUUID&&n.pageUUID!=e){this._setKeeping(false)}},this))},_requestKeep:function(){var n=+new Date(),o=g(this.resourceKeeperStorageKey);if(!o.currentKeeperPageUUID||o.currentKeeperPageUUID==e||o.expire<=n){this._startKeep(n)}else{this._setKeeping(false)}},_startKeep:function(n){n=n||+new Date();var o=n+k;m.set(this.resourceKeeperStorageKey,e+":"+o);this._setKeeping(true)},_setKeeping:function(n){this.keeping=n;if(this.keeping){this._startKeepingRefreshRequest()}else{this._stopKeepingRefreshRequest()}},_startKeepingRefreshRequest:function(){clearInterval(this.keepingRefreshInterval);this.keepingRefreshInterval=setInterval(M.bind(this._requestKeep,this),f)},_stopKeepingRefreshRequest:function(){clearInterval(this.keepingRefreshInterval)}});function b(){var o=null,p=d("Storage");if(p&&p.isSupport){o={set:M.bind(p.setItem,p),get:M.bind(p.getItem,p),remove:M.bind(p.removeItem,p)};if(window.addEventListener){window.addEventListener("storage",function(r){var q=r.key;if(q.indexOf(h)===0){var t="";if(r.newValue){var s=r.newValue.split(":");if(s.length==2){t=s[0]}}M.Event(o).fire("resource_keeper_change",{key:q,pageUUID:t})}},false)}}else{var n=d("Cookie");if(n&&n.isSupport){o={set:function(q,r){return n.set(q,r,k)},get:M.bind(n.get,n),remove:M.bind(n.remove,n)}}}return o}function g(p){var o={currentKeeperPageUUID:"",expire:0},n=m.get(p);if(n){n=n.split(":");o.currentKeeperPageUUID=n[0];o.expire=+n[1]}return o}function i(o){var n=new a(o);return{keep:M.bind(n.keep,n),forceKeep:M.bind(n.forceKeep,n),release:M.bind(n.release,n)}}i.isSupport=true;return i});(function(a){a.jGrowl=function(b,c){if(a("#jGrowl").size()==0){a('<div id="jGrowl"></div>').addClass((c&&c.position)?c.position:a.jGrowl.defaults.position).appendTo("body")}a("#jGrowl").jGrowl(b,c)};a.fn.jGrowl=function(b,d){if(a.isFunction(this.each)){var c=arguments;return this.each(function(){var e=this;if(a(this).data("jGrowl.instance")==undefined){a(this).data("jGrowl.instance",a.extend(new a.fn.jGrowl(),{notifications:[],element:null,interval:null}));a(this).data("jGrowl.instance").startup(this)}if(a.isFunction(a(this).data("jGrowl.instance")[b])){a(this).data("jGrowl.instance")[b].apply(a(this).data("jGrowl.instance"),a.makeArray(c).slice(1))}else{a(this).data("jGrowl.instance").create(b,d)}})}};a.extend(a.fn.jGrowl.prototype,{defaults:{pool:0,header:"",group:"",sticky:false,position:"top-right",glue:"after",theme:"default",themeState:"highlight",corners:"10px",check:250,life:3000,closeDuration:"normal",openDuration:"normal",easing:"swing",closer:true,closeTemplate:"&times;",closerTemplate:"<div>[ 关闭 ]</div>",log:function(c,b,d){},beforeOpen:function(c,b,d){},afterOpen:function(c,b,d){},open:function(c,b,d){},beforeClose:function(c,b,d){},close:function(c,b,d){},animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},notifications:[],element:null,interval:null,create:function(b,c){var c=a.extend({},this.defaults,c);if(typeof c.speed!=="undefined"){c.openDuration=c.speed;c.closeDuration=c.speed}this.notifications.push({message:b,options:c});c.log.apply(this.element,[this.element,b,c])},render:function(d){var b=this;var c=d.message;var e=d.options;var d=a('<div class="jGrowl-notification '+e.themeState+" ui-corner-all"+((e.group!=undefined&&e.group!="")?" "+e.group:"")+'"><div class="jGrowl-close">'+e.closeTemplate+'</div><div class="jGrowl-header">'+e.header+'</div><div class="jGrowl-message">'+c+"</div></div>").data("jGrowl",e).addClass(e.theme).children("div.jGrowl-close").bind("click.jGrowl",function(){a(this).parent().trigger("jGrowl.close")}).parent();a(d).bind("mouseover.jGrowl",function(){a("div.jGrowl-notification",b.element).data("jGrowl.pause",true)}).bind("mouseout.jGrowl",function(){a("div.jGrowl-notification",b.element).data("jGrowl.pause",false)}).bind("jGrowl.beforeOpen",function(){if(e.beforeOpen.apply(d,[d,c,e,b.element])!=false){a(this).trigger("jGrowl.open")}}).bind("jGrowl.open",function(){if(e.open.apply(d,[d,c,e,b.element])!=false){if(e.glue=="after"){a("div.jGrowl-notification:last",b.element).after(d)}else{a("div.jGrowl-notification:first",b.element).before(d)}a(this).animate(e.animateOpen,e.openDuration,e.easing,function(){if(a.browser.msie&&(parseInt(a(this).css("opacity"),10)===1||parseInt(a(this).css("opacity"),10)===0)){this.style.removeAttribute("filter")}a(this).data("jGrowl").created=new Date();a(this).trigger("jGrowl.afterOpen")})}}).bind("jGrowl.afterOpen",function(){e.afterOpen.apply(d,[d,c,e,b.element])}).bind("jGrowl.beforeClose",function(){if(e.beforeClose.apply(d,[d,c,e,b.element])!=false){a(this).trigger("jGrowl.close")}}).bind("jGrowl.close",function(){a(this).data("jGrowl.pause",true);a(this).animate(e.animateClose,e.closeDuration,e.easing,function(){a(this).remove();var f=e.close.apply(d,[d,c,e,b.element]);if(a.isFunction(f)){f.apply(d,[d,c,e,b.element])}})}).trigger("jGrowl.beforeOpen");if(e.corners!=""&&a.fn.corner!=undefined){a(d).corner(e.corners)}if(a("div.jGrowl-notification:parent",b.element).size()>1&&a("div.jGrowl-closer",b.element).size()==0&&this.defaults.closer!=false){a(this.defaults.closerTemplate).addClass("jGrowl-closer ui-state-highlight ui-corner-all").addClass(this.defaults.theme).appendTo(b.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){a(this).siblings().trigger("jGrowl.beforeClose");if(a.isFunction(b.defaults.closer)){b.defaults.closer.apply(a(this).parent()[0],[a(this).parent()[0]])}})}},update:function(){a(this.element).find("div.jGrowl-notification:parent").each(function(){if(a(this).data("jGrowl")!=undefined&&a(this).data("jGrowl").created!=undefined&&(a(this).data("jGrowl").created.getTime()+parseInt(a(this).data("jGrowl").life))<(new Date()).getTime()&&a(this).data("jGrowl").sticky!=true&&(a(this).data("jGrowl.pause")==undefined||a(this).data("jGrowl.pause")!=true)){a(this).trigger("jGrowl.beforeClose")}});if(this.notifications.length>0&&(this.defaults.pool==0||a(this.element).find("div.jGrowl-notification:parent").size()<this.defaults.pool)){this.render(this.notifications.shift())}if(a(this.element).find("div.jGrowl-notification:parent").size()<2){a(this.element).find("div.jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){a(this).remove()})}},startup:function(b){this.element=a(b).addClass("jGrowl").append('<div class="jGrowl-notification"></div>');this.interval=setInterval(function(){a(b).data("jGrowl.instance").update()},parseInt(this.defaults.check));if(a.browser.msie&&parseInt(a.browser.version)<7&&!window.XMLHttpRequest){a(this.element).addClass("ie6")}},shutdown:function(){a(this.element).removeClass("jGrowl").find("div.jGrowl-notification").remove();clearInterval(this.interval)},close:function(){a(this.element).find("div.jGrowl-notification").each(function(){a(this).trigger("jGrowl.beforeClose")})}});a.jGrowl.defaults=a.fn.jGrowl.prototype.defaults})(jQuery);if(window.M&&typeof window.M.define=="function"){window.M.define("jq-jgrowl",function(){return jQuery})}M.closure(function(e){var j=e("ResourceKeeper"),t=j.isSupport?new j("new_msg_loop"):null,s=e("Storage"),b=1000,r=10000,u=40000,d=120000;var v=(function(){if(j.isSupport){return $.proxy(t.keep,t)}else{return function(){return M.windowFocused}}}());var k=function(){if(j.isSupport){t.forceKeep()}};if("addEventListener" in window){window.addEventListener("focus",k,false)}else{if("attachEvent" in document){document.attachEvent("onfocusin",k)}}$(function(){if(window.Env&&window.Env.UID>0||window.__mfw_uid>0){setTimeout(n,b)}else{setTimeout(l,r)}$("body").delegate(".jGrowl-closer","click",function(x){$.getJSON("/ajax/ajax_msg.php",{a:"closetip"});s.setItem("jgrowl_close_time",+new Date())});M.Event.on("update msg",function(){setTimeout(function(){w();s.setItem("update_msg",+new Date())},1)});s.on("update_msg",function(x){w()});function w(){if(window.Env&&window.Env.UID>0||window.__mfw_uid>0){p("msgdisplay")}else{p("nologinfeed")}}});function n(){setInterval(function(){v()&&p("msgdisplay")},u)}function l(){var x,w=1;v()&&p("nologinfeed");x=setInterval(function(){v()&&p("nologinfeed");w++;if(w==3){clearInterval(x)}},d)}function p(w){$.get("/ajax/ajax_msg.php?a="+w,function(x){if(x){o(x)}},"json")}function o(w){g();M.Event.fire("get new msg",w);if(w.msg){m()}if(w.tips&&!i()){a(w)}}e("jq-jgrowl");function a(w){var x=w.tips.split(w.split_char);M.forEach(x,function(z,y){if(z){setTimeout(function(){$.jGrowl(z,{header:"新鲜事：",closer:false,life:20000})},2000*y+10)}})}function i(){var x=s.getItem("jgrowl_close_time"),w=+new Date();if(x&&w-x<24*60*60*1000){return true}return false}var c,f=0,h=1000,q=document.title;function m(){g();c=setInterval(function(){if(v()){f++;document.title=f%2===0?"【　　　】 - "+q:"【新消息】 - "+q}else{document.title=q}},h)}function g(){clearInterval(c);document.title=q}});M.define("FrequencyVerifyControl",function(c,b,d){function a(e){this.container=e.container;this.app=e.app;this.successHandler=$.noop;M.mix(this,e);this.init()}a.prototype={init:function(){this.initData();this.refreshImg();this.verifyCon.delegate("img,._j_change_img","click",$.proxy(function(e){this.refreshImg()},this));this.verifyCon.delegate("._j_fre_confirm","click",$.proxy(function(h){var g=this.verifyText.val();var f=g.length;if(f==0){this.showErro("您还没有输入验证码!");return false}else{if(f!==6){this.showErro("请输入正确的验证码!");return false}}var e=$(h.currentTarget);if(e.hasClass("waiting")){return false}e.addClass("waiting");$.post("/user/captcha/verify",{sCode:g,iApp:this.app},$.proxy(function(i){if(i){if(i.ret===1){this.successHandler(this.target);this.verifyCon.hide();this.hideErro()}else{if(i.ret===0){this.verifyText.val("");this.verifyText.focus();this.refreshImg();this.showErro("输入的验证码不正确!")}else{if(i.ret===-1){this.showErro("错误次数过多，请稍候尝试")}}}}e.removeClass("waiting")},this),"json")},this));this.verifyCon.delegate("._j_fre_text","keyup",$.proxy(function(e){if(e.keyCode==13){this.verifyCon.find("._j_fre_confirm").trigger("click")}},this))},showErro:function(e){this.errorCon.html(e);this.errorCon.show()},hideErro:function(){this.errorCon.hide()},initData:function(){this.verifyCon=this.container;this.verifyPo=this.verifyCon.find(".protectedYZM");this.verifyImg=this.verifyCon.find("img");this.verifyText=this.verifyCon.find("._j_fre_text");this.errorCon=this.verifyPo.find(".n-error")},refreshImg:function(){var e="/user/captcha/code?iApp="+this.app+"&s="+new Date().getTime();this.verifyImg.attr("src",e)}};d.exports=a});M.define("FrequencySystemVerify",function(f,e,g){var b=f("dialog/Dialog"),h=f("dialog/Layer"),d=f("FrequencyVerifyControl");var a='<div class="popYzm" style="z-index:inherit;position: relative;width:350px;height: 250px"><div class="protectedYZM" style="border: none;box-shadow: none;padding:25px 15px;"><p>亲爱的蜂蜂，你操作的速度有点像机器人<br>来证明下自己吧~</p><div class="YZMInput"><input class="_j_fre_text" type="text" placeHolder="验证码"></div><div class="YZMInput"><img src="http://images.mafengwo.net/images/home_new2015/verify.gif" width="150px" height="40px"><label><a href="javascript:void(0);" class="_j_change_img">看不清，换一张</a></label></div><div class="YZMSubmit"><a href="javascript:void(0);" class="_j_fre_confirm" title="确定">确定</a><span class="n-error">错误次数过多，请稍候尝试</span></div></div></div>';function c(i){this.app=i.app;this.init()}c.prototype={init:function(){var i=new b({content:a});if(h.getActive()){i.getLayer().setZIndex(h.getActive().getZIndex()+1)}i.show();var j=i.getPanel().find(".popYzm");new d({container:j,app:this.app,successHandler:$.proxy(function(){M.Event.fire("frequency:system:verify:success");i.close()},this)})}};g.exports=c});M.closure(function(d){var b=d("dialog/Dialog"),f=d("dialog/alert"),c=d("FrequencySystemVerify");window.show_login=a;$.ajaxSetup({dataFilter:function(i,h){try{var k=$.parseJSON(i);if(k&&k.unsafe==1){window.location.href="http://www.mafengwo.cn";return"{}"}if(k&&k.error&&k.error.msg=="login:required"){M.Event.fire("login:required");return"{}"}if(k&&k.error&&k.error.msg=="mobilebind:required"){f.pop({title:"依《网络安全法》要求，你需要在发布内容之前绑定手机号~",assureWords:"去绑定",hideCloser:true},function(m){location.href=window.Env.P_HTTP+"/setting/security/mobile/"});return{}}if(k&&k.resource&&k.resource.onload&&k.resource.onload.length){if(k.resource.onload[0]=='K.fire("login:required");'){M.Event.fire("login:required");return"{}"}}if(k&&k.error){var g=0;var l=0;if(typeof(k.error.errno)!=="undefined"){g=k.error.errno;l=k.error.error}else{if(typeof(k.error.code)!=="undefined"){g=k.error.code;l=k.error.msg}}if(g===10000){M.Event.fire("frequency:verify",l);return"{}"}}}catch(j){}return i},error:function(g){if(g.status==401){if(g.responseJSON&&g.responseJSON.data&&g.responseJSON.data.auth_type=="login"){M.Event.fire("login:required")}}}});var e=null;function a(){if($.browser.msie&&parseInt($.browser.version,10)<9){document.location.href=(window.Env&&window.Env.P_HTTP)||"https://passport.mafengwo.cn";return}if(!e){e=new b({PANEL_CLASS:"login_pop",content:'<iframe frameborder="no" border="0" scrolling="no" width="580" height="292" allowtransparency="true"></iframe>',background:"#aaa",bgOpacity:0.6,reposition:true,impl:"logindialog"})}e.show();if(!e.getPanel().find("iframe").attr("src")){M.Event(e).once("aftershow",function(){var g=window.Env.P_HTTP||"https://passport.mafengwo.cn";e.getPanel().find("iframe").attr("src",g+"/login-popup.html")})}}M.Event.on("login:required",a);M.Event.on("frequency:verify",function(g){new c({app:g})});if(M.Event.isFired("login:required")){a()}});M.define("ScrollObserver",function(e,g,c){var h=0,f={},a=false,b,d=true;g.addObserver=function(k){var j="ScrollObserver_"+h;h++;f[j]=k;d=false;return j};g.removeObserver=function(j){delete f[j];if(M.isEmpty(f)){d=true}};function i(){for(var j in f){if(f.hasOwnProperty(j)){f[j]()}}}$(window).scroll(function(){if(d){return}if(!a){b=setInterval(function(){if(a){a=false;clearTimeout(b);i()}},50)}a=true});return g});M.define("QRCode",function(b,a,c){c.exports={gen:function(e,d){var d={text:e,size:d.size||200,eclevel:d.evlevel||"H",logo:d.logo||"",__stk__:window.Env.CSTK};return"http://"+window.Env.WWW_HOST+"/qrcode.php?"+$.param(d)}}});M.closure(function(b){var l=b("ScrollObserver"),m=b("Storage"),d=window.Env||{},f=$("#_j_mfwtoolbar"),h=f.height(),a=$(window).height(),k=$(document).height(),g=$("#footer"),e=g.outerHeight();$("body").css("position","relative");$(window).resize(function(){a=$(window).height();k=$(document).height()});setInterval(function(){var n=$(document).height();if(n!=k){k=n;$(window).trigger("scroll")}},2000);if(!d.hideToolbar){if(!d.showToolbarDownArrow){f.children(".toolbar-item-down").remove()}else{f.children(".toolbar-item-down").show()}f.show();c();l.addObserver(c);f.on("click","._j_gotop",i);f.on("click","._j_gobottom",j);f.children(".toolbar-item-code").mouseenter(function(){$(this).addClass("hover")});f.children(".toolbar-item-code").mouseleave(function(){$(this).removeClass("hover")})}function c(){var n=$(window).scrollTop();if(n>500){f.children(".toolbar-item-top").show()}else{f.children(".toolbar-item-top").hide()}if(g.length){if(n+a>g.offset().top){f.css({position:"absolute",bottom:e+20})}else{f.css({position:"",bottom:""})}}}function i(){$("html, body").animate({scrollTop:0},500,function(){M.Event.fire("scroll to top")})}function j(){$("html, body").animate({scrollTop:k-a},500,function(){M.Event.fire("scroll to bottom")})}});(function(){var a=document.createElement("script"),b=window.Env&&window.Env.CNZZID||30065558;a.type="text/javascript";a.async=true;a.charset="utf-8";a.src=document.location.protocol+"//w.cnzz.com/c.php?id="+b+"&async=1";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c)})();M.closure(function(a){M.log("只要你有梦想，就加入我们\n你即将见证互联网最新趋势的快速成长\n马蜂窝的一切资源都会成为你成长路上的最大助力\n你可以和马蜂窝一起书写互联网的风云奇迹\n在这里有一群和你一样，疯狂地热爱互联网和旅行的人们\n马蜂窝能为你实现梦想提供最广阔的平台");M.log("请将简历发送至 %csuperhr@mafengwo.com%c（ 邮件标题请以“_console”结尾）","color:#4ae;","color:inherit;");M.log("职位介绍：http://www.mafengwo.cn/s/hr.html")});M.closure(function(a){$.get("/ajax/ajax_page_onload.php",{href:document.location.href,_t:+new Date()},function(b){if(b.payload&&b.payload.apps){var c=b.payload.apps;if(!M.isEmpty(c)){var d={css_list:c.css||[]};M.loadCssJsListSeq(d,function(){if(c.html){$("body").append(c.html)}if(c.js&&c.js.length){M.loadResource(c.js)}})}}},"json")});