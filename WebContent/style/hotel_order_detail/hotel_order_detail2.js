(function(b){function a(){this.defaults={submitClass:"submit",submitCallback:null,mainClass:"verification",loading:null,success:null,failed:null};this.allRules={phone:{regex:/^(\(\d{3,4}\)|\d{3,4}-)?\d{7,8}$/g},postcode:{regex:/^\d{6}$/g},mobile:{regex:[/^13\d{9}$/g,/^15\d{9}$/g,/^18\d{9}$/g,/^17\d{9}$/g,/^14\d{9}$/g]},email:{regex:/^([a-zA-Z0-9]+[_|\_|\.|\-]*)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]*)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/g}};this.original=null;this.options={};this.veriClass=[];this.cbf={};this.timer=null;this.init=function(e,d){var c=this;c.original=e;c.options=b.extend(true,{},c.defaults,d);c.append(e,d);delete c.options.loading;delete c.options.success;delete c.options.failed;if(("form"===e.nodeName.toLowerCase())){b(e).bind("submit.verification",function(){if(b(e).find('input[type="submit"]').hasClass("disabled")){return false}c.verifyFields();return c.manageSubmit()})}else{b(e).find("."+c.options.submitClass).click(function(){if(b(this).hasClass("disabled")){return false}c.verifyFields();return c.manageSubmit()})}};this.append=function(g,e){var d=this,h=false,c=b.extend({},d.defaults,e);for(var f=0;f<d.veriClass.length;f++){if(d.veriClass[f]==c.mainClass){h=true;break}}if(!h){d.veriClass.push(c.mainClass);d.cbf[c.mainClass]={loading:c.loading,success:c.success,failed:c.failed}}b(g).find("[class*="+c.mainClass+"][type=text],[class*="+c.mainClass+"][type=password]").each(function(){var i=b(this);if(i.data("mainClass")===undefined){i.data("mainClass",c.mainClass).bind("blur.verification",function(){d.verifyField(i)})}})};this.manageSubmit=function(){var c=this,e=true;for(var d=0;d<c.veriClass.length;d++){if(b(c.original).find("[class*="+c.veriClass[d]+"][data-verification-result=failed]").size()>0){e=false;break}else{if(b(c.original).find("[class*="+c.veriClass[d]+"][data-verification-result=loading]").size()>0){timer=setTimeout(function(){c.manageSubmit()},100)}else{if(b(c.original).find("[class*="+c.veriClass[d]+"]").size()===b(c.original).find("[class*="+c.veriClass[d]+"][data-verification-result=success]").size()){}else{e=false;break}}}}if(e){if(("form"===c.original.nodeName.toLowerCase())){if("function"===typeof c.options.submitCallback){c.options.submitCallback.call(c,c.original)}else{b(c.original).unbind("submit.verification").submit()}}else{c.options.submitCallback.call(c,c.original)}}return false};this.verifyFields=function(){var d=this,c=null;for(var e=0;e<d.veriClass.length;e++){b(d.original).find("[class*="+d.veriClass[e]+"]").each(function(){var f=b(this);if(c!==false){c=d.verifyField(f,"submit")}})}return c};this.verifyField=function(d,g){var r=this,m=d.data("mainClass"),f=d.attr("data-verification-name")?d.attr("data-verification-name"):"该项",s=d.attr("class"),h=new RegExp(m+"\\[(.*)\\]"),C=h.exec(s);if(!C){return false}var t=C[1],o=t.split(/\[|,|\]/),p=false;for(var y=0;y<o.length;y++){o[y]=o[y].replace(" ","");if(o[y]===""){delete o[y]}}for(var y=0;y<o.length;y++){switch(o[y]){case"required":p=true;if(!b.trim(d.val())||d.val()==d.attr("data-verification-placeholder")||d.val()==d.attr("placeholder")){d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,f+"不能为空",g)}return false}else{d.attr("data-verification-result","success");if("function"===typeof r.cbf[m].success){r.cbf[m].success.call(r,d)}}break;case"custom":var e=o[y+1],k=r.allRules[e],q;if(k){if(k.regex){if(k.regex.length){for(var w=0;w<k.regex.length;w++){if(false===q){break}var B=k.regex[w],A=new RegExp(B);if(p){q=(!A.test(d.val()))}else{q=(""!==b.trim(d.val())&&!A.test(d.val()))}}}else{var B=k.regex,A=new RegExp(B);if(p){q=(!A.test(d.val()))}else{q=(""!==b.trim(d.val())&&!A.test(d.val()))}}if(q){d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,f+"格式不正确",g)}return false}else{d.attr("data-verification-result","success");if("function"===typeof r.cbf[m].success){r.cbf[m].success.call(r,d)}}}else{if(k.func){}}}break;case"minSize":var v=o[y+1],z=d.val().length;if(z<v){d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,f+"不能小于"+v+"个字符",g)}return false}else{d.attr("data-verification-result","success");if("function"===typeof r.cbf[m].success){r.cbf[m].success.call(r,d)}}break;case"maxSize":var x=o[y+1],z=d.val().length;if(z>x){d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,f+"不能大于"+x+"个字符",g)}return false}else{d.attr("data-verification-result","success");if("function"===typeof r.cbf[m].success){r.cbf[m].success.call(r,d)}}break;case"equals":var G=o[y+1];if(d.val()!=b(r.original).find('input[name="'+G+'"]').val()){d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,"输入的"+f+"不一致",g)}return false}else{d.attr("data-verification-result","success");if("function"===typeof r.cbf[m].success){r.cbf[m].success.call(r,d)}}break;case"ajax":var F=o[y+1],E=d.val();switch(F){case"checkEmail":d.attr("data-verification-result","loading");if("function"===typeof r.cbf[m].loading){r.cbf[m].loading.call(r,d,"正在验证...")}b.post("/ajax/ajax_email.php",{email:E},function(i){if(i.ret==1){d.attr("data-verification-result","success");if("function"===typeof r.cbf[m].success){r.cbf[m].success.call(r,d)}return false}else{if(i.ret==2){d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,f+"格式不正确",g)}}else{if(i.ret==3){d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,f+"已经存在",g)}}}}},"json");break;case"checkMobile":d.attr("data-verification-result","loading");if("function"===typeof r.cbf[m].loading){r.cbf[m].loading.call(r,d,"正在验证...")}b.post("/ajax/ajax_mobile.php",{action:"verifymobile",mobile:E},function(i){if(i.ret==1){d.attr("data-verification-result","success");if("function"===typeof r.cbf[m].success){r.cbf[m].success.call(r,d)}return false}else{if(i.ret==3){d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,f+"格式不正确",g)}}else{if(i.ret==2){d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,f+"已经存在",g)}}}}},"json");break;case"checkMCode":d.attr("data-verification-result","loading");if("function"===typeof r.cbf[m].loading){r.cbf[m].loading.call(r,d,"正在验证...")}b.post("/ajax/ajax_mobile.php",{action:"nlmvc",mobile:b(r.original).find('input[name="'+o[y+2]+'"]').val(),v_code:E},function(i){if(i.ret==1){d.attr("data-verification-result","success");if("function"===typeof r.cbf[m].success){r.cbf[m].success.call(r,d)}return false}else{d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,f+"输入有误",g)}}},"json");break;case"checkCode":d.attr("data-verification-result","loading");if("function"===typeof r.cbf[m].loading){r.cbf[m].loading.call(r,d,"正在验证...")}b.post("/api/api.php?s=check_code",{code:E},function(i){if(""==i){d.attr("data-verification-result","success");if("function"===typeof r.cbf[m].success){r.cbf[m].success.call(r,d)}return false}else{d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,f+"输入有误",g)}}});break;default:break}break;case"funcCall":var D=o[y+1],u=o[y+2],l;if(~D.indexOf(".")){var n=D.split("."),c=window;while(n.length){c=c[n.shift()]}l=c}else{l=window[D]||r.options.customFuncs[D]}if("function"==typeof(l)){var q=l(d);if(q){d.attr("data-verification-result","success");if("function"===typeof r.cbf[m].success){r.cbf[m].success.call(r,d)}}else{d.attr("data-verification-result","failed");if("function"===typeof r.cbf[m].failed){r.cbf[m].failed.call(r,d,u,g)}return false}}break;case"customCall":var D=o[y+1],l;if(D.indexOf(".")>-1){var n=D.split("."),c=window;while(n.length){c=c[n.shift()]}l=c}else{l=window[D]||r.options.customFuncs[D]}if("function"==typeof(l)){var q=l(d);if(q){d.attr("data-verification-result","success")}else{d.attr("data-verification-result","failed")}}break;default:break}}}}b.verification={init:function(d,c){return d.each(function(){var e=b.extend(true,{},c),f;f=new a();f.init(this,e);b.data(this,"verification",f)})},append:function(d,c){return d.each(function(){var f=b.extend(true,{},c);var e=b(this).data("verification");e.append(this,f)})},verifyField:function(c,e){var d=c.data("verification");if(!d||!e.size()){return undefined}return d.verifyField(e)},verifyFields:function(c){var d=c.data("verification");if(!d){return undefined}return d.verifyFields()}};b.fn.verification=function(d){var c=arguments;if("undefined"!==typeof b.verification[d]){c=Array.prototype.concat.call([c[0]],[this],Array.prototype.slice.call(c,1));return b.verification[d].apply(b.verification,Array.prototype.slice.call(c,1))}else{if("object"===typeof d||!d){Array.prototype.unshift.call(c,this);return b.verification.init.apply(b.verification,c)}else{console.log('Method "'+d+'" does not exist in verification')}}}})(jQuery);(function(b,a){if(b.M&&typeof b.M.define==="function"){b.M.define("/youyudf/js/hotel/order_zx",function(d,c,e){var f=a(d);e.exports=f})}})(this,function(a){var b={loaded:false,api_url:"/hotel_zx/hotel/pay_ajax.php",cur_order_id:"",v_code:"",email:"",isNewEmail:"",pop_cancel:$("#pop_cancel"),pop_msg:$("#pop_message"),pop_resend:$("#pop_resend"),overlay:$("#overlay"),list_resend_btn:$("#email_info"),new_email_info:$("#new_email_info"),change_info_form:$("#change_info_form"),init:function(){$("#change_info_form").verification({submitCallback:function(){},success:function(c){c.removeClass("inp-err");c.next(".ok-tip").css({display:"inline-block"}).end();c.closest("div").find(".ok-tip").css({display:"inline-block"}).end();c.closest("dd").find(".err-tip").hide();c.closest("dd").find(".empty-tip").hide()},failed:function(d,c){d.next(".ok-tip").css({display:"none"}).end();d.closest("div").find(".ok-tip").css({display:"none"}).end();d.addClass("inp-err");if($.trim($(d).val())==""){if(d.closest(".name-in").find(".empty-tip").length>0){d.closest(".name-in").find(".err-tip").hide();d.closest(".name-in").find(".empty-tip").show()}else{d.closest("dd").find(".err-tip").hide();d.closest("dd").find(".empty-tip").show()}}else{if(d.closest(".name-in").find(".err-tip").length>0){d.closest(".name-in").find(".empty-tip").hide();d.closest(".name-in").find(".err-tip").show()}else{d.closest("dd").find(".empty-tip").hide();d.closest("dd").find(".err-tip").show()}}}});$(".operate").on("click","[name=btnOrderCancel]",function(){var e=$(this),c=a("dialog/confirm"),d=$(this).data("cancelinfo");c.pop('真的要取消此订单么？<br/><span style="font-size: 12px;">'+d+"</span>",function(){b.cur_order_id=e.data("order_id");b.v_code=e.data("vcode");b.cancel(b.cur_order_id,b.v_code)})});$(".row").on("click",".btn_cancel",function(){b.cancelPopHandle($(this))}).on("click",".btn_resend",function(){b.resendHandle($(this))}).on("mouseenter",".show_policy",function(){b.showCancelInfo($(this))}).on("mouseleave",".show_policy",function(){b.hideCancelInfo($(this))});this.pop_cancel.on("click",".yes",function(){b.cancelHandle()}).on("click",".no",function(){b.noCancelHandle()});this.pop_msg.on("click",".cancel_submit",function(){b.hideMsgPop()}).on("click",".close",function(){b.hideMsgPop()});this.pop_cancel.find(".close").click(function(){b.noCancelHandle()});this.pop_resend.on("click",".yes",function(){var c=$("#resend_newemail").val()!=""?$("#resend_newemail").val():b.email;var d=$(this).parents().find("[name=save_new_email]").attr("checked")?1:0;b.resendOkHandle(c,b.cur_order_id,b.v_code,d)}).on("click",".no",function(){b.noResendHandle()}).on("click","[name=newemail]",function(){b.newEmailHandle($(this))});this.pop_resend.find(".close").click(function(){b.noResendHandle()});this.list_resend_btn.on("click","[name=change_email]",function(){$("#email_info").hide();$("#new_email_info").show()}).on("click","[name=resend_email]",function(){var c=$("#email_info").data("email"),e=$("#email_info").data("order_id"),d=$("#email_info").data("vcode");b.resendOkHandle(c,e,d)});this.change_info_form.on("click","[name=saveNewContact]",function(){var e=$("#change_info_form").find("#ipt_email").val(),d=$("#change_info_form").find("#ipt_contact").val(),c=$("#change_info_form").find("#ipt_phone").val(),g=$("#email_info").data("order_id"),f=$("#email_info").data("vcode");b.saveContactInfo(e,c,d,g,f)}).on("click","[name=cancelNewContact]",function(){});this.new_email_info.on("click","[name=save_email]",function(){var c=$("#new_email_info").find("input[name=new_email]").val(),e=$("#email_info").data("order_id"),d=$("#email_info").data("vcode");b.saveOrderEmail(c,e,d)}).on("click","[name=save_send_email]",function(){var c=$("#new_email_info").find("input[name=new_email]").val(),e=$("#email_info").data("order_id"),d=$("#email_info").data("vcode");b.resendOkHandle(c,e,d,1)})},resendHandle:function(c){this.overlay.show();b.cur_order_id=c.data("order_id");b.v_code=c.data("v_code");b.email=c.data("email");this.pop_resend.show().find("[name=resend_email]").text(b.email);this.pop_resend.show().find("[name=newemail]").val(b.email)},cancelPopHandle:function(c){this.overlay.show();this.pop_cancel.show().find(".cancel_info").html(c.siblings(".cancel_info").html());b.cur_order_id=c.data("order_id");b.v_code=c.data("v_code")},noCancelHandle:function(){this.overlay.hide();this.pop_cancel.hide()},noResendHandle:function(){this.overlay.hide();this.pop_cancel.hide()},noResendHandle:function(){this.overlay.hide();this.pop_resend.hide()},newEmailHandle:function(d){if(b.isNewEmail==1){b.isNewEmail=0;d.parents().find("em[name=resend_email]").html(b.email);d.parents().find("[name=newemail]").html("使用其他邮箱")}else{var c=$("<input/>").attr("id","resend_newemail").val("");d.parents().find("em[name=resend_email]").html("").append(c);c.focus();b.isNewEmail=1;d.parents().find("[name=newemail]").html("使用原邮箱")}},resendOkHandle:function(d,g,f,c){var e={sOrderId:g,sVCode:f};e.sEmail=d;if(c){e.iSaveNew=1}$.getJSON(this.api_url+"?sAction=resendEmail",e,function(h){$("#pop_resend").hide();if(h&&h.ret==0){$("#sendmsgcontainer").html(h.msg);$("#sendmsgcontainer").closest(".hb-sent").show();b.showSuccPop(h.msg)}else{$("#sendmsgcontainer").html(h.msg);$("#sendmsgcontainer").closest(".hb-sent").show();b.showMsgPop(h.msg)}})},saveOrderEmail:function(c,f,e){var d={sOrderId:f,sVCode:e,sEmail:c};$.getJSON(this.api_url+"?sAction=saveNewEmail",d,function(g){if(g&&g.ret==0){window.location.reload()}else{b.showMsgPop(g.msg)}})},saveContactInfo:function(e,c,d,h,g){var f={sOrderId:h,sVCode:g,sEmail:e,sPhone:c,sName:d};$.getJSON(this.api_url+"?sAction=saveNewContact",f,function(i){if(i&&i.ret==0){window.location.reload()}else{b.showMsgPop(i.msg)}})},cancelHandle:function(){this.pop_cancel.hide();this.cancel(b.cur_order_id,b.v_code)},showSuccPop:function(c){this.pop_msg.find(".yes").click(function(){window.location.reload()});b.showMsgPop(c)},showMsgPop:function(c){this.overlay.show();this.pop_msg.show().find(".cancel_tips").text(c)},hideMsgPop:function(){this.overlay.hide();this.pop_msg.hide()},cancel:function(d,c){$.getJSON(this.api_url+"?sAction=cancelRooms",{sOrderId:d,sVCode:c},function(e){if(e&&e.ret==0){$("#msgcontainer").html(e.msg);$("#msgcontainer").closest(".hb-sent").show();b.showSuccPop(e.msg)}else{$("#msgcontainer").html(e.msg);$("#msgcontainer").closest(".hb-sent").show();b.showMsgPop(e.msg)}})},showCancelInfo:function(c){c.find(".cancel_info").show()},hideCancelInfo:function(c){c.find(".cancel_info").hide()}};return b});